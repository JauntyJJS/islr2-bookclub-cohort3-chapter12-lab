<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.11">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Jeremy Selva">
<title>Chapter 12 Lab</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><style>html{ scroll-behavior: smooth; }</style>
<script src="index_files/libs/core-js-2.5.3/shim.min.js"></script><script src="index_files/libs/react-17.0.0/react.min.js"></script><script src="index_files/libs/react-17.0.0/react-dom.min.js"></script><script src="index_files/libs/reactwidget-1.0.0/react-tools.js"></script><script src="index_files/libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="index_files/libs/reactable-binding-0.3.0/reactable.js"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#principal-components-analysis" id="toc-principal-components-analysis" class="nav-link active" data-scroll-target="#principal-components-analysis">Principal Components Analysis</a></li>
  <li>
<a href="#matrix-completion" id="toc-matrix-completion" class="nav-link" data-scroll-target="#matrix-completion">Matrix Completion</a>
  <ul class="collapse">
<li><a href="#initialisation" id="toc-initialisation" class="nav-link" data-scroll-target="#initialisation">Initialisation</a></li>
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions">Functions</a></li>
  <li><a href="#iteration-1" id="toc-iteration-1" class="nav-link" data-scroll-target="#iteration-1">Iteration 1</a></li>
  <li><a href="#the-rest-of-the-iteration" id="toc-the-rest-of-the-iteration" class="nav-link" data-scroll-target="#the-rest-of-the-iteration">The rest of the iteration</a></li>
  <li><a href="#softimpute" id="toc-softimpute" class="nav-link" data-scroll-target="#softimpute">SoftImpute</a></li>
  </ul>
</li>
  <li>
<a href="#k-means-clustering" id="toc-k-means-clustering" class="nav-link" data-scroll-target="#k-means-clustering">K-Means Clustering</a>
  <ul class="collapse">
<li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#exploration" id="toc-exploration" class="nav-link" data-scroll-target="#exploration">Exploration</a></li>
  </ul>
</li>
  <li><a href="#hierarchical-clustering" id="toc-hierarchical-clustering" class="nav-link" data-scroll-target="#hierarchical-clustering">Hierarchical Clustering</a></li>
  <li>
<a href="#nci60-data-example" id="toc-nci60-data-example" class="nav-link" data-scroll-target="#nci60-data-example">NCI60 Data Example</a>
  <ul class="collapse">
<li><a href="#pca-on-the-nci60-data" id="toc-pca-on-the-nci60-data" class="nav-link" data-scroll-target="#pca-on-the-nci60-data">PCA on the NCI60 Data</a></li>
  <li><a href="#clustering-on-nci60-dataset-base-r" id="toc-clustering-on-nci60-dataset-base-r" class="nav-link" data-scroll-target="#clustering-on-nci60-dataset-base-r">Clustering on NCI60 dataset (Base R)</a></li>
  <li><a href="#clustering-on-nci60-dataset-tidyclust" id="toc-clustering-on-nci60-dataset-tidyclust" class="nav-link" data-scroll-target="#clustering-on-nci60-dataset-tidyclust">Clustering on NCI60 dataset (tidyclust)</a></li>
  </ul>
</li>
  <li><a href="#blog-references" id="toc-blog-references" class="nav-link" data-scroll-target="#blog-references">Blog References</a></li>
  <li><a href="#package-references" id="toc-package-references" class="nav-link" data-scroll-target="#package-references">Package References</a></li>
  </ul></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><strong>Chapter 12 Lab</strong></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">This document was prepared on 2022-08-20.</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jeremy Selva </p>
          </div>
  </div>
    
    
  </div>
  

</header><details><summary>Code</summary><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Rmarkdown stuff</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(rmarkdown, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(knitr, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(htmltools, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(styler, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co"># Dataset</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">library</span>(ISLR2, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co"># Session info and package reporting</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="fu">library</span>(report, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co"># Data wrangling</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="fu">library</span>(dplyr, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="fu">library</span>(tidyr, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="fu">library</span>(magrittr, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="fu">library</span>(purrr, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="fu">library</span>(tibble, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="fu">library</span>(stringr, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-20"><a href="#cb1-20"></a></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="co"># Matrix Completion</span></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="fu">library</span>(softImpute, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="co"># Create interactive tables</span></span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="fu">library</span>(reactable, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="fu">library</span>(reactablefmtr, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-27"><a href="#cb1-27"></a></span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="co"># For plotting</span></span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="fu">library</span>(tidytext, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="fu">library</span>(scales, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="fu">library</span>(forcats, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="fu">library</span>(grid, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="fu">library</span>(ggplot2, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-34"><a href="#cb1-34"></a><span class="fu">library</span>(gridExtra, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-35"><a href="#cb1-35"></a><span class="fu">library</span>(grDevices, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-36"><a href="#cb1-36"></a><span class="fu">library</span>(cowplot, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-37"><a href="#cb1-37"></a><span class="fu">library</span>(ggforce, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-38"><a href="#cb1-38"></a></span>
<span id="cb1-39"><a href="#cb1-39"></a><span class="co"># For applying tidymodels</span></span>
<span id="cb1-40"><a href="#cb1-40"></a><span class="fu">library</span>(recipes, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-41"><a href="#cb1-41"></a><span class="co"># From GitHub remotes::install_github("tidymodels/parsnip")</span></span>
<span id="cb1-42"><a href="#cb1-42"></a><span class="fu">library</span>(parsnip, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-43"><a href="#cb1-43"></a><span class="fu">library</span>(broom, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-44"><a href="#cb1-44"></a><span class="fu">library</span>(yardstick, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-45"><a href="#cb1-45"></a></span>
<span id="cb1-46"><a href="#cb1-46"></a><span class="co"># For clustering</span></span>
<span id="cb1-47"><a href="#cb1-47"></a><span class="fu">library</span>(proxy, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-48"><a href="#cb1-48"></a><span class="fu">library</span>(factoextra, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-49"><a href="#cb1-49"></a><span class="fu">library</span>(cluster, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-50"><a href="#cb1-50"></a></span>
<span id="cb1-51"><a href="#cb1-51"></a><span class="co"># For tidy clustering</span></span>
<span id="cb1-52"><a href="#cb1-52"></a><span class="co"># From GitHub remotes::install_github("tidymodels/workflows@celery")</span></span>
<span id="cb1-53"><a href="#cb1-53"></a><span class="fu">library</span>(workflows, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-54"><a href="#cb1-54"></a><span class="fu">library</span>(rsample, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-55"><a href="#cb1-55"></a><span class="fu">library</span>(tune, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-56"><a href="#cb1-56"></a><span class="fu">library</span>(dials, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-57"><a href="#cb1-57"></a><span class="fu">library</span>(tidyclust, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-58"><a href="#cb1-58"></a><span class="fu">library</span>(Rfast, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-59"><a href="#cb1-59"></a><span class="fu">library</span>(flexclust, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-60"><a href="#cb1-60"></a></span>
<span id="cb1-61"><a href="#cb1-61"></a><span class="fu">summary</span>(report<span class="sc">::</span><span class="fu">report</span>(<span class="fu">sessionInfo</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><p>The analysis was done using the R Statistical language (v4.2.1; R Core Team, 2022) on Windows 10 x64, using the packages Rcpp (v1.0.9), ggplot2 (v3.3.6), rmarkdown (v2.14), cluster (v2.1.3), report (v0.5.1), lattice (v0.20.45), tidytext (v0.3.3), flexclust (v1.4.1), knitr (v1.39), broom (v1.0.0), cowplot (v1.1.1), dials (v1.0.0), dplyr (v1.0.9), factoextra (v1.0.7), forcats (v0.5.1), ggforce (v0.3.3), gridExtra (v2.3), htmltools (v0.5.2), ISLR2 (v1.3.1), magrittr (v2.0.3), Matrix (v1.4.1), modeltools (v0.2.23), parsnip (v1.0.0.9000), proxy (v0.4.27), purrr (v0.3.4), RcppZiggurat (v0.1.6), reactable (v0.3.0), reactablefmtr (v2.0.0), recipes (v1.0.1), Rfast (v2.0.6), rsample (v1.1.0), scales (v1.2.0), softImpute (v1.4.1), stringr (v1.4.0), styler (v1.7.0), tibble (v3.1.8), tidyclust (v0.0.0.9000), tidyr (v1.2.0), tune (v1.0.0), workflows (v1.0.0.9000) and yardstick (v1.0.0).</p>
<section id="principal-components-analysis" class="level1"><h1>Principal Components Analysis</h1>
<p>The <a href="https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/USArrests.html"><code>USArrests</code></a> data set from the <code>datasets</code> package contains statistics, in arrests per 100,000 residents for assault, murder, and rape in each of the 50 US states in 1973. Also given is the percent of the population living in urban areas.</p>
<table class="table">
<thead><tr class="header">
<th>Column Name</th>
<th>Column Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>Murder</code></td>
<td>Number of arrests for murder (per 100,000)</td>
</tr>
<tr class="even">
<td><code>Assault</code></td>
<td>Number of arrests for assault (per 100,000)</td>
</tr>
<tr class="odd">
<td><code>UrbanPop</code></td>
<td>Percent of the population living in urban areas</td>
</tr>
<tr class="even">
<td><code>Rape</code></td>
<td>Number of arrests for rape (per 100,000)</td>
</tr>
</tbody>
</table>
<p>Turn <a href="https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/USArrests.html"><code>USArrests</code></a> into a tibble and move the rownames into a column.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>USArrests <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>(datasets<span class="sc">::</span>USArrests,</span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="at">rownames =</span> <span class="st">"state"</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>)</span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a>USArrests <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(</span>
<span id="cb2-7"><a href="#cb2-7"></a>    <span class="at">defaultPageSize =</span> <span class="dv">5</span>,</span>
<span id="cb2-8"><a href="#cb2-8"></a>    <span class="at">filterable =</span> <span class="cn">TRUE</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-d98e9c7a0adba765966e" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d98e9c7a0adba765966e">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"state":["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"],"Murder":[13.2,10,8.1,8.8,9,7.9,3.3,5.9,15.4,17.4,5.3,2.6,10.4,7.2,2.2,6,9.7,15.4,2.1,11.3,4.4,12.1,2.7,16.1,9,6,4.3,12.2,2.1,7.4,11.4,11.1,13,0.8,7.3,6.6,4.9,6.3,3.4,14.4,3.8,13.2,12.7,3.2,2.2,8.5,4,5.7,2.6,6.8],"Assault":[236,263,294,190,276,204,110,238,335,211,46,120,249,113,56,115,109,249,83,300,149,255,72,259,178,109,102,252,57,159,285,254,337,45,120,151,159,106,174,279,86,188,201,120,48,156,145,81,53,161],"UrbanPop":[58,48,80,50,91,78,77,72,80,60,83,54,83,65,57,66,52,66,51,67,85,74,66,44,70,53,62,81,56,89,70,86,45,44,75,68,67,72,87,48,45,59,80,80,32,63,73,39,66,60],"Rape":[21.2,44.5,31,19.5,40.6,38.7,11.1,15.8,31.9,25.8,20.2,14.2,24,21,11.3,18,16.3,22.2,7.8,27.8,16.3,35.1,14.9,17.1,28.2,16.4,16.5,46,9.5,18.8,32.1,26.1,16.1,7.3,21.4,20,29.3,14.9,8.3,22.5,12.8,26.9,25.5,22.9,11.2,20.7,26.2,9.3,10.8,15.6]},"columns":[{"accessor":"state","name":"state","type":"character"},{"accessor":"Murder","name":"Murder","type":"numeric"},{"accessor":"Assault","name":"Assault","type":"numeric"},{"accessor":"UrbanPop","name":"UrbanPop","type":"numeric"},{"accessor":"Rape","name":"Rape","type":"numeric"}],"filterable":true,"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"ee5c0b0bf943f1bab5f69de52fe556fd"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We create a recipe with <a href="https://recipes.tidymodels.org/reference/recipe.html"><code>recipes::recipe</code></a>, <a href="https://recipes.tidymodels.org/reference/has_role.html"><code>recipes::all_numeric_predictors()</code></a>, <a href="https://recipes.tidymodels.org/reference/step_normalize.html"><code>recipes::step_normalize</code></a> and <a href="https://recipes.tidymodels.org/reference/step_pca.html"><code>recipes::step_pca</code></a></p>
<p>By default, <a href="https://recipes.tidymodels.org/reference/step_pca.html"><code>recipes::step_pca</code></a> uses <a href="https://rdrr.io/r/stats/prcomp.html"><code>stats::prcomp</code></a> with the argument defaults set to <code>retx = FALSE</code>, <code>center = FALSE</code>, <code>scale. = FALSE</code>, and <code>tol = NULL</code>.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>pca_recipe <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(</span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="at">formula =</span> <span class="sc">~</span>.,</span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="at">data =</span> USArrests</span>
<span id="cb3-4"><a href="#cb3-4"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>  recipes<span class="sc">::</span><span class="fu">step_normalize</span>(recipes<span class="sc">::</span><span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>  recipes<span class="sc">::</span><span class="fu">step_pca</span>(recipes<span class="sc">::</span><span class="fu">all_numeric_predictors</span>(),</span>
<span id="cb3-7"><a href="#cb3-7"></a>    <span class="at">id =</span> <span class="st">"pca"</span>,</span>
<span id="cb3-8"><a href="#cb3-8"></a>    <span class="at">num_comp =</span> <span class="dv">4</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>  )</span>
<span id="cb3-10"><a href="#cb3-10"></a></span>
<span id="cb3-11"><a href="#cb3-11"></a>pca_recipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt; Recipe
&gt; 
&gt; Inputs:
&gt; 
&gt;       role #variables
&gt;  predictor          5
&gt; 
&gt; Operations:
&gt; 
&gt; Centering and scaling for recipes::all_numeric_predictors()
&gt; PCA extraction with recipes::all_numeric_predictors()</code></pre>
</div>
</div>
<p>Apply <a href="https://recipes.tidymodels.org/reference/prep.html"><code>recipes::prep</code></a> and <a href="https://recipes.tidymodels.org/reference/bake.html"><code>recipes::bake</code></a> to compute the scores of the principal component analysis.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>pca_estimates <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">prep</span>(<span class="at">x =</span> pca_recipe, <span class="at">training =</span> USArrests)</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a>pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="fu">summary</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-9fece82aa863f2ca89f8" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9fece82aa863f2ca89f8">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"variable":["state","PC1","PC2","PC3","PC4"],"type":["nominal","numeric","numeric","numeric","numeric"],"role":["predictor","predictor","predictor","predictor","predictor"],"source":["original","derived","derived","derived","derived"]},"columns":[{"accessor":"variable","name":"variable","type":"character"},{"accessor":"type","name":"type","type":"character"},{"accessor":"role","name":"role","type":"character"},{"accessor":"source","name":"source","type":"character"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"6e91998c92184158f224b83a8ee51f5c"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>pca_score <span class="ot">&lt;-</span> pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>  recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data =</span> USArrests)</span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a></span>
<span id="cb6-5"><a href="#cb6-5"></a>pca_score <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-2a208346ba466fd607b0" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2a208346ba466fd607b0">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"state":["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"],"PC1":[-0.975660448333605,-1.93053787851368,-1.7454428533906,0.139998944348595,-2.49861284825858,-1.49934073746552,1.34499236494685,-0.0472298063468948,-2.98275966985053,-1.62280741822275,0.903484479467486,1.62331903335491,-1.36505197344764,0.500381218467362,2.23099578556003,0.788872062457507,0.743312560502576,-1.54909076342142,2.37274013811147,-1.74564663331427,0.481280070041076,-2.08725024890209,1.67566950509684,-0.986479185336293,-0.689784263994372,1.17353751396927,1.25291625304513,-2.84550541798477,2.35995585210981,-0.179741278311773,-1.96012351316822,-1.66566662172248,-1.1120880825676,2.96215223250691,0.223694355497657,0.308649279454715,-0.0585278699811304,0.879486795199492,0.855090717007698,-1.30744986085371,1.96779669368699,-0.989693774325593,-1.34151838166781,0.545031802555006,2.77325613354972,0.0953666966000219,0.214723389834347,2.08739305667661,2.05881198847966,0.623100606853615],"PC2":[1.12200121043341,1.06242691953445,-0.738459537284998,1.10854225950591,-1.52742672082479,-0.977629656524983,-1.07798361522603,-0.322088902660565,0.0388342468594005,1.26608838405527,-1.5546760937372,0.208852532733397,-0.674988339762984,-0.15003926151727,-0.103008276406122,-0.26744941274229,0.948807476193182,0.862300114746539,0.372608650017808,0.423357040829031,-1.45967706049893,-0.153835002114751,-0.625906704885262,2.36973712490675,-0.260707941347262,0.531478512267081,-0.192004396467082,-0.767805021353822,-0.0179005535270807,-1.43493744559758,0.141413077722027,-0.814910724517094,2.20561081445927,0.593097376917541,-0.734778367024732,-0.284961125167963,-0.535969994536816,-0.565360504607016,-1.47698328409526,1.91397296672008,0.815068224564379,0.851605343482672,-0.408335177969947,-1.45671524192276,1.38819435019003,0.197727848353299,-0.96037394381938,1.41052627218446,-0.605125065136858,0.317786624600862],"PC3":[-0.439803661285308,2.01950026646312,0.0542302493041439,0.113422168237126,0.592540999822734,1.08400161730102,-0.636792504557458,-0.711410317476905,-0.571032063384345,-0.339018182441255,0.0502715101850594,0.257190207094087,-0.67068646668843,0.225762771685342,0.162910360689878,0.0252964835338013,-0.0280842899738024,-0.775605983902665,-0.0650222451647877,-0.155669683777991,-0.603371717432899,0.381000459848847,0.151531999008798,-0.733362895630957,0.373650325294524,0.24440795843879,0.173809299774826,1.15168793167263,0.0364849778030574,-0.756770405899406,0.181845980098329,-0.636611862705565,-0.854892453821196,0.298249295679023,-0.0308261575802543,-0.0151559209906673,0.93038717956119,-0.39660218459394,-1.35617704965637,-0.297517232661885,0.385380733990227,0.186192620111975,-0.487123316812341,0.290775921276225,0.832807974162781,0.0115948248606322,0.618590668566375,0.103721632649936,-0.137469334136036,-0.238240486540007],"PC4":[0.154696580989146,-0.434175454303896,-0.826264239801615,-0.180973554221139,-0.338559240016013,0.00145016417331417,-0.117278736453347,-0.873113315397408,-0.0953170415226173,1.0659744588473,0.893733197875069,-0.494087851596784,-0.120794915862928,0.420397595093737,0.0173794698618796,0.204421034012508,0.663817237387495,0.450157791160094,-0.327138528652024,-0.553450589329408,-0.177793902098926,0.101343127922466,0.0666403161862511,0.213342048615757,0.223554810984365,0.122498554824023,0.0157331562329184,0.311354436061526,-0.0328042905621796,0.24093658013601,-0.336121112660172,-0.0133488441510547,-0.944789648490357,-0.2514346260662,0.469152816519226,0.0102284757257057,-0.235390871768678,0.355452377666657,-0.607402746333083,-0.130145377915021,-0.108470512331233,0.646302674061503,0.63673105088016,-0.0814867491743086,-0.143433696715143,0.209246429496956,-0.218628160905838,0.130583080145005,0.182253407200314,-0.164976865730025]},"columns":[{"accessor":"state","name":"state","type":"factor"},{"accessor":"PC1","name":"PC1","type":"numeric"},{"accessor":"PC2","name":"PC2","type":"numeric"},{"accessor":"PC3","name":"PC3","type":"numeric"},{"accessor":"PC4","name":"PC4","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"3aefd4bbae190ab377f7e1728128aa03"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We can explore the results of the PCA using the <a href="https://recipes.tidymodels.org/reference/prep.html"><code>recipes::prep</code></a> and <a href="https://parsnip.tidymodels.org/reference/tidy.model_fit.html"><code>parsnip::tidy</code></a>. We can see that pca is done at step number 2</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>  parsnip<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-fa4880e58b723ca706d3" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-fa4880e58b723ca706d3">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"number":[1,2],"operation":["step","step"],"type":["normalize","pca"],"trained":[true,true],"skip":[false,false],"id":["normalize_JQGWs","pca"]},"columns":[{"accessor":"number","name":"number","type":"numeric"},{"accessor":"operation","name":"operation","type":"character"},{"accessor":"type","name":"type","type":"character"},{"accessor":"trained","name":"trained","type":"logical"},{"accessor":"skip","name":"skip","type":"logical"},{"accessor":"id","name":"id","type":"character"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"5703bec80466a0d8a257d4e0eb93a169"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>As such, we extract the pca loadings of the pca step.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>tidied_pca_loadings <span class="ot">&lt;-</span> pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>  parsnip<span class="sc">::</span><span class="fu">tidy</span>(<span class="at">id =</span> <span class="st">"pca"</span>, <span class="at">type =</span> <span class="st">"coef"</span>)</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a></span>
<span id="cb8-5"><a href="#cb8-5"></a>tidied_pca_loadings <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-c5f64f06b6dec86431bd" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c5f64f06b6dec86431bd">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"terms":["Murder","Assault","UrbanPop","Rape","Murder","Assault","UrbanPop","Rape","Murder","Assault","UrbanPop","Rape","Murder","Assault","UrbanPop","Rape"],"value":[-0.535899474938155,-0.583183634909671,-0.278190874619433,-0.543432091445683,0.418180865420955,0.187985604231939,-0.872806193060425,-0.167318635401746,-0.341232727952828,-0.268148427832886,-0.378015793086999,0.817777907626166,0.649227804341945,-0.743407479936709,0.133877730824248,0.089024322703624],"component":["PC1","PC1","PC1","PC1","PC2","PC2","PC2","PC2","PC3","PC3","PC3","PC3","PC4","PC4","PC4","PC4"],"id":["pca","pca","pca","pca","pca","pca","pca","pca","pca","pca","pca","pca","pca","pca","pca","pca"]},"columns":[{"accessor":"terms","name":"terms","type":"character"},{"accessor":"value","name":"value","type":"numeric"},{"accessor":"component","name":"component","type":"character"},{"accessor":"id","name":"id","type":"character"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"25485c5aa45c49d89a615e39517fc508"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We make a visualization to see how the loadings of the four components look like</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>tidied_pca_loadings <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(.data[[<span class="st">"component"</span>]] <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>, <span class="st">"PC4"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">component =</span> forcats<span class="sc">::</span><span class="fu">fct_inorder</span>(.data[[<span class="st">"component"</span>]])) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb9-5"><a href="#cb9-5"></a>    <span class="at">x =</span> .data[[<span class="st">"value"</span>]],</span>
<span id="cb9-6"><a href="#cb9-6"></a>    <span class="at">y =</span> .data[[<span class="st">"terms"</span>]],</span>
<span id="cb9-7"><a href="#cb9-7"></a>    <span class="at">fill =</span> .data[[<span class="st">"terms"</span>]]</span>
<span id="cb9-8"><a href="#cb9-8"></a>  )) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> ggplot2<span class="sc">::</span><span class="fu">vars</span>(.data[[<span class="st">"component"</span>]])) <span class="sc">+</span></span>
<span id="cb9-11"><a href="#cb9-11"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="3883"></p>
</div>
</div>
<p>Let us take a closer look at the four variables that contribute to the four components</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>tidied_pca_loadings <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(.data[[<span class="st">"component"</span>]] <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>, <span class="st">"PC4"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(.data[[<span class="st">"component"</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>  dplyr<span class="sc">::</span><span class="fu">top_n</span>(<span class="dv">4</span>, <span class="fu">abs</span>(.data[[<span class="st">"value"</span>]])) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb10-7"><a href="#cb10-7"></a>    <span class="at">terms =</span> tidytext<span class="sc">::</span><span class="fu">reorder_within</span>(</span>
<span id="cb10-8"><a href="#cb10-8"></a>      <span class="at">x =</span> .data[[<span class="st">"terms"</span>]],</span>
<span id="cb10-9"><a href="#cb10-9"></a>      <span class="at">by =</span> <span class="fu">abs</span>(.data[[<span class="st">"value"</span>]]),</span>
<span id="cb10-10"><a href="#cb10-10"></a>      <span class="at">within =</span> .data[[<span class="st">"component"</span>]]</span>
<span id="cb10-11"><a href="#cb10-11"></a>    )</span>
<span id="cb10-12"><a href="#cb10-12"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-13"><a href="#cb10-13"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb10-14"><a href="#cb10-14"></a>    <span class="at">x =</span> <span class="fu">abs</span>(.data[[<span class="st">"value"</span>]]),</span>
<span id="cb10-15"><a href="#cb10-15"></a>    <span class="at">y =</span> .data[[<span class="st">"terms"</span>]],</span>
<span id="cb10-16"><a href="#cb10-16"></a>    <span class="at">fill =</span> .data[[<span class="st">"value"</span>]] <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb10-17"><a href="#cb10-17"></a>  )) <span class="sc">+</span></span>
<span id="cb10-18"><a href="#cb10-18"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb10-19"><a href="#cb10-19"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(</span>
<span id="cb10-20"><a href="#cb10-20"></a>    <span class="at">facets =</span> ggplot2<span class="sc">::</span><span class="fu">vars</span>(.data[[<span class="st">"component"</span>]]),</span>
<span id="cb10-21"><a href="#cb10-21"></a>    <span class="at">scales =</span> <span class="st">"free_y"</span></span>
<span id="cb10-22"><a href="#cb10-22"></a>  ) <span class="sc">+</span></span>
<span id="cb10-23"><a href="#cb10-23"></a>  tidytext<span class="sc">::</span><span class="fu">scale_y_reordered</span>() <span class="sc">+</span></span>
<span id="cb10-24"><a href="#cb10-24"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb10-25"><a href="#cb10-25"></a>    <span class="at">x =</span> <span class="st">"Absolute value of contribution to PCA component"</span>,</span>
<span id="cb10-26"><a href="#cb10-26"></a>    <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb10-27"><a href="#cb10-27"></a>    <span class="at">fill =</span> <span class="st">"Positive?"</span></span>
<span id="cb10-28"><a href="#cb10-28"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="3883"></p>
</div>
</div>
<p>How much variation are we capturing for each component?</p>
<p>Here is how we can see the variance statistics but it is in a long form</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>tidied_pca_variance <span class="ot">&lt;-</span> pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>  parsnip<span class="sc">::</span><span class="fu">tidy</span>(<span class="at">id =</span> <span class="st">"pca"</span>, <span class="at">type =</span> <span class="st">"variance"</span>)</span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a>tidied_pca_variance <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-5f9d1ca4c350a0262967" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5f9d1ca4c350a0262967">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"terms":["variance","variance","variance","variance","cumulative variance","cumulative variance","cumulative variance","cumulative variance","percent variance","percent variance","percent variance","percent variance","cumulative percent variance","cumulative percent variance","cumulative percent variance","cumulative percent variance"],"value":[2.48024157914949,0.98976515253984,0.35656318058083,0.173430087729835,2.48024157914949,3.47000673168933,3.82656991227016,4,62.0060394787374,24.744128813496,8.91407951452075,4.33575219324588,62.0060394787374,86.7501682922334,95.6642478067541,100],"component":[1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4],"id":["pca","pca","pca","pca","pca","pca","pca","pca","pca","pca","pca","pca","pca","pca","pca","pca"]},"columns":[{"accessor":"terms","name":"terms","type":"character"},{"accessor":"value","name":"value","type":"numeric"},{"accessor":"component","name":"component","type":"numeric"},{"accessor":"id","name":"id","type":"character"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"2f4c600b0629a40272bae17ea910afd3"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Here is how we can see the variance statistics in its wide form</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>tidied_pca_variance <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb12-3"><a href="#cb12-3"></a>    <span class="at">names_from =</span> .data[[<span class="st">"component"</span>]],</span>
<span id="cb12-4"><a href="#cb12-4"></a>    <span class="at">values_from =</span> .data[[<span class="st">"value"</span>]],</span>
<span id="cb12-5"><a href="#cb12-5"></a>    <span class="at">names_prefix =</span> <span class="st">"PC"</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>dplyr<span class="sc">::</span><span class="fu">all_of</span>(<span class="st">"id"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-473eecac8600994fc061" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-473eecac8600994fc061">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"terms":["variance","cumulative variance","percent variance","cumulative percent variance"],"PC1":[2.48024157914949,2.48024157914949,62.0060394787374,62.0060394787374],"PC2":[0.98976515253984,3.47000673168933,24.744128813496,86.7501682922334],"PC3":[0.35656318058083,3.82656991227016,8.91407951452075,95.6642478067541],"PC4":[0.173430087729835,4,4.33575219324588,100]},"columns":[{"accessor":"terms","name":"terms","type":"character"},{"accessor":"PC1","name":"PC1","type":"numeric"},{"accessor":"PC2","name":"PC2","type":"numeric"},{"accessor":"PC3","name":"PC3","type":"numeric"},{"accessor":"PC4","name":"PC4","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"f33c14a75b5f2f07ae8eef1e7c069667"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Here is a simple plot to show the variance captured for each component</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Get the variance</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>percent_variation <span class="ot">&lt;-</span> tidied_pca_variance <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(.data[[<span class="st">"terms"</span>]] <span class="sc">==</span> <span class="st">"percent variance"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(.data[[<span class="st">"value"</span>]])</span>
<span id="cb13-5"><a href="#cb13-5"></a></span>
<span id="cb13-6"><a href="#cb13-6"></a>percent_variation <span class="ot">&lt;-</span> percent_variation <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb13-7"><a href="#cb13-7"></a></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="co"># I use [1:4] to select the first four components</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>dplyr<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb13-10"><a href="#cb13-10"></a>  <span class="at">component =</span> <span class="fu">unique</span>(tidied_pca_loadings<span class="sc">$</span>component)[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>],</span>
<span id="cb13-11"><a href="#cb13-11"></a>  <span class="at">percent_var =</span> percent_variation[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb13-12"><a href="#cb13-12"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb13-13"><a href="#cb13-13"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">component =</span> forcats<span class="sc">::</span><span class="fu">fct_inorder</span>(.data[[<span class="st">"component"</span>]])) <span class="sc">%&gt;%</span></span>
<span id="cb13-14"><a href="#cb13-14"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb13-15"><a href="#cb13-15"></a>    <span class="at">x =</span> .data[[<span class="st">"component"</span>]],</span>
<span id="cb13-16"><a href="#cb13-16"></a>    <span class="at">y =</span> .data[[<span class="st">"percent_var"</span>]]</span>
<span id="cb13-17"><a href="#cb13-17"></a>  )) <span class="sc">+</span></span>
<span id="cb13-18"><a href="#cb13-18"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb13-19"><a href="#cb13-19"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb13-20"><a href="#cb13-20"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb13-21"><a href="#cb13-21"></a>      <span class="at">label =</span> <span class="fu">paste</span>(<span class="fu">round</span>(.data[[<span class="st">"percent_var"</span>]] <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">0</span>), <span class="st">"%"</span>)</span>
<span id="cb13-22"><a href="#cb13-22"></a>    ),</span>
<span id="cb13-23"><a href="#cb13-23"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span></span>
<span id="cb13-24"><a href="#cb13-24"></a>  ) <span class="sc">+</span></span>
<span id="cb13-25"><a href="#cb13-25"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb13-26"><a href="#cb13-26"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.title.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb13-27"><a href="#cb13-27"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb13-28"><a href="#cb13-28"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb13-29"><a href="#cb13-29"></a>    <span class="at">y =</span> <span class="st">"Percent variance </span><span class="sc">\n</span><span class="st">explained by each </span><span class="sc">\n</span><span class="st">PCA component"</span></span>
<span id="cb13-30"><a href="#cb13-30"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="3883"></p>
</div>
</div>
<p>Here is a PCA Biplot of PC1 and PC2</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>filtered_loadings <span class="ot">&lt;-</span> tidied_pca_loadings <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="at">names_from =</span> .data[[<span class="st">"component"</span>]],</span>
<span id="cb14-4"><a href="#cb14-4"></a>    <span class="at">values_from =</span> .data[[<span class="st">"value"</span>]]</span>
<span id="cb14-5"><a href="#cb14-5"></a>  )</span>
<span id="cb14-6"><a href="#cb14-6"></a></span>
<span id="cb14-7"><a href="#cb14-7"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(</span>
<span id="cb14-9"><a href="#cb14-9"></a>    <span class="at">data =</span> pca_score,</span>
<span id="cb14-10"><a href="#cb14-10"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb14-11"><a href="#cb14-11"></a>      <span class="at">x =</span> .data[[<span class="st">"PC1"</span>]],</span>
<span id="cb14-12"><a href="#cb14-12"></a>      <span class="at">y =</span> .data[[<span class="st">"PC2"</span>]]</span>
<span id="cb14-13"><a href="#cb14-13"></a>    ),</span>
<span id="cb14-14"><a href="#cb14-14"></a>    <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb14-15"><a href="#cb14-15"></a>    <span class="at">alpha =</span> <span class="fl">0.6</span></span>
<span id="cb14-16"><a href="#cb14-16"></a>  ) <span class="sc">+</span></span>
<span id="cb14-17"><a href="#cb14-17"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb14-18"><a href="#cb14-18"></a>    <span class="at">data =</span> pca_score,</span>
<span id="cb14-19"><a href="#cb14-19"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb14-20"><a href="#cb14-20"></a>      <span class="at">x =</span> .data[[<span class="st">"PC1"</span>]],</span>
<span id="cb14-21"><a href="#cb14-21"></a>      <span class="at">y =</span> .data[[<span class="st">"PC2"</span>]],</span>
<span id="cb14-22"><a href="#cb14-22"></a>      <span class="at">label =</span> .data[[<span class="st">"state"</span>]]</span>
<span id="cb14-23"><a href="#cb14-23"></a>    ),</span>
<span id="cb14-24"><a href="#cb14-24"></a>    <span class="at">check_overlap =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-25"><a href="#cb14-25"></a>    <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb14-26"><a href="#cb14-26"></a>    <span class="at">hjust =</span> <span class="st">"inward"</span></span>
<span id="cb14-27"><a href="#cb14-27"></a>  ) <span class="sc">+</span></span>
<span id="cb14-28"><a href="#cb14-28"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_segment</span>(</span>
<span id="cb14-29"><a href="#cb14-29"></a>    <span class="at">data =</span> filtered_loadings,</span>
<span id="cb14-30"><a href="#cb14-30"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb14-31"><a href="#cb14-31"></a>      <span class="at">x =</span> <span class="dv">0</span>,</span>
<span id="cb14-32"><a href="#cb14-32"></a>      <span class="at">y =</span> <span class="dv">0</span>,</span>
<span id="cb14-33"><a href="#cb14-33"></a>      <span class="at">xend =</span> .data[[<span class="st">"PC1"</span>]] <span class="sc">*</span> <span class="fl">2.5</span>,</span>
<span id="cb14-34"><a href="#cb14-34"></a>      <span class="at">yend =</span> .data[[<span class="st">"PC2"</span>]] <span class="sc">*</span> <span class="fl">2.5</span></span>
<span id="cb14-35"><a href="#cb14-35"></a>    ),</span>
<span id="cb14-36"><a href="#cb14-36"></a>    <span class="at">arrow =</span> ggplot2<span class="sc">::</span><span class="fu">arrow</span>(<span class="at">length =</span> grid<span class="sc">::</span><span class="fu">unit</span>(</span>
<span id="cb14-37"><a href="#cb14-37"></a>      <span class="at">x =</span> <span class="fl">0.5</span>,</span>
<span id="cb14-38"><a href="#cb14-38"></a>      <span class="at">units =</span> <span class="st">"picas"</span></span>
<span id="cb14-39"><a href="#cb14-39"></a>    )),</span>
<span id="cb14-40"><a href="#cb14-40"></a>    <span class="at">color =</span> <span class="st">"blue"</span></span>
<span id="cb14-41"><a href="#cb14-41"></a>  ) <span class="sc">+</span></span>
<span id="cb14-42"><a href="#cb14-42"></a>  ggplot2<span class="sc">::</span><span class="fu">annotate</span>(</span>
<span id="cb14-43"><a href="#cb14-43"></a>    <span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb14-44"><a href="#cb14-44"></a>    <span class="at">x =</span> filtered_loadings[[<span class="st">"PC1"</span>]] <span class="sc">*</span> <span class="fl">2.7</span>,</span>
<span id="cb14-45"><a href="#cb14-45"></a>    <span class="at">y =</span> filtered_loadings[[<span class="st">"PC2"</span>]] <span class="sc">*</span> <span class="fl">2.7</span>,</span>
<span id="cb14-46"><a href="#cb14-46"></a>    <span class="at">label =</span> filtered_loadings[[<span class="st">"terms"</span>]]</span>
<span id="cb14-47"><a href="#cb14-47"></a>  ) <span class="sc">+</span></span>
<span id="cb14-48"><a href="#cb14-48"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_fixed</span>(<span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span></span>
<span id="cb14-49"><a href="#cb14-49"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="3883"></p>
</div>
</div>
</section><section id="matrix-completion" class="level1"><h1>Matrix Completion</h1>
<section id="initialisation" class="level2"><h2 class="anchored" data-anchor-id="initialisation">Initialisation</h2>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>missing_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="at">SBP =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="cn">NA</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="cn">NA</span>),</span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="at">DBP =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="cn">NA</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb15-4"><a href="#cb15-4"></a>)</span>
<span id="cb15-5"><a href="#cb15-5"></a></span>
<span id="cb15-6"><a href="#cb15-6"></a>colour_missing_cells <span class="ot">&lt;-</span> <span class="cf">function</span>(value, index, name) {</span>
<span id="cb15-7"><a href="#cb15-7"></a>  missing_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">is.na</span>(missing_data[[name]]))</span>
<span id="cb15-8"><a href="#cb15-8"></a>  <span class="cf">if</span> (index <span class="sc">%in%</span> missing_indices) {</span>
<span id="cb15-9"><a href="#cb15-9"></a>    <span class="fu">list</span>(<span class="at">background =</span> <span class="st">"#aaf0f8"</span>)</span>
<span id="cb15-10"><a href="#cb15-10"></a>  }</span>
<span id="cb15-11"><a href="#cb15-11"></a>}</span>
<span id="cb15-12"><a href="#cb15-12"></a></span>
<span id="cb15-13"><a href="#cb15-13"></a>xbar <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(missing_data, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-14"><a href="#cb15-14"></a></span>
<span id="cb15-15"><a href="#cb15-15"></a>initialisation_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb15-16"><a href="#cb15-16"></a>  <span class="at">SBP =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb15-17"><a href="#cb15-17"></a>  <span class="at">DBP =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb15-18"><a href="#cb15-18"></a>)</span>
<span id="cb15-19"><a href="#cb15-19"></a></span>
<span id="cb15-20"><a href="#cb15-20"></a>thresh <span class="ot">&lt;-</span> <span class="fl">1e-2</span></span>
<span id="cb15-21"><a href="#cb15-21"></a>ismiss <span class="ot">&lt;-</span> <span class="fu">is.na</span>(missing_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="functions" class="level2"><h2 class="anchored" data-anchor-id="functions">Functions</h2>
<p>These are the implementations for calculating step 2a and 2b for Algorithm 12.1</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">BaseR PCA</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">BaseR SVD</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">Tidymodels</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>fit_pca <span class="ot">&lt;-</span> <span class="cf">function</span>(input_data, <span class="at">num_comp =</span> <span class="dv">1</span>) {</span>
<span id="cb16-2"><a href="#cb16-2"></a>  data_pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(input_data, <span class="at">center =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-3"><a href="#cb16-3"></a></span>
<span id="cb16-4"><a href="#cb16-4"></a>  pca_loadings <span class="ot">&lt;-</span> data_pca<span class="sc">$</span>rotation</span>
<span id="cb16-5"><a href="#cb16-5"></a>  pca_loadings_inverse <span class="ot">&lt;-</span> <span class="fu">solve</span>(pca_loadings)[<span class="dv">1</span><span class="sc">:</span>num_comp, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb16-6"><a href="#cb16-6"></a>  pca_scores <span class="ot">&lt;-</span> data_pca<span class="sc">$</span>x[, <span class="dv">1</span><span class="sc">:</span>num_comp, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb16-7"><a href="#cb16-7"></a></span>
<span id="cb16-8"><a href="#cb16-8"></a>  estimated_data <span class="ot">&lt;-</span> pca_scores <span class="sc">%*%</span> pca_loadings_inverse</span>
<span id="cb16-9"><a href="#cb16-9"></a>  <span class="fu">return</span>(estimated_data)</span>
<span id="cb16-10"><a href="#cb16-10"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>fit_svd <span class="ot">&lt;-</span> <span class="cf">function</span>(input_data, <span class="at">num_comp =</span> <span class="dv">1</span>) {</span>
<span id="cb17-2"><a href="#cb17-2"></a>  svd_object <span class="ot">&lt;-</span> <span class="fu">svd</span>(input_data)</span>
<span id="cb17-3"><a href="#cb17-3"></a></span>
<span id="cb17-4"><a href="#cb17-4"></a>  pca_loadings <span class="ot">&lt;-</span> svd_object<span class="sc">$</span>v[, <span class="dv">1</span><span class="sc">:</span>num_comp, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb17-5"><a href="#cb17-5"></a>  pca_loadings_inverse <span class="ot">&lt;-</span> <span class="fu">t</span>(pca_loadings)</span>
<span id="cb17-6"><a href="#cb17-6"></a></span>
<span id="cb17-7"><a href="#cb17-7"></a>  pca_scores <span class="ot">&lt;-</span> (svd_object<span class="sc">$</span>u <span class="sc">%*%</span> <span class="fu">diag</span>(svd_object<span class="sc">$</span>d))[, <span class="dv">1</span><span class="sc">:</span>num_comp, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb17-8"><a href="#cb17-8"></a></span>
<span id="cb17-9"><a href="#cb17-9"></a>  estimated_data <span class="ot">&lt;-</span> pca_scores <span class="sc">%*%</span> pca_loadings_inverse</span>
<span id="cb17-10"><a href="#cb17-10"></a></span>
<span id="cb17-11"><a href="#cb17-11"></a>  <span class="fu">return</span>(estimated_data)</span>
<span id="cb17-12"><a href="#cb17-12"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>fit_pca_tidy <span class="ot">&lt;-</span> <span class="cf">function</span>(input_data, <span class="at">num_comp =</span> <span class="dv">1</span>) {</span>
<span id="cb18-2"><a href="#cb18-2"></a>  pca_recipe <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(</span>
<span id="cb18-3"><a href="#cb18-3"></a>    <span class="at">formula =</span> <span class="sc">~</span>.,</span>
<span id="cb18-4"><a href="#cb18-4"></a>    <span class="at">data =</span> input_data</span>
<span id="cb18-5"><a href="#cb18-5"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>    recipes<span class="sc">::</span><span class="fu">step_pca</span>(recipes<span class="sc">::</span><span class="fu">all_numeric_predictors</span>(),</span>
<span id="cb18-7"><a href="#cb18-7"></a>      <span class="at">id =</span> <span class="st">"pca"</span></span>
<span id="cb18-8"><a href="#cb18-8"></a>    )</span>
<span id="cb18-9"><a href="#cb18-9"></a></span>
<span id="cb18-10"><a href="#cb18-10"></a></span>
<span id="cb18-11"><a href="#cb18-11"></a>  pca_estimates <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">prep</span>(<span class="at">x =</span> pca_recipe, <span class="at">training =</span> input_data)</span>
<span id="cb18-12"><a href="#cb18-12"></a></span>
<span id="cb18-13"><a href="#cb18-13"></a>  pca_scores <span class="ot">&lt;-</span> pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb18-14"><a href="#cb18-14"></a>    recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data =</span> input_data) <span class="sc">%&gt;%</span></span>
<span id="cb18-15"><a href="#cb18-15"></a>    <span class="fu">as.matrix</span>()</span>
<span id="cb18-16"><a href="#cb18-16"></a>  pca_scores <span class="ot">&lt;-</span> pca_scores[, <span class="dv">1</span><span class="sc">:</span>num_comp, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb18-17"><a href="#cb18-17"></a></span>
<span id="cb18-18"><a href="#cb18-18"></a></span>
<span id="cb18-19"><a href="#cb18-19"></a>  pca_loadings <span class="ot">&lt;-</span> pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb18-20"><a href="#cb18-20"></a>    parsnip<span class="sc">::</span><span class="fu">tidy</span>(<span class="at">id =</span> <span class="st">"pca"</span>, <span class="at">type =</span> <span class="st">"coef"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-21"><a href="#cb18-21"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb18-22"><a href="#cb18-22"></a>      <span class="at">names_from =</span> .data[[<span class="st">"component"</span>]],</span>
<span id="cb18-23"><a href="#cb18-23"></a>      <span class="at">values_from =</span> .data[[<span class="st">"value"</span>]]</span>
<span id="cb18-24"><a href="#cb18-24"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb18-25"><a href="#cb18-25"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"terms"</span>, <span class="st">"id"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-26"><a href="#cb18-26"></a>    <span class="fu">as.matrix</span>()</span>
<span id="cb18-27"><a href="#cb18-27"></a></span>
<span id="cb18-28"><a href="#cb18-28"></a>  pca_loadings_inverse <span class="ot">&lt;-</span> <span class="fu">solve</span>(pca_loadings)[<span class="dv">1</span><span class="sc">:</span>num_comp, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb18-29"><a href="#cb18-29"></a></span>
<span id="cb18-30"><a href="#cb18-30"></a>  estimated_data <span class="ot">&lt;-</span> pca_scores <span class="sc">%*%</span> pca_loadings_inverse</span>
<span id="cb18-31"><a href="#cb18-31"></a></span>
<span id="cb18-32"><a href="#cb18-32"></a>  <span class="fu">return</span>(estimated_data)</span>
<span id="cb18-33"><a href="#cb18-33"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section><section id="iteration-1" class="level2"><h2 class="anchored" data-anchor-id="iteration-1">Iteration 1</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">BaseR PCA</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">BaseR SVD</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false" href="">Tidymodels</a></li>
</ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>initialisation_data_pca <span class="ot">&lt;-</span> initialisation_data</span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="co"># Step 2(a)</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>Xapp <span class="ot">&lt;-</span> <span class="fu">fit_pca</span>(initialisation_data_pca, <span class="at">num_comp =</span> <span class="dv">1</span>)</span>
<span id="cb19-5"><a href="#cb19-5"></a></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="co"># Step 2(b)</span></span>
<span id="cb19-7"><a href="#cb19-7"></a>initialisation_data_pca[ismiss] <span class="ot">&lt;-</span> Xapp[ismiss]</span>
<span id="cb19-8"><a href="#cb19-8"></a></span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="co"># Step 2(c)</span></span>
<span id="cb19-10"><a href="#cb19-10"></a>mss_old_pca <span class="ot">&lt;-</span> <span class="fu">mean</span>(((missing_data <span class="sc">-</span> Xapp)[<span class="sc">!</span>ismiss])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb19-11"><a href="#cb19-11"></a></span>
<span id="cb19-12"><a href="#cb19-12"></a>initialisation_data_pca <span class="sc">%&gt;%</span></span>
<span id="cb19-13"><a href="#cb19-13"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-d3b63b433f032d69f8ce" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d3b63b433f032d69f8ce">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"SBP":[-3,0.14384952667793,-1,1,1,-0.295796456590457],"DBP":[1.21442472281113,-2,0,0.921327400632204,2,4]},"columns":[{"accessor":"SBP","name":"SBP","type":"numeric"},{"accessor":"DBP","name":"DBP","type":"numeric"}],"defaultPageSize":6,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"813289f8bd0920e298f9ffee9df6d8c8"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>mss_old_pca</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] 1.48974</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>initialisation_data_svd <span class="ot">&lt;-</span> initialisation_data</span>
<span id="cb22-2"><a href="#cb22-2"></a></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="co"># Step 2(a)</span></span>
<span id="cb22-4"><a href="#cb22-4"></a>Xapp <span class="ot">&lt;-</span> <span class="fu">fit_svd</span>(initialisation_data_svd, <span class="at">num_comp =</span> <span class="dv">1</span>)</span>
<span id="cb22-5"><a href="#cb22-5"></a></span>
<span id="cb22-6"><a href="#cb22-6"></a><span class="co"># Step 2(b)</span></span>
<span id="cb22-7"><a href="#cb22-7"></a>initialisation_data_svd[ismiss] <span class="ot">&lt;-</span> Xapp[ismiss]</span>
<span id="cb22-8"><a href="#cb22-8"></a></span>
<span id="cb22-9"><a href="#cb22-9"></a><span class="co"># Step 2(c)</span></span>
<span id="cb22-10"><a href="#cb22-10"></a>mss_old_svd <span class="ot">&lt;-</span> <span class="fu">mean</span>(((missing_data <span class="sc">-</span> Xapp)[<span class="sc">!</span>ismiss])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb22-11"><a href="#cb22-11"></a></span>
<span id="cb22-12"><a href="#cb22-12"></a>initialisation_data_svd <span class="sc">%&gt;%</span></span>
<span id="cb22-13"><a href="#cb22-13"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-d61fccfdb731a9527b4f" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d61fccfdb731a9527b4f">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"SBP":[-3,0.14384952667793,-1,1,1,-0.295796456590457],"DBP":[1.21442472281113,-2,0,0.921327400632205,2,4]},"columns":[{"accessor":"SBP","name":"SBP","type":"numeric"},{"accessor":"DBP","name":"DBP","type":"numeric"}],"defaultPageSize":6,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"cdb219166bece56c3401b437d732b151"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>mss_old_svd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] 1.48974</code></pre>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>initialisation_data_tidymodels <span class="ot">&lt;-</span> initialisation_data</span>
<span id="cb25-2"><a href="#cb25-2"></a></span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="co"># Step 2(a)</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>Xapp <span class="ot">&lt;-</span> <span class="fu">fit_pca_tidy</span>(initialisation_data_tidymodels, <span class="at">num_comp =</span> <span class="dv">1</span>)</span>
<span id="cb25-5"><a href="#cb25-5"></a></span>
<span id="cb25-6"><a href="#cb25-6"></a><span class="co"># Step 2(b)</span></span>
<span id="cb25-7"><a href="#cb25-7"></a>initialisation_data_tidymodels[ismiss] <span class="ot">&lt;-</span> Xapp[ismiss]</span>
<span id="cb25-8"><a href="#cb25-8"></a></span>
<span id="cb25-9"><a href="#cb25-9"></a><span class="co"># Step 2(c)</span></span>
<span id="cb25-10"><a href="#cb25-10"></a>mss_old_tidymodels <span class="ot">&lt;-</span> <span class="fu">mean</span>(((missing_data <span class="sc">-</span> Xapp)[<span class="sc">!</span>ismiss])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb25-11"><a href="#cb25-11"></a></span>
<span id="cb25-12"><a href="#cb25-12"></a>initialisation_data_tidymodels <span class="sc">%&gt;%</span></span>
<span id="cb25-13"><a href="#cb25-13"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(</span>
<span id="cb25-14"><a href="#cb25-14"></a>    <span class="at">defaultPageSize =</span> <span class="dv">6</span>,</span>
<span id="cb25-15"><a href="#cb25-15"></a>    <span class="at">columns =</span> <span class="fu">list</span>(</span>
<span id="cb25-16"><a href="#cb25-16"></a>      <span class="at">SBP =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(<span class="at">format =</span> reactable<span class="sc">::</span><span class="fu">colFormat</span>(<span class="at">digits =</span> <span class="dv">2</span>)),</span>
<span id="cb25-17"><a href="#cb25-17"></a>      <span class="at">DBP =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(<span class="at">format =</span> reactable<span class="sc">::</span><span class="fu">colFormat</span>(<span class="at">digits =</span> <span class="dv">2</span>))</span>
<span id="cb25-18"><a href="#cb25-18"></a>    ),</span>
<span id="cb25-19"><a href="#cb25-19"></a>    <span class="at">defaultColDef =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(</span>
<span id="cb25-20"><a href="#cb25-20"></a>      <span class="at">style =</span> colour_missing_cells</span>
<span id="cb25-21"><a href="#cb25-21"></a>    )</span>
<span id="cb25-22"><a href="#cb25-22"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-fd1b6780c389bb38e90a" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-fd1b6780c389bb38e90a">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"SBP":[-3,0.14384952667793,-1,1,1,-0.295796456590457],"DBP":[1.21442472281113,-2,0,0.921327400632204,2,4]},"columns":[{"accessor":"SBP","name":"SBP","type":"numeric","style":[null,{"background":"#aaf0f8"},null,null,null,{"background":"#aaf0f8"}],"format":{"cell":{"digits":2},"aggregated":{"digits":2}}},{"accessor":"DBP","name":"DBP","type":"numeric","style":[{"background":"#aaf0f8"},null,null,{"background":"#aaf0f8"},null,null],"format":{"cell":{"digits":2},"aggregated":{"digits":2}}}],"defaultPageSize":6,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"f69c3dc293641e179690916105e98135"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>mss_old_tidymodels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt; [1] 1.48974</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="the-rest-of-the-iteration" class="level2"><h2 class="anchored" data-anchor-id="the-rest-of-the-iteration">The rest of the iteration</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">BaseR PCA</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">Tidymodels</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false" href="">BaseR SVD</a></li>
</ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell" data-max.height="500px">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>iter <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>rel_err <span class="ot">&lt;-</span> mss_old_pca</span>
<span id="cb28-3"><a href="#cb28-3"></a>thresh <span class="ot">&lt;-</span> <span class="fl">1e-2</span></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="cf">while</span> (rel_err <span class="sc">&gt;</span> thresh) {</span>
<span id="cb28-5"><a href="#cb28-5"></a>  iter <span class="ot">&lt;-</span> iter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb28-6"><a href="#cb28-6"></a></span>
<span id="cb28-7"><a href="#cb28-7"></a>  <span class="co"># Step 2(a)</span></span>
<span id="cb28-8"><a href="#cb28-8"></a>  Xapp <span class="ot">&lt;-</span> <span class="fu">fit_pca</span>(initialisation_data_pca, <span class="at">num_comp =</span> <span class="dv">1</span>)</span>
<span id="cb28-9"><a href="#cb28-9"></a></span>
<span id="cb28-10"><a href="#cb28-10"></a>  <span class="co"># Step 2(b)</span></span>
<span id="cb28-11"><a href="#cb28-11"></a>  initialisation_data_pca[ismiss] <span class="ot">&lt;-</span> Xapp[ismiss]</span>
<span id="cb28-12"><a href="#cb28-12"></a></span>
<span id="cb28-13"><a href="#cb28-13"></a>  <span class="co"># Step 2(c)</span></span>
<span id="cb28-14"><a href="#cb28-14"></a>  mss_pca <span class="ot">&lt;-</span> <span class="fu">mean</span>(((missing_data <span class="sc">-</span> Xapp)[<span class="sc">!</span>ismiss])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb28-15"><a href="#cb28-15"></a>  rel_err <span class="ot">&lt;-</span> mss_old_pca <span class="sc">-</span> mss_pca</span>
<span id="cb28-16"><a href="#cb28-16"></a>  mss_old_pca <span class="ot">&lt;-</span> mss_pca</span>
<span id="cb28-17"><a href="#cb28-17"></a>  <span class="fu">cat</span>(</span>
<span id="cb28-18"><a href="#cb28-18"></a>    <span class="st">"Iter:"</span>, iter, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb28-19"><a href="#cb28-19"></a>    <span class="st">"MSS:"</span>, mss_pca, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb28-20"><a href="#cb28-20"></a>    <span class="st">"Rel. Err:"</span>, rel_err, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb28-21"><a href="#cb28-21"></a>  )</span>
<span id="cb28-22"><a href="#cb28-22"></a>  <span class="fu">print</span>(<span class="st">"Xapp"</span>)</span>
<span id="cb28-23"><a href="#cb28-23"></a>  <span class="fu">print</span>(Xapp)</span>
<span id="cb28-24"><a href="#cb28-24"></a>  <span class="fu">print</span>(<span class="st">"Data"</span>)</span>
<span id="cb28-25"><a href="#cb28-25"></a>  <span class="fu">print</span>(initialisation_data_pca)</span>
<span id="cb28-26"><a href="#cb28-26"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre style="max-height: 500px;"><code>&gt; Iter: 2 
&gt;  MSS: 1.43288 
&gt;  Rel. Err: 0.05686009 
&gt; [1] "Xapp"
&gt;              SBP        DBP
&gt; [1,] -0.24567017  1.6296426
&gt; [2,]  0.29799874 -1.9767619
&gt; [3,] -0.02222086  0.1474011
&gt; [4,] -0.11358385  0.7534536
&gt; [5,] -0.27258141  1.8081571
&gt; [6,] -0.59617741  3.9547173
&gt; [1] "Data"
&gt;          SBP        DBP
&gt; 1 -3.0000000  1.6296426
&gt; 2  0.2979987 -2.0000000
&gt; 3 -1.0000000  0.0000000
&gt; 4  1.0000000  0.7534536
&gt; 5  1.0000000  2.0000000
&gt; 6 -0.5961774  4.0000000
&gt; Iter: 3 
&gt;  MSS: 1.222089 
&gt;  Rel. Err: 0.2107907 
&gt; [1] "Xapp"
&gt;              SBP        DBP
&gt; [1,] -0.73055871  2.3385975
&gt; [2,]  0.59572858 -1.9069916
&gt; [3,] -0.08891186  0.2846165
&gt; [4,] -0.12553344  0.4018461
&gt; [5,] -0.48032110  1.5375598
&gt; [6,] -1.19147316  3.8140345
&gt; [1] "Data"
&gt;          SBP        DBP
&gt; 1 -3.0000000  2.3385975
&gt; 2  0.5957286 -2.0000000
&gt; 3 -1.0000000  0.0000000
&gt; 4  1.0000000  0.4018461
&gt; 5  1.0000000  2.0000000
&gt; 6 -1.1914732  4.0000000
&gt; Iter: 4 
&gt;  MSS: 0.8998268 
&gt;  Rel. Err: 0.3222623 
&gt; [1] "Xapp"
&gt;              SBP         DBP
&gt; [1,] -1.53549232  3.07087697
&gt; [2,]  0.91916923 -1.83827401
&gt; [3,] -0.20001122  0.40000841
&gt; [4,]  0.03926938 -0.07853601
&gt; [5,] -0.60000561  1.19996915
&gt; [6,] -1.83834165  3.67655441
&gt; [1] "Data"
&gt;          SBP         DBP
&gt; 1 -3.0000000  3.07087697
&gt; 2  0.9191692 -2.00000000
&gt; 3 -1.0000000  0.00000000
&gt; 4  1.0000000 -0.07853601
&gt; 5  1.0000000  2.00000000
&gt; 6 -1.8383417  4.00000000
&gt; Iter: 5 
&gt;  MSS: 0.6967107 
&gt;  Rel. Err: 0.2031161 
&gt; [1] "Xapp"
&gt;             SBP        DBP
&gt; [1,] -2.1668365  3.5757572
&gt; [2,]  1.1333206 -1.8702286
&gt; [3,] -0.2685842  0.4432231
&gt; [4,]  0.3033932 -0.5006656
&gt; [5,] -0.6178620  1.0196084
&gt; [6,] -2.2666421  3.7404586
&gt; [1] "Data"
&gt;         SBP        DBP
&gt; 1 -3.000000  3.5757572
&gt; 2  1.133321 -2.0000000
&gt; 3 -1.000000  0.0000000
&gt; 4  1.000000 -0.5006656
&gt; 5  1.000000  2.0000000
&gt; 6 -2.266642  4.0000000
&gt; Iter: 6 
&gt;  MSS: 0.612954 
&gt;  Rel. Err: 0.08375675 
&gt; [1] "Xapp"
&gt;             SBP        DBP
&gt; [1,] -2.5102026  3.8916848
&gt; [2,]  1.2439901 -1.9286163
&gt; [3,] -0.2938087  0.4555054
&gt; [4,]  0.5218645 -0.8090711
&gt; [5,] -0.6172021  0.9568773
&gt; [6,] -2.4879805  3.8572330
&gt; [1] "Data"
&gt;         SBP        DBP
&gt; 1 -3.000000  3.8916848
&gt; 2  1.243990 -2.0000000
&gt; 3 -1.000000  0.0000000
&gt; 4  1.000000 -0.8090711
&gt; 5  1.000000  2.0000000
&gt; 6 -2.487981  4.0000000
&gt; Iter: 7 
&gt;  MSS: 0.5807517 
&gt;  Rel. Err: 0.03220227 
&gt; [1] "Xapp"
&gt;             SBP        DBP
&gt; [1,] -2.6813227  4.1000892
&gt; [2,]  1.2887789 -1.9707096
&gt; [3,] -0.2995594  0.4580650
&gt; [4,]  0.6701665 -1.0247713
&gt; [5,] -0.6165707  0.9428163
&gt; [6,] -2.5775579  3.9414194
&gt; [1] "Data"
&gt;         SBP       DBP
&gt; 1 -3.000000  4.100089
&gt; 2  1.288779 -2.000000
&gt; 3 -1.000000  0.000000
&gt; 4  1.000000 -1.024771
&gt; 5  1.000000  2.000000
&gt; 6 -2.577558  4.000000
&gt; Iter: 8 
&gt;  MSS: 0.5665195 
&gt;  Rel. Err: 0.01423225 
&gt; [1] "Xapp"
&gt;             SBP       DBP
&gt; [1,] -2.7628696  4.254096
&gt; [2,]  1.2959129 -1.995367
&gt; [3,] -0.2966660  0.456788
&gt; [4,]  0.7647692 -1.177544
&gt; [5,] -0.6169100  0.949880
&gt; [6,] -2.5918258  3.990734
&gt; [1] "Data"
&gt;         SBP       DBP
&gt; 1 -3.000000  4.254096
&gt; 2  1.295913 -2.000000
&gt; 3 -1.000000  0.000000
&gt; 4  1.000000 -1.177544
&gt; 5  1.000000  2.000000
&gt; 6 -2.591826  4.000000
&gt; Iter: 9 
&gt;  MSS: 0.558216 
&gt;  Rel. Err: 0.00830349 
&gt; [1] "Xapp"
&gt;             SBP        DBP
&gt; [1,] -2.7988324  4.3825676
&gt; [2,]  1.2826615 -2.0084627
&gt; [3,] -0.2896952  0.4536209
&gt; [4,]  0.8238540 -1.2900364
&gt; [5,] -0.6175465  0.9669887
&gt; [6,] -2.5653230  4.0169255
&gt; [1] "Data"
&gt;         SBP       DBP
&gt; 1 -3.000000  4.382568
&gt; 2  1.282661 -2.000000
&gt; 3 -1.000000  0.000000
&gt; 4  1.000000 -1.290036
&gt; 5  1.000000  2.000000
&gt; 6 -2.565323  4.000000</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell" data-max.height="500px">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>iter <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>rel_err <span class="ot">&lt;-</span> mss_old_svd</span>
<span id="cb30-3"><a href="#cb30-3"></a>thresh <span class="ot">&lt;-</span> <span class="fl">1e-2</span></span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="cf">while</span> (rel_err <span class="sc">&gt;</span> thresh) {</span>
<span id="cb30-5"><a href="#cb30-5"></a>  iter <span class="ot">&lt;-</span> iter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb30-6"><a href="#cb30-6"></a></span>
<span id="cb30-7"><a href="#cb30-7"></a>  <span class="co"># Step 2(a)</span></span>
<span id="cb30-8"><a href="#cb30-8"></a>  Xapp <span class="ot">&lt;-</span> <span class="fu">fit_svd</span>(initialisation_data_svd, <span class="at">num_comp =</span> <span class="dv">1</span>)</span>
<span id="cb30-9"><a href="#cb30-9"></a></span>
<span id="cb30-10"><a href="#cb30-10"></a>  <span class="co"># Step 2(b)</span></span>
<span id="cb30-11"><a href="#cb30-11"></a>  initialisation_data_svd[ismiss] <span class="ot">&lt;-</span> Xapp[ismiss]</span>
<span id="cb30-12"><a href="#cb30-12"></a></span>
<span id="cb30-13"><a href="#cb30-13"></a>  <span class="co"># Step 2(c)</span></span>
<span id="cb30-14"><a href="#cb30-14"></a>  mss_svd <span class="ot">&lt;-</span> <span class="fu">mean</span>(((missing_data <span class="sc">-</span> Xapp)[<span class="sc">!</span>ismiss])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb30-15"><a href="#cb30-15"></a>  rel_err <span class="ot">&lt;-</span> mss_old_svd <span class="sc">-</span> mss_svd</span>
<span id="cb30-16"><a href="#cb30-16"></a>  mss_old_svd <span class="ot">&lt;-</span> mss_svd</span>
<span id="cb30-17"><a href="#cb30-17"></a>  <span class="fu">cat</span>(</span>
<span id="cb30-18"><a href="#cb30-18"></a>    <span class="st">"Iter:"</span>, iter, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb30-19"><a href="#cb30-19"></a>    <span class="st">"MSS:"</span>, mss_svd, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb30-20"><a href="#cb30-20"></a>    <span class="st">"Rel. Err:"</span>, rel_err, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb30-21"><a href="#cb30-21"></a>  )</span>
<span id="cb30-22"><a href="#cb30-22"></a>  <span class="fu">print</span>(<span class="st">"Xapp"</span>)</span>
<span id="cb30-23"><a href="#cb30-23"></a>  <span class="fu">print</span>(Xapp)</span>
<span id="cb30-24"><a href="#cb30-24"></a>  <span class="fu">print</span>(<span class="st">"Data"</span>)</span>
<span id="cb30-25"><a href="#cb30-25"></a>  <span class="fu">print</span>(initialisation_data_svd)</span>
<span id="cb30-26"><a href="#cb30-26"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre style="max-height: 500px;"><code>&gt; Iter: 2 
&gt;  MSS: 1.43288 
&gt;  Rel. Err: 0.05686009 
&gt; [1] "Xapp"
&gt;             [,1]       [,2]
&gt; [1,] -0.24567017  1.6296426
&gt; [2,]  0.29799874 -1.9767619
&gt; [3,] -0.02222086  0.1474011
&gt; [4,] -0.11358385  0.7534536
&gt; [5,] -0.27258141  1.8081571
&gt; [6,] -0.59617741  3.9547173
&gt; [1] "Data"
&gt;          SBP        DBP
&gt; 1 -3.0000000  1.6296426
&gt; 2  0.2979987 -2.0000000
&gt; 3 -1.0000000  0.0000000
&gt; 4  1.0000000  0.7534536
&gt; 5  1.0000000  2.0000000
&gt; 6 -0.5961774  4.0000000
&gt; Iter: 3 
&gt;  MSS: 1.222089 
&gt;  Rel. Err: 0.2107907 
&gt; [1] "Xapp"
&gt;             [,1]       [,2]
&gt; [1,] -0.73055871  2.3385975
&gt; [2,]  0.59572858 -1.9069916
&gt; [3,] -0.08891186  0.2846165
&gt; [4,] -0.12553344  0.4018461
&gt; [5,] -0.48032110  1.5375598
&gt; [6,] -1.19147316  3.8140345
&gt; [1] "Data"
&gt;          SBP        DBP
&gt; 1 -3.0000000  2.3385975
&gt; 2  0.5957286 -2.0000000
&gt; 3 -1.0000000  0.0000000
&gt; 4  1.0000000  0.4018461
&gt; 5  1.0000000  2.0000000
&gt; 6 -1.1914732  4.0000000
&gt; Iter: 4 
&gt;  MSS: 0.8998268 
&gt;  Rel. Err: 0.3222623 
&gt; [1] "Xapp"
&gt;             [,1]        [,2]
&gt; [1,] -1.53549232  3.07087697
&gt; [2,]  0.91916923 -1.83827401
&gt; [3,] -0.20001122  0.40000841
&gt; [4,]  0.03926938 -0.07853601
&gt; [5,] -0.60000561  1.19996915
&gt; [6,] -1.83834165  3.67655441
&gt; [1] "Data"
&gt;          SBP         DBP
&gt; 1 -3.0000000  3.07087697
&gt; 2  0.9191692 -2.00000000
&gt; 3 -1.0000000  0.00000000
&gt; 4  1.0000000 -0.07853601
&gt; 5  1.0000000  2.00000000
&gt; 6 -1.8383417  4.00000000
&gt; Iter: 5 
&gt;  MSS: 0.6967107 
&gt;  Rel. Err: 0.2031161 
&gt; [1] "Xapp"
&gt;            [,1]       [,2]
&gt; [1,] -2.1668365  3.5757572
&gt; [2,]  1.1333206 -1.8702286
&gt; [3,] -0.2685842  0.4432231
&gt; [4,]  0.3033932 -0.5006656
&gt; [5,] -0.6178620  1.0196084
&gt; [6,] -2.2666421  3.7404586
&gt; [1] "Data"
&gt;         SBP        DBP
&gt; 1 -3.000000  3.5757572
&gt; 2  1.133321 -2.0000000
&gt; 3 -1.000000  0.0000000
&gt; 4  1.000000 -0.5006656
&gt; 5  1.000000  2.0000000
&gt; 6 -2.266642  4.0000000
&gt; Iter: 6 
&gt;  MSS: 0.612954 
&gt;  Rel. Err: 0.08375675 
&gt; [1] "Xapp"
&gt;            [,1]       [,2]
&gt; [1,] -2.5102026  3.8916848
&gt; [2,]  1.2439901 -1.9286163
&gt; [3,] -0.2938087  0.4555054
&gt; [4,]  0.5218645 -0.8090711
&gt; [5,] -0.6172021  0.9568773
&gt; [6,] -2.4879805  3.8572330
&gt; [1] "Data"
&gt;         SBP        DBP
&gt; 1 -3.000000  3.8916848
&gt; 2  1.243990 -2.0000000
&gt; 3 -1.000000  0.0000000
&gt; 4  1.000000 -0.8090711
&gt; 5  1.000000  2.0000000
&gt; 6 -2.487981  4.0000000
&gt; Iter: 7 
&gt;  MSS: 0.5807517 
&gt;  Rel. Err: 0.03220227 
&gt; [1] "Xapp"
&gt;            [,1]       [,2]
&gt; [1,] -2.6813227  4.1000892
&gt; [2,]  1.2887789 -1.9707096
&gt; [3,] -0.2995594  0.4580650
&gt; [4,]  0.6701665 -1.0247713
&gt; [5,] -0.6165707  0.9428163
&gt; [6,] -2.5775579  3.9414194
&gt; [1] "Data"
&gt;         SBP       DBP
&gt; 1 -3.000000  4.100089
&gt; 2  1.288779 -2.000000
&gt; 3 -1.000000  0.000000
&gt; 4  1.000000 -1.024771
&gt; 5  1.000000  2.000000
&gt; 6 -2.577558  4.000000
&gt; Iter: 8 
&gt;  MSS: 0.5665195 
&gt;  Rel. Err: 0.01423225 
&gt; [1] "Xapp"
&gt;            [,1]      [,2]
&gt; [1,] -2.7628696  4.254096
&gt; [2,]  1.2959129 -1.995367
&gt; [3,] -0.2966660  0.456788
&gt; [4,]  0.7647692 -1.177544
&gt; [5,] -0.6169100  0.949880
&gt; [6,] -2.5918258  3.990734
&gt; [1] "Data"
&gt;         SBP       DBP
&gt; 1 -3.000000  4.254096
&gt; 2  1.295913 -2.000000
&gt; 3 -1.000000  0.000000
&gt; 4  1.000000 -1.177544
&gt; 5  1.000000  2.000000
&gt; 6 -2.591826  4.000000
&gt; Iter: 9 
&gt;  MSS: 0.558216 
&gt;  Rel. Err: 0.00830349 
&gt; [1] "Xapp"
&gt;            [,1]       [,2]
&gt; [1,] -2.7988324  4.3825676
&gt; [2,]  1.2826615 -2.0084627
&gt; [3,] -0.2896952  0.4536209
&gt; [4,]  0.8238540 -1.2900364
&gt; [5,] -0.6175465  0.9669887
&gt; [6,] -2.5653230  4.0169255
&gt; [1] "Data"
&gt;         SBP       DBP
&gt; 1 -3.000000  4.382568
&gt; 2  1.282661 -2.000000
&gt; 3 -1.000000  0.000000
&gt; 4  1.000000 -1.290036
&gt; 5  1.000000  2.000000
&gt; 6 -2.565323  4.000000</code></pre>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell" data-max.height="500px">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>iter <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>rel_err <span class="ot">&lt;-</span> mss_old_tidymodels</span>
<span id="cb32-3"><a href="#cb32-3"></a>thresh <span class="ot">&lt;-</span> <span class="fl">1e-2</span></span>
<span id="cb32-4"><a href="#cb32-4"></a><span class="cf">while</span> (rel_err <span class="sc">&gt;</span> thresh) {</span>
<span id="cb32-5"><a href="#cb32-5"></a>  iter <span class="ot">&lt;-</span> iter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb32-6"><a href="#cb32-6"></a></span>
<span id="cb32-7"><a href="#cb32-7"></a>  <span class="co"># Step 2(a)</span></span>
<span id="cb32-8"><a href="#cb32-8"></a>  Xapp <span class="ot">&lt;-</span> <span class="fu">fit_svd</span>(initialisation_data_tidymodels, <span class="at">num_comp =</span> <span class="dv">1</span>)</span>
<span id="cb32-9"><a href="#cb32-9"></a></span>
<span id="cb32-10"><a href="#cb32-10"></a>  <span class="co"># Step 2(b)</span></span>
<span id="cb32-11"><a href="#cb32-11"></a>  initialisation_data_tidymodels[ismiss] <span class="ot">&lt;-</span> Xapp[ismiss]</span>
<span id="cb32-12"><a href="#cb32-12"></a></span>
<span id="cb32-13"><a href="#cb32-13"></a>  <span class="co"># Step 2(c)</span></span>
<span id="cb32-14"><a href="#cb32-14"></a>  mss_tidymodels <span class="ot">&lt;-</span> <span class="fu">mean</span>(((missing_data <span class="sc">-</span> Xapp)[<span class="sc">!</span>ismiss])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb32-15"><a href="#cb32-15"></a>  rel_err <span class="ot">&lt;-</span> mss_old_tidymodels <span class="sc">-</span> mss_tidymodels</span>
<span id="cb32-16"><a href="#cb32-16"></a>  mss_old_tidymodels <span class="ot">&lt;-</span> mss_tidymodels</span>
<span id="cb32-17"><a href="#cb32-17"></a>  <span class="fu">cat</span>(</span>
<span id="cb32-18"><a href="#cb32-18"></a>    <span class="st">"Iter:"</span>, iter, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb32-19"><a href="#cb32-19"></a>    <span class="st">"MSS:"</span>, mss_tidymodels, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb32-20"><a href="#cb32-20"></a>    <span class="st">"Rel. Err:"</span>, rel_err, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb32-21"><a href="#cb32-21"></a>  )</span>
<span id="cb32-22"><a href="#cb32-22"></a>  <span class="fu">print</span>(<span class="st">"Xapp"</span>)</span>
<span id="cb32-23"><a href="#cb32-23"></a>  <span class="fu">print</span>(Xapp)</span>
<span id="cb32-24"><a href="#cb32-24"></a>  <span class="fu">print</span>(<span class="st">"Data"</span>)</span>
<span id="cb32-25"><a href="#cb32-25"></a>  <span class="fu">print</span>(initialisation_data_tidymodels)</span>
<span id="cb32-26"><a href="#cb32-26"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre style="max-height: 500px;"><code>&gt; Iter: 2 
&gt;  MSS: 1.43288 
&gt;  Rel. Err: 0.05686009 
&gt; [1] "Xapp"
&gt;             [,1]       [,2]
&gt; [1,] -0.24567017  1.6296426
&gt; [2,]  0.29799874 -1.9767619
&gt; [3,] -0.02222086  0.1474011
&gt; [4,] -0.11358385  0.7534536
&gt; [5,] -0.27258141  1.8081571
&gt; [6,] -0.59617741  3.9547173
&gt; [1] "Data"
&gt;          SBP        DBP
&gt; 1 -3.0000000  1.6296426
&gt; 2  0.2979987 -2.0000000
&gt; 3 -1.0000000  0.0000000
&gt; 4  1.0000000  0.7534536
&gt; 5  1.0000000  2.0000000
&gt; 6 -0.5961774  4.0000000
&gt; Iter: 3 
&gt;  MSS: 1.222089 
&gt;  Rel. Err: 0.2107907 
&gt; [1] "Xapp"
&gt;             [,1]       [,2]
&gt; [1,] -0.73055871  2.3385975
&gt; [2,]  0.59572858 -1.9069916
&gt; [3,] -0.08891186  0.2846165
&gt; [4,] -0.12553344  0.4018461
&gt; [5,] -0.48032110  1.5375598
&gt; [6,] -1.19147316  3.8140345
&gt; [1] "Data"
&gt;          SBP        DBP
&gt; 1 -3.0000000  2.3385975
&gt; 2  0.5957286 -2.0000000
&gt; 3 -1.0000000  0.0000000
&gt; 4  1.0000000  0.4018461
&gt; 5  1.0000000  2.0000000
&gt; 6 -1.1914732  4.0000000
&gt; Iter: 4 
&gt;  MSS: 0.8998268 
&gt;  Rel. Err: 0.3222623 
&gt; [1] "Xapp"
&gt;             [,1]        [,2]
&gt; [1,] -1.53549232  3.07087697
&gt; [2,]  0.91916923 -1.83827401
&gt; [3,] -0.20001122  0.40000841
&gt; [4,]  0.03926938 -0.07853601
&gt; [5,] -0.60000561  1.19996915
&gt; [6,] -1.83834165  3.67655441
&gt; [1] "Data"
&gt;          SBP         DBP
&gt; 1 -3.0000000  3.07087697
&gt; 2  0.9191692 -2.00000000
&gt; 3 -1.0000000  0.00000000
&gt; 4  1.0000000 -0.07853601
&gt; 5  1.0000000  2.00000000
&gt; 6 -1.8383417  4.00000000
&gt; Iter: 5 
&gt;  MSS: 0.6967107 
&gt;  Rel. Err: 0.2031161 
&gt; [1] "Xapp"
&gt;            [,1]       [,2]
&gt; [1,] -2.1668365  3.5757572
&gt; [2,]  1.1333206 -1.8702286
&gt; [3,] -0.2685842  0.4432231
&gt; [4,]  0.3033932 -0.5006656
&gt; [5,] -0.6178620  1.0196084
&gt; [6,] -2.2666421  3.7404586
&gt; [1] "Data"
&gt;         SBP        DBP
&gt; 1 -3.000000  3.5757572
&gt; 2  1.133321 -2.0000000
&gt; 3 -1.000000  0.0000000
&gt; 4  1.000000 -0.5006656
&gt; 5  1.000000  2.0000000
&gt; 6 -2.266642  4.0000000
&gt; Iter: 6 
&gt;  MSS: 0.612954 
&gt;  Rel. Err: 0.08375675 
&gt; [1] "Xapp"
&gt;            [,1]       [,2]
&gt; [1,] -2.5102026  3.8916848
&gt; [2,]  1.2439901 -1.9286163
&gt; [3,] -0.2938087  0.4555054
&gt; [4,]  0.5218645 -0.8090711
&gt; [5,] -0.6172021  0.9568773
&gt; [6,] -2.4879805  3.8572330
&gt; [1] "Data"
&gt;         SBP        DBP
&gt; 1 -3.000000  3.8916848
&gt; 2  1.243990 -2.0000000
&gt; 3 -1.000000  0.0000000
&gt; 4  1.000000 -0.8090711
&gt; 5  1.000000  2.0000000
&gt; 6 -2.487981  4.0000000
&gt; Iter: 7 
&gt;  MSS: 0.5807517 
&gt;  Rel. Err: 0.03220227 
&gt; [1] "Xapp"
&gt;            [,1]       [,2]
&gt; [1,] -2.6813227  4.1000892
&gt; [2,]  1.2887789 -1.9707096
&gt; [3,] -0.2995594  0.4580650
&gt; [4,]  0.6701665 -1.0247713
&gt; [5,] -0.6165707  0.9428163
&gt; [6,] -2.5775579  3.9414194
&gt; [1] "Data"
&gt;         SBP       DBP
&gt; 1 -3.000000  4.100089
&gt; 2  1.288779 -2.000000
&gt; 3 -1.000000  0.000000
&gt; 4  1.000000 -1.024771
&gt; 5  1.000000  2.000000
&gt; 6 -2.577558  4.000000
&gt; Iter: 8 
&gt;  MSS: 0.5665195 
&gt;  Rel. Err: 0.01423225 
&gt; [1] "Xapp"
&gt;            [,1]      [,2]
&gt; [1,] -2.7628696  4.254096
&gt; [2,]  1.2959129 -1.995367
&gt; [3,] -0.2966660  0.456788
&gt; [4,]  0.7647692 -1.177544
&gt; [5,] -0.6169100  0.949880
&gt; [6,] -2.5918258  3.990734
&gt; [1] "Data"
&gt;         SBP       DBP
&gt; 1 -3.000000  4.254096
&gt; 2  1.295913 -2.000000
&gt; 3 -1.000000  0.000000
&gt; 4  1.000000 -1.177544
&gt; 5  1.000000  2.000000
&gt; 6 -2.591826  4.000000
&gt; Iter: 9 
&gt;  MSS: 0.558216 
&gt;  Rel. Err: 0.00830349 
&gt; [1] "Xapp"
&gt;            [,1]       [,2]
&gt; [1,] -2.7988324  4.3825676
&gt; [2,]  1.2826615 -2.0084627
&gt; [3,] -0.2896952  0.4536209
&gt; [4,]  0.8238540 -1.2900364
&gt; [5,] -0.6175465  0.9669887
&gt; [6,] -2.5653230  4.0169255
&gt; [1] "Data"
&gt;         SBP       DBP
&gt; 1 -3.000000  4.382568
&gt; 2  1.282661 -2.000000
&gt; 3 -1.000000  0.000000
&gt; 4  1.000000 -1.290036
&gt; 5  1.000000  2.000000
&gt; 6 -2.565323  4.000000</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="softimpute" class="level2"><h2 class="anchored" data-anchor-id="softimpute">SoftImpute</h2>
<div>
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>initialisation_data_tidymodels <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(</span>
<span id="cb34-3"><a href="#cb34-3"></a>    <span class="at">defaultPageSize =</span> <span class="dv">6</span>,</span>
<span id="cb34-4"><a href="#cb34-4"></a>    <span class="at">columns =</span> <span class="fu">list</span>(</span>
<span id="cb34-5"><a href="#cb34-5"></a>      <span class="at">SBP =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(<span class="at">format =</span> reactable<span class="sc">::</span><span class="fu">colFormat</span>(<span class="at">digits =</span> <span class="dv">2</span>)),</span>
<span id="cb34-6"><a href="#cb34-6"></a>      <span class="at">DBP =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(<span class="at">format =</span> reactable<span class="sc">::</span><span class="fu">colFormat</span>(<span class="at">digits =</span> <span class="dv">2</span>))</span>
<span id="cb34-7"><a href="#cb34-7"></a>    ),</span>
<span id="cb34-8"><a href="#cb34-8"></a>    <span class="at">defaultColDef =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(</span>
<span id="cb34-9"><a href="#cb34-9"></a>      <span class="at">style =</span> colour_missing_cells</span>
<span id="cb34-10"><a href="#cb34-10"></a>    )</span>
<span id="cb34-11"><a href="#cb34-11"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-12"><a href="#cb34-12"></a>  reactablefmtr<span class="sc">::</span><span class="fu">add_title</span>(</span>
<span id="cb34-13"><a href="#cb34-13"></a>    <span class="at">title =</span> <span class="st">"Algorithm 12.1"</span></span>
<span id="cb34-14"><a href="#cb34-14"></a>  )</span>
<span id="cb34-15"><a href="#cb34-15"></a>fits <span class="ot">&lt;-</span> softImpute<span class="sc">::</span><span class="fu">softImpute</span>(missing_data, <span class="at">type =</span> <span class="st">"svd"</span>)</span>
<span id="cb34-16"><a href="#cb34-16"></a>softImpute<span class="sc">::</span><span class="fu">complete</span>(missing_data, fits) <span class="sc">%&gt;%</span></span>
<span id="cb34-17"><a href="#cb34-17"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(</span>
<span id="cb34-18"><a href="#cb34-18"></a>    <span class="at">defaultPageSize =</span> <span class="dv">6</span>,</span>
<span id="cb34-19"><a href="#cb34-19"></a>    <span class="at">columns =</span> <span class="fu">list</span>(</span>
<span id="cb34-20"><a href="#cb34-20"></a>      <span class="at">SBP =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(<span class="at">format =</span> reactable<span class="sc">::</span><span class="fu">colFormat</span>(<span class="at">digits =</span> <span class="dv">2</span>)),</span>
<span id="cb34-21"><a href="#cb34-21"></a>      <span class="at">DBP =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(<span class="at">format =</span> reactable<span class="sc">::</span><span class="fu">colFormat</span>(<span class="at">digits =</span> <span class="dv">2</span>))</span>
<span id="cb34-22"><a href="#cb34-22"></a>    ),</span>
<span id="cb34-23"><a href="#cb34-23"></a>    <span class="at">defaultColDef =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(</span>
<span id="cb34-24"><a href="#cb34-24"></a>      <span class="at">style =</span> colour_missing_cells</span>
<span id="cb34-25"><a href="#cb34-25"></a>    )</span>
<span id="cb34-26"><a href="#cb34-26"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-27"><a href="#cb34-27"></a>  reactablefmtr<span class="sc">::</span><span class="fu">add_title</span>(</span>
<span id="cb34-28"><a href="#cb34-28"></a>    <span class="at">title =</span> <span class="st">"Soft Impute"</span></span>
<span id="cb34-29"><a href="#cb34-29"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">

<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:32px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Algorithm 12.1</h1>
<div id="htmlwidget-7eb2de3db6cc5f6ef8b1" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7eb2de3db6cc5f6ef8b1">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"SBP":[-3,1.28266147864382,-1,1,1,-2.56532296378831],"DBP":[4.38256755539689,-2,0,-1.29003636881543,2,4]},"columns":[{"accessor":"SBP","name":"SBP","type":"numeric","style":[null,{"background":"#aaf0f8"},null,null,null,{"background":"#aaf0f8"}],"format":{"cell":{"digits":2},"aggregated":{"digits":2}}},{"accessor":"DBP","name":"DBP","type":"numeric","style":[{"background":"#aaf0f8"},null,null,{"background":"#aaf0f8"},null,null],"format":{"cell":{"digits":2},"aggregated":{"digits":2}}}],"defaultPageSize":6,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"48b84ac36001cd490861f534887086a2"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">

<h1 style="color:#000;background:#FFFFFF;text-align:left;font-size:32px;font-style:normal;font-weight:bold;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Soft Impute</h1>
<div id="htmlwidget-0505c0607e8e7a9d4053" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0505c0607e8e7a9d4053">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"SBP":[-3,-1.42293242457236,-1,1,1,2.84586484914471],"DBP":[-4.18812805883708,-2,0,1.39604268627903,2,4]},"columns":[{"accessor":"SBP","name":"SBP","type":"numeric","style":[null,{"background":"#aaf0f8"},null,null,null,{"background":"#aaf0f8"}],"format":{"cell":{"digits":2},"aggregated":{"digits":2}}},{"accessor":"DBP","name":"DBP","type":"numeric","style":[{"background":"#aaf0f8"},null,null,{"background":"#aaf0f8"},null,null],"format":{"cell":{"digits":2},"aggregated":{"digits":2}}}],"defaultPageSize":6,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"af935ee1c0fe2078fec87fb1b1472010"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</section></section><section id="k-means-clustering" class="level1"><h1>K-Means Clustering</h1>
<section id="introduction" class="level2"><h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>We begin with a simple simulated example in which there truly are two clusters in the</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb35-2"><a href="#cb35-2"></a></span>
<span id="cb35-3"><a href="#cb35-3"></a><span class="co"># CLuster centre at (0,0) and (3,-4)</span></span>
<span id="cb35-4"><a href="#cb35-4"></a>centers <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb35-5"><a href="#cb35-5"></a>  <span class="at">cluster =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>),</span>
<span id="cb35-6"><a href="#cb35-6"></a>  <span class="at">num_points =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">25</span>), <span class="co"># number points in each cluster</span></span>
<span id="cb35-7"><a href="#cb35-7"></a>  <span class="at">V1 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>), <span class="co"># V1 coordinate of cluster center</span></span>
<span id="cb35-8"><a href="#cb35-8"></a>  <span class="at">V2 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="dv">4</span>) <span class="co"># V2 coordinate of cluster center</span></span>
<span id="cb35-9"><a href="#cb35-9"></a>)</span>
<span id="cb35-10"><a href="#cb35-10"></a></span>
<span id="cb35-11"><a href="#cb35-11"></a>labelled_points <span class="ot">&lt;-</span> centers <span class="sc">%&gt;%</span></span>
<span id="cb35-12"><a href="#cb35-12"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb35-13"><a href="#cb35-13"></a>    <span class="at">V1 =</span> purrr<span class="sc">::</span><span class="fu">map2</span>(.data[[<span class="st">"num_points"</span>]], .data[[<span class="st">"V1"</span>]], rnorm),</span>
<span id="cb35-14"><a href="#cb35-14"></a>    <span class="at">V2 =</span> purrr<span class="sc">::</span><span class="fu">map2</span>(.data[[<span class="st">"num_points"</span>]], .data[[<span class="st">"V2"</span>]], rnorm)</span>
<span id="cb35-15"><a href="#cb35-15"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb35-16"><a href="#cb35-16"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"num_points"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb35-17"><a href="#cb35-17"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"V1"</span>, <span class="st">"V2"</span>))</span>
<span id="cb35-18"><a href="#cb35-18"></a></span>
<span id="cb35-19"><a href="#cb35-19"></a>labelled_points <span class="sc">%&gt;%</span></span>
<span id="cb35-20"><a href="#cb35-20"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(</span>
<span id="cb35-21"><a href="#cb35-21"></a>    <span class="at">defaultPageSize =</span> <span class="dv">10</span>,</span>
<span id="cb35-22"><a href="#cb35-22"></a>    <span class="at">columns =</span> <span class="fu">list</span>(</span>
<span id="cb35-23"><a href="#cb35-23"></a>      <span class="at">V1 =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(<span class="at">format =</span> reactable<span class="sc">::</span><span class="fu">colFormat</span>(<span class="at">digits =</span> <span class="dv">2</span>)),</span>
<span id="cb35-24"><a href="#cb35-24"></a>      <span class="at">V2 =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(<span class="at">format =</span> reactable<span class="sc">::</span><span class="fu">colFormat</span>(<span class="at">digits =</span> <span class="dv">2</span>))</span>
<span id="cb35-25"><a href="#cb35-25"></a>    )</span>
<span id="cb35-26"><a href="#cb35-26"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-f019ca2f6a50b7a45aba" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f019ca2f6a50b7a45aba">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"cluster":["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2"],"V1":[-0.896914546624981,0.184849184646742,1.58784533120882,-1.13037567424629,-0.0802517565509893,0.132420284381094,0.707954729271733,-0.23969802417184,1.98447393665293,-0.138787012119665,0.417650750792556,0.981752777463662,-0.392695355503813,-1.03966897694891,1.78222896030858,-2.31106908460517,0.878604580921265,0.035806718015226,1.01282869212708,0.432265154539617,2.09081920524915,-1.19992581964387,1.58963820029007,1.95465164222325,0.00493777682814261,0.548293612153874,3.47723730261362,2.4034418313686,3.79220327029965,3.28963671017735,3.73893860376212,3.31896040109765,4.076164353812,2.71584227951175,2.22332472602024,2.40433950130822,1.27402022085397,2.09741552023631,2.44093808509953,2.75348743266648,2.61641377156856,1.04089682483287,2.15829493986439,4.90354746734764,3.62249393012074,4.99092043558031,2.69451627515855,2.90915576479924,2.81583854844874,1.80123223469259],"V2":[-0.838287147602044,2.06630135573124,-0.562247053342494,1.27571551185092,-1.04757262699498,-1.96587824144733,-0.322971093759972,0.935862526808633,1.13922980273408,1.67161876732599,-1.78824220676485,2.03124251875525,-0.703144332993886,0.158164762560122,0.50623479748072,-0.819995105616198,-1.99884699496412,-0.479292591451641,0.0841799043222426,-0.895486610663309,-0.921275665507737,0.330449503465315,-0.141660808936081,0.434847761502698,-0.053722626017184,-4.90711037559349,-2.69648776757773,-3.22821022446014,-2.94747440469236,-5.41003834066371,-3.00401541022225,-5.69576490337902,-4.5333721425472,-5.37226945114308,-6.20791977880464,-2.17787748124644,-4.65339341081878,-4.28468121935507,-4.38694960364493,-3.61330502535393,-2.39960914846048,-2.31884504423318,-5.18360638822726,-5.3584572535632,-5.512670794721,-5.2531048993692,-2.0406429228544,-3.99235412786723,-4.84261519758963,-4.60116010515235]},"columns":[{"accessor":"cluster","name":"cluster","type":"factor"},{"accessor":"V1","name":"V1","type":"numeric","format":{"cell":{"digits":2},"aggregated":{"digits":2}}},{"accessor":"V2","name":"V2","type":"numeric","format":{"cell":{"digits":2},"aggregated":{"digits":2}}}],"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"600c53aec0172c2d637cfe8208f42ce4"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb36-2"><a href="#cb36-2"></a>  <span class="at">data =</span> labelled_points,</span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb36-4"><a href="#cb36-4"></a>    <span class="at">x =</span> .data[[<span class="st">"V1"</span>]],</span>
<span id="cb36-5"><a href="#cb36-5"></a>    <span class="at">y =</span> .data[[<span class="st">"V2"</span>]],</span>
<span id="cb36-6"><a href="#cb36-6"></a>    <span class="at">color =</span> .data[[<span class="st">"cluster"</span>]]</span>
<span id="cb36-7"><a href="#cb36-7"></a>  )</span>
<span id="cb36-8"><a href="#cb36-8"></a>) <span class="sc">+</span></span>
<span id="cb36-9"><a href="#cb36-9"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-24-2.png" class="img-fluid" width="3883"></p>
</div>
</div>
<p>We now perform K-means clustering with <span class="math inline">\(K = 2\)</span>.</p>
<p>We’ll use the built-in <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/kmeans.html"><code>stats::kmeans</code></a> function, which accepts a data frame with all numeric columns as it’s primary argument</p>
<div class="cell" data-max.height="300px">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>points <span class="ot">&lt;-</span> labelled_points <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"cluster"</span>))</span>
<span id="cb37-3"><a href="#cb37-3"></a></span>
<span id="cb37-4"><a href="#cb37-4"></a>result_kmeans <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">kmeans</span>(</span>
<span id="cb37-5"><a href="#cb37-5"></a>  <span class="at">x =</span> points,</span>
<span id="cb37-6"><a href="#cb37-6"></a>  <span class="at">centers =</span> <span class="dv">2</span>,</span>
<span id="cb37-7"><a href="#cb37-7"></a>  <span class="at">nstart =</span> <span class="dv">20</span></span>
<span id="cb37-8"><a href="#cb37-8"></a>)</span>
<span id="cb37-9"><a href="#cb37-9"></a></span>
<span id="cb37-10"><a href="#cb37-10"></a>result_kmeans</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre style="max-height: 300px;"><code>&gt; K-means clustering with 2 clusters of sizes 26, 24
&gt; 
&gt; Cluster means:
&gt;         V1        V2
&gt; 1 0.361163 -0.162447
&gt; 2 2.877777 -4.262629
&gt; 
&gt; Clustering vector:
&gt;  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2
&gt; [39] 2 2 2 1 2 2 2 2 2 2 2 2
&gt; 
&gt; Within cluster sum of squares by cluster:
&gt; [1] 68.52253 58.53435
&gt;  (between_SS / total_SS =  69.5 %)
&gt; 
&gt; Available components:
&gt; 
&gt; [1] "cluster"      "centers"      "totss"        "withinss"     "tot.withinss"
&gt; [6] "betweenss"    "size"         "iter"         "ifault"</code></pre>
</div>
</div>
<p>The <a href="https://broom.tidymodels.org/"><code>broom::tidy</code></a> function returns information for each cluster, including their mean position (centroid), size and within-cluster sum-of-squares.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>result_kmeans <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-b83068cdf40bd79430b4" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b83068cdf40bd79430b4">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"V1":[0.361163019205279,2.87777738410676],"V2":[-0.162446959144531,-4.26262876572115],"size":[26,24],"withinss":[68.522525237568,58.5343503354752],"cluster":["1","2"]},"columns":[{"accessor":"V1","name":"V1","type":"numeric"},{"accessor":"V2","name":"V2","type":"numeric"},{"accessor":"size","name":"size","type":"numeric"},{"accessor":"withinss","name":"withinss","type":"numeric"},{"accessor":"cluster","name":"cluster","type":"factor"}],"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"96032b17147c8a5901044ee2bf27d3bc"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The <a href="https://broom.tidymodels.org/"><code>broom::glance</code></a> function returns model wise metrics. One of these is <code>tot.withinss</code> which is the <strong>total</strong> within-cluster sum-of-squares that we seek to minimize when we perform K-means clustering.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>result_kmeans <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>  broom<span class="sc">::</span><span class="fu">glance</span>() <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-db483dd40ae1adf47295" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-db483dd40ae1adf47295">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"totss":[415.9044626565],"tot.withinss":[127.056875573043],"betweenss":[288.847587083457],"iter":[1]},"columns":[{"accessor":"totss","name":"totss","type":"numeric"},{"accessor":"tot.withinss","name":"tot.withinss","type":"numeric"},{"accessor":"betweenss","name":"betweenss","type":"numeric"},{"accessor":"iter","name":"iter","type":"numeric"}],"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"c724a2e17b038acb4a95249fa3614e23"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We can see what cluster each observation belongs to by using <a href="https://broom.tidymodels.org/"><code>broom::augment</code></a> which “predict” which cluster a given observation belongs to.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>predicted_kmeans <span class="ot">&lt;-</span> result_kmeans <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>  broom<span class="sc">::</span><span class="fu">augment</span>(<span class="at">data =</span> points)</span>
<span id="cb41-3"><a href="#cb41-3"></a></span>
<span id="cb41-4"><a href="#cb41-4"></a>predicted_kmeans <span class="sc">%&gt;%</span></span>
<span id="cb41-5"><a href="#cb41-5"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-baa69d9e9010fbdbc655" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-baa69d9e9010fbdbc655">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"V1":[-0.896914546624981,0.184849184646742,1.58784533120882,-1.13037567424629,-0.0802517565509893,0.132420284381094,0.707954729271733,-0.23969802417184,1.98447393665293,-0.138787012119665,0.417650750792556,0.981752777463662,-0.392695355503813,-1.03966897694891,1.78222896030858,-2.31106908460517,0.878604580921265,0.035806718015226,1.01282869212708,0.432265154539617,2.09081920524915,-1.19992581964387,1.58963820029007,1.95465164222325,0.00493777682814261,0.548293612153874,3.47723730261362,2.4034418313686,3.79220327029965,3.28963671017735,3.73893860376212,3.31896040109765,4.076164353812,2.71584227951175,2.22332472602024,2.40433950130822,1.27402022085397,2.09741552023631,2.44093808509953,2.75348743266648,2.61641377156856,1.04089682483287,2.15829493986439,4.90354746734764,3.62249393012074,4.99092043558031,2.69451627515855,2.90915576479924,2.81583854844874,1.80123223469259],"V2":[-0.838287147602044,2.06630135573124,-0.562247053342494,1.27571551185092,-1.04757262699498,-1.96587824144733,-0.322971093759972,0.935862526808633,1.13922980273408,1.67161876732599,-1.78824220676485,2.03124251875525,-0.703144332993886,0.158164762560122,0.50623479748072,-0.819995105616198,-1.99884699496412,-0.479292591451641,0.0841799043222426,-0.895486610663309,-0.921275665507737,0.330449503465315,-0.141660808936081,0.434847761502698,-0.053722626017184,-4.90711037559349,-2.69648776757773,-3.22821022446014,-2.94747440469236,-5.41003834066371,-3.00401541022225,-5.69576490337902,-4.5333721425472,-5.37226945114308,-6.20791977880464,-2.17787748124644,-4.65339341081878,-4.28468121935507,-4.38694960364493,-3.61330502535393,-2.39960914846048,-2.31884504423318,-5.18360638822726,-5.3584572535632,-5.512670794721,-5.2531048993692,-2.0406429228544,-3.99235412786723,-4.84261519758963,-4.60116010515235],".cluster":["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","1","2","2","2","2","2","2","2","2"]},"columns":[{"accessor":"V1","name":"V1","type":"numeric"},{"accessor":"V2","name":"V2","type":"numeric"},{"accessor":".cluster","name":".cluster","type":"factor"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"37664fa9bc32e0899eeb1319783267b6"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb42-2"><a href="#cb42-2"></a>  <span class="at">data =</span> predicted_kmeans,</span>
<span id="cb42-3"><a href="#cb42-3"></a>  <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb42-4"><a href="#cb42-4"></a>    <span class="at">x =</span> .data[[<span class="st">"V1"</span>]],</span>
<span id="cb42-5"><a href="#cb42-5"></a>    <span class="at">y =</span> .data[[<span class="st">"V2"</span>]],</span>
<span id="cb42-6"><a href="#cb42-6"></a>    <span class="at">color =</span> .data[[<span class="st">".cluster"</span>]]</span>
<span id="cb42-7"><a href="#cb42-7"></a>  )</span>
<span id="cb42-8"><a href="#cb42-8"></a>) <span class="sc">+</span></span>
<span id="cb42-9"><a href="#cb42-9"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="3883"></p>
</div>
</div>
</section><section id="exploration" class="level2"><h2 class="anchored" data-anchor-id="exploration">Exploration</h2>
<p>In reality, we will not know how many clusters is required for a given dataset. We need to try out a number of different values of <span class="math inline">\(K\)</span> and then find the best one.</p>
<p>Let us try <span class="math inline">\(K\)</span> from 1 to 9.</p>
<div class="cell" data-max.height="300px">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>kclusts <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb43-3"><a href="#cb43-3"></a>    <span class="at">kclust =</span> purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb43-4"><a href="#cb43-4"></a>      <span class="at">.x =</span> .data[[<span class="st">"k"</span>]],</span>
<span id="cb43-5"><a href="#cb43-5"></a>      <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">kmeans</span>(<span class="at">x =</span> points, <span class="at">centers =</span> .x)</span>
<span id="cb43-6"><a href="#cb43-6"></a>    )</span>
<span id="cb43-7"><a href="#cb43-7"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb43-8"><a href="#cb43-8"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb43-9"><a href="#cb43-9"></a>    <span class="at">tidied =</span> purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb43-10"><a href="#cb43-10"></a>      <span class="at">.x =</span> .data[[<span class="st">"kclust"</span>]],</span>
<span id="cb43-11"><a href="#cb43-11"></a>      <span class="at">.f =</span> broom<span class="sc">::</span>tidy</span>
<span id="cb43-12"><a href="#cb43-12"></a>    ),</span>
<span id="cb43-13"><a href="#cb43-13"></a>    <span class="at">glanced =</span> purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb43-14"><a href="#cb43-14"></a>      <span class="at">.x =</span> .data[[<span class="st">"kclust"</span>]],</span>
<span id="cb43-15"><a href="#cb43-15"></a>      <span class="at">.f =</span> broom<span class="sc">::</span>glance</span>
<span id="cb43-16"><a href="#cb43-16"></a>    ),</span>
<span id="cb43-17"><a href="#cb43-17"></a>    <span class="at">augmented =</span> purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb43-18"><a href="#cb43-18"></a>      <span class="at">.x =</span> .data[[<span class="st">"kclust"</span>]],</span>
<span id="cb43-19"><a href="#cb43-19"></a>      <span class="at">.f =</span> broom<span class="sc">::</span>augment, <span class="at">data =</span> points</span>
<span id="cb43-20"><a href="#cb43-20"></a>    )</span>
<span id="cb43-21"><a href="#cb43-21"></a>  )</span>
<span id="cb43-22"><a href="#cb43-22"></a></span>
<span id="cb43-23"><a href="#cb43-23"></a>kclusts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre style="max-height: 300px;"><code>&gt; # A tibble: 9 × 5
&gt;       k kclust   tidied           glanced          augmented        
&gt;   &lt;int&gt; &lt;list&gt;   &lt;list&gt;           &lt;list&gt;           &lt;list&gt;           
&gt; 1     1 &lt;kmeans&gt; &lt;tibble [1 × 5]&gt; &lt;tibble [1 × 4]&gt; &lt;tibble [50 × 3]&gt;
&gt; 2     2 &lt;kmeans&gt; &lt;tibble [2 × 5]&gt; &lt;tibble [1 × 4]&gt; &lt;tibble [50 × 3]&gt;
&gt; 3     3 &lt;kmeans&gt; &lt;tibble [3 × 5]&gt; &lt;tibble [1 × 4]&gt; &lt;tibble [50 × 3]&gt;
&gt; 4     4 &lt;kmeans&gt; &lt;tibble [4 × 5]&gt; &lt;tibble [1 × 4]&gt; &lt;tibble [50 × 3]&gt;
&gt; 5     5 &lt;kmeans&gt; &lt;tibble [5 × 5]&gt; &lt;tibble [1 × 4]&gt; &lt;tibble [50 × 3]&gt;
&gt; 6     6 &lt;kmeans&gt; &lt;tibble [6 × 5]&gt; &lt;tibble [1 × 4]&gt; &lt;tibble [50 × 3]&gt;
&gt; 7     7 &lt;kmeans&gt; &lt;tibble [7 × 5]&gt; &lt;tibble [1 × 4]&gt; &lt;tibble [50 × 3]&gt;
&gt; 8     8 &lt;kmeans&gt; &lt;tibble [8 × 5]&gt; &lt;tibble [1 × 4]&gt; &lt;tibble [50 × 3]&gt;
&gt; 9     9 &lt;kmeans&gt; &lt;tibble [9 × 5]&gt; &lt;tibble [1 × 4]&gt; &lt;tibble [50 × 3]&gt;</code></pre>
</div>
</div>
<p>Let <code>assignments</code> be a dataset of which cluster each points goes to for <span class="math inline">\(K\)</span> from 1 to 9</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>assignments <span class="ot">&lt;-</span> kclusts <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"k"</span>, <span class="st">"augmented"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"augmented"</span>))</span>
<span id="cb45-4"><a href="#cb45-4"></a></span>
<span id="cb45-5"><a href="#cb45-5"></a>assignments <span class="sc">%&gt;%</span></span>
<span id="cb45-6"><a href="#cb45-6"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-dd37d50e9819e97463e9" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-dd37d50e9819e97463e9">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"k":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],"V1":[-0.896914546624981,0.184849184646742,1.58784533120882,-1.13037567424629,-0.0802517565509893,0.132420284381094,0.707954729271733,-0.23969802417184,1.98447393665293,-0.138787012119665,0.417650750792556,0.981752777463662,-0.392695355503813,-1.03966897694891,1.78222896030858,-2.31106908460517,0.878604580921265,0.035806718015226,1.01282869212708,0.432265154539617,2.09081920524915,-1.19992581964387,1.58963820029007,1.95465164222325,0.00493777682814261,0.548293612153874,3.47723730261362,2.4034418313686,3.79220327029965,3.28963671017735,3.73893860376212,3.31896040109765,4.076164353812,2.71584227951175,2.22332472602024,2.40433950130822,1.27402022085397,2.09741552023631,2.44093808509953,2.75348743266648,2.61641377156856,1.04089682483287,2.15829493986439,4.90354746734764,3.62249393012074,4.99092043558031,2.69451627515855,2.90915576479924,2.81583854844874,1.80123223469259,-0.896914546624981,0.184849184646742,1.58784533120882,-1.13037567424629,-0.0802517565509893,0.132420284381094,0.707954729271733,-0.23969802417184,1.98447393665293,-0.138787012119665,0.417650750792556,0.981752777463662,-0.392695355503813,-1.03966897694891,1.78222896030858,-2.31106908460517,0.878604580921265,0.035806718015226,1.01282869212708,0.432265154539617,2.09081920524915,-1.19992581964387,1.58963820029007,1.95465164222325,0.00493777682814261,0.548293612153874,3.47723730261362,2.4034418313686,3.79220327029965,3.28963671017735,3.73893860376212,3.31896040109765,4.076164353812,2.71584227951175,2.22332472602024,2.40433950130822,1.27402022085397,2.09741552023631,2.44093808509953,2.75348743266648,2.61641377156856,1.04089682483287,2.15829493986439,4.90354746734764,3.62249393012074,4.99092043558031,2.69451627515855,2.90915576479924,2.81583854844874,1.80123223469259,-0.896914546624981,0.184849184646742,1.58784533120882,-1.13037567424629,-0.0802517565509893,0.132420284381094,0.707954729271733,-0.23969802417184,1.98447393665293,-0.138787012119665,0.417650750792556,0.981752777463662,-0.392695355503813,-1.03966897694891,1.78222896030858,-2.31106908460517,0.878604580921265,0.035806718015226,1.01282869212708,0.432265154539617,2.09081920524915,-1.19992581964387,1.58963820029007,1.95465164222325,0.00493777682814261,0.548293612153874,3.47723730261362,2.4034418313686,3.79220327029965,3.28963671017735,3.73893860376212,3.31896040109765,4.076164353812,2.71584227951175,2.22332472602024,2.40433950130822,1.27402022085397,2.09741552023631,2.44093808509953,2.75348743266648,2.61641377156856,1.04089682483287,2.15829493986439,4.90354746734764,3.62249393012074,4.99092043558031,2.69451627515855,2.90915576479924,2.81583854844874,1.80123223469259,-0.896914546624981,0.184849184646742,1.58784533120882,-1.13037567424629,-0.0802517565509893,0.132420284381094,0.707954729271733,-0.23969802417184,1.98447393665293,-0.138787012119665,0.417650750792556,0.981752777463662,-0.392695355503813,-1.03966897694891,1.78222896030858,-2.31106908460517,0.878604580921265,0.035806718015226,1.01282869212708,0.432265154539617,2.09081920524915,-1.19992581964387,1.58963820029007,1.95465164222325,0.00493777682814261,0.548293612153874,3.47723730261362,2.4034418313686,3.79220327029965,3.28963671017735,3.73893860376212,3.31896040109765,4.076164353812,2.71584227951175,2.22332472602024,2.40433950130822,1.27402022085397,2.09741552023631,2.44093808509953,2.75348743266648,2.61641377156856,1.04089682483287,2.15829493986439,4.90354746734764,3.62249393012074,4.99092043558031,2.69451627515855,2.90915576479924,2.81583854844874,1.80123223469259,-0.896914546624981,0.184849184646742,1.58784533120882,-1.13037567424629,-0.0802517565509893,0.132420284381094,0.707954729271733,-0.23969802417184,1.98447393665293,-0.138787012119665,0.417650750792556,0.981752777463662,-0.392695355503813,-1.03966897694891,1.78222896030858,-2.31106908460517,0.878604580921265,0.035806718015226,1.01282869212708,0.432265154539617,2.09081920524915,-1.19992581964387,1.58963820029007,1.95465164222325,0.00493777682814261,0.548293612153874,3.47723730261362,2.4034418313686,3.79220327029965,3.28963671017735,3.73893860376212,3.31896040109765,4.076164353812,2.71584227951175,2.22332472602024,2.40433950130822,1.27402022085397,2.09741552023631,2.44093808509953,2.75348743266648,2.61641377156856,1.04089682483287,2.15829493986439,4.90354746734764,3.62249393012074,4.99092043558031,2.69451627515855,2.90915576479924,2.81583854844874,1.80123223469259,-0.896914546624981,0.184849184646742,1.58784533120882,-1.13037567424629,-0.0802517565509893,0.132420284381094,0.707954729271733,-0.23969802417184,1.98447393665293,-0.138787012119665,0.417650750792556,0.981752777463662,-0.392695355503813,-1.03966897694891,1.78222896030858,-2.31106908460517,0.878604580921265,0.035806718015226,1.01282869212708,0.432265154539617,2.09081920524915,-1.19992581964387,1.58963820029007,1.95465164222325,0.00493777682814261,0.548293612153874,3.47723730261362,2.4034418313686,3.79220327029965,3.28963671017735,3.73893860376212,3.31896040109765,4.076164353812,2.71584227951175,2.22332472602024,2.40433950130822,1.27402022085397,2.09741552023631,2.44093808509953,2.75348743266648,2.61641377156856,1.04089682483287,2.15829493986439,4.90354746734764,3.62249393012074,4.99092043558031,2.69451627515855,2.90915576479924,2.81583854844874,1.80123223469259,-0.896914546624981,0.184849184646742,1.58784533120882,-1.13037567424629,-0.0802517565509893,0.132420284381094,0.707954729271733,-0.23969802417184,1.98447393665293,-0.138787012119665,0.417650750792556,0.981752777463662,-0.392695355503813,-1.03966897694891,1.78222896030858,-2.31106908460517,0.878604580921265,0.035806718015226,1.01282869212708,0.432265154539617,2.09081920524915,-1.19992581964387,1.58963820029007,1.95465164222325,0.00493777682814261,0.548293612153874,3.47723730261362,2.4034418313686,3.79220327029965,3.28963671017735,3.73893860376212,3.31896040109765,4.076164353812,2.71584227951175,2.22332472602024,2.40433950130822,1.27402022085397,2.09741552023631,2.44093808509953,2.75348743266648,2.61641377156856,1.04089682483287,2.15829493986439,4.90354746734764,3.62249393012074,4.99092043558031,2.69451627515855,2.90915576479924,2.81583854844874,1.80123223469259,-0.896914546624981,0.184849184646742,1.58784533120882,-1.13037567424629,-0.0802517565509893,0.132420284381094,0.707954729271733,-0.23969802417184,1.98447393665293,-0.138787012119665,0.417650750792556,0.981752777463662,-0.392695355503813,-1.03966897694891,1.78222896030858,-2.31106908460517,0.878604580921265,0.035806718015226,1.01282869212708,0.432265154539617,2.09081920524915,-1.19992581964387,1.58963820029007,1.95465164222325,0.00493777682814261,0.548293612153874,3.47723730261362,2.4034418313686,3.79220327029965,3.28963671017735,3.73893860376212,3.31896040109765,4.076164353812,2.71584227951175,2.22332472602024,2.40433950130822,1.27402022085397,2.09741552023631,2.44093808509953,2.75348743266648,2.61641377156856,1.04089682483287,2.15829493986439,4.90354746734764,3.62249393012074,4.99092043558031,2.69451627515855,2.90915576479924,2.81583854844874,1.80123223469259,-0.896914546624981,0.184849184646742,1.58784533120882,-1.13037567424629,-0.0802517565509893,0.132420284381094,0.707954729271733,-0.23969802417184,1.98447393665293,-0.138787012119665,0.417650750792556,0.981752777463662,-0.392695355503813,-1.03966897694891,1.78222896030858,-2.31106908460517,0.878604580921265,0.035806718015226,1.01282869212708,0.432265154539617,2.09081920524915,-1.19992581964387,1.58963820029007,1.95465164222325,0.00493777682814261,0.548293612153874,3.47723730261362,2.4034418313686,3.79220327029965,3.28963671017735,3.73893860376212,3.31896040109765,4.076164353812,2.71584227951175,2.22332472602024,2.40433950130822,1.27402022085397,2.09741552023631,2.44093808509953,2.75348743266648,2.61641377156856,1.04089682483287,2.15829493986439,4.90354746734764,3.62249393012074,4.99092043558031,2.69451627515855,2.90915576479924,2.81583854844874,1.80123223469259],"V2":[-0.838287147602044,2.06630135573124,-0.562247053342494,1.27571551185092,-1.04757262699498,-1.96587824144733,-0.322971093759972,0.935862526808633,1.13922980273408,1.67161876732599,-1.78824220676485,2.03124251875525,-0.703144332993886,0.158164762560122,0.50623479748072,-0.819995105616198,-1.99884699496412,-0.479292591451641,0.0841799043222426,-0.895486610663309,-0.921275665507737,0.330449503465315,-0.141660808936081,0.434847761502698,-0.053722626017184,-4.90711037559349,-2.69648776757773,-3.22821022446014,-2.94747440469236,-5.41003834066371,-3.00401541022225,-5.69576490337902,-4.5333721425472,-5.37226945114308,-6.20791977880464,-2.17787748124644,-4.65339341081878,-4.28468121935507,-4.38694960364493,-3.61330502535393,-2.39960914846048,-2.31884504423318,-5.18360638822726,-5.3584572535632,-5.512670794721,-5.2531048993692,-2.0406429228544,-3.99235412786723,-4.84261519758963,-4.60116010515235,-0.838287147602044,2.06630135573124,-0.562247053342494,1.27571551185092,-1.04757262699498,-1.96587824144733,-0.322971093759972,0.935862526808633,1.13922980273408,1.67161876732599,-1.78824220676485,2.03124251875525,-0.703144332993886,0.158164762560122,0.50623479748072,-0.819995105616198,-1.99884699496412,-0.479292591451641,0.0841799043222426,-0.895486610663309,-0.921275665507737,0.330449503465315,-0.141660808936081,0.434847761502698,-0.053722626017184,-4.90711037559349,-2.69648776757773,-3.22821022446014,-2.94747440469236,-5.41003834066371,-3.00401541022225,-5.69576490337902,-4.5333721425472,-5.37226945114308,-6.20791977880464,-2.17787748124644,-4.65339341081878,-4.28468121935507,-4.38694960364493,-3.61330502535393,-2.39960914846048,-2.31884504423318,-5.18360638822726,-5.3584572535632,-5.512670794721,-5.2531048993692,-2.0406429228544,-3.99235412786723,-4.84261519758963,-4.60116010515235,-0.838287147602044,2.06630135573124,-0.562247053342494,1.27571551185092,-1.04757262699498,-1.96587824144733,-0.322971093759972,0.935862526808633,1.13922980273408,1.67161876732599,-1.78824220676485,2.03124251875525,-0.703144332993886,0.158164762560122,0.50623479748072,-0.819995105616198,-1.99884699496412,-0.479292591451641,0.0841799043222426,-0.895486610663309,-0.921275665507737,0.330449503465315,-0.141660808936081,0.434847761502698,-0.053722626017184,-4.90711037559349,-2.69648776757773,-3.22821022446014,-2.94747440469236,-5.41003834066371,-3.00401541022225,-5.69576490337902,-4.5333721425472,-5.37226945114308,-6.20791977880464,-2.17787748124644,-4.65339341081878,-4.28468121935507,-4.38694960364493,-3.61330502535393,-2.39960914846048,-2.31884504423318,-5.18360638822726,-5.3584572535632,-5.512670794721,-5.2531048993692,-2.0406429228544,-3.99235412786723,-4.84261519758963,-4.60116010515235,-0.838287147602044,2.06630135573124,-0.562247053342494,1.27571551185092,-1.04757262699498,-1.96587824144733,-0.322971093759972,0.935862526808633,1.13922980273408,1.67161876732599,-1.78824220676485,2.03124251875525,-0.703144332993886,0.158164762560122,0.50623479748072,-0.819995105616198,-1.99884699496412,-0.479292591451641,0.0841799043222426,-0.895486610663309,-0.921275665507737,0.330449503465315,-0.141660808936081,0.434847761502698,-0.053722626017184,-4.90711037559349,-2.69648776757773,-3.22821022446014,-2.94747440469236,-5.41003834066371,-3.00401541022225,-5.69576490337902,-4.5333721425472,-5.37226945114308,-6.20791977880464,-2.17787748124644,-4.65339341081878,-4.28468121935507,-4.38694960364493,-3.61330502535393,-2.39960914846048,-2.31884504423318,-5.18360638822726,-5.3584572535632,-5.512670794721,-5.2531048993692,-2.0406429228544,-3.99235412786723,-4.84261519758963,-4.60116010515235,-0.838287147602044,2.06630135573124,-0.562247053342494,1.27571551185092,-1.04757262699498,-1.96587824144733,-0.322971093759972,0.935862526808633,1.13922980273408,1.67161876732599,-1.78824220676485,2.03124251875525,-0.703144332993886,0.158164762560122,0.50623479748072,-0.819995105616198,-1.99884699496412,-0.479292591451641,0.0841799043222426,-0.895486610663309,-0.921275665507737,0.330449503465315,-0.141660808936081,0.434847761502698,-0.053722626017184,-4.90711037559349,-2.69648776757773,-3.22821022446014,-2.94747440469236,-5.41003834066371,-3.00401541022225,-5.69576490337902,-4.5333721425472,-5.37226945114308,-6.20791977880464,-2.17787748124644,-4.65339341081878,-4.28468121935507,-4.38694960364493,-3.61330502535393,-2.39960914846048,-2.31884504423318,-5.18360638822726,-5.3584572535632,-5.512670794721,-5.2531048993692,-2.0406429228544,-3.99235412786723,-4.84261519758963,-4.60116010515235,-0.838287147602044,2.06630135573124,-0.562247053342494,1.27571551185092,-1.04757262699498,-1.96587824144733,-0.322971093759972,0.935862526808633,1.13922980273408,1.67161876732599,-1.78824220676485,2.03124251875525,-0.703144332993886,0.158164762560122,0.50623479748072,-0.819995105616198,-1.99884699496412,-0.479292591451641,0.0841799043222426,-0.895486610663309,-0.921275665507737,0.330449503465315,-0.141660808936081,0.434847761502698,-0.053722626017184,-4.90711037559349,-2.69648776757773,-3.22821022446014,-2.94747440469236,-5.41003834066371,-3.00401541022225,-5.69576490337902,-4.5333721425472,-5.37226945114308,-6.20791977880464,-2.17787748124644,-4.65339341081878,-4.28468121935507,-4.38694960364493,-3.61330502535393,-2.39960914846048,-2.31884504423318,-5.18360638822726,-5.3584572535632,-5.512670794721,-5.2531048993692,-2.0406429228544,-3.99235412786723,-4.84261519758963,-4.60116010515235,-0.838287147602044,2.06630135573124,-0.562247053342494,1.27571551185092,-1.04757262699498,-1.96587824144733,-0.322971093759972,0.935862526808633,1.13922980273408,1.67161876732599,-1.78824220676485,2.03124251875525,-0.703144332993886,0.158164762560122,0.50623479748072,-0.819995105616198,-1.99884699496412,-0.479292591451641,0.0841799043222426,-0.895486610663309,-0.921275665507737,0.330449503465315,-0.141660808936081,0.434847761502698,-0.053722626017184,-4.90711037559349,-2.69648776757773,-3.22821022446014,-2.94747440469236,-5.41003834066371,-3.00401541022225,-5.69576490337902,-4.5333721425472,-5.37226945114308,-6.20791977880464,-2.17787748124644,-4.65339341081878,-4.28468121935507,-4.38694960364493,-3.61330502535393,-2.39960914846048,-2.31884504423318,-5.18360638822726,-5.3584572535632,-5.512670794721,-5.2531048993692,-2.0406429228544,-3.99235412786723,-4.84261519758963,-4.60116010515235,-0.838287147602044,2.06630135573124,-0.562247053342494,1.27571551185092,-1.04757262699498,-1.96587824144733,-0.322971093759972,0.935862526808633,1.13922980273408,1.67161876732599,-1.78824220676485,2.03124251875525,-0.703144332993886,0.158164762560122,0.50623479748072,-0.819995105616198,-1.99884699496412,-0.479292591451641,0.0841799043222426,-0.895486610663309,-0.921275665507737,0.330449503465315,-0.141660808936081,0.434847761502698,-0.053722626017184,-4.90711037559349,-2.69648776757773,-3.22821022446014,-2.94747440469236,-5.41003834066371,-3.00401541022225,-5.69576490337902,-4.5333721425472,-5.37226945114308,-6.20791977880464,-2.17787748124644,-4.65339341081878,-4.28468121935507,-4.38694960364493,-3.61330502535393,-2.39960914846048,-2.31884504423318,-5.18360638822726,-5.3584572535632,-5.512670794721,-5.2531048993692,-2.0406429228544,-3.99235412786723,-4.84261519758963,-4.60116010515235,-0.838287147602044,2.06630135573124,-0.562247053342494,1.27571551185092,-1.04757262699498,-1.96587824144733,-0.322971093759972,0.935862526808633,1.13922980273408,1.67161876732599,-1.78824220676485,2.03124251875525,-0.703144332993886,0.158164762560122,0.50623479748072,-0.819995105616198,-1.99884699496412,-0.479292591451641,0.0841799043222426,-0.895486610663309,-0.921275665507737,0.330449503465315,-0.141660808936081,0.434847761502698,-0.053722626017184,-4.90711037559349,-2.69648776757773,-3.22821022446014,-2.94747440469236,-5.41003834066371,-3.00401541022225,-5.69576490337902,-4.5333721425472,-5.37226945114308,-6.20791977880464,-2.17787748124644,-4.65339341081878,-4.28468121935507,-4.38694960364493,-3.61330502535393,-2.39960914846048,-2.31884504423318,-5.18360638822726,-5.3584572535632,-5.512670794721,-5.2531048993692,-2.0406429228544,-3.99235412786723,-4.84261519758963,-4.60116010515235],".cluster":["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","1","2","2","2","2","2","2","2","2","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","2","1","1","1","1","1","1","1","1","2","2","2","2","3","2","3","3","3","3","2","2","2","2","2","2","2","3","3","3","3","2","2","3","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","1","2","2","2","1","2","2","2","2","4","1","1","1","3","1","3","3","4","4","1","4","4","4","1","1","1","4","3","3","3","1","4","4","4","5","4","2","5","5","2","5","5","4","4","2","4","5","5","4","5","2","5","4","5","2","5","4","4","5","3","1","1","1","3","1","3","1","3","3","2","3","3","3","1","2","2","3","1","3","1","2","1","3","3","1","6","2","6","4","4","2","6","2","6","4","6","1","1","2","1","4","1","2","4","2","1","2","2","1","5","3","3","3","5","3","5","5","5","5","3","5","5","5","3","3","4","5","5","5","5","3","5","5","5","6","3","1","3","5","5","1","3","1","3","5","3","6","6","1","6","5","6","1","5","1","6","1","1","6","7","4","4","4","2","4","2","2","7","7","4","7","7","7","4","4","5","7","2","2","2","4","4","7","7","7","6","3","6","4","1","4","6","3","6","1","6","4","7","3","7","1","4","3","4","3","7","3","3","4","2","5","5","5","8","5","8","8","2","2","5","2","2","2","5","5","1","2","8","8","8","5","5","2","2","2","1","9","1","3","5","3","1","4","1","5","4","3","2","9","2","5","3","9","3","9","2","9","9","3","6","7","7","7","8","7","8","8","6","6","7","6","6","6","7","7","5","6","8","8","8","7","7","6","6"]},"columns":[{"accessor":"k","name":"k","type":"numeric"},{"accessor":"V1","name":"V1","type":"numeric"},{"accessor":"V2","name":"V2","type":"numeric"},{"accessor":".cluster","name":".cluster","type":"factor"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"aa56721a9b21929cd26d53ea9aa18c3e"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Now we can plot the original points using the data from assignments, with each point coloured according to the predicted cluster.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb46-2"><a href="#cb46-2"></a>  <span class="at">data =</span> assignments,</span>
<span id="cb46-3"><a href="#cb46-3"></a>  <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb46-4"><a href="#cb46-4"></a>    <span class="at">x =</span> .data[[<span class="st">"V1"</span>]],</span>
<span id="cb46-5"><a href="#cb46-5"></a>    <span class="at">y =</span> .data[[<span class="st">"V2"</span>]]</span>
<span id="cb46-6"><a href="#cb46-6"></a>  )</span>
<span id="cb46-7"><a href="#cb46-7"></a>) <span class="sc">+</span></span>
<span id="cb46-8"><a href="#cb46-8"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb46-9"><a href="#cb46-9"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> .data[[<span class="st">".cluster"</span>]]),</span>
<span id="cb46-10"><a href="#cb46-10"></a>    <span class="at">alpha =</span> <span class="fl">0.8</span></span>
<span id="cb46-11"><a href="#cb46-11"></a>  ) <span class="sc">+</span></span>
<span id="cb46-12"><a href="#cb46-12"></a>  <span class="fu">facet_wrap</span>(ggplot2<span class="sc">::</span><span class="fu">vars</span>(.data[[<span class="st">"k"</span>]]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="3883"></p>
</div>
</div>
<p>Let <code>clusters</code> be a dataset of cluster mean position (centroids) for <span class="math inline">\(K\)</span> from 1 to 9</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>clusters <span class="ot">&lt;-</span> kclusts <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"k"</span>, <span class="st">"tidied"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"tidied"</span>))</span>
<span id="cb47-4"><a href="#cb47-4"></a></span>
<span id="cb47-5"><a href="#cb47-5"></a>clusters <span class="sc">%&gt;%</span></span>
<span id="cb47-6"><a href="#cb47-6"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-ffa2ce8600ecb7234da1" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ffa2ce8600ecb7234da1">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"k":[1,2,2,3,3,3,4,4,4,4,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9],"V1":[1.56913791435799,0.361163019205279,2.87777738410676,0.31128071223263,2.30444592702097,3.41150237919808,2.53553623634083,0.233909473405825,4.03362054968928,2.09843559316806,3.67167738469441,1.54038961393568,2.35885760068976,1.16895454769908,-0.509136238303429,-0.828504184069054,1.58880508716645,2.98507224859322,0.470264306486069,2.82412995186352,-0.0684517496854772,1.58880508716645,4.03362054968928,-0.0684517496854772,2.97663708372723,0.470264306486069,-0.828504184069054,2.00835557409793,0.617393110231947,2.00835557409793,1.71464085257998,0.118002877766653,2.97663708372723,-0.0684517496854772,-1.36189460695573,4.03362054968928,-0.331002881472762,-1.36189460695573,0.118002877766653,1.48311335705829,0.617393110231947,2.00835557409793,2.97663708372723,4.03362054968928,1.66966867190116],"V2":[-2.13053422630131,-0.162446959144531,-4.26262876572115,0.00391962922664625,-3.32818520415606,-5.33698191500079,-2.48605364450662,0.0441455116064021,-5.29390138904056,-4.84320596581965,-3.84742013951703,-1.797051639869,-5.08818163075775,0.973999262364518,-0.205023319201185,-0.343689648236502,0.0270422055616824,-2.76345279810847,-1.6691452875113,-5.01221674952749,1.59614813609441,0.0270422055616824,-5.29390138904056,1.59614813609441,-2.89999739030388,-1.6691452875113,-0.343689648236502,-4.93774505892547,-2.01795312185237,-4.93774505892547,0.0770441054647759,-0.583698313646829,-2.89999739030388,1.59614813609441,-0.292416996798201,-5.29390138904056,1.4873745404292,-0.292416996798201,-0.583698313646829,1.58523616074467,-2.01795312185237,-4.93774505892547,-2.89999739030388,-5.29390138904056,-0.0999868440801086],"size":[50,26,24,24,16,10,11,23,6,10,9,9,12,8,12,7,8,8,6,16,5,8,6,5,9,6,7,9,4,9,7,6,9,5,4,6,4,4,6,2,4,9,9,6,6],"withinss":[415.9044626565,68.522525237568,58.5343503354752,59.0463375577275,30.2894689003941,10.8974363141729,14.5669761388172,54.8486920813524,3.71536074415667,8.46153749970896,14.5461355787099,10.672579449638,12.2740626346006,9.94436826890642,13.9796456704948,5.42630315901204,4.72117179719365,4.44371092713986,2.53172972391847,26.9821501705843,3.28374680984574,4.72117179719365,3.71536074415667,3.28374680984574,5.7912325189572,2.53172972391847,5.42630315901204,6.92685300322375,0.669062371386869,6.92685300322375,3.69442132553047,1.45287361669297,5.7912325189572,3.28374680984574,2.41450137168238,3.71536074415667,1.66845097151128,2.41450137168238,1.45287361669297,0.90056820431466,0.669062371386869,6.92685300322375,5.7912325189572,3.71536074415667,2.29319825199604],"cluster":["1","1","2","1","2","3","1","2","3","4","1","2","3","4","5","1","2","3","4","5","6","1","2","3","4","5","6","7","1","2","3","4","5","6","7","8","1","2","3","4","5","6","7","8","9"]},"columns":[{"accessor":"k","name":"k","type":"numeric"},{"accessor":"V1","name":"V1","type":"numeric"},{"accessor":"V2","name":"V2","type":"numeric"},{"accessor":"size","name":"size","type":"numeric"},{"accessor":"withinss","name":"withinss","type":"numeric"},{"accessor":"cluster","name":"cluster","type":"factor"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"3425a75bb601c205a765c5dd4560c30f"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We can then add the centers of the cluster using the data from <code>clusters</code></p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb48-2"><a href="#cb48-2"></a>  <span class="at">data =</span> assignments,</span>
<span id="cb48-3"><a href="#cb48-3"></a>  <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb48-4"><a href="#cb48-4"></a>    <span class="at">x =</span> .data[[<span class="st">"V1"</span>]],</span>
<span id="cb48-5"><a href="#cb48-5"></a>    <span class="at">y =</span> .data[[<span class="st">"V2"</span>]]</span>
<span id="cb48-6"><a href="#cb48-6"></a>  )</span>
<span id="cb48-7"><a href="#cb48-7"></a>) <span class="sc">+</span></span>
<span id="cb48-8"><a href="#cb48-8"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb48-9"><a href="#cb48-9"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> .data[[<span class="st">".cluster"</span>]]),</span>
<span id="cb48-10"><a href="#cb48-10"></a>    <span class="at">alpha =</span> <span class="fl">0.8</span></span>
<span id="cb48-11"><a href="#cb48-11"></a>  ) <span class="sc">+</span></span>
<span id="cb48-12"><a href="#cb48-12"></a>  <span class="fu">facet_wrap</span>(ggplot2<span class="sc">::</span><span class="fu">vars</span>(.data[[<span class="st">"k"</span>]])) <span class="sc">+</span></span>
<span id="cb48-13"><a href="#cb48-13"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb48-14"><a href="#cb48-14"></a>    <span class="at">data =</span> clusters,</span>
<span id="cb48-15"><a href="#cb48-15"></a>    <span class="at">size =</span> <span class="dv">10</span>,</span>
<span id="cb48-16"><a href="#cb48-16"></a>    <span class="at">shape =</span> <span class="st">"x"</span></span>
<span id="cb48-17"><a href="#cb48-17"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="3883"></p>
</div>
</div>
<p>Let <code>clusterings</code> be a dataset of cluster metrics for <span class="math inline">\(K\)</span> from 1 to 9</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a>clusterings <span class="ot">&lt;-</span> kclusts <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="#cb49-2"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"k"</span>, <span class="st">"glanced"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="#cb49-3"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"glanced"</span>))</span>
<span id="cb49-4"><a href="#cb49-4"></a></span>
<span id="cb49-5"><a href="#cb49-5"></a>clusterings <span class="sc">%&gt;%</span></span>
<span id="cb49-6"><a href="#cb49-6"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-0b4854b41ccea98a0422" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0b4854b41ccea98a0422">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"k":[1,2,3,4,5,6,7,8,9],"totss":[415.9044626565,415.9044626565,415.9044626565,415.9044626565,415.9044626565,415.9044626565,415.9044626565,415.9044626565,415.9044626565],"tot.withinss":[415.9044626565,127.056875573043,100.233242772295,81.5925664640352,61.4167916023497,47.388812587694,32.3963977563075,27.9480517614761,25.8321010539218],"betweenss":[0,288.847587083457,315.671219884206,334.311896192465,354.487671054151,368.515650068806,383.508064900193,387.956410895024,390.072361602578],"iter":[1,1,2,3,3,2,2,2,3]},"columns":[{"accessor":"k","name":"k","type":"numeric"},{"accessor":"totss","name":"totss","type":"numeric"},{"accessor":"tot.withinss","name":"tot.withinss","type":"numeric"},{"accessor":"betweenss","name":"betweenss","type":"numeric"},{"accessor":"iter","name":"iter","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"be804197b5538c4b8dce28e4b5933666"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Now that we have the total within-cluster sum-of-squares for <span class="math inline">\(K\)</span> from 1 to 9, we can plot them against k so we can use the elbow method to find the optimal number of clusters.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb50-2"><a href="#cb50-2"></a>  <span class="at">data =</span> clusterings,</span>
<span id="cb50-3"><a href="#cb50-3"></a>  <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb50-4"><a href="#cb50-4"></a>    <span class="at">x =</span> .data[[<span class="st">"k"</span>]],</span>
<span id="cb50-5"><a href="#cb50-5"></a>    <span class="at">y =</span> .data[[<span class="st">"tot.withinss"</span>]]</span>
<span id="cb50-6"><a href="#cb50-6"></a>  )</span>
<span id="cb50-7"><a href="#cb50-7"></a>) <span class="sc">+</span></span>
<span id="cb50-8"><a href="#cb50-8"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">"midnightblue"</span>) <span class="sc">+</span></span>
<span id="cb50-9"><a href="#cb50-9"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"midnightblue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="3883"></p>
</div>
</div>
<p>We see an elbow at k = 2 which makes us happy since the data set is specifically created to have 2 clusters. We can now extract the model where k = 2 from</p>
<div class="cell" data-max.height="300px">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>final_kclusts <span class="ot">&lt;-</span> kclusts <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="#cb51-2"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(.data[[<span class="st">"k"</span>]] <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(.data[[<span class="st">"kclust"</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="#cb51-4"></a>  purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="hierarchical-clustering" class="level1"><h1>Hierarchical Clustering</h1>
<p>The <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/dist.html"><code>stats::dist</code></a> function is used to calculate the Euclidean distance dissimilarity measure.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>dissimilarity_measure <span class="ot">&lt;-</span> points <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2"></a>  stats<span class="sc">::</span><span class="fu">dist</span>(<span class="at">method =</span> <span class="st">"euclidean"</span>)</span>
<span id="cb52-3"><a href="#cb52-3"></a></span>
<span id="cb52-4"><a href="#cb52-4"></a>dissimilarity_measure <span class="sc">%&gt;%</span></span>
<span id="cb52-5"><a href="#cb52-5"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span></span>
<span id="cb52-6"><a href="#cb52-6"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-8fde5e40f6675c3b9471" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8fde5e40f6675c3b9471">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".rownames":["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50"],"1":[0,3.09949143312105,2.5000459564039,2.1268548004705,0.84305309712744,1.52675861525046,1.68557290796471,1.89196739522564,3.4947064083315,2.6219048534159,1.6218805552825,3.42980923969584,0.522015874313321,1.00662566857941,2.99759056436221,1.41427283650997,2.121171216944,0.999422857882314,2.12086413988381,1.33040988291673,2.98888609120388,1.20737781623014,2.58229216374018,3.12286762866497,1.19535731137074,4.31786394908914,4.7524850283063,4.07481098151335,5.14164339355348,6.19904189347789,5.11678740416934,6.43184979012286,6.19557639528724,5.79732760965092,6.21038225173244,3.56269287912793,4.38953227169871,4.56548405397762,4.87178257089113,4.58542896927404,3.84463291638945,2.43868091324556,5.31188331096254,7.3537267669097,6.50191629138166,7.35915868554272,3.78735194534907,4.94310729516405,5.4606939739283,4.63024933974378],"2":[3.09949143312105,0,2.97954105964528,1.53454957756149,3.12513834722931,4.03252043931412,2.44586635953707,1.2075314813501,2.02437914245575,0.510406439465341,3.86156738182568,0.797674406192541,2.82902582502456,2.26725163717578,2.23280760789305,3.81579811698315,4.12392139389456,2.54995337227835,2.14810509820704,2.97210407288129,3.54377456637274,2.22053675167134,2.61696944939649,2.4070400015299,2.12764418967357,6.98287641494988,5.78998961591812,5.74055800466025,6.17664560057382,8.09539133301049,6.1919030762906,8.37092143840219,7.66146356968787,7.8573698967999,8.5216264830124,4.78948757864589,6.80739240103818,6.63271359679282,6.83625519355705,6.23344456085504,5.08496440221779,4.46792194553454,7.5136975215067,8.79733788651182,8.32215238104997,8.75625655153237,4.81304687413339,6.64297769163799,7.39291775777266,6.86059301349697],"3":[2.5000459564039,2.97954105964528,0,3.28128508751522,1.73726474857285,2.02198975743056,0.911844535110756,2.363101146785,1.74709408516564,2.82336957442325,1.69482136883234,2.66336935934261,1.98554613523265,2.72448612109985,1.08601954899559,3.90742468645181,1.60213664652417,1.55425393664983,0.865165849312459,1.20266959189721,0.617967848937491,2.92721286073683,0.420590065697507,1.06242408650745,1.66258636434381,4.46749427147166,2.85040092757286,2.78793064491004,3.24784596944809,5.13781804494467,3.25414120404806,5.41754233041514,4.68631689414618,4.94051541670745,5.68132507292595,1.81022772307116,4.10316520727361,3.75715023626195,3.91868815358288,3.26614088141727,2.10567150930063,1.83977965262911,4.65643370597519,5.83073862733502,5.35224159957846,5.79526250463457,1.84672004515368,3.67579866214399,4.45303478448944,4.04454603270359],"4":[2.1268548004705,1.53454957756149,3.28128508751522,0,2.54959369677166,3.4788767863418,2.43623839873244,0.953313551662982,3.11783842546597,1.06770195398989,3.43281556656977,2.24319139947631,2.11188506746916,1.12122583905965,3.01253486735309,2.40541886610821,3.841713325678,2.10713901171196,2.45215865311578,2.67506355374952,3.8990853651952,0.947821211692417,3.06715358474237,3.19756972041876,1.74823979894314,6.40665798428135,6.08346087664181,5.72478935867472,6.48591678457871,8.01472482714613,6.48277088160347,8.27031623889266,7.80086908236857,7.68043596523043,8.20073798741877,4.94181302097384,6.39808191861095,6.42935827307715,6.69477842635187,6.24395022773636,5.24847049243516,4.19943923120851,7.24832351767943,8.96774647054795,8.28685453736031,8.94962356896326,5.06241362317057,6.63855194872778,7.28056161030753,6.56749510464077],"5":[0.84305309712744,3.12513834722931,1.73726474857285,2.54959369677166,0,0.942610523243251,1.07066187298303,1.98983369194568,3.00752340886074,2.7198213572023,0.892467553032304,3.25683225419558,0.465028872474708,1.54087120012259,2.42552096116062,2.24239547791724,1.35067701508014,0.580010145011083,1.57343212736527,0.534606154582505,2.17474137396902,1.77556047478008,1.89979174912868,2.51761832901188,0.997494401508561,3.91038372968398,3.92105209694017,3.3051345161962,4.31341334674506,5.51246363989132,4.29114010169217,5.75850108369727,5.42462838774317,5.14986839436721,5.65116336148986,2.72961220362433,3.85175234326404,3.90142368977297,4.18423670575907,3.82270330165652,3.01662190635896,1.69502439521374,4.70296359608337,6.58953571715905,5.80064024635181,6.58811726491164,2.94712168773458,4.19622394738231,4.77385453981781,4.02094093145158],"6":[1.52675861525046,4.03252043931412,2.02198975743056,3.4788767863418,0.942610523243251,0,1.74079975677209,2.92550363556755,3.61549425347815,3.64759343766683,0.336022290610328,4.08636024543214,1.36756841101637,2.42597442678156,2.97207192786508,2.69883094271039,0.746912272701152,1.48972181160746,2.23111124004743,1.11159578508235,2.21957673327974,2.65485729427517,2.33479191696477,3.01396955239161,1.91640050285764,2.97048768583322,3.42368093798625,2.59827267664858,3.78913479988721,4.67228577340384,3.75295925493776,4.90572037791596,4.705862537023,4.27522751188956,4.72935490196402,2.28178890476709,2.91992948554525,3.03941664259567,3.3452714354873,3.09580490408452,2.52157612300089,0.974635926087327,3.80236012843463,5.85433573938935,4.97597743851839,5.86607899876528,2.5631866150446,3.43756664611093,3.93399912236476,3.11923769961109],"7":[1.68557290796471,2.44586635953707,0.911844535110756,2.43623839873244,1.07066187298303,1.74079975677209,0,1.57566107567048,1.94101333033061,2.1668780054635,1.4937522667857,2.37008166621863,1.16445794297004,1.81264456824311,1.35707314966367,3.05966299731155,1.68454189858989,0.690086487099004,0.508645326791143,0.635435880881045,1.50674567180217,2.01667217608831,0.90013285822142,1.4589525729627,0.752813106159101,4.58691885992857,3.64726025557623,3.36379115284054,4.04976625151722,5.70467659250316,4.04658644714968,5.97363071665699,5.39187472651899,5.43387765010224,6.07692086937575,2.51364257624974,4.36726316871805,4.19830303918984,4.41804851041531,3.87433883676376,2.82039740574884,2.02345330195045,5.07240201406425,6.55432065811287,5.95210229578093,6.53069786337006,2.62618036091598,4.27897859889502,4.98701885102016,4.41567174063672],"8":[1.89196739522564,1.2075314813501,2.363101146785,0.953313551662982,1.98983369194568,2.92550363556755,1.57566107567048,0,2.23345005769917,0.742644112488368,2.80229441911885,1.64067040796529,1.6461323366833,1.11569141692683,2.06706766129644,2.71543994508168,3.14056056998455,1.44172357673231,1.51465721022542,1.95073682921691,2.97997866133101,1.13514860173934,2.12309386537736,2.25081901837149,1.01937502903701,5.89586831239681,5.19707387715765,4.93210808618439,5.59790440896595,7.26131265590939,5.59930241868043,7.52612331552964,6.9670076743305,6.96618601086384,7.55646125497624,4.08488815929024,5.79060660566985,5.71980565448381,5.95970963440612,5.44555640836427,4.39121234812096,3.49757695273375,6.5725390875717,8.12843377801748,7.51665541917949,8.1032516481836,4.17961699755715,5.84829886204032,6.53659762858239,5.90118767269747],"9":[3.4947064083315,2.02437914245575,1.74709408516564,3.11783842546597,3.00752340886074,3.61549425347815,1.94101333033061,2.23345005769917,0,2.1889895080155,3.3203956484355,1.34206423416665,3.00753658324755,3.17929693091724,0.664519154827182,4.72125535096115,3.3272320358217,2.53316376680898,1.43430288619542,2.55918404696076,2.06324794942519,3.28550260696722,1.34036413626073,0.705013070271993,2.31121156654197,6.21456703854231,4.1159533216441,4.38748977069357,4.46867280327434,6.67805084433468,4.49940297848727,6.96405103056981,6.04595580788051,6.55244398573379,7.35103099388692,3.34357410951514,5.83602845919072,5.42508678058172,5.54499940038812,4.81435032473132,3.59481975590502,3.58449709348165,6.32522499511977,7.12326662137363,6.85061245856337,7.06404016796525,3.25818211176294,5.21422958068684,6.03934075256929,5.74331383574864],"10":[2.6219048534159,0.510406439465341,2.82336957442325,1.06770195398989,2.7198213572023,3.64759343766683,2.1668780054635,0.742644112488368,2.1889895080155,0,3.50432032554555,1.1768341695547,2.38829839623967,1.76128684179962,2.24686941398399,3.30559360694564,3.80885869595268,2.1579857839942,1.96116824215629,2.62985372192977,3.41968498905233,1.71019021256657,2.50508214168374,2.43147854614065,1.73131734195135,6.61451108700789,5.67062488135223,5.5200771408932,6.06536943081472,7.86790674924087,6.07439798781106,8.13844944230669,7.50118172082094,7.60034667807512,8.22597711906718,4.61368766076261,6.4808798269388,6.36224105933217,6.5849246224199,6.02458886218781,4.91589545258188,4.1611843730518,7.22984767664306,8.65142218726529,8.1093310968167,8.61775471680862,4.66995657089897,6.4319937911083,7.15297534965867,6.56592944380403],"11":[1.6218805552825,3.86156738182568,1.69482136883234,3.43281556656977,0.892467553032304,0.336022290610328,1.4937522667857,2.80229441911885,3.3203956484355,3.50432032554555,0,3.8609162986234,1.35428881988,2.43151822512218,2.66958768593536,2.89541264571663,0.506786750342573,1.3635079613982,1.96473951045401,0.892875206939641,1.88444253312431,2.66559721717721,2.02108507526414,2.70268398953163,1.78294424334459,3.12160314770426,3.19154819277739,2.45293173726475,3.56811210524887,4.62230576513801,3.53681459572427,4.86686051901103,4.57388895228193,4.2575739090616,4.77430710633554,2.02453645028828,2.99039463806116,3.00895620178274,3.29347411888514,2.96428529264376,2.28217623310082,0.818520030259559,3.81553929578866,5.73321069140015,4.91349042035002,5.73760133578485,2.29081268058498,3.32651568395011,3.88336182706517,3.13477348873244],"12":[3.42980923969584,0.797674406192541,2.66336935934261,2.24319139947631,3.25683225419558,4.08636024543214,2.37008166621863,1.64067040796529,1.34206423416665,1.1768341695547,3.8609162986234,0,3.06038872126341,2.75582404916667,1.7223271086669,4.35571254859062,4.03140931177185,2.68283441288641,1.94731059078794,2.97786501452531,3.15394863142133,2.76630048655892,2.25633188134567,1.86949416207538,2.30244374532419,6.95187943900846,5.34592149919666,5.44821465473865,5.71718935986081,7.7909555945104,5.74072261061897,8.07274322505621,7.25737891082074,7.6038842632921,8.33218436359728,4.44302196272684,6.69102217672442,6.41370376781126,6.58197628999529,5.91607645878209,4.72277069764311,4.35048960738971,7.31015021805252,8.36589124448827,7.99275558969376,8.31475451344325,4.41744381386211,6.32444454768889,7.11433696980147,6.68283705819891],"13":[0.522015874313321,2.82902582502456,1.98554613523265,2.11188506746916,0.465028872474708,1.36756841101637,1.16445794297004,1.6461323366833,3.00753658324755,2.38829839623967,1.35428881988,3.06038872126341,0,1.07723174151612,2.4885525232029,1.92192920461932,1.81522696007721,0.483449717345673,1.61101747449683,0.84708641525536,2.49307558082306,1.31146377799855,2.06031795464069,2.60865174656852,0.761485824832383,4.30799149541687,4.35313643555568,3.76753778004375,4.7487255110168,5.97615433547208,4.72910212274862,6.22114528164594,5.88569045861416,5.60925446001872,6.09476117462679,3.1619996598318,4.28747111819194,4.3621163031085,4.64756923001497,4.28573230521185,3.45437846923963,2.16001743692537,5.15578235726149,7.05139180779406,6.26524459103135,7.04879139580543,3.36448779614012,4.66059244038108,5.237357048326,4.47301299249411],"14":[1.00662566857941,2.26725163717578,2.72448612109985,1.12122583905965,1.54087120012259,2.42597442678156,1.81264456824311,1.11569141692683,3.17929693091724,1.76128684179962,2.43151822512218,2.75582404916667,1.07723174151612,0,2.84328343953038,1.60413682753656,2.88660235656416,1.25019992346915,2.05383067481496,1.81018543352235,3.31136646969631,0.235296169920647,2.64634684151633,3.00707656242794,1.06587970028271,5.30835543361474,5.34335881315993,4.82934235596001,5.74386490534932,7.05321015788806,5.73013733304595,7.29836574781868,6.94134491291913,6.68502560873941,7.15361169573942,4.16152469212377,5.33893713765568,5.43876636393767,5.72474367306215,5.34902046256647,4.46196688063736,3.23486191954063,6.22587280954439,8.10894198847997,7.34126275853004,8.10245938074522,4.33346221103805,5.7288763209583,6.31448639940204,5.54273334111722],"15":[2.99759056436221,2.23280760789305,1.08601954899559,3.01253486735309,2.42552096116062,2.97207192786508,1.35707314966367,2.06706766129644,0.664519154827182,2.24686941398399,2.66958768593536,1.7223271086669,2.4885525232029,2.84328343953038,0,4.30278684579693,2.66307562901653,2.00530668046381,0.877557465649268,1.94607943900949,1.4604841872523,2.9873311837132,0.675914134826828,0.186616425173075,1.86341521594294,5.55219797974383,3.62360112446421,3.7857608288255,3.99601100849323,6.1052899988038,4.01877707138165,6.38954957806683,5.53712720637203,5.95217993939041,6.72862817733172,2.75526409805608,5.18459635562287,4.80127262795322,4.93732227978914,4.23248761038323,3.02320911243334,2.92072755441983,5.70225554842626,6.64358653710195,6.29394945061961,6.59285179017342,2.70533810588909,4.63759273135781,5.44780185491905,5.107430255606],"16":[1.41427283650997,3.81579811698315,3.90742468645181,2.40541886610821,2.24239547791724,2.69883094271039,3.05966299731155,2.71543994508168,4.72125535096115,3.30559360694564,2.89541264571663,4.35571254859062,1.92192920461932,1.60413682753656,4.30278684579693,0,3.40054552529032,2.37147722655799,3.44468124487053,2.74437273616365,4.40305328927194,1.5994255699574,3.95924926475807,4.44645970862806,2.43947971813602,4.98803230359414,6.08487596773453,5.29396951591755,6.46344347899345,7.24129838491108,6.43214876384516,7.44784285082998,7.38822847611258,6.78181683471546,7.04204938308379,4.90702788642504,5.2486005653362,5.60703008533567,5.94177890298287,5.78379745706434,5.17448237239599,3.67181516372038,6.24630436409828,8.523399008615,7.56494383143976,8.54233653026895,5.15226803336251,6.10856851024827,6.51664440354196,5.58643275216083],"17":[2.121171216944,4.12392139389456,1.60213664652417,3.841713325678,1.35067701508014,0.746912272701152,1.68454189858989,3.14056056998455,3.3272320358217,3.80885869595268,0.506786750342573,4.03140931177185,1.81522696007721,2.88660235656416,2.66307562901653,3.40054552529032,0,1.7376287931987,2.0873469225741,1.19021973651387,1.62191993190194,3.1218441350697,1.98864510092829,2.66096738908818,2.1323232623703,2.92696109082403,2.69064948848101,1.95868899787298,3.06413956686622,4.17723620654625,3.03181039401436,4.42973346270716,4.08022134509147,3.84127861902447,4.41866110584439,1.53620277382469,2.68383498043941,2.59047065360544,2.85375542888069,2.47419894908603,1.78342117481352,0.358800117014848,3.43224413580237,5.24281854813596,4.45823804393487,5.2441716406753,1.81639262849636,2.84555948791865,3.44091456377605,2.76102794461793],"18":[0.999422857882314,2.54995337227835,1.55425393664983,2.10713901171196,0.580010145011083,1.48972181160746,0.690086487099004,1.44172357673231,2.53316376680898,2.1579857839942,1.3635079613982,2.68283441288641,0.483449717345673,1.25019992346915,2.00530668046381,2.37147722655799,1.7376287931987,0,1.12786222181217,0.574801490532972,2.10200508097374,1.47740216762732,1.59009040493711,2.12546899014274,0.426688044137513,4.45737738431768,4.09382448544708,3.627980730799,4.49471206210437,5.90759369466678,4.48189815534182,6.16365812548382,5.7236396490129,5.5788720329796,6.13207994786648,2.91464203177215,4.35388221347955,4.32795719280727,4.58851176503627,4.14823123784602,3.21669837628141,2.09622502355002,5.16096159164374,6.89210764590263,6.18055186003874,6.88058397995598,3.083269590324,4.53847288229172,5.17369898075433,4.48402933257988],"19":[2.12086413988381,2.14810509820704,0.865165849312459,2.45215865311578,1.57343212736527,2.23111124004743,0.508645326791143,1.51465721022542,1.43430288619542,1.96116824215629,1.96473951045401,1.94731059078794,1.61101747449683,2.05383067481496,0.877557465649268,3.44468124487053,2.0873469225741,1.12786222181217,0,1.13877148794655,1.47411141006482,2.22641668265956,0.619445910852801,1.00498677373754,1.01728128116866,5.01286061036081,3.71556489661933,3.59245504749692,4.11288838836635,5.94729256675628,4.11929915775601,6.22302221104765,5.54128254844479,5.7160383875176,6.40748149201202,2.65578725572546,4.74476784795789,4.50147488115695,4.69366546691506,4.08672089286736,2.95646633089751,2.40318886553958,5.39088725059965,6.69029086215608,6.1753615604087,6.6567126267435,2.70978692406121,4.49601891478988,5.24634677830354,4.75120944079644],"20":[1.33040988291673,2.97210407288129,1.20266959189721,2.67506355374952,0.534606154582505,1.11159578508235,0.635435880881045,1.95073682921691,2.55918404696076,2.62985372192977,0.892875206939641,2.97786501452531,0.84708641525536,1.81018543352235,1.94607943900949,2.74437273616365,1.19021973651387,0.574801490532972,1.13877148794655,0,1.65875453713765,2.04131495172372,1.38121892051165,2.02174433587634,0.944020812052937,4.01330136350722,3.53771968218985,3.05403617359714,3.93698336910143,5.34282224389107,3.92173214260772,5.60139992627008,5.1490011184256,5.02556554892185,5.60623229580799,2.35236127627918,3.8510277992142,3.77615754914505,4.02803683862553,3.57415861423411,2.65195961318773,1.54802510977647,4.62246147053314,6.31747358365796,5.61212521510865,6.30635989469553,2.53557944306478,3.96554857671736,4.61099188959192,3.95045401369275],"21":[2.98888609120388,3.54377456637274,0.617967848937491,3.8990853651952,2.17474137396902,2.21957673327974,1.50674567180217,2.97997866133101,2.06324794942519,3.41968498905233,1.88444253312431,3.15394863142133,2.49307558082306,3.31136646969631,1.4604841872523,4.40305328927194,1.62191993190194,2.10200508097374,1.47411141006482,1.65875453713765,0,3.52076962005451,0.926812669485604,1.36294253529154,2.25910371823893,4.27390495232151,2.25245047626701,2.32802061108804,2.64578704121876,4.64609015883201,2.65595602297332,4.92991666050137,4.12175160803789,4.4946634493725,5.28830442520962,1.29512281246173,3.82045330370292,3.36341202219152,3.4833143808033,2.77239089125295,1.56898678610231,1.74800948889015,4.26286478375758,5.25357218678739,4.84013808639524,5.21299641832844,1.27178347568954,3.17823813561298,3.98780099476915,3.69126131595349],"22":[1.20737781623014,2.22053675167134,2.92721286073683,0.947821211692417,1.77556047478008,2.65485729427517,2.01667217608831,1.13514860173934,3.28550260696722,1.71019021256657,2.66559721717721,2.76630048655892,1.31146377799855,0.235296169920647,2.9873311837132,1.5994255699574,3.1218441350697,1.47740216762732,2.22641668265956,2.04131495172372,3.52076962005451,0,2.82923232845692,3.15630447821519,1.2646282106511,5.52162156150181,5.57119413725953,5.06441679638649,5.9721133611421,7.28761774503629,5.95911386477879,7.53230328340979,7.17592422776729,6.91767614749453,7.38030603496366,4.39117669492485,5.56409015073936,5.67202710681141,5.95900531201542,5.58414506680525,4.6922988095826,3.46987719155372,6.45619540025717,8.3436230892331,7.57613272468195,8.33682536252475,4.55946910549021,5.96415817217077,6.5488137751308,5.77301680223769],"23":[2.58229216374018,2.61696944939649,0.420590065697507,3.06715358474237,1.89979174912868,2.33479191696477,0.90013285822142,2.12309386537736,1.34036413626073,2.50508214168374,2.02108507526414,2.25633188134567,2.06031795464069,2.64634684151633,0.675914134826828,3.95924926475807,1.98864510092829,1.59009040493711,0.619445910852801,1.38121892051165,0.926812669485604,2.82923232845692,0,0.682346645467884,1.58713848045326,4.87789997064268,3.17650297649708,3.19203127247032,3.56705520307116,5.53586458924272,3.57946449736119,5.81709786458109,5.04677528228838,5.35047683818799,6.09926688237224,2.19315219409765,4.52275864709079,4.17402155334638,4.32980235626952,3.66153773722061,2.48044326234954,2.24527243148017,5.07391226885104,6.18036890282159,5.74284343210806,6.13967275461198,2.19701812220717,4.07049943367018,4.85824448314672,4.46451632412159],"24":[3.12286762866497,2.4070400015299,1.06242408650745,3.19756972041876,2.51761832901188,3.01396955239161,1.4589525729627,2.25081901837149,0.705013070271993,2.43147854614065,2.70268398953163,1.86949416207538,2.60865174656852,3.00707656242794,0.186616425173075,4.44645970862806,2.66096738908818,2.12546899014274,1.00498677373754,2.02174433587634,1.36294253529154,3.15630447821519,0.682346645467884,0,2.00999631354768,5.52398041698455,3.48188588108625,3.69044800022968,3.8492465784593,5.99540479692226,3.87420441832433,6.28058516671413,5.40222409757594,5.8567927663272,6.64819868990976,2.65114170966152,5.13356185893017,4.72168776244487,4.8462567343332,4.12621856011386,2.91068292506649,2.90133967929743,5.62214350806629,6.50064378235139,6.17694705124824,6.44761457112889,2.58368995883934,4.52892864696003,5.34726642052234,5.03834424663684],"25":[1.19535731137074,2.12764418967357,1.66258636434381,1.74823979894314,0.997494401508561,1.91640050285764,0.752813106159101,1.01937502903701,2.31121156654197,1.73131734195135,1.78294424334459,2.30244374532419,0.761485824832383,1.06587970028271,1.86341521594294,2.43947971813602,2.1323232623703,0.426688044137513,1.01728128116866,0.944020812052937,2.25910371823893,1.2646282106511,1.58713848045326,2.00999631354768,0,4.8837084486607,4.36360763476938,3.97871753361747,4.76625421842202,6.2832607074444,4.75888534092556,6.54334677467949,6.05327561177313,5.96958487281377,6.54181803872005,3.2045533985927,4.77153450980834,4.72011374070564,4.97101131979592,4.4972382712368,3.51041172048045,2.49078114627672,5.56351098546467,7.22056690078676,6.54880352666194,7.20372119795211,3.34390262487784,4.89359788182687,5.5528961101356,4.88936206534121],"26":[4.31786394908914,6.98287641494988,4.46749427147166,6.40665798428135,3.91038372968398,2.97048768583322,4.58691885992857,5.89586831239681,6.21456703854231,6.61451108700789,3.12160314770426,6.95187943900846,4.30799149541687,5.30835543361474,5.55219797974383,4.98803230359414,2.92696109082403,4.45737738431768,5.01286061036081,4.01330136350722,4.27390495232151,5.52162156150181,4.87789997064268,5.52398041698455,4.8837084486607,0,3.66954540194754,2.50205528170965,3.7898711071303,2.78709499643098,3.71510240904557,2.88072394018459,3.54761218803409,2.21689877778194,2.12080983020708,3.30054821722585,0.76879867897248,1.6694899642216,1.96282203208693,2.55671900496232,3.25033589000444,2.63472490986504,1.63357103311488,4.37857855330165,3.13327480700328,4.45607958891119,3.58090873617402,2.53188646991676,2.26846196047063,1.28975220869445],"27":[4.7524850283063,5.78998961591812,2.85040092757286,6.08346087664181,3.92105209694017,3.42368093798625,3.64726025557623,5.19707387715765,4.1159533216441,5.67062488135223,3.19154819277739,5.34592149919666,4.35313643555568,5.34335881315993,3.62360112446421,6.08487596773453,2.69064948848101,4.09382448544708,3.71556489661933,3.53771968218985,2.25245047626701,5.57119413725953,3.17650297649708,3.48188588108625,4.36360763476938,3.66954540194754,0,1.19823431983038,0.402737945580629,2.7200277011416,0.403807902366106,3.00345050148889,1.93206051138782,2.78200107823633,3.72859913629879,1.19166535618628,2.94680253934772,2.10386943306644,1.9828205383796,1.16806153879184,0.910578973011049,2.4654348399761,2.81520301034154,3.02000699177027,2.81992665333774,2.97111557930645,1.0211682854312,1.41491563611952,2.2457317867146,2.53707897023702],"28":[4.07481098151335,5.74055800466025,2.78793064491004,5.72478935867472,3.3051345161962,2.59827267664858,3.36379115284054,4.93210808618439,4.38748977069357,5.5200771408932,2.45293173726475,5.44821465473865,3.76753778004375,4.82934235596001,3.7857608288255,5.29396951591755,1.95868899787298,3.627980730799,3.59245504749692,3.05403617359714,2.32802061108804,5.06441679638649,3.19203127247032,3.69044800022968,3.97871753361747,2.50205528170965,1.19823431983038,0,1.41685247459379,2.35493424364318,1.35418423554725,2.63191951719144,2.12166167649654,2.16669887329188,2.98514843850201,1.05033312681174,1.81844446958845,1.09990138928884,1.159345900893,0.520413228755213,0.855533044633774,1.63813122973852,1.97070321349749,3.28458225594315,2.5893721471717,3.28561165869134,1.22271845805597,0.916330992371273,1.66624562100661,1.49921571937511],"29":[5.14164339355348,6.17664560057382,3.24784596944809,6.48591678457871,4.31341334674506,3.78913479988721,4.04976625151722,5.59790440896595,4.46867280327434,6.06536943081472,3.56811210524887,5.71718935986081,4.7487255110168,5.74386490534932,3.99601100849323,6.46344347899345,3.06413956686622,4.49471206210437,4.11288838836635,3.93698336910143,2.64578704121876,5.9721133611421,3.56705520307116,3.8492465784593,4.76625421842202,3.7898711071303,0.402737945580629,1.41685247459379,0,2.51332335486302,0.0776788903607989,2.78873797234913,1.61111934129121,2.65295759479526,3.61827084727919,1.58696101585909,3.04161232341975,2.15880234920781,1.97433696443476,1.23379941917661,1.29716509524129,2.8222087147655,2.76946613628935,2.65479268905533,2.57080411147173,2.59862556370138,1.42381883529975,1.36804478467355,2.1318646052173,2.58817349892393],"30":[6.19904189347789,8.09539133301049,5.13781804494467,8.01472482714613,5.51246363989132,4.67228577340384,5.70467659250316,7.26131265590939,6.67805084433468,7.86790674924087,4.62230576513801,7.7909555945104,5.97615433547208,7.05321015788806,6.1052899988038,7.24129838491108,4.17723620654625,5.90759369466678,5.94729256675628,5.34282224389107,4.64609015883201,7.28761774503629,5.53586458924272,5.99540479692226,6.2832607074444,2.78709499643098,2.7200277011416,2.35493424364318,2.51332335486302,0,2.44761486622977,0.28722734460754,1.17778154049108,0.575036118586019,1.33177927483758,3.35121097055683,2.15295642823824,1.63945723220354,1.32928549229413,1.87502177430543,3.08478735836661,3.82260474909924,1.15377884810697,1.61473482053756,0.348320756622778,1.70850648793545,3.42154845263535,1.46785362928603,0.739225081658809,1.69399878468877],"31":[5.11678740416934,6.1919030762906,3.25414120404806,6.48277088160347,4.29114010169217,3.75295925493776,4.04658644714968,5.59930241868043,4.49940297848727,6.07439798781106,3.53681459572427,5.74072261061897,4.72910212274862,5.73013733304595,4.01877707138165,6.43214876384516,3.03181039401436,4.48189815534182,4.11929915775601,3.92173214260772,2.65595602297332,5.95911386477879,3.57946449736119,3.87420441832433,4.75888534092556,3.71510240904557,0.403807902366106,1.35418423554725,0.0776788903607989,2.44761486622977,0,2.72431588194597,1.56609489533819,2.57979714144978,3.54430368752808,1.56960461325876,2.9658507081865,2.08199494438145,1.8966582005691,1.15859736134737,1.27489957571098,2.78368243003352,2.69240621445221,2.62672994402102,2.51135644626446,2.57407498674652,1.4208816100939,1.29048556002515,2.05731934570863,2.51109082855957],"32":[6.43184979012286,8.37092143840219,5.41754233041514,8.27031623889266,5.75850108369727,4.90572037791596,5.97363071665699,7.52612331552964,6.96405103056981,8.13844944230669,4.86686051901103,8.07274322505621,6.22114528164594,7.29836574781868,6.38954957806683,7.44784285082998,4.42973346270716,6.16365812548382,6.22302221104765,5.60139992627008,4.92991666050137,7.53230328340979,5.81709786458109,6.28058516671413,6.54334677467949,2.88072394018459,3.00345050148889,2.63191951719144,2.78873797234913,0.28722734460754,2.72431588194597,0,1.3872688118892,0.684398112360515,1.20942967919782,3.63484020352068,2.29528182785412,1.86636787886985,1.57604589914404,2.1578690464462,3.37019502808745,4.07347043595481,1.26864126432269,1.62009031265268,0.354479979500233,1.7295659097176,3.70807863440544,1.7520125884426,0.990452431518746,1.87127188067371],"33":[6.19557639528724,7.66146356968787,4.68631689414618,7.80086908236857,5.42462838774317,4.705862537023,5.39187472651899,6.9670076743305,6.04595580788051,7.50118172082094,4.57388895228193,7.25737891082074,5.88569045861416,6.94134491291913,5.53712720637203,7.38822847611258,4.08022134509147,5.7236396490129,5.54128254844479,5.1490011184256,4.12175160803789,7.17592422776729,5.04677528228838,5.40222409757594,6.05327561177313,3.54761218803409,1.93206051138782,2.12166167649654,1.61111934129121,1.17778154049108,1.56609489533819,1.3872688118892,0,1.59819424357553,2.49742356688066,2.88848635739649,2.80471332701021,1.99431545189203,1.64176871385281,1.61121002289314,2.5853077722573,3.75725687724997,2.02509942057443,1.16847261713068,1.07927878858136,1.16395615483347,2.85002638162475,1.28631626711234,1.29771044642345,2.27594186096115],"34":[5.79732760965092,7.8573698967999,4.94051541670745,7.68043596523043,5.14986839436721,4.27522751188956,5.43387765010224,6.96618601086384,6.55244398573379,7.60034667807512,4.2575739090616,7.6038842632921,5.60925446001872,6.68502560873941,5.95217993939041,6.78181683471546,3.84127861902447,5.5788720329796,5.7160383875176,5.02556554892185,4.4946634493725,6.91767614749453,5.35047683818799,5.8567927663272,5.96958487281377,2.21689877778194,2.78200107823633,2.16669887329188,2.65295759479526,0.575036118586019,2.57979714144978,0.684398112360515,1.59819424357553,0,0.969992273483733,3.20954421034648,1.61109702072362,1.25111942615871,1.02295039859184,1.75936721827702,2.97432266294981,3.48264883168868,0.588602401674195,2.18774878943768,0.917458311222085,2.27819683228201,3.33169478230804,1.39339025509922,0.539011022251472,1.19629476198735],"35":[6.21038225173244,8.5216264830124,5.68132507292595,8.20073798741877,5.65116336148986,4.72935490196402,6.07692086937575,7.55646125497624,7.35103099388692,8.22597711906718,4.77430710633554,8.33218436359728,6.09476117462679,7.15361169573942,6.72862817733172,7.04204938308379,4.41866110584439,6.13207994786648,6.40748149201202,5.60623229580799,5.28830442520962,7.38030603496366,6.09926688237224,6.64819868990976,6.54181803872005,2.12080983020708,3.72859913629879,2.98514843850201,3.61827084727919,1.33177927483758,3.54430368752808,1.20942967919782,2.49742356688066,0.969992273483733,0,4.0341055103927,1.82146404639024,1.92735561966514,1.83392692135509,2.64822548404447,3.82854396016586,4.06485399892646,1.02637556245441,2.81161528750257,1.56238459144109,2.92767099681071,4.19383093008265,2.31928768533927,1.48833102139797,1.66127623233176],"36":[3.56269287912793,4.78948757864589,1.81022772307116,4.94181302097384,2.72961220362433,2.28178890476709,2.51364257624974,4.08488815929024,3.34357410951514,4.61368766076261,2.02453645028828,4.44302196272684,3.1619996598318,4.16152469212377,2.75526409805608,4.90702788642504,1.53620277382469,2.91464203177215,2.65578725572546,2.35236127627918,1.29512281246173,4.39117669492485,2.19315219409765,2.65114170966152,3.2045533985927,3.30054821722585,1.19166535618628,1.05033312681174,1.58696101585909,3.35121097055683,1.56960461325876,3.63484020352068,2.88848635739649,3.20954421034648,4.0341055103927,0,2.72136009990097,2.12904305289149,2.20937527330549,1.47728010626089,0.306823122257706,1.37071068641369,3.01578251677341,4.04501274974324,3.55031641632548,4.01838582053961,0.320992031208317,1.8833918766463,2.69632315620726,2.49720584861739],"37":[4.38953227169871,6.80739240103818,4.10316520727361,6.39808191861095,3.85175234326404,2.91992948554525,4.36726316871805,5.79060660566985,5.83602845919072,6.4808798269388,2.99039463806116,6.69102217672442,4.28747111819194,5.33893713765568,5.18459635562287,5.2486005653362,2.68383498043941,4.35388221347955,4.74476784795789,3.8510277992142,3.82045330370292,5.56409015073936,4.52275864709079,5.13356185893017,4.77153450980834,0.76879867897248,2.94680253934772,1.81844446958845,3.04161232341975,2.15295642823824,2.9658507081865,2.29528182785412,2.80471332701021,1.61109702072362,1.82146404639024,2.72136009990097,0,0.902179859661539,1.1969501260607,1.8084819823286,2.62327351724026,2.34615911517098,1.03105168643154,3.69737515751181,2.50073716843715,3.76497026226398,2.97393243915409,1.76370098958931,1.55338618504733,0.529793191497037],"38":[4.56548405397762,6.63271359679282,3.75715023626195,6.42935827307715,3.90142368977297,3.03941664259567,4.19830303918984,5.71980565448381,5.42508678058172,6.36224105933217,3.00895620178274,6.41370376781126,4.3621163031085,5.43876636393767,4.80127262795322,5.60703008533567,2.59047065360544,4.32795719280727,4.50147488115695,3.77615754914505,3.36341202219152,5.67202710681141,4.17402155334638,4.72168776244487,4.72011374070564,1.6694899642216,2.10386943306644,1.09990138928884,2.15880234920781,1.63945723220354,2.08199494438145,1.86636787886985,1.99431545189203,1.25111942615871,1.92735561966514,2.12904305289149,0.902179859661539,0,0.358422341652227,0.938709938240371,1.95521249416854,2.23175796652657,0.900984330033628,3.00455844946284,1.95801495231855,3.0512645114988,2.32211911574112,0.862773059999454,0.90962738059854,0.433455215438647],"39":[4.87178257089113,6.83625519355705,3.91868815358288,6.69477842635187,4.18423670575907,3.3452714354873,4.41804851041531,5.95970963440612,5.54499940038812,6.5849246224199,3.29347411888514,6.58197628999529,4.64756923001497,5.72474367306215,4.93732227978914,5.94177890298287,2.85375542888069,4.58851176503627,4.69366546691506,4.02803683862553,3.4833143808033,5.95900531201542,4.32980235626952,4.8462567343332,4.97101131979592,1.96282203208693,1.9828205383796,1.159345900893,1.97433696443476,1.32928549229413,1.8966582005691,1.57604589914404,1.64176871385281,1.02295039859184,1.83392692135509,2.20937527330549,1.1969501260607,0.358422341652227,0,0.834393808811877,1.99507237997886,2.49743308200815,0.845310108758594,2.64731412631484,1.63196887682992,2.69307166337524,2.35996969022822,0.612318042431877,0.590069056064141,0.67461819868792],"40":[4.58542896927404,6.23344456085504,3.26614088141727,6.24395022773636,3.82270330165652,3.09580490408452,3.87433883676376,5.44555640836427,4.81435032473132,6.02458886218781,2.96428529264376,5.91607645878209,4.28573230521185,5.34902046256647,4.23248761038323,5.78379745706434,2.47419894908603,4.14823123784602,4.08672089286736,3.57415861423411,2.77239089125295,5.58414506680525,3.66153773722061,4.12621856011386,4.4972382712368,2.55671900496232,1.16806153879184,0.520413228755213,1.23379941917661,1.87502177430543,1.15859736134737,2.1578690464462,1.61121002289314,1.75936721827702,2.64822548404447,1.47728010626089,1.8084819823286,0.938709938240371,0.834393808811877,0,1.22141183478586,2.14676343195123,1.67931547772591,2.76917216011517,2.08872272416927,2.77399532612232,1.57376735448924,0.409769266472165,1.23089039365878,1.37209606833919],"41":[3.84463291638945,5.08496440221779,2.10567150930063,5.24847049243516,3.01662190635896,2.52157612300089,2.82039740574884,4.39121234812096,3.59481975590502,4.91589545258188,2.28217623310082,4.72277069764311,3.45437846923963,4.46196688063736,3.02320911243334,5.17448237239599,1.78342117481352,3.21669837628141,2.95646633089751,2.65195961318773,1.56898678610231,4.6922988095826,2.48044326234954,2.91068292506649,3.51041172048045,3.25033589000444,0.910578973011049,0.855533044633774,1.29716509524129,3.08478735836661,1.27489957571098,3.37019502808745,2.5853077722573,2.97432266294981,3.82854396016586,0.306823122257706,2.62327351724026,1.95521249416854,1.99507237997886,1.22141183478586,0,1.57758565218595,2.82143819620261,3.73975435709862,3.27159748423468,3.71223920267679,0.367364603892237,1.61942410875783,2.4511321461144,2.34762593974729],"42":[2.43868091324556,4.46792194553454,1.83977965262911,4.19943923120851,1.69502439521374,0.974635926087327,2.02345330195045,3.49757695273375,3.58449709348165,4.1611843730518,0.818520030259559,4.35048960738971,2.16001743692537,3.23486191954063,2.92072755441983,3.67181516372038,0.358800117014848,2.09622502355002,2.40318886553958,1.54802510977647,1.74800948889015,3.46987719155372,2.24527243148017,2.90133967929743,2.49078114627672,2.63472490986504,2.4654348399761,1.63813122973852,2.8222087147655,3.82260474909924,2.78368243003352,4.07347043595481,3.75725687724997,3.48264883168868,4.06485399892646,1.37071068641369,2.34615911517098,2.23175796652657,2.49743308200815,2.14676343195123,1.57758565218595,0,3.0749692852968,4.91521234223181,4.10672211605677,4.92062673070464,1.67685828466065,2.50819140413365,3.08542280882301,2.40563338287134],"43":[5.31188331096254,7.5136975215067,4.65643370597519,7.24832351767943,4.70296359608337,3.80236012843463,5.07240201406425,6.5725390875717,6.32522499511977,7.22984767664306,3.81553929578866,7.31015021805252,5.15578235726149,6.22587280954439,5.70225554842626,6.24630436409828,3.43224413580237,5.16096159164374,5.39088725059965,4.62246147053314,4.26286478375758,6.45619540025717,5.07391226885104,5.62214350806629,5.56351098546467,1.63357103311488,2.81520301034154,1.97070321349749,2.76946613628935,1.15377884810697,2.69240621445221,1.26864126432269,2.02509942057443,0.588602401674195,1.02637556245441,3.01578251677341,1.03105168643154,0.900984330033628,0.845310108758594,1.67931547772591,2.82143819620261,3.0749692852968,0,2.75081520003833,1.50072051584856,2.83347794098186,3.18837774818061,1.40814556287151,0.740701417092333,0.683181855798574],"44":[7.3537267669097,8.79733788651182,5.83073862733502,8.96774647054795,6.58953571715905,5.85433573938935,6.55432065811287,8.12843377801748,7.12326662137363,8.65142218726529,5.73321069140015,8.36589124448827,7.05139180779406,8.10894198847997,6.64358653710195,8.523399008615,5.24281854813596,6.89210764590263,6.69029086215608,6.31747358365796,5.25357218678739,8.3436230892331,6.18036890282159,6.50064378235139,7.22056690078676,4.37857855330165,3.02000699177027,3.28458225594315,2.65479268905533,1.61473482053756,2.62672994402102,1.62009031265268,1.16847261713068,2.18774878943768,2.81161528750257,4.04501274974324,3.69737515751181,3.00455844946284,2.64731412631484,2.76917216011517,3.73975435709862,4.91521234223181,2.75081520003833,0,1.29030228300116,0.136869113067943,3.98593912912893,2.41740274121426,2.15049332869485,3.19340864496776],"45":[6.50191629138166,8.32215238104997,5.35224159957846,8.28685453736031,5.80064024635181,4.97597743851839,5.95210229578093,7.51665541917949,6.85061245856337,8.1093310968167,4.91349042035002,7.99275558969376,6.26524459103135,7.34126275853004,6.29394945061961,7.56494383143976,4.45823804393487,6.18055186003874,6.1753615604087,5.61212521510865,4.84013808639524,7.57613272468195,5.74284343210806,6.17694705124824,6.54880352666194,3.13327480700328,2.81992665333774,2.5893721471717,2.57080411147173,0.348320756622778,2.51135644626446,0.354479979500233,1.07927878858136,0.917458311222085,1.56238459144109,3.55031641632548,2.50073716843715,1.95801495231855,1.63196887682992,2.08872272416927,3.27159748423468,4.10672211605677,1.50072051584856,1.29030228300116,0,1.39282646258394,3.5939003980533,1.67934931018463,1.04865027918152,2.03662610717621],"46":[7.35915868554272,8.75625655153237,5.79526250463457,8.94962356896326,6.58811726491164,5.86607899876528,6.53069786337006,8.1032516481836,7.06404016796525,8.61775471680862,5.73760133578485,8.31475451344325,7.04879139580543,8.10245938074522,6.59285179017342,8.54233653026895,5.2441716406753,6.88058397995598,6.6567126267435,6.30635989469553,5.21299641832844,8.33682536252475,6.13967275461198,6.44761457112889,7.20372119795211,4.45607958891119,2.97111557930645,3.28561165869134,2.59862556370138,1.70850648793545,2.57407498674652,1.7295659097176,1.16395615483347,2.27819683228201,2.92767099681071,4.01838582053961,3.76497026226398,3.0512645114988,2.69307166337524,2.77399532612232,3.71223920267679,4.92062673070464,2.83347794098186,0.136869113067943,1.39282646258394,0,3.94884590970017,2.43377004919426,2.21347758312456,3.25563247827343],"47":[3.78735194534907,4.81304687413339,1.84672004515368,5.06241362317057,2.94712168773458,2.5631866150446,2.62618036091598,4.17961699755715,3.25818211176294,4.66995657089897,2.29081268058498,4.41744381386211,3.36448779614012,4.33346221103805,2.70533810588909,5.15226803336251,1.81639262849636,3.083269590324,2.70978692406121,2.53557944306478,1.27178347568954,4.55946910549021,2.19701812220717,2.58368995883934,3.34390262487784,3.58090873617402,1.0211682854312,1.22271845805597,1.42381883529975,3.42154845263535,1.4208816100939,3.70807863440544,2.85002638162475,3.33169478230804,4.19383093008265,0.320992031208317,2.97393243915409,2.32211911574112,2.35996969022822,1.57376735448924,0.367364603892237,1.67685828466065,3.18837774818061,3.98593912912893,3.5939003980533,3.94884590970017,0,1.96347822455098,2.80459760435989,2.71186367979555],"48":[4.94310729516405,6.64297769163799,3.67579866214399,6.63855194872778,4.19622394738231,3.43756664611093,4.27897859889502,5.84829886204032,5.21422958068684,6.4319937911083,3.32651568395011,6.32444454768889,4.66059244038108,5.7288763209583,4.63759273135781,6.10856851024827,2.84555948791865,4.53847288229172,4.49601891478988,3.96554857671736,3.17823813561298,5.96415817217077,4.07049943367018,4.52892864696003,4.89359788182687,2.53188646991676,1.41491563611952,0.916330992371273,1.36804478467355,1.46785362928603,1.29048556002515,1.7520125884426,1.28631626711234,1.39339025509922,2.31928768533927,1.8833918766463,1.76370098958931,0.862773059999454,0.612318042431877,0.409769266472165,1.61942410875783,2.50819140413365,1.40814556287151,2.41740274121426,1.67934931018463,2.43377004919426,1.96347822455098,0,0.855366581971079,1.26417533061758],"49":[5.4606939739283,7.39291775777266,4.45303478448944,7.28056161030753,4.77385453981781,3.93399912236476,4.98701885102016,6.53659762858239,6.03934075256929,7.15297534965867,3.88336182706517,7.11433696980147,5.237357048326,6.31448639940204,5.44780185491905,6.51664440354196,3.44091456377605,5.17369898075433,5.24634677830354,4.61099188959192,3.98780099476915,6.5488137751308,4.85824448314672,5.34726642052234,5.5528961101356,2.26846196047063,2.2457317867146,1.66624562100661,2.1318646052173,0.739225081658809,2.05731934570863,0.990452431518746,1.29771044642345,0.539011022251472,1.48833102139797,2.69632315620726,1.55338618504733,0.90962738059854,0.590069056064141,1.23089039365878,2.4511321461144,3.08542280882301,0.740701417092333,2.15049332869485,1.04865027918152,2.21347758312456,2.80459760435989,0.855366581971079,0,1.0429412896121],"50":[4.63024933974378,6.86059301349697,4.04454603270359,6.56749510464077,4.02094093145158,3.11923769961109,4.41567174063672,5.90118767269747,5.74331383574864,6.56592944380403,3.13477348873244,6.68283705819891,4.47301299249411,5.54273334111722,5.107430255606,5.58643275216083,2.76102794461793,4.48402933257988,4.75120944079644,3.95045401369275,3.69126131595349,5.77301680223769,4.46451632412159,5.03834424663684,4.88936206534121,1.28975220869445,2.53707897023702,1.49921571937511,2.58817349892393,1.69399878468877,2.51109082855957,1.87127188067371,2.27594186096115,1.19629476198735,1.66127623233176,2.49720584861739,0.529793191497037,0.433455215438647,0.67461819868792,1.37209606833919,2.34762593974729,2.40563338287134,0.683181855798574,3.19340864496776,2.03662610717621,3.25563247827343,2.71186367979555,1.26417533061758,1.0429412896121,0]},"columns":[{"accessor":".rownames","name":"","type":"character","sortable":false,"filterable":false,"rowHeader":true},{"accessor":"1","name":"1","type":"numeric"},{"accessor":"2","name":"2","type":"numeric"},{"accessor":"3","name":"3","type":"numeric"},{"accessor":"4","name":"4","type":"numeric"},{"accessor":"5","name":"5","type":"numeric"},{"accessor":"6","name":"6","type":"numeric"},{"accessor":"7","name":"7","type":"numeric"},{"accessor":"8","name":"8","type":"numeric"},{"accessor":"9","name":"9","type":"numeric"},{"accessor":"10","name":"10","type":"numeric"},{"accessor":"11","name":"11","type":"numeric"},{"accessor":"12","name":"12","type":"numeric"},{"accessor":"13","name":"13","type":"numeric"},{"accessor":"14","name":"14","type":"numeric"},{"accessor":"15","name":"15","type":"numeric"},{"accessor":"16","name":"16","type":"numeric"},{"accessor":"17","name":"17","type":"numeric"},{"accessor":"18","name":"18","type":"numeric"},{"accessor":"19","name":"19","type":"numeric"},{"accessor":"20","name":"20","type":"numeric"},{"accessor":"21","name":"21","type":"numeric"},{"accessor":"22","name":"22","type":"numeric"},{"accessor":"23","name":"23","type":"numeric"},{"accessor":"24","name":"24","type":"numeric"},{"accessor":"25","name":"25","type":"numeric"},{"accessor":"26","name":"26","type":"numeric"},{"accessor":"27","name":"27","type":"numeric"},{"accessor":"28","name":"28","type":"numeric"},{"accessor":"29","name":"29","type":"numeric"},{"accessor":"30","name":"30","type":"numeric"},{"accessor":"31","name":"31","type":"numeric"},{"accessor":"32","name":"32","type":"numeric"},{"accessor":"33","name":"33","type":"numeric"},{"accessor":"34","name":"34","type":"numeric"},{"accessor":"35","name":"35","type":"numeric"},{"accessor":"36","name":"36","type":"numeric"},{"accessor":"37","name":"37","type":"numeric"},{"accessor":"38","name":"38","type":"numeric"},{"accessor":"39","name":"39","type":"numeric"},{"accessor":"40","name":"40","type":"numeric"},{"accessor":"41","name":"41","type":"numeric"},{"accessor":"42","name":"42","type":"numeric"},{"accessor":"43","name":"43","type":"numeric"},{"accessor":"44","name":"44","type":"numeric"},{"accessor":"45","name":"45","type":"numeric"},{"accessor":"46","name":"46","type":"numeric"},{"accessor":"47","name":"47","type":"numeric"},{"accessor":"48","name":"48","type":"numeric"},{"accessor":"49","name":"49","type":"numeric"},{"accessor":"50","name":"50","type":"numeric"}],"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"f33743123c83a2cc0706e9e80e5be011"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/hclust.html"><code>stats::hclust</code></a> function implements hierarchical clustering in R. We use the data used for K-means clustering to plot the hierarchical clustering dendrogram using complete, single, and average linkage clustering, with Euclidean distance as the dissimilarity measure.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>res_hclust_complete <span class="ot">&lt;-</span> dissimilarity_measure <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>  stats<span class="sc">::</span><span class="fu">hclust</span>(<span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb53-3"><a href="#cb53-3"></a></span>
<span id="cb53-4"><a href="#cb53-4"></a>res_hclust_average <span class="ot">&lt;-</span> dissimilarity_measure <span class="sc">%&gt;%</span></span>
<span id="cb53-5"><a href="#cb53-5"></a>  stats<span class="sc">::</span><span class="fu">hclust</span>(<span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb53-6"><a href="#cb53-6"></a></span>
<span id="cb53-7"><a href="#cb53-7"></a>res_hclust_single <span class="ot">&lt;-</span> dissimilarity_measure <span class="sc">%&gt;%</span></span>
<span id="cb53-8"><a href="#cb53-8"></a>  stats<span class="sc">::</span><span class="fu">hclust</span>(<span class="at">method =</span> <span class="st">"single"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We use <a href="https://rpkgs.datanovia.com/factoextra/reference/fviz_dend.html"><code>factoextra::fviz_dend</code></a> to visualize the clustering created using <code>hclust</code>.</p>
<p>To determine the cluster labels for each observation associated with a given cut of the dendrogram, we can use the <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/cutree.html"><code>stats::cutree</code></a> function</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">Complete</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href="">Average</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false" href="">Single</a></li>
</ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(res_hclust_complete, <span class="at">main =</span> <span class="st">"complete"</span>, <span class="at">k =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="3883"></p>
</div>
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>stats<span class="sc">::</span><span class="fu">cutree</span>(<span class="at">tree =</span> res_hclust_complete, <span class="at">k =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2
&gt; [39] 2 2 2 1 2 2 2 2 2 2 2 2</code></pre>
</div>
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>results_hclust <span class="ot">&lt;-</span></span>
<span id="cb57-2"><a href="#cb57-2"></a>  tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb57-3"><a href="#cb57-3"></a>    <span class="at">cluster_id =</span> stats<span class="sc">::</span><span class="fu">cutree</span>(<span class="at">tree =</span> res_hclust_complete, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb57-4"><a href="#cb57-4"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb57-5"><a href="#cb57-5"></a>  dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(points) <span class="sc">%&gt;%</span></span>
<span id="cb57-6"><a href="#cb57-6"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">cluster_id =</span> <span class="fu">as.factor</span>(.data<span class="sc">$</span>cluster_id))</span>
<span id="cb57-7"><a href="#cb57-7"></a></span>
<span id="cb57-8"><a href="#cb57-8"></a>results_hclust <span class="sc">%&gt;%</span></span>
<span id="cb57-9"><a href="#cb57-9"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-3660fd94fc1dd7d34269" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3660fd94fc1dd7d34269">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"cluster_id":["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","1","2","2","2","2","2","2","2","2"],"V1":[-0.896914546624981,0.184849184646742,1.58784533120882,-1.13037567424629,-0.0802517565509893,0.132420284381094,0.707954729271733,-0.23969802417184,1.98447393665293,-0.138787012119665,0.417650750792556,0.981752777463662,-0.392695355503813,-1.03966897694891,1.78222896030858,-2.31106908460517,0.878604580921265,0.035806718015226,1.01282869212708,0.432265154539617,2.09081920524915,-1.19992581964387,1.58963820029007,1.95465164222325,0.00493777682814261,0.548293612153874,3.47723730261362,2.4034418313686,3.79220327029965,3.28963671017735,3.73893860376212,3.31896040109765,4.076164353812,2.71584227951175,2.22332472602024,2.40433950130822,1.27402022085397,2.09741552023631,2.44093808509953,2.75348743266648,2.61641377156856,1.04089682483287,2.15829493986439,4.90354746734764,3.62249393012074,4.99092043558031,2.69451627515855,2.90915576479924,2.81583854844874,1.80123223469259],"V2":[-0.838287147602044,2.06630135573124,-0.562247053342494,1.27571551185092,-1.04757262699498,-1.96587824144733,-0.322971093759972,0.935862526808633,1.13922980273408,1.67161876732599,-1.78824220676485,2.03124251875525,-0.703144332993886,0.158164762560122,0.50623479748072,-0.819995105616198,-1.99884699496412,-0.479292591451641,0.0841799043222426,-0.895486610663309,-0.921275665507737,0.330449503465315,-0.141660808936081,0.434847761502698,-0.053722626017184,-4.90711037559349,-2.69648776757773,-3.22821022446014,-2.94747440469236,-5.41003834066371,-3.00401541022225,-5.69576490337902,-4.5333721425472,-5.37226945114308,-6.20791977880464,-2.17787748124644,-4.65339341081878,-4.28468121935507,-4.38694960364493,-3.61330502535393,-2.39960914846048,-2.31884504423318,-5.18360638822726,-5.3584572535632,-5.512670794721,-5.2531048993692,-2.0406429228544,-3.99235412786723,-4.84261519758963,-4.60116010515235]},"columns":[{"accessor":"cluster_id","name":"cluster_id","type":"factor"},{"accessor":"V1","name":"V1","type":"numeric"},{"accessor":"V2","name":"V2","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"42925d6365888e986a541ecd503b691c"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(res_hclust_average, <span class="at">main =</span> <span class="st">"average"</span>, <span class="at">k =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="3883"></p>
</div>
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="fu">cutree</span>(<span class="at">tree =</span> res_hclust_average, <span class="at">k =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2
&gt; [39] 2 2 2 1 2 2 2 2 2 2 2 2</code></pre>
</div>
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>results_hclust <span class="ot">&lt;-</span></span>
<span id="cb61-2"><a href="#cb61-2"></a>  tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb61-3"><a href="#cb61-3"></a>    <span class="at">cluster_id =</span> stats<span class="sc">::</span><span class="fu">cutree</span>(<span class="at">tree =</span> res_hclust_average, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb61-4"><a href="#cb61-4"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb61-5"><a href="#cb61-5"></a>  dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(points) <span class="sc">%&gt;%</span></span>
<span id="cb61-6"><a href="#cb61-6"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">cluster_id =</span> <span class="fu">as.factor</span>(.data<span class="sc">$</span>cluster_id))</span>
<span id="cb61-7"><a href="#cb61-7"></a></span>
<span id="cb61-8"><a href="#cb61-8"></a>results_hclust <span class="sc">%&gt;%</span></span>
<span id="cb61-9"><a href="#cb61-9"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-3de992e7f635c365efb9" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3de992e7f635c365efb9">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"cluster_id":["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","1","2","2","2","2","2","2","2","2"],"V1":[-0.896914546624981,0.184849184646742,1.58784533120882,-1.13037567424629,-0.0802517565509893,0.132420284381094,0.707954729271733,-0.23969802417184,1.98447393665293,-0.138787012119665,0.417650750792556,0.981752777463662,-0.392695355503813,-1.03966897694891,1.78222896030858,-2.31106908460517,0.878604580921265,0.035806718015226,1.01282869212708,0.432265154539617,2.09081920524915,-1.19992581964387,1.58963820029007,1.95465164222325,0.00493777682814261,0.548293612153874,3.47723730261362,2.4034418313686,3.79220327029965,3.28963671017735,3.73893860376212,3.31896040109765,4.076164353812,2.71584227951175,2.22332472602024,2.40433950130822,1.27402022085397,2.09741552023631,2.44093808509953,2.75348743266648,2.61641377156856,1.04089682483287,2.15829493986439,4.90354746734764,3.62249393012074,4.99092043558031,2.69451627515855,2.90915576479924,2.81583854844874,1.80123223469259],"V2":[-0.838287147602044,2.06630135573124,-0.562247053342494,1.27571551185092,-1.04757262699498,-1.96587824144733,-0.322971093759972,0.935862526808633,1.13922980273408,1.67161876732599,-1.78824220676485,2.03124251875525,-0.703144332993886,0.158164762560122,0.50623479748072,-0.819995105616198,-1.99884699496412,-0.479292591451641,0.0841799043222426,-0.895486610663309,-0.921275665507737,0.330449503465315,-0.141660808936081,0.434847761502698,-0.053722626017184,-4.90711037559349,-2.69648776757773,-3.22821022446014,-2.94747440469236,-5.41003834066371,-3.00401541022225,-5.69576490337902,-4.5333721425472,-5.37226945114308,-6.20791977880464,-2.17787748124644,-4.65339341081878,-4.28468121935507,-4.38694960364493,-3.61330502535393,-2.39960914846048,-2.31884504423318,-5.18360638822726,-5.3584572535632,-5.512670794721,-5.2531048993692,-2.0406429228544,-3.99235412786723,-4.84261519758963,-4.60116010515235]},"columns":[{"accessor":"cluster_id","name":"cluster_id","type":"factor"},{"accessor":"V1","name":"V1","type":"numeric"},{"accessor":"V2","name":"V2","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"42925d6365888e986a541ecd503b691c"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(res_hclust_single, <span class="at">main =</span> <span class="st">"single"</span>, <span class="at">k =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="3883"></p>
</div>
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="fu">cutree</span>(<span class="at">tree =</span> res_hclust_single, <span class="at">k =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 3 3 3 3 3 3 3 3 3 3 3 3 3
&gt; [39] 3 3 3 1 3 4 3 4 3 3 3 3</code></pre>
</div>
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a>results_hclust <span class="ot">&lt;-</span></span>
<span id="cb65-2"><a href="#cb65-2"></a>  tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb65-3"><a href="#cb65-3"></a>    <span class="at">cluster_id =</span> stats<span class="sc">::</span><span class="fu">cutree</span>(<span class="at">tree =</span> res_hclust_single, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb65-4"><a href="#cb65-4"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb65-5"><a href="#cb65-5"></a>  dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(points) <span class="sc">%&gt;%</span></span>
<span id="cb65-6"><a href="#cb65-6"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">cluster_id =</span> <span class="fu">as.factor</span>(.data<span class="sc">$</span>cluster_id))</span>
<span id="cb65-7"><a href="#cb65-7"></a></span>
<span id="cb65-8"><a href="#cb65-8"></a>results_hclust <span class="sc">%&gt;%</span></span>
<span id="cb65-9"><a href="#cb65-9"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-1ff23250e3e1cc3ddbbe" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1ff23250e3e1cc3ddbbe">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"cluster_id":["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","2","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1"],"V1":[-0.896914546624981,0.184849184646742,1.58784533120882,-1.13037567424629,-0.0802517565509893,0.132420284381094,0.707954729271733,-0.23969802417184,1.98447393665293,-0.138787012119665,0.417650750792556,0.981752777463662,-0.392695355503813,-1.03966897694891,1.78222896030858,-2.31106908460517,0.878604580921265,0.035806718015226,1.01282869212708,0.432265154539617,2.09081920524915,-1.19992581964387,1.58963820029007,1.95465164222325,0.00493777682814261,0.548293612153874,3.47723730261362,2.4034418313686,3.79220327029965,3.28963671017735,3.73893860376212,3.31896040109765,4.076164353812,2.71584227951175,2.22332472602024,2.40433950130822,1.27402022085397,2.09741552023631,2.44093808509953,2.75348743266648,2.61641377156856,1.04089682483287,2.15829493986439,4.90354746734764,3.62249393012074,4.99092043558031,2.69451627515855,2.90915576479924,2.81583854844874,1.80123223469259],"V2":[-0.838287147602044,2.06630135573124,-0.562247053342494,1.27571551185092,-1.04757262699498,-1.96587824144733,-0.322971093759972,0.935862526808633,1.13922980273408,1.67161876732599,-1.78824220676485,2.03124251875525,-0.703144332993886,0.158164762560122,0.50623479748072,-0.819995105616198,-1.99884699496412,-0.479292591451641,0.0841799043222426,-0.895486610663309,-0.921275665507737,0.330449503465315,-0.141660808936081,0.434847761502698,-0.053722626017184,-4.90711037559349,-2.69648776757773,-3.22821022446014,-2.94747440469236,-5.41003834066371,-3.00401541022225,-5.69576490337902,-4.5333721425472,-5.37226945114308,-6.20791977880464,-2.17787748124644,-4.65339341081878,-4.28468121935507,-4.38694960364493,-3.61330502535393,-2.39960914846048,-2.31884504423318,-5.18360638822726,-5.3584572535632,-5.512670794721,-5.2531048993692,-2.0406429228544,-3.99235412786723,-4.84261519758963,-4.60116010515235]},"columns":[{"accessor":"cluster_id","name":"cluster_id","type":"factor"},{"accessor":"V1","name":"V1","type":"numeric"},{"accessor":"V2","name":"V2","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"da59282261538d6607769a33e1275cc7"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</div>
<p>We analyze the nature of the clusters mathematically by evaluating the c, which measures the clustering structure of the dataset - with values closer to 1 suggest a more balanced clustering structure and values closer to 0 suggest less well-formed clusters. However, the agglomerative coefficient tends to become larger as the number of samples increases, so it should not be used to compare across data sets of very different sizes.</p>
<p><a href="https://stat.ethz.ch/R-manual/R-devel/library/cluster/html/agnes.html"><code>cluster::agnes</code></a> allows us to compute this metric on the results from hierarchical clustering.</p>
<p>It looks like the complete linkage did the best.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="co"># Compute agglomerative coefficient values</span></span>
<span id="cb66-2"><a href="#cb66-2"></a></span>
<span id="cb66-3"><a href="#cb66-3"></a>ac_metric <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb66-4"><a href="#cb66-4"></a>  <span class="at">complete_ac =</span> cluster<span class="sc">::</span><span class="fu">agnes</span>(</span>
<span id="cb66-5"><a href="#cb66-5"></a>    <span class="at">x =</span> dissimilarity_measure,</span>
<span id="cb66-6"><a href="#cb66-6"></a>    <span class="at">metric =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb66-7"><a href="#cb66-7"></a>    <span class="at">method =</span> <span class="st">"complete"</span></span>
<span id="cb66-8"><a href="#cb66-8"></a>  )<span class="sc">$</span>ac,</span>
<span id="cb66-9"><a href="#cb66-9"></a>  <span class="at">average_ac =</span> cluster<span class="sc">::</span><span class="fu">agnes</span>(</span>
<span id="cb66-10"><a href="#cb66-10"></a>    <span class="at">x =</span> dissimilarity_measure,</span>
<span id="cb66-11"><a href="#cb66-11"></a>    <span class="at">metric =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb66-12"><a href="#cb66-12"></a>    <span class="at">method =</span> <span class="st">"average"</span></span>
<span id="cb66-13"><a href="#cb66-13"></a>  )<span class="sc">$</span>ac,</span>
<span id="cb66-14"><a href="#cb66-14"></a>  <span class="at">single_ac =</span> cluster<span class="sc">::</span><span class="fu">agnes</span>(</span>
<span id="cb66-15"><a href="#cb66-15"></a>    <span class="at">x =</span> dissimilarity_measure,</span>
<span id="cb66-16"><a href="#cb66-16"></a>    <span class="at">metric =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb66-17"><a href="#cb66-17"></a>    <span class="at">method =</span> <span class="st">"single"</span></span>
<span id="cb66-18"><a href="#cb66-18"></a>  )<span class="sc">$</span>ac</span>
<span id="cb66-19"><a href="#cb66-19"></a>)</span>
<span id="cb66-20"><a href="#cb66-20"></a></span>
<span id="cb66-21"><a href="#cb66-21"></a>ac_metric</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt; $complete_ac
&gt; [1] 0.9359608
&gt; 
&gt; $average_ac
&gt; [1] 0.8887208
&gt; 
&gt; $single_ac
&gt; [1] 0.6700538</code></pre>
</div>
</div>
<p>Although hierarchical clustering provides a fully connected dendrogram representing the cluster relationships, there may still need to choose the preferred number of clusters to extract. Fortunately we can execute approaches similar to those discussed for k-means clustering with <a href="https://rpkgs.datanovia.com/factoextra/reference/fviz_nbclust.html"><code>factoextra::fviz_nbclust</code></a></p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="co"># Plot cluster results</span></span>
<span id="cb68-2"><a href="#cb68-2"></a>p1 <span class="ot">&lt;-</span> factoextra<span class="sc">::</span><span class="fu">fviz_nbclust</span>(</span>
<span id="cb68-3"><a href="#cb68-3"></a>  <span class="at">x =</span> points,</span>
<span id="cb68-4"><a href="#cb68-4"></a>  <span class="at">FUN =</span> factoextra<span class="sc">::</span>hcut,</span>
<span id="cb68-5"><a href="#cb68-5"></a>  <span class="at">method =</span> <span class="st">"wss"</span>,</span>
<span id="cb68-6"><a href="#cb68-6"></a>  <span class="at">k.max =</span> <span class="dv">10</span></span>
<span id="cb68-7"><a href="#cb68-7"></a>) <span class="sc">+</span></span>
<span id="cb68-8"><a href="#cb68-8"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="at">label =</span> <span class="st">"(A) Elbow method"</span>)</span>
<span id="cb68-9"><a href="#cb68-9"></a></span>
<span id="cb68-10"><a href="#cb68-10"></a>p2 <span class="ot">&lt;-</span> factoextra<span class="sc">::</span><span class="fu">fviz_nbclust</span>(</span>
<span id="cb68-11"><a href="#cb68-11"></a>  <span class="at">x =</span> points,</span>
<span id="cb68-12"><a href="#cb68-12"></a>  <span class="at">FUN =</span> factoextra<span class="sc">::</span>hcut,</span>
<span id="cb68-13"><a href="#cb68-13"></a>  <span class="at">method =</span> <span class="st">"silhouette"</span>,</span>
<span id="cb68-14"><a href="#cb68-14"></a>  <span class="at">k.max =</span> <span class="dv">10</span></span>
<span id="cb68-15"><a href="#cb68-15"></a>) <span class="sc">+</span></span>
<span id="cb68-16"><a href="#cb68-16"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">"(B) Silhouette method"</span>)</span>
<span id="cb68-17"><a href="#cb68-17"></a></span>
<span id="cb68-18"><a href="#cb68-18"></a>p3 <span class="ot">&lt;-</span> factoextra<span class="sc">::</span><span class="fu">fviz_nbclust</span>(</span>
<span id="cb68-19"><a href="#cb68-19"></a>  <span class="at">x =</span> points,</span>
<span id="cb68-20"><a href="#cb68-20"></a>  <span class="at">FUN =</span> factoextra<span class="sc">::</span>hcut,</span>
<span id="cb68-21"><a href="#cb68-21"></a>  <span class="at">method =</span> <span class="st">"gap_stat"</span>,</span>
<span id="cb68-22"><a href="#cb68-22"></a>  <span class="at">k.max =</span> <span class="dv">10</span></span>
<span id="cb68-23"><a href="#cb68-23"></a>) <span class="sc">+</span></span>
<span id="cb68-24"><a href="#cb68-24"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">"(C) Gap statistic"</span>)</span>
<span id="cb68-25"><a href="#cb68-25"></a></span>
<span id="cb68-26"><a href="#cb68-26"></a><span class="co"># Display plots side by side</span></span>
<span id="cb68-27"><a href="#cb68-27"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="3883"></p>
</div>
</div>
<p>Another way of calculating distances is based on pearson correlation using [proxy::dist]. However, this only makes sense if we have data with 3 or more variables.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="co"># correlation based distance</span></span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb69-3"><a href="#cb69-3"></a>three_var_data <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">30</span> <span class="sc">*</span> <span class="dv">3</span>), <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb69-4"><a href="#cb69-4"></a></span>
<span id="cb69-5"><a href="#cb69-5"></a>three_var_data <span class="sc">%&gt;%</span></span>
<span id="cb69-6"><a href="#cb69-6"></a>  proxy<span class="sc">::</span><span class="fu">dist</span>(<span class="at">method =</span> <span class="st">"correlation"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-7"><a href="#cb69-7"></a>  stats<span class="sc">::</span><span class="fu">hclust</span>(<span class="at">method =</span> <span class="st">"complete"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-8"><a href="#cb69-8"></a>  factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(<span class="at">main =</span> <span class="st">"complete"</span>, <span class="at">k =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="3883"></p>
</div>
</div>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="co"># Plot cluster results</span></span>
<span id="cb70-2"><a href="#cb70-2"></a>p1 <span class="ot">&lt;-</span> factoextra<span class="sc">::</span><span class="fu">fviz_nbclust</span>(</span>
<span id="cb70-3"><a href="#cb70-3"></a>  <span class="at">x =</span> three_var_data,</span>
<span id="cb70-4"><a href="#cb70-4"></a>  <span class="at">FUN =</span> factoextra<span class="sc">::</span>hcut,</span>
<span id="cb70-5"><a href="#cb70-5"></a>  <span class="at">method =</span> <span class="st">"wss"</span>,</span>
<span id="cb70-6"><a href="#cb70-6"></a>  <span class="at">hc_metric =</span> <span class="st">"pearson"</span>,</span>
<span id="cb70-7"><a href="#cb70-7"></a>  <span class="at">k.max =</span> <span class="dv">10</span></span>
<span id="cb70-8"><a href="#cb70-8"></a>) <span class="sc">+</span></span>
<span id="cb70-9"><a href="#cb70-9"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="at">label =</span> <span class="st">"(A) Elbow method"</span>)</span>
<span id="cb70-10"><a href="#cb70-10"></a></span>
<span id="cb70-11"><a href="#cb70-11"></a>p2 <span class="ot">&lt;-</span> factoextra<span class="sc">::</span><span class="fu">fviz_nbclust</span>(</span>
<span id="cb70-12"><a href="#cb70-12"></a>  <span class="at">x =</span> three_var_data,</span>
<span id="cb70-13"><a href="#cb70-13"></a>  <span class="at">FUN =</span> factoextra<span class="sc">::</span>hcut,</span>
<span id="cb70-14"><a href="#cb70-14"></a>  <span class="at">method =</span> <span class="st">"silhouette"</span>,</span>
<span id="cb70-15"><a href="#cb70-15"></a>  <span class="at">hc_metric =</span> <span class="st">"pearson"</span>,</span>
<span id="cb70-16"><a href="#cb70-16"></a>  <span class="at">k.max =</span> <span class="dv">10</span></span>
<span id="cb70-17"><a href="#cb70-17"></a>) <span class="sc">+</span></span>
<span id="cb70-18"><a href="#cb70-18"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">"(B) Silhouette method"</span>)</span>
<span id="cb70-19"><a href="#cb70-19"></a></span>
<span id="cb70-20"><a href="#cb70-20"></a>p3 <span class="ot">&lt;-</span> factoextra<span class="sc">::</span><span class="fu">fviz_nbclust</span>(</span>
<span id="cb70-21"><a href="#cb70-21"></a>  <span class="at">x =</span> three_var_data,</span>
<span id="cb70-22"><a href="#cb70-22"></a>  <span class="at">FUN =</span> factoextra<span class="sc">::</span>hcut,</span>
<span id="cb70-23"><a href="#cb70-23"></a>  <span class="at">method =</span> <span class="st">"gap_stat"</span>,</span>
<span id="cb70-24"><a href="#cb70-24"></a>  <span class="at">hc_metric =</span> <span class="st">"pearson"</span>,</span>
<span id="cb70-25"><a href="#cb70-25"></a>  <span class="at">k.max =</span> <span class="dv">10</span></span>
<span id="cb70-26"><a href="#cb70-26"></a>) <span class="sc">+</span></span>
<span id="cb70-27"><a href="#cb70-27"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">"(C) Gap statistic"</span>)</span>
<span id="cb70-28"><a href="#cb70-28"></a></span>
<span id="cb70-29"><a href="#cb70-29"></a><span class="co"># Display plots side by side</span></span>
<span id="cb70-30"><a href="#cb70-30"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="3883"></p>
</div>
</div>
</section><section id="nci60-data-example" class="level1"><h1>NCI60 Data Example</h1>
<p>Unsupervised techniques are often used in the analysis of genomic data.</p>
<p>We illustrate these techniques on the <a href="https://rdrr.io/cran/ISLR2/man/NCI60.html">NCI60</a> cancer cell line microarray data, which consists of 6,830 gene expression measurements on 64 cancer cell lines.</p>
<p><code>labels</code> represents the type of cancer. V_1 to V_6830 represent a gene.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a>nci60 <span class="ot">&lt;-</span> ISLR2<span class="sc">::</span>NCI60<span class="sc">$</span>data <span class="sc">%&gt;%</span></span>
<span id="cb71-2"><a href="#cb71-2"></a>  tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb71-3"><a href="#cb71-3"></a>  magrittr<span class="sc">::</span><span class="fu">set_colnames</span>(., <span class="fu">paste0</span>(<span class="st">"V_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(.))) <span class="sc">%&gt;%</span></span>
<span id="cb71-4"><a href="#cb71-4"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">factor</span>(ISLR2<span class="sc">::</span>NCI60<span class="sc">$</span>labs)) <span class="sc">%&gt;%</span></span>
<span id="cb71-5"><a href="#cb71-5"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(.data[[<span class="st">"label"</span>]])</span>
<span id="cb71-6"><a href="#cb71-6"></a></span>
<span id="cb71-7"><a href="#cb71-7"></a><span class="co"># head(nci60) %&gt;%</span></span>
<span id="cb71-8"><a href="#cb71-8"></a><span class="co">#   reactable::reactable(defaultPageSize = 10)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="pca-on-the-nci60-data" class="level2"><h2 class="anchored" data-anchor-id="pca-on-the-nci60-data">PCA on the NCI60 Data</h2>
<p>We first perform PCA on the data after scaling the variables (genes) to have standard deviation one and plot the first few principal component score vectors, in order to visualize the data.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a>nci60_preproc_rec <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(<span class="at">formula =</span> label <span class="sc">~</span> ., <span class="at">data =</span> nci60) <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="#cb72-2"></a>  recipes<span class="sc">::</span><span class="fu">step_normalize</span>(recipes<span class="sc">::</span><span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3"></a>  recipes<span class="sc">::</span><span class="fu">step_pca</span>(recipes<span class="sc">::</span><span class="fu">all_numeric_predictors</span>(),</span>
<span id="cb72-4"><a href="#cb72-4"></a>    <span class="at">id =</span> <span class="st">"pca"</span>,</span>
<span id="cb72-5"><a href="#cb72-5"></a>    <span class="at">threshold =</span> <span class="fl">0.99</span></span>
<span id="cb72-6"><a href="#cb72-6"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a>nci60_pca_estimates <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">prep</span>(<span class="at">x =</span> nci60_preproc_rec)</span>
<span id="cb73-2"><a href="#cb73-2"></a></span>
<span id="cb73-3"><a href="#cb73-3"></a>nci60_pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb73-4"><a href="#cb73-4"></a>  <span class="fu">summary</span>() <span class="sc">%&gt;%</span></span>
<span id="cb73-5"><a href="#cb73-5"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-ad5d2ca61fd1c400a6ef" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ad5d2ca61fd1c400a6ef">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"variable":["label","PC01","PC02","PC03","PC04","PC05","PC06","PC07","PC08","PC09","PC10","PC11","PC12","PC13","PC14","PC15","PC16","PC17","PC18","PC19","PC20","PC21","PC22","PC23","PC24","PC25","PC26","PC27","PC28","PC29","PC30","PC31","PC32","PC33","PC34","PC35","PC36","PC37","PC38","PC39","PC40","PC41","PC42","PC43","PC44","PC45","PC46","PC47","PC48","PC49","PC50","PC51","PC52","PC53","PC54","PC55","PC56","PC57","PC58","PC59","PC60"],"type":["nominal","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric"],"role":["outcome","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor","predictor"],"source":["original","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived","derived"]},"columns":[{"accessor":"variable","name":"variable","type":"character"},{"accessor":"type","name":"type","type":"character"},{"accessor":"role","name":"role","type":"character"},{"accessor":"source","name":"source","type":"character"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"8c1565860be44446fe2ea58fee326555"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a>nci60_pca_score <span class="ot">&lt;-</span> nci60_pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2"></a>  recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data =</span> <span class="cn">NULL</span>)</span>
<span id="cb74-3"><a href="#cb74-3"></a></span>
<span id="cb74-4"><a href="#cb74-4"></a></span>
<span id="cb74-5"><a href="#cb74-5"></a><span class="fu">head</span>(nci60_pca_score) <span class="sc">%&gt;%</span></span>
<span id="cb74-6"><a href="#cb74-6"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-bd8ca626710f95b98403" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-bd8ca626710f95b98403">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"label":["CNS","CNS","CNS","RENAL","BREAST","CNS"],"PC01":[-19.6824468025745,-22.9081202285315,-27.2407690143487,-42.4809775873896,-54.9838679804783,-26.9648816460474],"PC02":[3.52774824026763,6.39093774592974,2.44580850625661,-9.69174249480421,-5.15812084985909,6.72712243850131],"PC03":[-9.73543821390473,-13.3725377737062,-3.50534368240367,-0.883092106417618,-20.929107600449,-21.6422924143377],"PC04":[0.817781589502393,-5.59110879065057,1.33115016655506,-3.41802265496951,-15.7253985964131,-13.7323152903084],"PC05":[-12.5110806465161,-7.9724712642808,-12.4662964234964,-41.9383699231016,-10.3613641086036,7.93482658795791],"PC06":[7.41290369363138,3.68603851407774,17.208884631525,27.0251739275357,12.8891586783271,0.707349505847972],"PC07":[-14.079428837674,-10.0636686506772,-10.2736408065009,-17.3832230719911,-12.499086547613,-27.7843016080027],"PC08":[3.17289431321425,7.23552500497875,2.65033022640746,0.549993542748257,-32.2580874821563,-31.0436472452867],"PC09":[-21.7662819215445,-22.1630786133483,0.233083184618946,-14.1524751403612,7.8348684654573,10.8657698964732],"PC10":[20.2096006994903,13.0168621310676,6.30809960036591,-15.8439530229899,10.0974402885034,-2.29807059869325],"PC11":[-12.3480442386707,-14.5726486834802,-10.6163423697875,14.1806026534481,2.13304694940096,-20.2293707247696],"PC12":[20.1303499120546,22.2443908934699,-0.0854211764167011,6.85376499629147,-17.1264305978879,14.0851795023613],"PC13":[-6.48029345994061,-22.7168168827728,-13.6339710766728,-7.32803052579982,6.98165989999192,-3.57129237039482],"PC14":[3.59062312428483,-4.06234036657002,11.6764343498519,9.00467261523794,12.4028885718114,-27.8214837648165],"PC15":[-3.76574774412446,2.83835740567823,-3.82527543071743,-6.73800888353107,-6.40293520310184,3.1337575436922],"PC16":[6.12709169315801,-5.06769542348757,7.73202432249283,21.1010591185415,4.54592737448792,16.9270303153614],"PC17":[-20.1640310082371,-19.0485372726732,-12.8691131166342,2.85356593637569,20.940377806906,3.73885329929782],"PC18":[8.77249361120264,4.79090214265383,-0.649267584285895,1.35484101379413,-16.9982020152134,8.53052233302386],"PC19":[6.81408728599265,8.18418469849397,-3.63206801745844,3.07686280662751,-3.86126556040149,-5.43648630767475],"PC20":[5.92756224606513,17.6107381514655,5.5902654720974,-1.09323585945134,4.39738740930278,-28.3791091433415],"PC21":[7.24013616449786,-2.10238751518893,1.74465524487709,-5.85899974386812,-4.73389996798293,7.24660030273803],"PC22":[-7.56671765398526,-10.532971826806,6.87207525173443,-16.9964449878841,8.48753228525083,-6.98802881639383],"PC23":[-11.4890416034948,-4.11745649588952,5.15729449927785,-7.55134251003154,-4.38114586830962,6.97340122307744],"PC24":[14.4032035823844,11.2250207355061,0.875897033995556,-16.6752661720187,-10.6172338321826,-0.43803933152966],"PC25":[7.25765040693341,5.50167037353496,6.90486862625404,-5.21166515445905,18.4959620920336,-29.80937468824],"PC26":[3.44413838390383,-2.83032800155904,-8.40057450669115,-1.68226774968772,4.61357513537548,10.3278878992913],"PC27":[-10.9719141526716,-2.97271123549273,11.376138375911,10.5743979589505,12.8403357666178,7.85091443371048],"PC28":[-1.17891032811645,-6.43253236846533,-0.841513028033262,-4.52406525186412,-4.13077040584683,13.3752655838722],"PC29":[-0.675597115861164,-11.5409457521836,-14.3417373829548,6.45790838517299,-13.5779015254664,-8.79986242831618],"PC30":[-3.09372531690955,-12.401353894136,-0.616313013874113,6.29796131801187,14.9174840375868,-6.3616115807992],"PC31":[4.55856832976561,-5.21661321591152,1.75542361991944,-5.75221184767757,-7.67653934195802,6.7623373953213],"PC32":[1.71957628091725,-1.08055226164513,-0.0946407267764156,4.41405924331734,10.4025074798616,3.30326620524453],"PC33":[4.32877379936458,-1.1699373561713,-5.14450682447658,4.8273337896023,-8.31920494626779,-2.10609744882594],"PC34":[2.3100903996461,-7.70033735892209,-2.28554194420595,0.919314131926634,-4.37063115683784,20.1763454494783],"PC35":[0.690492977753616,2.44878717343343,-6.46676756514892,-6.01817186228761,6.78007395951546,-2.32135266864952],"PC36":[-7.87302071502837,-11.8371456146915,1.96810159773087,13.7016586200292,-13.088402912592,-9.65201299911908],"PC37":[-0.573848186554159,-14.2812728494118,1.04419056404125,0.106821900056233,4.65953103467963,4.06441684358548],"PC38":[-5.06158335014187,4.37567062825055,2.50618059074113,0.100888236061464,10.4589520417067,0.880778600376907],"PC39":[-2.32710633397765,5.92899371409215,2.23284253610143,-6.2849862709771,10.3276433178667,3.38020784130427],"PC40":[14.818463809776,-3.75776220882301,-18.1334546130287,-1.61649391632205,13.0823336613337,-0.806178843271263],"PC41":[3.59123022815611,-1.6250538622381,-9.08545150626185,-6.15283118708637,-3.65423893151757,7.6213176521424],"PC42":[7.1254782589801,-0.234670789820203,2.68136671280072,11.1449127422531,-7.44640091742224,1.79139022166547],"PC43":[-4.96533400229068,0.903723135362824,2.01639265580193,4.13183411163623,3.03246302277032,2.10404315593372],"PC44":[-3.52883092857423,0.59790649373185,6.13433537722121,4.8678069524965,-5.50081406428649,-0.163576410492311],"PC45":[-4.99908604654366,2.5791661744337,-4.06422648443224,4.4131934893141,-9.70552564879287,2.19072930949672],"PC46":[-0.00660486674457773,-14.6395502850682,30.8012179761236,-12.8952256715645,-7.16211898243803,-0.211284999232895],"PC47":[-5.79955686811733,-4.96991021025858,-0.399386228269276,1.74778060562273,-6.09901983970995,0.615801401457795],"PC48":[2.08808791870162,-1.41037161352881,12.289090491511,0.3940295891768,4.13544778540785,-3.25093389886499],"PC49":[15.1080963872517,-12.190625012036,10.7688023680817,-7.53974625947966,-0.964433840130228,2.48716550179903],"PC50":[10.9572089125674,-3.66619166114722,-4.92181961024718,-8.06805052442636,4.35203047927434,-0.383301904149703],"PC51":[-9.85579248973004,12.3976879432041,-7.52841237859231,-8.88144739841955,4.13455253476282,0.63988741491382],"PC52":[-8.34959066087565,0.433588352945617,13.4335244425701,7.29986619416599,-2.12659665824719,1.23620383651718],"PC53":[-3.95392526237828,-1.31899627891623,-7.79124109027199,16.2762385428228,-5.05757083632279,-0.715092137417344],"PC54":[-14.6993625171049,14.0747866131432,1.94296165947432,-0.25094589275811,-1.07092758655799,1.28229108251732],"PC55":[-3.5435988699045,3.35163575839427,1.28930774347207,-0.339947161396025,-0.262489801586057,0.801355651626869],"PC56":[11.0245222156645,-5.19122107357171,-5.28127107032227,1.10911078904498,2.29382203362359,-1.69989995723524],"PC57":[6.28656668708671,-6.27572938303642,-4.82899784112398,2.49201928116972,2.90352446289154,-1.87614786973006],"PC58":[-9.0066970695839,7.60546727876638,0.0446247515137549,-6.33994185643882,1.85564982738797,2.92108736656044],"PC59":[3.86203068407045,-3.90790541661557,-2.01193145506392,3.40267255570011,-2.27768337117865,-1.9576288237299],"PC60":[-3.21536921526774,3.98678144552592,-1.08127017369526,-0.700201900873579,0.609559532596292,-0.136023363619553]},"columns":[{"accessor":"label","name":"label","type":"factor"},{"accessor":"PC01","name":"PC01","type":"numeric"},{"accessor":"PC02","name":"PC02","type":"numeric"},{"accessor":"PC03","name":"PC03","type":"numeric"},{"accessor":"PC04","name":"PC04","type":"numeric"},{"accessor":"PC05","name":"PC05","type":"numeric"},{"accessor":"PC06","name":"PC06","type":"numeric"},{"accessor":"PC07","name":"PC07","type":"numeric"},{"accessor":"PC08","name":"PC08","type":"numeric"},{"accessor":"PC09","name":"PC09","type":"numeric"},{"accessor":"PC10","name":"PC10","type":"numeric"},{"accessor":"PC11","name":"PC11","type":"numeric"},{"accessor":"PC12","name":"PC12","type":"numeric"},{"accessor":"PC13","name":"PC13","type":"numeric"},{"accessor":"PC14","name":"PC14","type":"numeric"},{"accessor":"PC15","name":"PC15","type":"numeric"},{"accessor":"PC16","name":"PC16","type":"numeric"},{"accessor":"PC17","name":"PC17","type":"numeric"},{"accessor":"PC18","name":"PC18","type":"numeric"},{"accessor":"PC19","name":"PC19","type":"numeric"},{"accessor":"PC20","name":"PC20","type":"numeric"},{"accessor":"PC21","name":"PC21","type":"numeric"},{"accessor":"PC22","name":"PC22","type":"numeric"},{"accessor":"PC23","name":"PC23","type":"numeric"},{"accessor":"PC24","name":"PC24","type":"numeric"},{"accessor":"PC25","name":"PC25","type":"numeric"},{"accessor":"PC26","name":"PC26","type":"numeric"},{"accessor":"PC27","name":"PC27","type":"numeric"},{"accessor":"PC28","name":"PC28","type":"numeric"},{"accessor":"PC29","name":"PC29","type":"numeric"},{"accessor":"PC30","name":"PC30","type":"numeric"},{"accessor":"PC31","name":"PC31","type":"numeric"},{"accessor":"PC32","name":"PC32","type":"numeric"},{"accessor":"PC33","name":"PC33","type":"numeric"},{"accessor":"PC34","name":"PC34","type":"numeric"},{"accessor":"PC35","name":"PC35","type":"numeric"},{"accessor":"PC36","name":"PC36","type":"numeric"},{"accessor":"PC37","name":"PC37","type":"numeric"},{"accessor":"PC38","name":"PC38","type":"numeric"},{"accessor":"PC39","name":"PC39","type":"numeric"},{"accessor":"PC40","name":"PC40","type":"numeric"},{"accessor":"PC41","name":"PC41","type":"numeric"},{"accessor":"PC42","name":"PC42","type":"numeric"},{"accessor":"PC43","name":"PC43","type":"numeric"},{"accessor":"PC44","name":"PC44","type":"numeric"},{"accessor":"PC45","name":"PC45","type":"numeric"},{"accessor":"PC46","name":"PC46","type":"numeric"},{"accessor":"PC47","name":"PC47","type":"numeric"},{"accessor":"PC48","name":"PC48","type":"numeric"},{"accessor":"PC49","name":"PC49","type":"numeric"},{"accessor":"PC50","name":"PC50","type":"numeric"},{"accessor":"PC51","name":"PC51","type":"numeric"},{"accessor":"PC52","name":"PC52","type":"numeric"},{"accessor":"PC53","name":"PC53","type":"numeric"},{"accessor":"PC54","name":"PC54","type":"numeric"},{"accessor":"PC55","name":"PC55","type":"numeric"},{"accessor":"PC56","name":"PC56","type":"numeric"},{"accessor":"PC57","name":"PC57","type":"numeric"},{"accessor":"PC58","name":"PC58","type":"numeric"},{"accessor":"PC59","name":"PC59","type":"numeric"},{"accessor":"PC60","name":"PC60","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"1c6a46f4904dfa386984480b3e4d2be6"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We visualise the projections of the NCI60 cancer cell lines onto the first three principal components</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">palette.colors</span>(<span class="at">n =</span> <span class="dv">14</span>, <span class="at">palette =</span> <span class="st">"Polychrome 36"</span>))</span>
<span id="cb75-2"><a href="#cb75-2"></a></span>
<span id="cb75-3"><a href="#cb75-3"></a>nci60_pca_score <span class="sc">%&gt;%</span></span>
<span id="cb75-4"><a href="#cb75-4"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"label"</span>, <span class="st">"PC01"</span>, <span class="st">"PC02"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb75-5"><a href="#cb75-5"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb75-6"><a href="#cb75-6"></a>    <span class="at">x =</span> .data[[<span class="st">"PC01"</span>]],</span>
<span id="cb75-7"><a href="#cb75-7"></a>    <span class="at">y =</span> .data[[<span class="st">"PC02"</span>]],</span>
<span id="cb75-8"><a href="#cb75-8"></a>    <span class="at">color =</span> .data[[<span class="st">"label"</span>]]</span>
<span id="cb75-9"><a href="#cb75-9"></a>  )) <span class="sc">+</span></span>
<span id="cb75-10"><a href="#cb75-10"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb75-11"><a href="#cb75-11"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb75-12"><a href="#cb75-12"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="3883"></p>
</div>
</div>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a>nci60_pca_score <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="#cb76-2"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"label"</span>, <span class="st">"PC01"</span>, <span class="st">"PC03"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="#cb76-3"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb76-4"><a href="#cb76-4"></a>    <span class="at">x =</span> .data[[<span class="st">"PC01"</span>]],</span>
<span id="cb76-5"><a href="#cb76-5"></a>    <span class="at">y =</span> .data[[<span class="st">"PC03"</span>]],</span>
<span id="cb76-6"><a href="#cb76-6"></a>    <span class="at">color =</span> .data[[<span class="st">"label"</span>]]</span>
<span id="cb76-7"><a href="#cb76-7"></a>  )) <span class="sc">+</span></span>
<span id="cb76-8"><a href="#cb76-8"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb76-9"><a href="#cb76-9"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb76-10"><a href="#cb76-10"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="3883"></p>
</div>
</div>
<p>Here is a scatter plot matrix</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a>nci60_pca_score <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="#cb77-2"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"label"</span>, <span class="st">"PC01"</span>, <span class="st">"PC02"</span>, <span class="st">"PC03"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="#cb77-3"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb77-4"><a href="#cb77-4"></a>    <span class="at">x =</span> .panel_x,</span>
<span id="cb77-5"><a href="#cb77-5"></a>    <span class="at">y =</span> .panel_y,</span>
<span id="cb77-6"><a href="#cb77-6"></a>    <span class="at">color =</span> .data[[<span class="st">"label"</span>]],</span>
<span id="cb77-7"><a href="#cb77-7"></a>    <span class="at">fill =</span> .data[[<span class="st">"label"</span>]]</span>
<span id="cb77-8"><a href="#cb77-8"></a>  )) <span class="sc">+</span></span>
<span id="cb77-9"><a href="#cb77-9"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb77-10"><a href="#cb77-10"></a>  ggforce<span class="sc">::</span><span class="fu">geom_autodensity</span>(<span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb77-11"><a href="#cb77-11"></a>  ggforce<span class="sc">::</span><span class="fu">facet_matrix</span>(<span class="at">rows =</span> ggplot2<span class="sc">::</span><span class="fu">vars</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"label"</span>)), <span class="at">layer.diag =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb77-12"><a href="#cb77-12"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb77-13"><a href="#cb77-13"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb77-14"><a href="#cb77-14"></a>  cowplot<span class="sc">::</span><span class="fu">theme_minimal_grid</span>() <span class="sc">+</span></span>
<span id="cb77-15"><a href="#cb77-15"></a>  cowplot<span class="sc">::</span><span class="fu">panel_border</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb77-16"><a href="#cb77-16"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="3883"></p>
</div>
</div>
<p>How much variation are we capturing for each component?</p>
<p>We extract the pca loadings of the pca step.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a>nci60_pca_loadings <span class="ot">&lt;-</span> nci60_pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb78-2"><a href="#cb78-2"></a>  parsnip<span class="sc">::</span><span class="fu">tidy</span>(<span class="at">id =</span> <span class="st">"pca"</span>, <span class="at">type =</span> <span class="st">"coef"</span>)</span>
<span id="cb78-3"><a href="#cb78-3"></a></span>
<span id="cb78-4"><a href="#cb78-4"></a></span>
<span id="cb78-5"><a href="#cb78-5"></a><span class="fu">head</span>(nci60_pca_loadings) <span class="sc">%&gt;%</span></span>
<span id="cb78-6"><a href="#cb78-6"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-3c99ad6a966c6975d291" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3c99ad6a966c6975d291">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"terms":["V_1","V_2","V_3","V_4","V_5","V_6"],"value":[-0.0106823695867676,-0.00231207843457899,-0.00587974962439539,0.00327807101365119,-0.00767753470997208,0.00226667120542434],"component":["PC1","PC1","PC1","PC1","PC1","PC1"],"id":["pca","pca","pca","pca","pca","pca"]},"columns":[{"accessor":"terms","name":"terms","type":"character"},{"accessor":"value","name":"value","type":"numeric"},{"accessor":"component","name":"component","type":"character"},{"accessor":"id","name":"id","type":"character"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"037844454ec313b67430c5886a1bdf0a"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Here is how we can see the variance statistics but it is in a long form</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a>nci60_pca_variance <span class="ot">&lt;-</span> nci60_pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb79-2"><a href="#cb79-2"></a>  parsnip<span class="sc">::</span><span class="fu">tidy</span>(<span class="at">id =</span> <span class="st">"pca"</span>, <span class="at">type =</span> <span class="st">"variance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here is how we can see the variance statistics in its wide form</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a>nci60_pca_variance <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="#cb80-2"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb80-3"><a href="#cb80-3"></a>    <span class="at">names_from =</span> .data[[<span class="st">"component"</span>]],</span>
<span id="cb80-4"><a href="#cb80-4"></a>    <span class="at">values_from =</span> .data[[<span class="st">"value"</span>]],</span>
<span id="cb80-5"><a href="#cb80-5"></a>    <span class="at">names_prefix =</span> <span class="st">"PC"</span></span>
<span id="cb80-6"><a href="#cb80-6"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb80-7"><a href="#cb80-7"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>dplyr<span class="sc">::</span><span class="fu">all_of</span>(<span class="st">"id"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb80-8"><a href="#cb80-8"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-84fad466141f02bfbaea" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-84fad466141f02bfbaea">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"terms":["variance","cumulative variance","percent variance","cumulative percent variance"],"PC1":[775.815728883096,775.815728883096,11.358941857732,11.358941857732],"PC2":[461.448632884252,1237.26436176735,6.75620253124821,18.1151443889802],"PC3":[392.850824580941,1630.11518634829,5.75184223398158,23.8669866229618],"PC4":[290.107970933344,1920.22315728163,4.24755447925833,28.1145411022201],"PC5":[255.098611783571,2175.3217690652,3.73497235407864,31.8495134562988],"PC6":[247.152442144941,2422.47421121014,3.61863019245887,35.4681436487576],"PC7":[209.422989741865,2631.89720095201,3.06622239739187,38.5343660461495],"PC8":[183.447180841476,2815.34438179349,2.68590308699086,41.2202691331404],"PC9":[172.764718013591,2988.10909980708,2.52949806754891,43.7497672006893],"PC10":[162.271841934729,3150.38094174181,2.37586884238257,46.1256360430719],"PC11":[160.952921741935,3311.33386348374,2.35655815141925,48.4821941944911],"PC12":[147.809530947836,3459.14339443158,2.16412197581019,50.6463161703013],"PC13":[139.953357317645,3599.09675174922,2.04909747170783,52.6954136420091],"PC14":[135.153264385237,3734.25001613446,1.97881792657741,54.6742315685865],"PC15":[130.823006374313,3865.07302250877,1.91541737004851,56.589648938635],"PC16":[121.011263982497,3986.08428649127,1.77176081965589,58.3614097582909],"PC17":[113.56443946,4099.64872595127,1.66272971390923,60.0241394722002],"PC18":[110.01483823405,4209.66356418532,1.6107589785366,61.6348984507368],"PC19":[108.89295725587,4318.55652144119,1.59433319554714,63.2292316462839],"PC20":[106.542440981009,4425.0989624222,1.55991860879955,64.7891502550835],"PC21":[102.942903377602,4528.0418657998,1.50721674052126,66.2963669956047],"PC22":[101.090755964854,4629.13262176465,1.48009891603008,67.7764659116348],"PC23":[98.0625679100158,4727.19518967467,1.43576234128867,69.2122282529235],"PC24":[93.0772621482041,4820.27245182287,1.36277104170138,70.5749992946248],"PC25":[90.3951862946018,4910.66763811747,1.32350199552858,71.8985012901534],"PC26":[87.096103187007,4997.76374130448,1.27519916818458,73.173700458338],"PC27":[85.9922292324378,5083.75597053692,1.25903703122164,74.4327374895596],"PC28":[82.6289389584157,5166.38490949534,1.20979412823449,75.6425316177941],"PC29":[80.6614672641136,5247.04637675945,1.1809878076737,76.8235194254678],"PC30":[76.5630499854874,5323.60942674494,1.12098169817697,77.9445011236448],"PC31":[73.953491351883,5397.56291809682,1.08277439753855,79.0272755211833],"PC32":[71.3581483725124,5468.92106646933,1.04477523239403,80.0720507535774],"PC33":[70.1079358667899,5539.02900233612,1.02647051049473,81.0985212640721],"PC34":[67.4991507642301,5606.52815310035,0.988274535347439,82.0867957994195],"PC35":[66.5417625576957,5673.06991565805,0.974257138472851,83.0610529378924],"PC36":[63.5951205696375,5736.66503622769,0.931114503215777,83.9921674411082],"PC37":[62.4805200624806,5799.14555629017,0.914795315702498,84.9069627568107],"PC38":[61.1722730803721,5860.31782937054,0.895640894295346,85.802603651106],"PC39":[59.6225249979663,5919.9403543685,0.872950585621761,86.6755542367278],"PC40":[57.5479237621176,5977.48827813062,0.84257575054345,87.5181299872712],"PC41":[55.5948212763819,6033.083099407,0.813979813709837,88.3321098009811],"PC42":[53.9399116670718,6087.02301107408,0.789749804788754,89.1218596057698],"PC43":[50.4737681793735,6137.49677925345,0.739000998233873,89.8608606040037],"PC44":[49.1829383295195,6186.67971758297,0.720101586083741,90.5809621900874],"PC45":[48.4191234792185,6235.09884106219,0.708918352550784,91.2898805426382],"PC46":[47.1456003848638,6282.24444144705,0.690272333599763,91.980152876238],"PC47":[46.3412256313824,6328.58566707843,0.678495250825512,92.6586481270635],"PC48":[44.1909848311011,6372.77665190953,0.647012955067366,93.3056610821308],"PC49":[43.7723619400277,6416.54901384956,0.640883776574344,93.9465448587052],"PC50":[41.0615168266991,6457.61053067626,0.601193511371876,94.5477383700771],"PC51":[38.6863908296451,6496.29692150591,0.566418606583384,95.1141569766605],"PC52":[38.4804104413751,6534.77733194728,0.563402788307103,95.6775597649676],"PC53":[36.8092753275115,6571.58660727479,0.538935217093873,96.2164949820614],"PC54":[35.0233066225295,6606.60991389732,0.512786334151237,96.7292813162127],"PC55":[34.9556790924001,6641.56559298972,0.511796179976575,97.2410774961892],"PC56":[32.8946545575704,6674.46024754729,0.481620125293856,97.7226976214831],"PC57":[29.9494643220917,6704.40971186938,0.438498745565032,98.1611963670481],"PC58":[28.0068287163904,6732.41654058577,0.410056057341002,98.5712524243891],"PC59":[25.212192393478,6757.62873297925,0.369138980870835,98.94039140526],"PC60":[21.9396619055426,6779.5683948848,0.321224918089935,99.2616163233499],"PC61":[17.4362472463325,6797.00464213113,0.255289125129319,99.5169054484792],"PC62":[16.6637127693848,6813.66835490051,0.243978225027596,99.7608836735068],"PC63":[16.3316450994844,6830,0.239116326493184,100],"PC64":[4.36276831669746e-28,6830,6.38765492927886e-30,100]},"columns":[{"accessor":"terms","name":"terms","type":"character"},{"accessor":"PC1","name":"PC1","type":"numeric"},{"accessor":"PC2","name":"PC2","type":"numeric"},{"accessor":"PC3","name":"PC3","type":"numeric"},{"accessor":"PC4","name":"PC4","type":"numeric"},{"accessor":"PC5","name":"PC5","type":"numeric"},{"accessor":"PC6","name":"PC6","type":"numeric"},{"accessor":"PC7","name":"PC7","type":"numeric"},{"accessor":"PC8","name":"PC8","type":"numeric"},{"accessor":"PC9","name":"PC9","type":"numeric"},{"accessor":"PC10","name":"PC10","type":"numeric"},{"accessor":"PC11","name":"PC11","type":"numeric"},{"accessor":"PC12","name":"PC12","type":"numeric"},{"accessor":"PC13","name":"PC13","type":"numeric"},{"accessor":"PC14","name":"PC14","type":"numeric"},{"accessor":"PC15","name":"PC15","type":"numeric"},{"accessor":"PC16","name":"PC16","type":"numeric"},{"accessor":"PC17","name":"PC17","type":"numeric"},{"accessor":"PC18","name":"PC18","type":"numeric"},{"accessor":"PC19","name":"PC19","type":"numeric"},{"accessor":"PC20","name":"PC20","type":"numeric"},{"accessor":"PC21","name":"PC21","type":"numeric"},{"accessor":"PC22","name":"PC22","type":"numeric"},{"accessor":"PC23","name":"PC23","type":"numeric"},{"accessor":"PC24","name":"PC24","type":"numeric"},{"accessor":"PC25","name":"PC25","type":"numeric"},{"accessor":"PC26","name":"PC26","type":"numeric"},{"accessor":"PC27","name":"PC27","type":"numeric"},{"accessor":"PC28","name":"PC28","type":"numeric"},{"accessor":"PC29","name":"PC29","type":"numeric"},{"accessor":"PC30","name":"PC30","type":"numeric"},{"accessor":"PC31","name":"PC31","type":"numeric"},{"accessor":"PC32","name":"PC32","type":"numeric"},{"accessor":"PC33","name":"PC33","type":"numeric"},{"accessor":"PC34","name":"PC34","type":"numeric"},{"accessor":"PC35","name":"PC35","type":"numeric"},{"accessor":"PC36","name":"PC36","type":"numeric"},{"accessor":"PC37","name":"PC37","type":"numeric"},{"accessor":"PC38","name":"PC38","type":"numeric"},{"accessor":"PC39","name":"PC39","type":"numeric"},{"accessor":"PC40","name":"PC40","type":"numeric"},{"accessor":"PC41","name":"PC41","type":"numeric"},{"accessor":"PC42","name":"PC42","type":"numeric"},{"accessor":"PC43","name":"PC43","type":"numeric"},{"accessor":"PC44","name":"PC44","type":"numeric"},{"accessor":"PC45","name":"PC45","type":"numeric"},{"accessor":"PC46","name":"PC46","type":"numeric"},{"accessor":"PC47","name":"PC47","type":"numeric"},{"accessor":"PC48","name":"PC48","type":"numeric"},{"accessor":"PC49","name":"PC49","type":"numeric"},{"accessor":"PC50","name":"PC50","type":"numeric"},{"accessor":"PC51","name":"PC51","type":"numeric"},{"accessor":"PC52","name":"PC52","type":"numeric"},{"accessor":"PC53","name":"PC53","type":"numeric"},{"accessor":"PC54","name":"PC54","type":"numeric"},{"accessor":"PC55","name":"PC55","type":"numeric"},{"accessor":"PC56","name":"PC56","type":"numeric"},{"accessor":"PC57","name":"PC57","type":"numeric"},{"accessor":"PC58","name":"PC58","type":"numeric"},{"accessor":"PC59","name":"PC59","type":"numeric"},{"accessor":"PC60","name":"PC60","type":"numeric"},{"accessor":"PC61","name":"PC61","type":"numeric"},{"accessor":"PC62","name":"PC62","type":"numeric"},{"accessor":"PC63","name":"PC63","type":"numeric"},{"accessor":"PC64","name":"PC64","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"f0f215c1a63a79c3f530e67cda6c8ab8"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Here is a simple plot to show the variance captured for each component.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a><span class="co"># Get the variance</span></span>
<span id="cb81-2"><a href="#cb81-2"></a>percent_variation <span class="ot">&lt;-</span> nci60_pca_variance <span class="sc">%&gt;%</span></span>
<span id="cb81-3"><a href="#cb81-3"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(.data[[<span class="st">"terms"</span>]] <span class="sc">==</span> <span class="st">"percent variance"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-4"><a href="#cb81-4"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(.data[[<span class="st">"value"</span>]])</span>
<span id="cb81-5"><a href="#cb81-5"></a></span>
<span id="cb81-6"><a href="#cb81-6"></a>percent_variation <span class="ot">&lt;-</span> percent_variation <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb81-7"><a href="#cb81-7"></a>component <span class="ot">&lt;-</span> <span class="fu">unique</span>(nci60_pca_loadings<span class="sc">$</span>component) <span class="sc">%&gt;%</span></span>
<span id="cb81-8"><a href="#cb81-8"></a>  stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="at">pattern =</span> <span class="st">"PC"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-9"><a href="#cb81-9"></a>  <span class="fu">as.integer</span>()</span>
<span id="cb81-10"><a href="#cb81-10"></a></span>
<span id="cb81-11"><a href="#cb81-11"></a><span class="co"># I use [1:4] to select the first four components</span></span>
<span id="cb81-12"><a href="#cb81-12"></a>dplyr<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb81-13"><a href="#cb81-13"></a>  <span class="at">component =</span> component,</span>
<span id="cb81-14"><a href="#cb81-14"></a>  <span class="at">percent_var =</span> percent_variation</span>
<span id="cb81-15"><a href="#cb81-15"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb81-16"><a href="#cb81-16"></a>  <span class="co"># dplyr::mutate(component = forcats::fct_inorder(.data[["component"]])) %&gt;%</span></span>
<span id="cb81-17"><a href="#cb81-17"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb81-18"><a href="#cb81-18"></a>    <span class="at">x =</span> .data[[<span class="st">"component"</span>]],</span>
<span id="cb81-19"><a href="#cb81-19"></a>    <span class="at">y =</span> .data[[<span class="st">"percent_var"</span>]]</span>
<span id="cb81-20"><a href="#cb81-20"></a>  )) <span class="sc">+</span></span>
<span id="cb81-21"><a href="#cb81-21"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb81-22"><a href="#cb81-22"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb81-23"><a href="#cb81-23"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb81-24"><a href="#cb81-24"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.title.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb81-25"><a href="#cb81-25"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb81-26"><a href="#cb81-26"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb81-27"><a href="#cb81-27"></a>    <span class="at">y =</span> <span class="st">"Percent variance </span><span class="sc">\n</span><span class="st">explained by each </span><span class="sc">\n</span><span class="st">PCA component"</span></span>
<span id="cb81-28"><a href="#cb81-28"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid" width="3883"></p>
</div>
</div>
<p>We see that together, the first seven principal components explain around 40% of the variance in the data.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="co"># Get the variance</span></span>
<span id="cb82-2"><a href="#cb82-2"></a>cumulative_percent_variation <span class="ot">&lt;-</span> nci60_pca_variance <span class="sc">%&gt;%</span></span>
<span id="cb82-3"><a href="#cb82-3"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(.data[[<span class="st">"terms"</span>]] <span class="sc">==</span> <span class="st">"cumulative percent variance"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-4"><a href="#cb82-4"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(.data[[<span class="st">"value"</span>]])</span>
<span id="cb82-5"><a href="#cb82-5"></a></span>
<span id="cb82-6"><a href="#cb82-6"></a>cumulative_percent_variation <span class="ot">&lt;-</span> cumulative_percent_variation <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb82-7"><a href="#cb82-7"></a>component <span class="ot">&lt;-</span> <span class="fu">unique</span>(nci60_pca_loadings<span class="sc">$</span>component) <span class="sc">%&gt;%</span></span>
<span id="cb82-8"><a href="#cb82-8"></a>  stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="at">pattern =</span> <span class="st">"PC"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-9"><a href="#cb82-9"></a>  <span class="fu">as.integer</span>()</span>
<span id="cb82-10"><a href="#cb82-10"></a></span>
<span id="cb82-11"><a href="#cb82-11"></a><span class="co"># I use [1:4] to select the first four components</span></span>
<span id="cb82-12"><a href="#cb82-12"></a>dplyr<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb82-13"><a href="#cb82-13"></a>  <span class="at">component =</span> component,</span>
<span id="cb82-14"><a href="#cb82-14"></a>  <span class="at">cumulative_percent_var =</span> cumulative_percent_variation</span>
<span id="cb82-15"><a href="#cb82-15"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb82-16"><a href="#cb82-16"></a>  <span class="co"># dplyr::mutate(component = forcats::fct_inorder(.data[["component"]])) %&gt;%</span></span>
<span id="cb82-17"><a href="#cb82-17"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb82-18"><a href="#cb82-18"></a>    <span class="at">x =</span> .data[[<span class="st">"component"</span>]],</span>
<span id="cb82-19"><a href="#cb82-19"></a>    <span class="at">y =</span> .data[[<span class="st">"cumulative_percent_var"</span>]]</span>
<span id="cb82-20"><a href="#cb82-20"></a>  )) <span class="sc">+</span></span>
<span id="cb82-21"><a href="#cb82-21"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb82-22"><a href="#cb82-22"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb82-23"><a href="#cb82-23"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb82-24"><a href="#cb82-24"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.title.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb82-25"><a href="#cb82-25"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb82-26"><a href="#cb82-26"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb82-27"><a href="#cb82-27"></a>    <span class="at">y =</span> <span class="st">"Cumulative percent </span><span class="sc">\n</span><span class="st">variance explained </span><span class="sc">\n</span><span class="st">by each PCA </span><span class="sc">\n</span><span class="st">component"</span></span>
<span id="cb82-28"><a href="#cb82-28"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="3883"></p>
</div>
</div>
</section><section id="clustering-on-nci60-dataset-base-r" class="level2"><h2 class="anchored" data-anchor-id="clustering-on-nci60-dataset-base-r">Clustering on NCI60 dataset (Base R)</h2>
<p>We now proceed to hierarchically cluster the cell lines in the NCI60 data, with the goal of finding out whether or not the observations cluster into distinct types of cancer.</p>
<p>We first preprocess the data suited for hierarchical clustering</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a>nci60_scaled <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(<span class="at">formula =</span> label <span class="sc">~</span> ., <span class="at">data =</span> nci60) <span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="#cb83-2"></a>  recipes<span class="sc">::</span><span class="fu">step_normalize</span>(recipes<span class="sc">::</span><span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb83-3"><a href="#cb83-3"></a>  recipes<span class="sc">::</span><span class="fu">prep</span>() <span class="sc">%&gt;%</span></span>
<span id="cb83-4"><a href="#cb83-4"></a>  recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We choose the preferred number of clusters to extract.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a>nci60_num_cluster <span class="ot">&lt;-</span> nci60_scaled <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="#cb84-2"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"label"</span>))</span>
<span id="cb84-3"><a href="#cb84-3"></a></span>
<span id="cb84-4"><a href="#cb84-4"></a><span class="co"># Plot cluster results</span></span>
<span id="cb84-5"><a href="#cb84-5"></a>p1 <span class="ot">&lt;-</span> factoextra<span class="sc">::</span><span class="fu">fviz_nbclust</span>(</span>
<span id="cb84-6"><a href="#cb84-6"></a>  <span class="at">x =</span> nci60_num_cluster,</span>
<span id="cb84-7"><a href="#cb84-7"></a>  <span class="at">FUN =</span> factoextra<span class="sc">::</span>hcut,</span>
<span id="cb84-8"><a href="#cb84-8"></a>  <span class="at">method =</span> <span class="st">"wss"</span>,</span>
<span id="cb84-9"><a href="#cb84-9"></a>  <span class="at">hc_metric =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb84-10"><a href="#cb84-10"></a>  <span class="at">k.max =</span> <span class="dv">10</span></span>
<span id="cb84-11"><a href="#cb84-11"></a>) <span class="sc">+</span></span>
<span id="cb84-12"><a href="#cb84-12"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="at">label =</span> <span class="st">"(A) Elbow method"</span>)</span>
<span id="cb84-13"><a href="#cb84-13"></a></span>
<span id="cb84-14"><a href="#cb84-14"></a>p2 <span class="ot">&lt;-</span> factoextra<span class="sc">::</span><span class="fu">fviz_nbclust</span>(</span>
<span id="cb84-15"><a href="#cb84-15"></a>  <span class="at">x =</span> nci60_num_cluster,</span>
<span id="cb84-16"><a href="#cb84-16"></a>  <span class="at">FUN =</span> factoextra<span class="sc">::</span>hcut,</span>
<span id="cb84-17"><a href="#cb84-17"></a>  <span class="at">method =</span> <span class="st">"silhouette"</span>,</span>
<span id="cb84-18"><a href="#cb84-18"></a>  <span class="at">hc_metric =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb84-19"><a href="#cb84-19"></a>  <span class="at">k.max =</span> <span class="dv">10</span></span>
<span id="cb84-20"><a href="#cb84-20"></a>) <span class="sc">+</span></span>
<span id="cb84-21"><a href="#cb84-21"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">"(B) Silhouette method"</span>)</span>
<span id="cb84-22"><a href="#cb84-22"></a></span>
<span id="cb84-23"><a href="#cb84-23"></a>p3 <span class="ot">&lt;-</span> factoextra<span class="sc">::</span><span class="fu">fviz_nbclust</span>(</span>
<span id="cb84-24"><a href="#cb84-24"></a>  <span class="at">x =</span> nci60_num_cluster,</span>
<span id="cb84-25"><a href="#cb84-25"></a>  <span class="at">FUN =</span> factoextra<span class="sc">::</span>hcut,</span>
<span id="cb84-26"><a href="#cb84-26"></a>  <span class="at">method =</span> <span class="st">"gap_stat"</span>,</span>
<span id="cb84-27"><a href="#cb84-27"></a>  <span class="at">hc_metric =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb84-28"><a href="#cb84-28"></a>  <span class="at">k.max =</span> <span class="dv">10</span></span>
<span id="cb84-29"><a href="#cb84-29"></a>) <span class="sc">+</span></span>
<span id="cb84-30"><a href="#cb84-30"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">"(C) Gap statistic"</span>)</span>
<span id="cb84-31"><a href="#cb84-31"></a></span>
<span id="cb84-32"><a href="#cb84-32"></a><span class="co"># Display plots side by side</span></span>
<span id="cb84-33"><a href="#cb84-33"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="3883"></p>
</div>
</div>
<p>We now perform hierarchical clustering of the observations using complete, single, and average linkage. Euclidean distance is used as the dissimilarity measure.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a>nci60_complete <span class="ot">&lt;-</span> nci60_num_cluster <span class="sc">%&gt;%</span></span>
<span id="cb85-2"><a href="#cb85-2"></a>  stats<span class="sc">::</span><span class="fu">dist</span>(<span class="at">method =</span> <span class="st">"euclidean"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb85-3"><a href="#cb85-3"></a>  stats<span class="sc">::</span><span class="fu">hclust</span>(<span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb85-4"><a href="#cb85-4"></a></span>
<span id="cb85-5"><a href="#cb85-5"></a>nci60_average <span class="ot">&lt;-</span> nci60_num_cluster <span class="sc">%&gt;%</span></span>
<span id="cb85-6"><a href="#cb85-6"></a>  stats<span class="sc">::</span><span class="fu">dist</span>(<span class="at">method =</span> <span class="st">"euclidean"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb85-7"><a href="#cb85-7"></a>  stats<span class="sc">::</span><span class="fu">hclust</span>(<span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb85-8"><a href="#cb85-8"></a></span>
<span id="cb85-9"><a href="#cb85-9"></a>nci60_single <span class="ot">&lt;-</span> nci60_num_cluster <span class="sc">%&gt;%</span></span>
<span id="cb85-10"><a href="#cb85-10"></a>  stats<span class="sc">::</span><span class="fu">dist</span>(<span class="at">method =</span> <span class="st">"euclidean"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb85-11"><a href="#cb85-11"></a>  stats<span class="sc">::</span><span class="fu">hclust</span>(<span class="at">method =</span> <span class="st">"single"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We then visualize them to see if any of them have some good natural separations.</p>
<p>Typically, single linkage will tend to yield trailing clusters: very large clusters onto which individual observations.</p>
<p>Complete and average linkage tend to yield more balanced, attractive clusters. For this reason, complete and average linkage are generally preferred to single linkage.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true" href="">Complete</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false" href="">Average</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false" href="">Single</a></li>
</ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a>nci60_complete<span class="sc">$</span>labels <span class="ot">&lt;-</span> nci60_scaled<span class="sc">$</span>label</span>
<span id="cb86-2"><a href="#cb86-2"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(nci60_complete, <span class="at">main =</span> <span class="st">"complete"</span>, <span class="at">k =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="3883"></p>
</div>
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a>stats<span class="sc">::</span><span class="fu">cutree</span>(<span class="at">tree =</span> nci60_complete, <span class="at">k =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;         CNS         CNS         CNS       RENAL      BREAST         CNS 
&gt;           1           1           1           1           2           2 
&gt;         CNS      BREAST       NSCLC       NSCLC       RENAL       RENAL 
&gt;           2           2           1           1           1           1 
&gt;       RENAL       RENAL       RENAL       RENAL       RENAL      BREAST 
&gt;           1           1           1           1           1           2 
&gt;       NSCLC       RENAL     UNKNOWN     OVARIAN    MELANOMA    PROSTATE 
&gt;           2           2           1           1           1           1 
&gt;     OVARIAN     OVARIAN     OVARIAN     OVARIAN     OVARIAN    PROSTATE 
&gt;           1           1           1           1           1           1 
&gt;       NSCLC       NSCLC       NSCLC    LEUKEMIA K562B-repro K562A-repro 
&gt;           1           1           1           3           3           3 
&gt;    LEUKEMIA    LEUKEMIA    LEUKEMIA    LEUKEMIA    LEUKEMIA       COLON 
&gt;           3           3           3           3           3           1 
&gt;       COLON       COLON       COLON       COLON       COLON       COLON 
&gt;           4           1           4           4           4           4 
&gt; MCF7A-repro      BREAST MCF7D-repro      BREAST       NSCLC       NSCLC 
&gt;           4           4           4           4           1           1 
&gt;       NSCLC    MELANOMA      BREAST      BREAST    MELANOMA    MELANOMA 
&gt;           1           1           1           1           1           1 
&gt;    MELANOMA    MELANOMA    MELANOMA    MELANOMA 
&gt;           1           1           1           1</code></pre>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a>nci60_average<span class="sc">$</span>labels <span class="ot">&lt;-</span> nci60_scaled<span class="sc">$</span>label</span>
<span id="cb89-2"><a href="#cb89-2"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(nci60_average, <span class="at">main =</span> <span class="st">"average"</span>, <span class="at">k =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid" width="3883"></p>
</div>
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a>stats<span class="sc">::</span><span class="fu">cutree</span>(<span class="at">tree =</span> nci60_average, <span class="at">k =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;         CNS         CNS         CNS       RENAL      BREAST         CNS 
&gt;           1           1           1           1           1           1 
&gt;         CNS      BREAST       NSCLC       NSCLC       RENAL       RENAL 
&gt;           1           1           1           1           1           1 
&gt;       RENAL       RENAL       RENAL       RENAL       RENAL      BREAST 
&gt;           1           1           1           1           1           1 
&gt;       NSCLC       RENAL     UNKNOWN     OVARIAN    MELANOMA    PROSTATE 
&gt;           1           2           1           1           1           1 
&gt;     OVARIAN     OVARIAN     OVARIAN     OVARIAN     OVARIAN    PROSTATE 
&gt;           1           1           1           1           1           1 
&gt;       NSCLC       NSCLC       NSCLC    LEUKEMIA K562B-repro K562A-repro 
&gt;           1           1           1           3           3           3 
&gt;    LEUKEMIA    LEUKEMIA    LEUKEMIA    LEUKEMIA    LEUKEMIA       COLON 
&gt;           3           3           3           3           3           1 
&gt;       COLON       COLON       COLON       COLON       COLON       COLON 
&gt;           1           1           1           1           1           1 
&gt; MCF7A-repro      BREAST MCF7D-repro      BREAST       NSCLC       NSCLC 
&gt;           1           1           1           1           1           1 
&gt;       NSCLC    MELANOMA      BREAST      BREAST    MELANOMA    MELANOMA 
&gt;           4           1           1           1           1           1 
&gt;    MELANOMA    MELANOMA    MELANOMA    MELANOMA 
&gt;           1           1           1           1</code></pre>
</div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a>nci60_single<span class="sc">$</span>labels <span class="ot">&lt;-</span> nci60_scaled<span class="sc">$</span>label</span>
<span id="cb92-2"><a href="#cb92-2"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(nci60_single, <span class="at">main =</span> <span class="st">"single"</span>, <span class="at">k =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid" width="3883"></p>
</div>
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a>stats<span class="sc">::</span><span class="fu">cutree</span>(<span class="at">tree =</span> nci60_single, <span class="at">k =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;         CNS         CNS         CNS       RENAL      BREAST         CNS 
&gt;           1           1           1           1           1           1 
&gt;         CNS      BREAST       NSCLC       NSCLC       RENAL       RENAL 
&gt;           1           1           1           1           1           1 
&gt;       RENAL       RENAL       RENAL       RENAL       RENAL      BREAST 
&gt;           1           1           1           1           1           2 
&gt;       NSCLC       RENAL     UNKNOWN     OVARIAN    MELANOMA    PROSTATE 
&gt;           1           3           1           1           1           1 
&gt;     OVARIAN     OVARIAN     OVARIAN     OVARIAN     OVARIAN    PROSTATE 
&gt;           1           1           1           1           1           1 
&gt;       NSCLC       NSCLC       NSCLC    LEUKEMIA K562B-repro K562A-repro 
&gt;           1           1           1           1           1           1 
&gt;    LEUKEMIA    LEUKEMIA    LEUKEMIA    LEUKEMIA    LEUKEMIA       COLON 
&gt;           1           1           1           1           4           1 
&gt;       COLON       COLON       COLON       COLON       COLON       COLON 
&gt;           1           1           1           1           1           1 
&gt; MCF7A-repro      BREAST MCF7D-repro      BREAST       NSCLC       NSCLC 
&gt;           1           1           1           1           1           1 
&gt;       NSCLC    MELANOMA      BREAST      BREAST    MELANOMA    MELANOMA 
&gt;           1           1           1           1           1           1 
&gt;    MELANOMA    MELANOMA    MELANOMA    MELANOMA 
&gt;           1           1           1           1</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>We will use complete linkage hierarchical clustering for the analysis that follows. We calculate which Label is the most common within each cluster.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a>tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb95-2"><a href="#cb95-2"></a>  <span class="at">label =</span> nci60<span class="sc">$</span>label,</span>
<span id="cb95-3"><a href="#cb95-3"></a>  <span class="at">cluster_id =</span> stats<span class="sc">::</span><span class="fu">cutree</span>(nci60_complete, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb95-4"><a href="#cb95-4"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb95-5"><a href="#cb95-5"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(.data[[<span class="st">"label"</span>]], .data[[<span class="st">"cluster_id"</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb95-6"><a href="#cb95-6"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(.data[[<span class="st">"cluster_id"</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb95-7"><a href="#cb95-7"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb95-8"><a href="#cb95-8"></a>    <span class="at">total =</span> <span class="fu">sum</span>(.data[[<span class="st">"n"</span>]]),</span>
<span id="cb95-9"><a href="#cb95-9"></a>    <span class="at">prop =</span> .data[[<span class="st">"n"</span>]] <span class="sc">/</span> <span class="fu">sum</span>(.data[[<span class="st">"n"</span>]])</span>
<span id="cb95-10"><a href="#cb95-10"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb95-11"><a href="#cb95-11"></a>  dplyr<span class="sc">::</span><span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">order_by =</span> .data[[<span class="st">"prop"</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb95-12"><a href="#cb95-12"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-13"><a href="#cb95-13"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-3fc496195b722eaad4ef" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3fc496195b722eaad4ef">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"label":["MELANOMA","NSCLC","RENAL","BREAST","LEUKEMIA","COLON"],"cluster_id":[1,1,1,2,3,4],"n":[8,8,8,3,6,5],"total":[40,40,40,7,8,9],"prop":[0.2,0.2,0.2,0.428571428571429,0.75,0.555555555555556]},"columns":[{"accessor":"label","name":"label","type":"factor"},{"accessor":"cluster_id","name":"cluster_id","type":"numeric"},{"accessor":"n","name":"n","type":"numeric"},{"accessor":"total","name":"total","type":"numeric"},{"accessor":"prop","name":"prop","type":"numeric"}],"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"96d54f5893440b1769a146eed1f4435a"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>How do these NCI60 hierarchical clustering results compare to what we get if we perform K-means clustering with K = 4?</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1"></a>nci60_kmeans_results <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(nci60_num_cluster, <span class="at">centers =</span> <span class="dv">4</span>, <span class="at">nstart =</span> <span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a>nci60_kmeans_results <span class="sc">%&gt;%</span></span>
<span id="cb97-2"><a href="#cb97-2"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb97-3"><a href="#cb97-3"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(cluster, size, withinss) <span class="sc">%&gt;%</span></span>
<span id="cb97-4"><a href="#cb97-4"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-51b0d3e6b9d3d3bf77c4" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-51b0d3e6b9d3d3bf77c4">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"cluster":["1","2","3","4"],"size":[8,9,27,20],"withinss":[44070.8333699462,37149.6012719003,154545.001108182,108801.43547288]},"columns":[{"accessor":"cluster","name":"cluster","type":"factor"},{"accessor":"size","name":"size","type":"numeric"},{"accessor":"withinss","name":"withinss","type":"numeric"}],"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"86870b9aede7915558542bbeb70b6c57"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We see that the four clusters obtained using hierarchical clustering and Kmeans clustering are somewhat different.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a>cluster_kmeans <span class="ot">&lt;-</span> nci60_kmeans_results<span class="sc">$</span>cluster</span>
<span id="cb98-2"><a href="#cb98-2"></a>cluster_hclust <span class="ot">&lt;-</span> <span class="fu">cutree</span>(nci60_complete, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb98-3"><a href="#cb98-3"></a></span>
<span id="cb98-4"><a href="#cb98-4"></a><span class="fu">table</span>(cluster_hclust, cluster_kmeans)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;               cluster_kmeans
&gt; cluster_hclust  1  2  3  4
&gt;              1  0  9 20 11
&gt;              2  0  0  7  0
&gt;              3  8  0  0  0
&gt;              4  0  0  0  9</code></pre>
</div>
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1"></a><span class="fu">tibble</span>(</span>
<span id="cb100-2"><a href="#cb100-2"></a>  <span class="at">kmeans =</span> <span class="fu">factor</span>(cluster_kmeans),</span>
<span id="cb100-3"><a href="#cb100-3"></a>  <span class="at">hclust =</span> <span class="fu">factor</span>(cluster_hclust)</span>
<span id="cb100-4"><a href="#cb100-4"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb100-5"><a href="#cb100-5"></a>  yardstick<span class="sc">::</span><span class="fu">conf_mat</span>(</span>
<span id="cb100-6"><a href="#cb100-6"></a>    <span class="at">truth =</span> kmeans,</span>
<span id="cb100-7"><a href="#cb100-7"></a>    <span class="at">estimate =</span> hclust,</span>
<span id="cb100-8"><a href="#cb100-8"></a>    <span class="at">dnn =</span> <span class="fu">c</span>(<span class="st">"Hierarchical clustering"</span>, <span class="st">"K-means"</span>)</span>
<span id="cb100-9"><a href="#cb100-9"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb100-10"><a href="#cb100-10"></a>  parsnip<span class="sc">::</span><span class="fu">autoplot</span>(<span class="at">type =</span> <span class="st">"heatmap"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid" width="3883"></p>
</div>
</div>
<p>Cluster 2 in K-means clustering is identical to cluster 4 in hierarchical clustering. However, the other clusters defer. For the twenty seven samples in K-means Cluster 3, twenty goes to hierarchical clustering Cluster 1 and seven goes to hierarchical clustering Cluster 2.</p>
<p>Rather than performing hierarchical clustering on the entire data matrix, we can also perform hierarchical clustering on the first few principal component score vectors, as follows:</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a><span class="co"># nci60_scaled &lt;- recipes::recipe(formula = label ~ ., data = nci60) %&gt;%</span></span>
<span id="cb101-2"><a href="#cb101-2"></a><span class="co">#   recipes::step_normalize(recipes::all_numeric_predictors()) %&gt;%</span></span>
<span id="cb101-3"><a href="#cb101-3"></a><span class="co">#   recipes::prep() %&gt;%</span></span>
<span id="cb101-4"><a href="#cb101-4"></a><span class="co">#   recipes::bake(new_data = NULL)</span></span>
<span id="cb101-5"><a href="#cb101-5"></a></span>
<span id="cb101-6"><a href="#cb101-6"></a>nci60_pca <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(<span class="sc">~</span>., nci60_scaled) <span class="sc">%&gt;%</span></span>
<span id="cb101-7"><a href="#cb101-7"></a>  <span class="fu">step_pca</span>(recipes<span class="sc">::</span><span class="fu">all_numeric_predictors</span>(), <span class="at">num_comp =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-8"><a href="#cb101-8"></a>  recipes<span class="sc">::</span><span class="fu">prep</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-9"><a href="#cb101-9"></a>  recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a>nci60_pca_complete <span class="ot">&lt;-</span> nci60_pca <span class="sc">%&gt;%</span></span>
<span id="cb102-2"><a href="#cb102-2"></a>  stats<span class="sc">::</span><span class="fu">dist</span>(<span class="at">method =</span> <span class="st">"euclidean"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-3"><a href="#cb102-3"></a>  stats<span class="sc">::</span><span class="fu">hclust</span>(<span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb102-4"><a href="#cb102-4"></a></span>
<span id="cb102-5"><a href="#cb102-5"></a>nci60_pca_complete<span class="sc">$</span>labels <span class="ot">&lt;-</span> nci60_pca<span class="sc">$</span>label</span>
<span id="cb102-6"><a href="#cb102-6"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(nci60_pca_complete, <span class="at">main =</span> <span class="st">"complete"</span>, <span class="at">k =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid" width="3883"></p>
</div>
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a>stats<span class="sc">::</span><span class="fu">cutree</span>(<span class="at">tree =</span> nci60_pca_complete, <span class="at">k =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;         CNS         CNS         CNS       RENAL      BREAST         CNS 
&gt;           1           2           1           2           2           2 
&gt;         CNS      BREAST       NSCLC       NSCLC       RENAL       RENAL 
&gt;           2           2           2           1           1           1 
&gt;       RENAL       RENAL       RENAL       RENAL       RENAL      BREAST 
&gt;           1           1           1           1           1           2 
&gt;       NSCLC       RENAL     UNKNOWN     OVARIAN    MELANOMA    PROSTATE 
&gt;           1           2           2           2           1           1 
&gt;     OVARIAN     OVARIAN     OVARIAN     OVARIAN     OVARIAN    PROSTATE 
&gt;           1           1           1           1           1           1 
&gt;       NSCLC       NSCLC       NSCLC    LEUKEMIA K562B-repro K562A-repro 
&gt;           1           1           1           1           3           3 
&gt;    LEUKEMIA    LEUKEMIA    LEUKEMIA    LEUKEMIA    LEUKEMIA       COLON 
&gt;           3           3           3           3           1           1 
&gt;       COLON       COLON       COLON       COLON       COLON       COLON 
&gt;           1           1           1           1           1           1 
&gt; MCF7A-repro      BREAST MCF7D-repro      BREAST       NSCLC       NSCLC 
&gt;           4           4           4           4           1           1 
&gt;       NSCLC    MELANOMA      BREAST      BREAST    MELANOMA    MELANOMA 
&gt;           1           2           2           2           2           2 
&gt;    MELANOMA    MELANOMA    MELANOMA    MELANOMA 
&gt;           2           2           2           2</code></pre>
</div>
</div>
</section><section id="clustering-on-nci60-dataset-tidyclust" class="level2"><h2 class="anchored" data-anchor-id="clustering-on-nci60-dataset-tidyclust">Clustering on NCI60 dataset (tidyclust)</h2>
<p>Recall that we scale the data before clustering and remove the labels.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a>nci60_scaled <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(<span class="at">formula =</span> label <span class="sc">~</span> ., <span class="at">data =</span> nci60) <span class="sc">%&gt;%</span></span>
<span id="cb105-2"><a href="#cb105-2"></a>  recipes<span class="sc">::</span><span class="fu">step_normalize</span>(recipes<span class="sc">::</span><span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb105-3"><a href="#cb105-3"></a>  recipes<span class="sc">::</span><span class="fu">prep</span>() <span class="sc">%&gt;%</span></span>
<span id="cb105-4"><a href="#cb105-4"></a>  recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data =</span> <span class="cn">NULL</span>)</span>
<span id="cb105-5"><a href="#cb105-5"></a></span>
<span id="cb105-6"><a href="#cb105-6"></a>nci60_num_cluster <span class="ot">&lt;-</span> nci60_scaled <span class="sc">%&gt;%</span></span>
<span id="cb105-7"><a href="#cb105-7"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"label"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here is how we can create the clustering elbow plot using <code>tidyclust</code></p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a>kmeans_spec <span class="ot">&lt;-</span> tidyclust<span class="sc">::</span><span class="fu">k_means</span>(</span>
<span id="cb106-2"><a href="#cb106-2"></a>  <span class="at">num_clusters =</span> tune<span class="sc">::</span><span class="fu">tune</span>()</span>
<span id="cb106-3"><a href="#cb106-3"></a>)</span>
<span id="cb106-4"><a href="#cb106-4"></a></span>
<span id="cb106-5"><a href="#cb106-5"></a>nci60_cv <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">vfold_cv</span>(nci60_num_cluster, <span class="at">v =</span> <span class="dv">5</span>)</span>
<span id="cb106-6"><a href="#cb106-6"></a></span>
<span id="cb106-7"><a href="#cb106-7"></a>nci60_rec <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(<span class="at">formula =</span> <span class="sc">~</span>., <span class="at">data =</span> nci60_num_cluster)</span>
<span id="cb106-8"><a href="#cb106-8"></a></span>
<span id="cb106-9"><a href="#cb106-9"></a>kmeans_wflow <span class="ot">&lt;-</span> workflows<span class="sc">::</span><span class="fu">workflow</span>(nci60_rec, kmeans_spec)</span>
<span id="cb106-10"><a href="#cb106-10"></a></span>
<span id="cb106-11"><a href="#cb106-11"></a>clust_num_grid <span class="ot">&lt;-</span> dials<span class="sc">::</span><span class="fu">grid_regular</span>(</span>
<span id="cb106-12"><a href="#cb106-12"></a>  tidyclust<span class="sc">::</span><span class="fu">num_clusters</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">15</span>)),</span>
<span id="cb106-13"><a href="#cb106-13"></a>  <span class="at">levels =</span> <span class="dv">15</span></span>
<span id="cb106-14"><a href="#cb106-14"></a>)</span>
<span id="cb106-15"><a href="#cb106-15"></a></span>
<span id="cb106-16"><a href="#cb106-16"></a>clust_num_grid <span class="sc">%&gt;%</span></span>
<span id="cb106-17"><a href="#cb106-17"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-84f1fbeddef845e260c1" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-84f1fbeddef845e260c1">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"num_clusters":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]},"columns":[{"accessor":"num_clusters","name":"num_clusters","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"3d0d9f8b034760b492055953a8c00a57"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a>res <span class="ot">&lt;-</span> tidyclust<span class="sc">::</span><span class="fu">tune_cluster</span>(</span>
<span id="cb107-2"><a href="#cb107-2"></a>  kmeans_wflow,</span>
<span id="cb107-3"><a href="#cb107-3"></a>  <span class="at">resamples =</span> nci60_cv,</span>
<span id="cb107-4"><a href="#cb107-4"></a>  <span class="at">grid =</span> clust_num_grid,</span>
<span id="cb107-5"><a href="#cb107-5"></a>  <span class="at">control =</span> tune<span class="sc">::</span><span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>, <span class="at">extract =</span> identity),</span>
<span id="cb107-6"><a href="#cb107-6"></a>  <span class="at">metrics =</span> tidyclust<span class="sc">::</span><span class="fu">cluster_metric_set</span>(tidyclust<span class="sc">::</span>sse_ratio)</span>
<span id="cb107-7"><a href="#cb107-7"></a>)</span>
<span id="cb107-8"><a href="#cb107-8"></a></span>
<span id="cb107-9"><a href="#cb107-9"></a>res_metrics <span class="ot">&lt;-</span> res <span class="sc">%&gt;%</span> tune<span class="sc">::</span><span class="fu">collect_metrics</span>()</span>
<span id="cb107-10"><a href="#cb107-10"></a></span>
<span id="cb107-11"><a href="#cb107-11"></a>res_metrics <span class="sc">%&gt;%</span></span>
<span id="cb107-12"><a href="#cb107-12"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-48fdbee86a88a902a204" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-48fdbee86a88a902a204">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"num_clusters":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],".metric":["sse_ratio","sse_ratio","sse_ratio","sse_ratio","sse_ratio","sse_ratio","sse_ratio","sse_ratio","sse_ratio","sse_ratio","sse_ratio","sse_ratio","sse_ratio","sse_ratio","sse_ratio"],".estimator":["standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard","standard"],"mean":[1,0.914863704014626,0.853663370190061,0.797065951928822,0.757657914676175,0.720363758598442,0.686728105152741,0.662112377667425,0.636011013337499,0.615615160328773,0.578673239126653,0.554170254247168,0.539302149624814,0.505788539485686,0.488780352656952],"n":[5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],"std_err":[0,0.003658670362702,0.00824939757253292,0.00516301929062526,0.0061748425653595,0.00370967471195495,0.00788931365220749,0.00483211569443746,0.0072066314554225,0.011600340201173,0.00540991493289201,0.00522252324052953,0.00684151606000248,0.00417720349942857,0.00585977673034216],".config":["Preprocessor1_Model01","Preprocessor1_Model02","Preprocessor1_Model03","Preprocessor1_Model04","Preprocessor1_Model05","Preprocessor1_Model06","Preprocessor1_Model07","Preprocessor1_Model08","Preprocessor1_Model09","Preprocessor1_Model10","Preprocessor1_Model11","Preprocessor1_Model12","Preprocessor1_Model13","Preprocessor1_Model14","Preprocessor1_Model15"]},"columns":[{"accessor":"num_clusters","name":"num_clusters","type":"numeric"},{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":"mean","name":"mean","type":"numeric"},{"accessor":"n","name":"n","type":"numeric"},{"accessor":"std_err","name":"std_err","type":"numeric"},{"accessor":".config","name":".config","type":"character"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"ec49addb429d876eb7ebf5606a840c8b"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a>res_metrics <span class="sc">%&gt;%</span></span>
<span id="cb108-2"><a href="#cb108-2"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">"sse_ratio"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb108-3"><a href="#cb108-3"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb108-4"><a href="#cb108-4"></a>    <span class="at">x =</span> .data[[<span class="st">"num_clusters"</span>]],</span>
<span id="cb108-5"><a href="#cb108-5"></a>    <span class="at">y =</span> .data[[<span class="st">"mean"</span>]]</span>
<span id="cb108-6"><a href="#cb108-6"></a>  )) <span class="sc">+</span></span>
<span id="cb108-7"><a href="#cb108-7"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb108-8"><a href="#cb108-8"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb108-9"><a href="#cb108-9"></a>  <span class="fu">ylab</span>(<span class="st">"mean WSS/TSS ratio, over 5 folds"</span>) <span class="sc">+</span></span>
<span id="cb108-10"><a href="#cb108-10"></a>  <span class="fu">xlab</span>(<span class="st">"Number of clusters"</span>) <span class="sc">+</span></span>
<span id="cb108-11"><a href="#cb108-11"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-72-3.png" class="img-fluid" width="3883"></p>
</div>
</div>
<p><a href="https://emilhvitfeldt.github.io/tidyclust/reference/hier_clust.html"><code>tidyclust::hier_clust</code></a> is used to do the hierarchical clustering. Here, we set the number of clusters to three and use the complete linkage method. It actually uses <a href="https://rdrr.io/r/stats/hclust.html"><code>stats::hclust()</code></a> and Euclidean distance under the hood.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1"></a>hc_spec <span class="ot">&lt;-</span> tidyclust<span class="sc">::</span><span class="fu">hier_clust</span>(</span>
<span id="cb109-2"><a href="#cb109-2"></a>  <span class="at">num_clusters =</span> <span class="dv">3</span>,</span>
<span id="cb109-3"><a href="#cb109-3"></a>  <span class="at">linkage_method =</span> <span class="st">"complete"</span></span>
<span id="cb109-4"><a href="#cb109-4"></a>)</span>
<span id="cb109-5"><a href="#cb109-5"></a></span>
<span id="cb109-6"><a href="#cb109-6"></a>hc_fit <span class="ot">&lt;-</span> hc_spec <span class="sc">%&gt;%</span></span>
<span id="cb109-7"><a href="#cb109-7"></a>  tidyclust<span class="sc">::</span><span class="fu">fit</span>(label <span class="sc">~</span> ., <span class="at">data =</span> nci60_scaled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We use <a href="https://emilhvitfeldt.github.io/tidyclust/reference/within_cluster_sse.html"><code>tidyclust::within_cluster_sse</code></a> to calculate the Sum of Squared Error in each cluster</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a>hc_fit <span class="sc">%&gt;%</span></span>
<span id="cb110-2"><a href="#cb110-2"></a>  tidyclust<span class="sc">::</span><span class="fu">within_cluster_sse</span>() <span class="sc">%&gt;%</span></span>
<span id="cb110-3"><a href="#cb110-3"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-e12f535e164694c1d74d" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e12f535e164694c1d74d">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".cluster":["Cluster_1","Cluster_2","Cluster_3"],"wss":[3625.68132928723,589.192940452126,638.011576431525],"n_members":[47,8,9]},"columns":[{"accessor":".cluster","name":".cluster","type":"factor"},{"accessor":"wss","name":"wss","type":"numeric"},{"accessor":"n_members","name":"n_members","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"c5bff1748af2fe467dfcb517023e7972"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We use <a href="https://emilhvitfeldt.github.io/tidyclust/reference/tot_sse.html"><code>tidyclust::tot_sse</code></a> to calculate the total sum of squares.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1"></a>hc_fit <span class="sc">%&gt;%</span></span>
<span id="cb111-2"><a href="#cb111-2"></a>  tidyclust<span class="sc">::</span><span class="fu">tot_sse</span>() <span class="sc">%&gt;%</span></span>
<span id="cb111-3"><a href="#cb111-3"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-4eda5e7cdd175cbe525f" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4eda5e7cdd175cbe525f">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".metric":["tot_sse"],".estimator":["standard"],".estimate":[5203.92333917343]},"columns":[{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":".estimate","name":".estimate","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"c665a62e8e36e7dbc87e27722efd380a"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We use <a href="https://emilhvitfeldt.github.io/tidyclust/reference/sse_ratio.html"><code>tidyclust::sse_ratio</code></a> to calculate the ratio of the WSS to the total SSE.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a>hc_fit <span class="sc">%&gt;%</span></span>
<span id="cb112-2"><a href="#cb112-2"></a>  tidyclust<span class="sc">::</span><span class="fu">sse_ratio</span>() <span class="sc">%&gt;%</span></span>
<span id="cb112-3"><a href="#cb112-3"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-6fca875960db1e31e9e1" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6fca875960db1e31e9e1">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".metric":["sse_ratio"],".estimator":["standard"],".estimate":[0.932543684807951]},"columns":[{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":".estimate","name":".estimate","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"95d29f99c8ff689cdb47107d4f907cfc"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We use <a href="https://emilhvitfeldt.github.io/tidyclust/reference/silhouettes.html"><code>tidyclust::silhouettes</code></a> to measure silhouettes between clusters for all observations. Ensure that the labels are removed.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1"></a>hc_fit <span class="sc">%&gt;%</span></span>
<span id="cb113-2"><a href="#cb113-2"></a>  tidyclust<span class="sc">::</span><span class="fu">silhouettes</span>(<span class="at">new_data =</span> nci60_num_cluster) <span class="sc">%&gt;%</span></span>
<span id="cb113-3"><a href="#cb113-3"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-1514c59501143b6ac9fd" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1514c59501143b6ac9fd">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"cluster":["Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_3","Cluster_3","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_3","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_2","Cluster_2","Cluster_2","Cluster_2","Cluster_2","Cluster_2","Cluster_2","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_2","Cluster_3","Cluster_1","Cluster_3","Cluster_3","Cluster_1","Cluster_3","Cluster_3","Cluster_3","Cluster_1"],"neighbor":["Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_1","Cluster_1","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_1","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_2","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_1","Cluster_2","Cluster_2","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_2","Cluster_2","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_3","Cluster_1","Cluster_3","Cluster_1","Cluster_1","Cluster_3","Cluster_1","Cluster_1","Cluster_1","Cluster_3"],"sil_width":[0.0352817792805266,0.0529225641648429,0.0440486941450832,0.0469867462937912,0.0974684333535377,0.0702715760153774,0.0838386313251737,0.0549606392095582,0.0495625983687089,-0.0458343319230968,-0.0338443761595954,0.0629562683264321,0.0318506584415993,0.0201582204238722,0.0474278377501193,0.017143507268221,-0.0311743545700099,0.0559309743175026,0.0461234221833361,0.0474123495877097,0.0260879417521248,0.0482669227268585,0.00543613580596345,0.0231380455762049,0.0353625544495733,0.0155489553462084,0.0474786734876816,-0.0114289243336992,0.0318418857812675,0.0149173967246127,0.0159328526136062,0.0275173156656712,0.0364254184175317,0.00592829796122134,0.151426051914562,0.171340436632502,0.177786051855285,0.0805314261605381,0.133025333624598,0.112517995625729,0.0117223104405757,0.059875199868278,0.0312930452437808,0.0929937623655741,0.0730900378765819,0.0869933798379052,0.0903077955129761,0.0716940412979638,0.0988628612298761,0.098853048233258,0.112018393842967,0.0700081776358348,0.0564947151239558,0.0378762455099569,-0.0528055445249419,0.0329848514329952,-0.0242802656735718,-0.0015009180278376,-0.00361635638697044,-0.0107999530773912,0.0211680456877661,0.000791915924102812,-0.0160906395559298,-0.00195757495327454]},"columns":[{"accessor":"cluster","name":"cluster","type":"factor"},{"accessor":"neighbor","name":"neighbor","type":"factor"},{"accessor":"sil_width","name":"sil_width","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"f4fd2bb362278e37cfe63c2ee8fd5736"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We use <a href="https://emilhvitfeldt.github.io/tidyclust/reference/avg_silhouette.html"><code>tidyclust::avg_silhouette</code></a> to measure average silhouettes across all observations. Ensure that the labels are removed. (This is also the mean of the column <code>sil_width</code>)</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a>hc_fit <span class="sc">%&gt;%</span></span>
<span id="cb114-2"><a href="#cb114-2"></a>  tidyclust<span class="sc">::</span><span class="fu">avg_silhouette</span>(<span class="at">new_data =</span> nci60_num_cluster) <span class="sc">%&gt;%</span></span>
<span id="cb114-3"><a href="#cb114-3"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-1a7569166777a69594ef" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1a7569166777a69594ef">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".metric":["avg_silhouette"],".estimator":["standard"],".estimate":[0.0443523309446119]},"columns":[{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":".estimate","name":".estimate","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"d5d3fdd9f8d717b90d386652df6dbd7d"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Use <a href="https://emilhvitfeldt.github.io/tidyclust/reference/cluster_metric_set.html"><code>tidyclust::cluster_metric_set</code></a> to combine the metrics together.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1"></a>many_metrics <span class="ot">&lt;-</span> tidyclust<span class="sc">::</span><span class="fu">cluster_metric_set</span>(</span>
<span id="cb115-2"><a href="#cb115-2"></a>  tidyclust<span class="sc">::</span>tot_wss,</span>
<span id="cb115-3"><a href="#cb115-3"></a>  tidyclust<span class="sc">::</span>tot_sse,</span>
<span id="cb115-4"><a href="#cb115-4"></a>  tidyclust<span class="sc">::</span>sse_ratio,</span>
<span id="cb115-5"><a href="#cb115-5"></a>  tidyclust<span class="sc">::</span>avg_silhouette</span>
<span id="cb115-6"><a href="#cb115-6"></a>)</span>
<span id="cb115-7"><a href="#cb115-7"></a></span>
<span id="cb115-8"><a href="#cb115-8"></a><span class="co"># new_data required for tidyclust::avg_silhouette to work</span></span>
<span id="cb115-9"><a href="#cb115-9"></a>hc_fit <span class="sc">%&gt;%</span></span>
<span id="cb115-10"><a href="#cb115-10"></a>  <span class="fu">many_metrics</span>(<span class="at">new_data =</span> nci60_num_cluster) <span class="sc">%&gt;%</span></span>
<span id="cb115-11"><a href="#cb115-11"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-6fc7049a7a56a27de247" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6fc7049a7a56a27de247">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".metric":["tot_wss","tot_sse","sse_ratio","avg_silhouette"],".estimator":["standard","standard","standard","standard"],".estimate":[372221.285366204,430290,0.865047492077911,0.0443523309446119]},"columns":[{"accessor":".metric","name":".metric","type":"character"},{"accessor":".estimator","name":".estimator","type":"character"},{"accessor":".estimate","name":".estimate","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"233733a506752b13af683440122f1556"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We use <a href="https://emilhvitfeldt.github.io/tidyclust/reference/extract_cluster_assignment.html"><code>tidyclust::extract_cluster_assignment</code></a> to see the cluster assignments. However, the labels need to be updated.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1"></a>hc_fit <span class="sc">%&gt;%</span></span>
<span id="cb116-2"><a href="#cb116-2"></a>  tidyclust<span class="sc">::</span><span class="fu">extract_cluster_assignment</span>() <span class="sc">%&gt;%</span></span>
<span id="cb116-3"><a href="#cb116-3"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">labels =</span> nci60_scaled<span class="sc">$</span>label) <span class="sc">%&gt;%</span></span>
<span id="cb116-4"><a href="#cb116-4"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-5023045c70ac23bcad68" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5023045c70ac23bcad68">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".cluster":["Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_2","Cluster_2","Cluster_2","Cluster_2","Cluster_2","Cluster_2","Cluster_2","Cluster_2","Cluster_1","Cluster_3","Cluster_1","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1"],"labels":["CNS","CNS","CNS","RENAL","BREAST","CNS","CNS","BREAST","NSCLC","NSCLC","RENAL","RENAL","RENAL","RENAL","RENAL","RENAL","RENAL","BREAST","NSCLC","RENAL","UNKNOWN","OVARIAN","MELANOMA","PROSTATE","OVARIAN","OVARIAN","OVARIAN","OVARIAN","OVARIAN","PROSTATE","NSCLC","NSCLC","NSCLC","LEUKEMIA","K562B-repro","K562A-repro","LEUKEMIA","LEUKEMIA","LEUKEMIA","LEUKEMIA","LEUKEMIA","COLON","COLON","COLON","COLON","COLON","COLON","COLON","MCF7A-repro","BREAST","MCF7D-repro","BREAST","NSCLC","NSCLC","NSCLC","MELANOMA","BREAST","BREAST","MELANOMA","MELANOMA","MELANOMA","MELANOMA","MELANOMA","MELANOMA"]},"columns":[{"accessor":".cluster","name":".cluster","type":"factor"},{"accessor":"labels","name":"labels","type":"factor"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"f6f4399893d306c780f4127d94dad468"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Centroid can be extracted using <a href="https://emilhvitfeldt.github.io/tidyclust/reference/extract_centroids.html"><code>extract_centroids</code></a>. Here is a preview of the first few columns. For hierarchical clustering, the geometric mean over the predictors for each cluster is used.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1"></a>hc_fit_centroids <span class="ot">&lt;-</span> hc_fit <span class="sc">%&gt;%</span></span>
<span id="cb117-2"><a href="#cb117-2"></a>  tidyclust<span class="sc">::</span><span class="fu">extract_centroids</span>()</span>
<span id="cb117-3"><a href="#cb117-3"></a></span>
<span id="cb117-4"><a href="#cb117-4"></a>hc_fit_centroids[, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>] <span class="sc">%&gt;%</span></span>
<span id="cb117-5"><a href="#cb117-5"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-cf12c26ce98f2c631008" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-cf12c26ce98f2c631008">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".cluster":["Cluster_1","Cluster_2","Cluster_3"],"V_1":[0.112613731974766,-0.469451828582262,-0.170803419350659],"V_2":[0.0437406462802131,-0.331296015057964,0.0660619716992995],"V_3":[-0.00337371526160473,-0.484818963369254,0.448568480472162],"V_4":[-0.0377528139570673,-0.445391082885002,0.593056768784686],"V_5":[0.138104079539303,-0.83975007225376,0.0252343155203143],"V_6":[0.0300044984193903,-0.144008954162729,-0.0286821991566121],"V_7":[0.0892344019439184,-0.656717139661605,0.117746691769853],"V_8":[0.0491241717985437,-0.544464255111029,0.227430885150742],"V_9":[0.0621284879133876,-0.561007747012433,0.174224782685584]},"columns":[{"accessor":".cluster","name":".cluster","type":"factor"},{"accessor":"V_1","name":"V_1","type":"numeric"},{"accessor":"V_2","name":"V_2","type":"numeric"},{"accessor":"V_3","name":"V_3","type":"numeric"},{"accessor":"V_4","name":"V_4","type":"numeric"},{"accessor":"V_5","name":"V_5","type":"numeric"},{"accessor":"V_6","name":"V_6","type":"numeric"},{"accessor":"V_7","name":"V_7","type":"numeric"},{"accessor":"V_8","name":"V_8","type":"numeric"},{"accessor":"V_9","name":"V_9","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"cab73aa77ab82d2a315e272e48348e2f"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Here is how to see the plots. <code>hc_fit$fit</code> gives back the <code>hclust</code> object. We can plot the hierarchical clustering results.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a>hc_fit<span class="sc">$</span>fit<span class="sc">$</span>labels <span class="ot">&lt;-</span> nci60_scaled<span class="sc">$</span>label</span>
<span id="cb118-2"><a href="#cb118-2"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(hc_fit<span class="sc">$</span>fit, <span class="at">main =</span> <span class="st">"complete"</span>, <span class="at">k =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid" width="3883"></p>
</div>
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb119"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1"></a>stats<span class="sc">::</span><span class="fu">cutree</span>(<span class="at">tree =</span> hc_fit<span class="sc">$</span>fit, <span class="at">k =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;         CNS         CNS         CNS       RENAL      BREAST         CNS 
&gt;           1           1           1           1           1           1 
&gt;         CNS      BREAST       NSCLC       NSCLC       RENAL       RENAL 
&gt;           1           1           1           1           1           1 
&gt;       RENAL       RENAL       RENAL       RENAL       RENAL      BREAST 
&gt;           1           1           1           1           1           1 
&gt;       NSCLC       RENAL     UNKNOWN     OVARIAN    MELANOMA    PROSTATE 
&gt;           1           1           1           1           1           1 
&gt;     OVARIAN     OVARIAN     OVARIAN     OVARIAN     OVARIAN    PROSTATE 
&gt;           1           1           1           1           1           1 
&gt;       NSCLC       NSCLC       NSCLC    LEUKEMIA K562B-repro K562A-repro 
&gt;           1           1           1           2           2           2 
&gt;    LEUKEMIA    LEUKEMIA    LEUKEMIA    LEUKEMIA    LEUKEMIA       COLON 
&gt;           2           2           2           2           2           1 
&gt;       COLON       COLON       COLON       COLON       COLON       COLON 
&gt;           3           1           3           3           3           3 
&gt; MCF7A-repro      BREAST MCF7D-repro      BREAST       NSCLC       NSCLC 
&gt;           3           3           3           3           1           1 
&gt;       NSCLC    MELANOMA      BREAST      BREAST    MELANOMA    MELANOMA 
&gt;           1           1           1           1           1           1 
&gt;    MELANOMA    MELANOMA    MELANOMA    MELANOMA 
&gt;           1           1           1           1</code></pre>
</div>
</div>
<p>Alternatively, we can use <a href="https://emilhvitfeldt.github.io/tidyclust/reference/extract_fit_summary.html"><code>tidyclust::extract_fit_summary</code></a> as well.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a>hc_summary <span class="ot">&lt;-</span> hc_fit <span class="sc">%&gt;%</span></span>
<span id="cb121-2"><a href="#cb121-2"></a>  tidyclust<span class="sc">::</span><span class="fu">extract_fit_summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here is how you can do k-means clustering using <a href="https://emilhvitfeldt.github.io/tidyclust/reference/k_means.html"><code>tidyclust::k_means</code></a>.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1"></a>km_spec <span class="ot">&lt;-</span> tidyclust<span class="sc">::</span><span class="fu">k_means</span>(<span class="at">num_clusters =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb122-2"><a href="#cb122-2"></a>  parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">"stats"</span>, <span class="at">algorithm =</span> <span class="st">"Lloyd"</span>)</span>
<span id="cb122-3"><a href="#cb122-3"></a></span>
<span id="cb122-4"><a href="#cb122-4"></a>km_fit <span class="ot">&lt;-</span> km_spec <span class="sc">%&gt;%</span></span>
<span id="cb122-5"><a href="#cb122-5"></a>  tidyclust<span class="sc">::</span><span class="fu">fit</span>(label <span class="sc">~</span> ., <span class="at">data =</span> nci60_scaled)</span>
<span id="cb122-6"><a href="#cb122-6"></a></span>
<span id="cb122-7"><a href="#cb122-7"></a>km_summary <span class="ot">&lt;-</span> km_fit <span class="sc">%&gt;%</span> <span class="fu">extract_fit_summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><code><a href="https://rdrr.io/r/stats/predict.html">stats::predict</a></code> returns the cluster a new observation belongs to</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1"></a>km_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(km_fit, nci60_num_cluster, <span class="at">prefix =</span> <span class="st">"KM_"</span>)</span>
<span id="cb123-2"><a href="#cb123-2"></a>hc_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(hc_fit, nci60_num_cluster, <span class="at">prefix =</span> <span class="st">"HC_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>However, <code><a href="https://rdrr.io/r/stats/predict.html">stats::predict</a></code> on the “training data” will not necessarily produce the same results as <a href="https://emilhvitfeldt.github.io/tidyclust/reference/extract_cluster_assignment.html"><code>tidyclust::extract_cluster_assignment</code></a></p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb124"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1"></a><span class="fu">cbind</span>(</span>
<span id="cb124-2"><a href="#cb124-2"></a>  hc_preds,</span>
<span id="cb124-3"><a href="#cb124-3"></a>  tidyclust<span class="sc">::</span><span class="fu">extract_cluster_assignment</span>(hc_fit),</span>
<span id="cb124-4"><a href="#cb124-4"></a>  nci60_scaled<span class="sc">$</span>label</span>
<span id="cb124-5"><a href="#cb124-5"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb124-6"><a href="#cb124-6"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-691ec69a92ce349e44db" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-691ec69a92ce349e44db">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".pred_cluster":["HC_1","HC_1","HC_1","HC_1","HC_1","HC_1","HC_1","HC_1","HC_1","HC_3","HC_3","HC_1","HC_1","HC_1","HC_1","HC_1","HC_3","HC_1","HC_1","HC_1","HC_1","HC_1","HC_1","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_2","HC_2","HC_2","HC_2","HC_2","HC_2","HC_2","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_2","HC_3","HC_1","HC_3","HC_3","HC_1","HC_3","HC_3","HC_3","HC_1"],".cluster":["Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_2","Cluster_2","Cluster_2","Cluster_2","Cluster_2","Cluster_2","Cluster_2","Cluster_2","Cluster_1","Cluster_3","Cluster_1","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_3","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1","Cluster_1"],"nci60_scaled$label":["CNS","CNS","CNS","RENAL","BREAST","CNS","CNS","BREAST","NSCLC","NSCLC","RENAL","RENAL","RENAL","RENAL","RENAL","RENAL","RENAL","BREAST","NSCLC","RENAL","UNKNOWN","OVARIAN","MELANOMA","PROSTATE","OVARIAN","OVARIAN","OVARIAN","OVARIAN","OVARIAN","PROSTATE","NSCLC","NSCLC","NSCLC","LEUKEMIA","K562B-repro","K562A-repro","LEUKEMIA","LEUKEMIA","LEUKEMIA","LEUKEMIA","LEUKEMIA","COLON","COLON","COLON","COLON","COLON","COLON","COLON","MCF7A-repro","BREAST","MCF7D-repro","BREAST","NSCLC","NSCLC","NSCLC","MELANOMA","BREAST","BREAST","MELANOMA","MELANOMA","MELANOMA","MELANOMA","MELANOMA","MELANOMA"]},"columns":[{"accessor":".pred_cluster","name":".pred_cluster","type":"factor"},{"accessor":".cluster","name":".cluster","type":"factor"},{"accessor":"nci60_scaled$label","name":"nci60_scaled$label","type":"factor"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"ee9eb5210cc130becc663e8b66408096"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We notice that the three-cluster assignments from hier_clust do not line up perfectly with the five-cluster assignments from k_means.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1"></a><span class="fu">tibble</span>(</span>
<span id="cb125-2"><a href="#cb125-2"></a>  <span class="at">hc =</span> hc_preds<span class="sc">$</span>.pred_cluster,</span>
<span id="cb125-3"><a href="#cb125-3"></a>  <span class="at">km =</span> km_preds<span class="sc">$</span>.pred_cluster</span>
<span id="cb125-4"><a href="#cb125-4"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb125-5"><a href="#cb125-5"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(.data[[<span class="st">"hc"</span>]], .data[[<span class="st">"km"</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb125-6"><a href="#cb125-6"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-c3f368d45cdc4c1eb312" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c3f368d45cdc4c1eb312">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"hc":["HC_1","HC_1","HC_2","HC_2","HC_2","HC_3","HC_3","HC_3","HC_3"],"km":["KM_1","KM_2","KM_3","KM_4","KM_5","KM_1","KM_2","KM_3","KM_5"],"n":[13,10,5,2,1,24,3,2,4]},"columns":[{"accessor":"hc","name":"hc","type":"factor"},{"accessor":"km","name":"km","type":"factor"},{"accessor":"n","name":"n","type":"numeric"}],"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"be8a729e310707a9344df1107af3bc42"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><code>tidyclust</code> also have a useful function called <a href="https://emilhvitfeldt.github.io/tidyclust/reference/reconcile_clusterings.html"><code>tidyclust::reconcile_clusterings</code></a> to match clusters from k-means with the clusters from hierarchical clustering.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb126"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1"></a>cluster_table <span class="ot">&lt;-</span> tidyclust<span class="sc">::</span><span class="fu">reconcile_clusterings</span>(</span>
<span id="cb126-2"><a href="#cb126-2"></a>  <span class="at">primary_cluster_assignment =</span> hc_preds<span class="sc">$</span>.pred_cluster,</span>
<span id="cb126-3"><a href="#cb126-3"></a>  <span class="at">alt_cluster_assignment =</span> km_preds<span class="sc">$</span>.pred_cluster,</span>
<span id="cb126-4"><a href="#cb126-4"></a>  <span class="at">one_to_one =</span> <span class="cn">FALSE</span></span>
<span id="cb126-5"><a href="#cb126-5"></a>)</span>
<span id="cb126-6"><a href="#cb126-6"></a></span>
<span id="cb126-7"><a href="#cb126-7"></a>cluster_table <span class="sc">%&gt;%</span></span>
<span id="cb126-8"><a href="#cb126-8"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">labels =</span> nci60_scaled<span class="sc">$</span>label) <span class="sc">%&gt;%</span></span>
<span id="cb126-9"><a href="#cb126-9"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(</span>
<span id="cb126-10"><a href="#cb126-10"></a>    <span class="at">defaultPageSize =</span> <span class="dv">5</span>,</span>
<span id="cb126-11"><a href="#cb126-11"></a>    <span class="at">filterable =</span> <span class="cn">TRUE</span></span>
<span id="cb126-12"><a href="#cb126-12"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="htmlwidget-102008966a0462f8433a" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-102008966a0462f8433a">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"primary":["HC_1","HC_1","HC_1","HC_1","HC_1","HC_1","HC_1","HC_1","HC_1","HC_3","HC_3","HC_1","HC_1","HC_1","HC_1","HC_1","HC_3","HC_1","HC_1","HC_1","HC_1","HC_1","HC_1","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_2","HC_2","HC_2","HC_2","HC_2","HC_2","HC_2","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_2","HC_3","HC_1","HC_3","HC_3","HC_1","HC_3","HC_3","HC_3","HC_1"],"alt":["KM_1","KM_1","KM_2","KM_2","KM_2","KM_2","KM_2","KM_2","KM_1","KM_1","KM_2","KM_2","KM_1","KM_2","KM_1","KM_1","KM_1","KM_2","KM_2","KM_1","KM_1","KM_1","KM_1","KM_1","KM_1","KM_1","KM_1","KM_1","KM_1","KM_1","KM_1","KM_1","KM_1","KM_3","KM_3","KM_3","KM_3","KM_3","KM_4","KM_4","KM_3","KM_1","KM_3","KM_1","KM_1","KM_1","KM_1","KM_1","KM_5","KM_5","KM_5","KM_5","KM_1","KM_1","KM_5","KM_1","KM_1","KM_1","KM_2","KM_1","KM_1","KM_2","KM_1","KM_1"],"alt_recoded":["HC_3","HC_3","HC_1","HC_1","HC_1","HC_1","HC_1","HC_1","HC_3","HC_3","HC_1","HC_1","HC_3","HC_1","HC_3","HC_3","HC_3","HC_1","HC_1","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_2","HC_2","HC_2","HC_2","HC_2","HC_2","HC_2","HC_2","HC_3","HC_2","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_3","HC_1","HC_3","HC_3","HC_1","HC_3","HC_3"],"labels":["CNS","CNS","CNS","RENAL","BREAST","CNS","CNS","BREAST","NSCLC","NSCLC","RENAL","RENAL","RENAL","RENAL","RENAL","RENAL","RENAL","BREAST","NSCLC","RENAL","UNKNOWN","OVARIAN","MELANOMA","PROSTATE","OVARIAN","OVARIAN","OVARIAN","OVARIAN","OVARIAN","PROSTATE","NSCLC","NSCLC","NSCLC","LEUKEMIA","K562B-repro","K562A-repro","LEUKEMIA","LEUKEMIA","LEUKEMIA","LEUKEMIA","LEUKEMIA","COLON","COLON","COLON","COLON","COLON","COLON","COLON","MCF7A-repro","BREAST","MCF7D-repro","BREAST","NSCLC","NSCLC","NSCLC","MELANOMA","BREAST","BREAST","MELANOMA","MELANOMA","MELANOMA","MELANOMA","MELANOMA","MELANOMA"]},"columns":[{"accessor":"primary","name":"primary","type":"factor"},{"accessor":"alt","name":"alt","type":"factor"},{"accessor":"alt_recoded","name":"alt_recoded","type":"character"},{"accessor":"labels","name":"labels","type":"factor"}],"filterable":true,"defaultPageSize":5,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"dde515b9a7038f485716edad3b2fd731"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We can see that <code>KM_1</code> and <code>KM_2</code> is matched to <code>HC_1</code>, <code>KM_3</code> is matched to <code>HC_2</code>, <code>KM_4</code> and <code>KM_5</code> is matched to <code>HC_3</code>.</p>
</section></section><section id="blog-references" class="level1"><h1>Blog References</h1>
<ul>
<li><p>Tengku Hanis’s <a href="https://tengkuhanis.netlify.app/post/explore-data-using-pca/">blog</a> titled “Explore data using PCA”</p></li>
<li><p>Julia Silge’s <a href="https://juliasilge.com/blog/cocktail-recipes-umap/">blog</a> titled “PCA and UMAP with tidymodels and #TidyTuesday cocktail recipes”</p></li>
<li><p>Julia Silge’s <a href="https://juliasilge.com/blog/kmeans-employment/">blog</a> titled “Getting started with k-means and #TidyTuesday employment status”</p></li>
<li><p>Tidymodels’ <a href="https://www.tidymodels.org/learn/statistics/k-means/">tutorial</a> titled “K-means clustering with tidy data principles”</p></li>
<li><p>Emil Hvitfeldt’s ISLR tidymodels Labs <a href="https://emilhvitfeldt.github.io/ISLR-tidymodels-labs/unsupervised-learning.html">Chapter 12</a></p></li>
<li><p><a href="https://twitter.com/ericntay">Eric (R_ic)</a> RPubs’s <a href="https://rpubs.com/eR_ic/clustering">post</a> titled “Train and Evaluate Clustering Models using Tidymodels and friends”</p></li>
<li><p><a href="https://bradleyboehmke.github.io/HOML/hierarchical.html">Chapter 21</a> Hierarchical Clustering from Hands-On Machine Learning with R</p></li>
</ul></section><section id="package-references" class="level1"><h1>Package References</h1>
<details open=""><summary>Code</summary><div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1"></a>get_citation <span class="ot">&lt;-</span> <span class="cf">function</span>(package_name) {</span>
<span id="cb127-2"><a href="#cb127-2"></a>  transform_name <span class="ot">&lt;-</span> package_name <span class="sc">%&gt;%</span></span>
<span id="cb127-3"><a href="#cb127-3"></a>    <span class="fu">citation</span>() <span class="sc">%&gt;%</span></span>
<span id="cb127-4"><a href="#cb127-4"></a>    <span class="fu">format</span>(<span class="at">style =</span> <span class="st">"text"</span>)</span>
<span id="cb127-5"><a href="#cb127-5"></a>  <span class="fu">return</span>(transform_name[<span class="dv">1</span>])</span>
<span id="cb127-6"><a href="#cb127-6"></a>}</span>
<span id="cb127-7"><a href="#cb127-7"></a></span>
<span id="cb127-8"><a href="#cb127-8"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb127-9"><a href="#cb127-9"></a>  <span class="st">"base"</span>, <span class="st">"ggplot2"</span>, <span class="st">"rmarkdown"</span>, <span class="st">"cluster"</span>,</span>
<span id="cb127-10"><a href="#cb127-10"></a>  <span class="st">"report"</span>, <span class="st">"tidytext"</span>, <span class="st">"knitr"</span>, <span class="st">"broom"</span>,</span>
<span id="cb127-11"><a href="#cb127-11"></a>  <span class="st">"cowplot"</span>, <span class="st">"dplyr"</span>, <span class="st">"factoextra"</span>, <span class="st">"forcats"</span>,</span>
<span id="cb127-12"><a href="#cb127-12"></a>  <span class="st">"ggforce"</span>, <span class="st">"gridExtra"</span>, <span class="st">"htmltools"</span>, <span class="st">"ISLR2"</span>,</span>
<span id="cb127-13"><a href="#cb127-13"></a>  <span class="st">"magrittr"</span>, <span class="st">"Matrix"</span>, <span class="st">"parsnip"</span>, <span class="st">"proxy"</span>,</span>
<span id="cb127-14"><a href="#cb127-14"></a>  <span class="st">"purrr"</span>, <span class="st">"reactable"</span>, <span class="st">"reactablefmtr"</span>, <span class="st">"recipes"</span>,</span>
<span id="cb127-15"><a href="#cb127-15"></a>  <span class="st">"scales"</span>, <span class="st">"softImpute"</span>, <span class="st">"stringr"</span>, <span class="st">"styler"</span>,</span>
<span id="cb127-16"><a href="#cb127-16"></a>  <span class="st">"tibble"</span>, <span class="st">"tidyr"</span>, <span class="st">"yardstick"</span>, <span class="st">"tidyclust"</span>,</span>
<span id="cb127-17"><a href="#cb127-17"></a>  <span class="st">"rsample"</span>, <span class="st">"tune"</span>, <span class="st">"dials"</span>, <span class="st">"workflows"</span>,</span>
<span id="cb127-18"><a href="#cb127-18"></a>  <span class="st">"Rfast"</span>, <span class="st">"flexclust"</span></span>
<span id="cb127-19"><a href="#cb127-19"></a>)</span>
<span id="cb127-20"><a href="#cb127-20"></a></span>
<span id="cb127-21"><a href="#cb127-21"></a>table <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">Packages =</span> packages)</span>
<span id="cb127-22"><a href="#cb127-22"></a></span>
<span id="cb127-23"><a href="#cb127-23"></a>table <span class="sc">%&gt;%</span></span>
<span id="cb127-24"><a href="#cb127-24"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb127-25"><a href="#cb127-25"></a>    <span class="at">transform_name =</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(</span>
<span id="cb127-26"><a href="#cb127-26"></a>      .data[[<span class="st">"Packages"</span>]],</span>
<span id="cb127-27"><a href="#cb127-27"></a>      get_citation</span>
<span id="cb127-28"><a href="#cb127-28"></a>    )</span>
<span id="cb127-29"><a href="#cb127-29"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb127-30"><a href="#cb127-30"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(.data[[<span class="st">"transform_name"</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb127-31"><a href="#cb127-31"></a>  report<span class="sc">::</span><span class="fu">as.report_parameters</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><ul>
<li>R Core Team (2022). <em>R: A Language and Environment for Statistical Computing</em>. R Foundation for Statistical Computing, Vienna, Austria. <a href="https://www.R-project.org/" class="uri">https://www.R-project.org/</a>.</li>
<li>Wickham H (2016). <em>ggplot2: Elegant Graphics for Data Analysis</em>. Springer-Verlag New York. ISBN 978-3-319-24277-4, <a href="https://ggplot2.tidyverse.org" class="uri">https://ggplot2.tidyverse.org</a>.</li>
<li>Allaire J, Xie Y, McPherson J, Luraschi J, Ushey K, Atkins A, Wickham H, Cheng J, Chang W, Iannone R (2022). <em>rmarkdown: Dynamic Documents for R</em>. R package version 2.14, <a href="https://github.com/rstudio/rmarkdown" class="uri">https://github.com/rstudio/rmarkdown</a>.</li>
<li>Maechler M, Rousseeuw P, Struyf A, Hubert M, Hornik K (2022). <em>cluster: Cluster Analysis Basics and Extensions</em>. R package version 2.1.3 - For new features, see the ‘Changelog’ file (in the package source), <a href="https://CRAN.R-project.org/package=cluster" class="uri">https://CRAN.R-project.org/package=cluster</a>.</li>
<li>Makowski D, Ben-Shachar M, Patil I, Lüdecke D (2021). “Automated Results Reporting as a Practical Tool to Improve Reproducibility and Methodological Best Practices Adoption.” <em>CRAN</em>. <a href="https://github.com/easystats/report" class="uri">https://github.com/easystats/report</a>.</li>
<li>Silge J, Robinson D (2016). “tidytext: Text Mining and Analysis Using Tidy Data Principles in R.” <em>JOSS</em>, <em>1</em>(3). doi:10.21105/joss.00037 <a href="https://doi.org/10.21105/joss.00037" class="uri">https://doi.org/10.21105/joss.00037</a>, <a href="http://dx.doi.org/10.21105/joss.00037" class="uri">http://dx.doi.org/10.21105/joss.00037</a>.</li>
<li>Xie Y (2022). <em>knitr: A General-Purpose Package for Dynamic Report Generation in R</em>. R package version 1.39, <a href="https://yihui.org/knitr/" class="uri">https://yihui.org/knitr/</a>.</li>
<li>Robinson D, Hayes A, Couch S (2022). <em>broom: Convert Statistical Objects into Tidy Tibbles</em>. R package version 1.0.0, <a href="https://CRAN.R-project.org/package=broom" class="uri">https://CRAN.R-project.org/package=broom</a>.</li>
<li>Wilke C (2020). <em>cowplot: Streamlined Plot Theme and Plot Annotations for ‘ggplot2’</em>. R package version 1.1.1, <a href="https://CRAN.R-project.org/package=cowplot" class="uri">https://CRAN.R-project.org/package=cowplot</a>.</li>
<li>Wickham H, François R, Henry L, Müller K (2022). <em>dplyr: A Grammar of Data Manipulation</em>. R package version 1.0.9, <a href="https://CRAN.R-project.org/package=dplyr" class="uri">https://CRAN.R-project.org/package=dplyr</a>.</li>
<li>Kassambara A, Mundt F (2020). <em>factoextra: Extract and Visualize the Results of Multivariate Data Analyses</em>. R package version 1.0.7, <a href="https://CRAN.R-project.org/package=factoextra" class="uri">https://CRAN.R-project.org/package=factoextra</a>.</li>
<li>Wickham H (2021). <em>forcats: Tools for Working with Categorical Variables (Factors)</em>. R package version 0.5.1, <a href="https://CRAN.R-project.org/package=forcats" class="uri">https://CRAN.R-project.org/package=forcats</a>.</li>
<li>Pedersen T (2021). <em>ggforce: Accelerating ‘ggplot2’</em>. R package version 0.3.3, <a href="https://CRAN.R-project.org/package=ggforce" class="uri">https://CRAN.R-project.org/package=ggforce</a>.</li>
<li>Auguie B (2017). <em>gridExtra: Miscellaneous Functions for “Grid” Graphics</em>. R package version 2.3, <a href="https://CRAN.R-project.org/package=gridExtra" class="uri">https://CRAN.R-project.org/package=gridExtra</a>.</li>
<li>Cheng J, Sievert C, Schloerke B, Chang W, Xie Y, Allen J (2021). <em>htmltools: Tools for HTML</em>. R package version 0.5.2, <a href="https://CRAN.R-project.org/package=htmltools" class="uri">https://CRAN.R-project.org/package=htmltools</a>.</li>
<li>James G, Witten D, Hastie T, Tibshirani R (2022). <em>ISLR2: Introduction to Statistical Learning, Second Edition</em>. R package version 1.3-1, <a href="https://CRAN.R-project.org/package=ISLR2" class="uri">https://CRAN.R-project.org/package=ISLR2</a>.</li>
<li>Bache S, Wickham H (2022). <em>magrittr: A Forward-Pipe Operator for R</em>. R package version 2.0.3, <a href="https://CRAN.R-project.org/package=magrittr" class="uri">https://CRAN.R-project.org/package=magrittr</a>.</li>
<li>Bates D, Maechler M, Jagan M (2022). <em>Matrix: Sparse and Dense Matrix Classes and Methods</em>. R package version 1.4-1, <a href="https://CRAN.R-project.org/package=Matrix" class="uri">https://CRAN.R-project.org/package=Matrix</a>.</li>
<li>Kuhn M, Vaughan D (2022). <em>parsnip: A Common API to Modeling and Analysis Functions</em>. https://github.com/tidymodels/parsnip, https://parsnip.tidymodels.org/.</li>
<li>Meyer D, Buchta C (2022). <em>proxy: Distance and Similarity Measures</em>. R package version 0.4-27, <a href="https://CRAN.R-project.org/package=proxy" class="uri">https://CRAN.R-project.org/package=proxy</a>.</li>
<li>Henry L, Wickham H (2020). <em>purrr: Functional Programming Tools</em>. R package version 0.3.4, <a href="https://CRAN.R-project.org/package=purrr" class="uri">https://CRAN.R-project.org/package=purrr</a>.</li>
<li>Lin G (2022). <em>reactable: Interactive Data Tables Based on ‘React Table’</em>. R package version 0.3.0, <a href="https://CRAN.R-project.org/package=reactable" class="uri">https://CRAN.R-project.org/package=reactable</a>.</li>
<li>Cuilla K (2022). <em>reactablefmtr: Streamlined Table Styling and Formatting for Reactable</em>. R package version 2.0.0, <a href="https://CRAN.R-project.org/package=reactablefmtr" class="uri">https://CRAN.R-project.org/package=reactablefmtr</a>.</li>
<li>Kuhn M, Wickham H (2022). <em>recipes: Preprocessing and Feature Engineering Steps for Modeling</em>. R package version 1.0.1, <a href="https://CRAN.R-project.org/package=recipes" class="uri">https://CRAN.R-project.org/package=recipes</a>.</li>
<li>Wickham H, Seidel D (2022). <em>scales: Scale Functions for Visualization</em>. R package version 1.2.0, <a href="https://CRAN.R-project.org/package=scales" class="uri">https://CRAN.R-project.org/package=scales</a>.</li>
<li>Hastie T, Mazumder R (2021). <em>softImpute: Matrix Completion via Iterative Soft-Thresholded SVD</em>. R package version 1.4-1, <a href="https://CRAN.R-project.org/package=softImpute" class="uri">https://CRAN.R-project.org/package=softImpute</a>.</li>
<li>Wickham H (2019). <em>stringr: Simple, Consistent Wrappers for Common String Operations</em>. R package version 1.4.0, <a href="https://CRAN.R-project.org/package=stringr" class="uri">https://CRAN.R-project.org/package=stringr</a>.</li>
<li>Müller K, Walthert L (2022). <em>styler: Non-Invasive Pretty Printing of R Code</em>. R package version 1.7.0, <a href="https://CRAN.R-project.org/package=styler" class="uri">https://CRAN.R-project.org/package=styler</a>.</li>
<li>Müller K, Wickham H (2022). <em>tibble: Simple Data Frames</em>. R package version 3.1.8, <a href="https://CRAN.R-project.org/package=tibble" class="uri">https://CRAN.R-project.org/package=tibble</a>.</li>
<li>Wickham H, Girlich M (2022). <em>tidyr: Tidy Messy Data</em>. R package version 1.2.0, <a href="https://CRAN.R-project.org/package=tidyr" class="uri">https://CRAN.R-project.org/package=tidyr</a>.</li>
<li>Kuhn M, Vaughan D (2022). <em>yardstick: Tidy Characterizations of Model Performance</em>. R package version 1.0.0, <a href="https://CRAN.R-project.org/package=yardstick" class="uri">https://CRAN.R-project.org/package=yardstick</a>.</li>
<li>Hvitfeldt E, Bodwin K (2022). <em>tidyclust: A Common API to Clustering</em>. R package version 0.0.0.9000, <a href="https://github.com/EmilHvitfeldt/tidyclust" class="uri">https://github.com/EmilHvitfeldt/tidyclust</a>.</li>
<li>Silge J, Chow F, Kuhn M, Wickham H (2022). <em>rsample: General Resampling Infrastructure</em>. R package version 1.1.0, <a href="https://CRAN.R-project.org/package=rsample" class="uri">https://CRAN.R-project.org/package=rsample</a>.</li>
<li>Kuhn M (2022). <em>tune: Tidy Tuning Tools</em>. R package version 1.0.0, <a href="https://CRAN.R-project.org/package=tune" class="uri">https://CRAN.R-project.org/package=tune</a>.</li>
<li>Kuhn M, Frick H (2022). <em>dials: Tools for Creating Tuning Parameter Values</em>. R package version 1.0.0, <a href="https://CRAN.R-project.org/package=dials" class="uri">https://CRAN.R-project.org/package=dials</a>.</li>
<li>Vaughan D (2022). <em>workflows: Modeling Workflows</em>. https://github.com/tidymodels/workflows, https://workflows.tidymodels.org.</li>
<li>Papadakis M, Tsagris M, Dimitriadis M, Fafalios S, Tsamardinos I, Fasiolo M, Borboudakis G, Burkardt J, Zou C, Lakiotaki K, Chatzipantsiou. C (2022). <em>Rfast: A Collection of Efficient and Extremely Fast R Functions</em>. R package version 2.0.6, <a href="https://CRAN.R-project.org/package=Rfast" class="uri">https://CRAN.R-project.org/package=Rfast</a>.</li>
<li>Leisch F (2006). “A Toolbox for K-Centroids Cluster Analysis.” <em>Computational Statistics and Data Analysis</em>, <em>51</em>(2), 526-544.</li>
</ul>
<!-- -->
</section></main><!-- /main column --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    toggleBodyColorMode(window.document.querySelector("link#quarto-bootstrap"));
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb128" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb128-1"><a href="#cb128-1"></a><span class="co">---</span></span>
<span id="cb128-2"><a href="#cb128-2"></a><span class="an">title:</span><span class="co"> '**Chapter 12 Lab**'</span></span>
<span id="cb128-3"><a href="#cb128-3"></a><span class="an">author:</span><span class="co"> "Jeremy Selva"</span></span>
<span id="cb128-4"><a href="#cb128-4"></a><span class="an">subtitle:</span><span class="co"> This document was prepared on `r format(Sys.Date())`.</span></span>
<span id="cb128-5"><a href="#cb128-5"></a><span class="an">knitr:</span></span>
<span id="cb128-6"><a href="#cb128-6"></a><span class="co">  opts_chunk:</span></span>
<span id="cb128-7"><a href="#cb128-7"></a><span class="co">    comment: "&gt;"</span></span>
<span id="cb128-8"><a href="#cb128-8"></a><span class="co">    dpi: 600</span></span>
<span id="cb128-9"><a href="#cb128-9"></a><span class="co">    fig-path: "docs/figures/"</span></span>
<span id="cb128-10"><a href="#cb128-10"></a><span class="co">    fig-align: "center"</span></span>
<span id="cb128-11"><a href="#cb128-11"></a><span class="co">    tidy: "styler"</span></span>
<span id="cb128-12"><a href="#cb128-12"></a><span class="an">format:</span></span>
<span id="cb128-13"><a href="#cb128-13"></a><span class="co">  html:</span></span>
<span id="cb128-14"><a href="#cb128-14"></a><span class="co">    theme: cerulean</span></span>
<span id="cb128-15"><a href="#cb128-15"></a><span class="co">    toc: true</span></span>
<span id="cb128-16"><a href="#cb128-16"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb128-17"><a href="#cb128-17"></a><span class="co">    toc-location: left</span></span>
<span id="cb128-18"><a href="#cb128-18"></a><span class="co">    number-sections: false</span></span>
<span id="cb128-19"><a href="#cb128-19"></a><span class="co">    code-fold: show</span></span>
<span id="cb128-20"><a href="#cb128-20"></a><span class="co">    code-overflow: scroll</span></span>
<span id="cb128-21"><a href="#cb128-21"></a><span class="co">    code-line-numbers: true</span></span>
<span id="cb128-22"><a href="#cb128-22"></a><span class="co">    code-copy: hover</span></span>
<span id="cb128-23"><a href="#cb128-23"></a><span class="co">    code-tools: true</span></span>
<span id="cb128-24"><a href="#cb128-24"></a><span class="co">    code-link: true</span></span>
<span id="cb128-25"><a href="#cb128-25"></a><span class="co">    self-contained: false</span></span>
<span id="cb128-26"><a href="#cb128-26"></a><span class="co">    smooth-scroll: true</span></span>
<span id="cb128-27"><a href="#cb128-27"></a><span class="co">    fig-height: 4</span></span>
<span id="cb128-28"><a href="#cb128-28"></a><span class="co">    fig-width: 6.472</span></span>
<span id="cb128-29"><a href="#cb128-29"></a><span class="co">---</span></span>
<span id="cb128-30"><a href="#cb128-30"></a></span>
<span id="cb128-31"><a href="#cb128-31"></a><span class="in">```{r setup, warning=FALSE, message=TRUE, include=FALSE}</span></span>
<span id="cb128-32"><a href="#cb128-32"></a><span class="co"># Set up the environment</span></span>
<span id="cb128-33"><a href="#cb128-33"></a>hook_output <span class="ot">&lt;-</span> knitr<span class="sc">::</span>knit_hooks<span class="sc">$</span><span class="fu">get</span>(<span class="st">'output'</span>)</span>
<span id="cb128-34"><a href="#cb128-34"></a></span>
<span id="cb128-35"><a href="#cb128-35"></a>knitr<span class="sc">::</span>knit_hooks<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb128-36"><a href="#cb128-36"></a>  <span class="at">output =</span> <span class="cf">function</span>(x, options) {</span>
<span id="cb128-37"><a href="#cb128-37"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(options<span class="sc">$</span>max.height)) {</span>
<span id="cb128-38"><a href="#cb128-38"></a>      options<span class="sc">$</span>attr.output <span class="ot">&lt;-</span> <span class="fu">c</span>(options<span class="sc">$</span>attr.output,</span>
<span id="cb128-39"><a href="#cb128-39"></a>                               <span class="fu">sprintf</span>(<span class="st">'style="max-height: %s;"'</span>, options<span class="sc">$</span>max.height))</span>
<span id="cb128-40"><a href="#cb128-40"></a>    }</span>
<span id="cb128-41"><a href="#cb128-41"></a>    <span class="fu">hook_output</span>(x, options)</span>
<span id="cb128-42"><a href="#cb128-42"></a>    }</span>
<span id="cb128-43"><a href="#cb128-43"></a>  )</span>
<span id="cb128-44"><a href="#cb128-44"></a></span>
<span id="cb128-45"><a href="#cb128-45"></a><span class="in">```</span></span>
<span id="cb128-46"><a href="#cb128-46"></a></span>
<span id="cb128-47"><a href="#cb128-47"></a><span class="in">```{r, results='asis'}</span></span>
<span id="cb128-48"><a href="#cb128-48"></a><span class="co">#| warning: false</span></span>
<span id="cb128-49"><a href="#cb128-49"></a><span class="co">#| message: false</span></span>
<span id="cb128-50"><a href="#cb128-50"></a><span class="co">#| code-fold: true</span></span>
<span id="cb128-51"><a href="#cb128-51"></a></span>
<span id="cb128-52"><a href="#cb128-52"></a><span class="co"># Rmarkdown stuff</span></span>
<span id="cb128-53"><a href="#cb128-53"></a><span class="fu">library</span>(rmarkdown, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-54"><a href="#cb128-54"></a><span class="fu">library</span>(knitr, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-55"><a href="#cb128-55"></a><span class="fu">library</span>(htmltools, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-56"><a href="#cb128-56"></a><span class="fu">library</span>(styler, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-57"><a href="#cb128-57"></a></span>
<span id="cb128-58"><a href="#cb128-58"></a><span class="co"># Dataset</span></span>
<span id="cb128-59"><a href="#cb128-59"></a><span class="fu">library</span>(ISLR2, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-60"><a href="#cb128-60"></a></span>
<span id="cb128-61"><a href="#cb128-61"></a><span class="co"># Session info and package reporting</span></span>
<span id="cb128-62"><a href="#cb128-62"></a><span class="fu">library</span>(report, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-63"><a href="#cb128-63"></a></span>
<span id="cb128-64"><a href="#cb128-64"></a><span class="co"># Data wrangling</span></span>
<span id="cb128-65"><a href="#cb128-65"></a><span class="fu">library</span>(dplyr, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-66"><a href="#cb128-66"></a><span class="fu">library</span>(tidyr, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-67"><a href="#cb128-67"></a><span class="fu">library</span>(magrittr, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-68"><a href="#cb128-68"></a><span class="fu">library</span>(purrr, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-69"><a href="#cb128-69"></a><span class="fu">library</span>(tibble, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-70"><a href="#cb128-70"></a><span class="fu">library</span>(stringr, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-71"><a href="#cb128-71"></a></span>
<span id="cb128-72"><a href="#cb128-72"></a><span class="co"># Matrix Completion</span></span>
<span id="cb128-73"><a href="#cb128-73"></a><span class="fu">library</span>(softImpute, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-74"><a href="#cb128-74"></a></span>
<span id="cb128-75"><a href="#cb128-75"></a><span class="co"># Create interactive tables</span></span>
<span id="cb128-76"><a href="#cb128-76"></a><span class="fu">library</span>(reactable, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-77"><a href="#cb128-77"></a><span class="fu">library</span>(reactablefmtr, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-78"><a href="#cb128-78"></a></span>
<span id="cb128-79"><a href="#cb128-79"></a><span class="co"># For plotting</span></span>
<span id="cb128-80"><a href="#cb128-80"></a><span class="fu">library</span>(tidytext, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-81"><a href="#cb128-81"></a><span class="fu">library</span>(scales, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-82"><a href="#cb128-82"></a><span class="fu">library</span>(forcats, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-83"><a href="#cb128-83"></a><span class="fu">library</span>(grid, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-84"><a href="#cb128-84"></a><span class="fu">library</span>(ggplot2, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-85"><a href="#cb128-85"></a><span class="fu">library</span>(gridExtra, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-86"><a href="#cb128-86"></a><span class="fu">library</span>(grDevices, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-87"><a href="#cb128-87"></a><span class="fu">library</span>(cowplot, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-88"><a href="#cb128-88"></a><span class="fu">library</span>(ggforce, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-89"><a href="#cb128-89"></a></span>
<span id="cb128-90"><a href="#cb128-90"></a><span class="co"># For applying tidymodels</span></span>
<span id="cb128-91"><a href="#cb128-91"></a><span class="fu">library</span>(recipes, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-92"><a href="#cb128-92"></a><span class="co"># From GitHub remotes::install_github("tidymodels/parsnip")</span></span>
<span id="cb128-93"><a href="#cb128-93"></a><span class="fu">library</span>(parsnip, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-94"><a href="#cb128-94"></a><span class="fu">library</span>(broom, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-95"><a href="#cb128-95"></a><span class="fu">library</span>(yardstick, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-96"><a href="#cb128-96"></a></span>
<span id="cb128-97"><a href="#cb128-97"></a><span class="co"># For clustering</span></span>
<span id="cb128-98"><a href="#cb128-98"></a><span class="fu">library</span>(proxy, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-99"><a href="#cb128-99"></a><span class="fu">library</span>(factoextra, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-100"><a href="#cb128-100"></a><span class="fu">library</span>(cluster, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-101"><a href="#cb128-101"></a></span>
<span id="cb128-102"><a href="#cb128-102"></a><span class="co"># For tidy clustering</span></span>
<span id="cb128-103"><a href="#cb128-103"></a><span class="co"># From GitHub remotes::install_github("tidymodels/workflows@celery")</span></span>
<span id="cb128-104"><a href="#cb128-104"></a><span class="fu">library</span>(workflows, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-105"><a href="#cb128-105"></a><span class="fu">library</span>(rsample, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-106"><a href="#cb128-106"></a><span class="fu">library</span>(tune, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-107"><a href="#cb128-107"></a><span class="fu">library</span>(dials, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-108"><a href="#cb128-108"></a><span class="fu">library</span>(tidyclust, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-109"><a href="#cb128-109"></a><span class="fu">library</span>(Rfast, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-110"><a href="#cb128-110"></a><span class="fu">library</span>(flexclust, <span class="at">quietly=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-111"><a href="#cb128-111"></a></span>
<span id="cb128-112"><a href="#cb128-112"></a><span class="fu">summary</span>(report<span class="sc">::</span><span class="fu">report</span>(<span class="fu">sessionInfo</span>()))</span>
<span id="cb128-113"><a href="#cb128-113"></a><span class="in">```</span></span>
<span id="cb128-114"><a href="#cb128-114"></a></span>
<span id="cb128-115"><a href="#cb128-115"></a><span class="fu"># Principal Components Analysis</span></span>
<span id="cb128-116"><a href="#cb128-116"></a></span>
<span id="cb128-117"><a href="#cb128-117"></a>The</span>
<span id="cb128-118"><a href="#cb128-118"></a><span class="co">[</span><span class="ot">`USArrests`</span><span class="co">](https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/USArrests.html)</span></span>
<span id="cb128-119"><a href="#cb128-119"></a>data set from the <span class="in">`datasets`</span> package contains statistics, in arrests per</span>
<span id="cb128-120"><a href="#cb128-120"></a>100,000 residents for assault, murder, and rape in each of the 50 US</span>
<span id="cb128-121"><a href="#cb128-121"></a>states in 1973. Also given is the percent of the population living in</span>
<span id="cb128-122"><a href="#cb128-122"></a>urban areas.</span>
<span id="cb128-123"><a href="#cb128-123"></a></span>
<span id="cb128-124"><a href="#cb128-124"></a>| Column Name | Column Description                              |</span>
<span id="cb128-125"><a href="#cb128-125"></a>|-------------|-------------------------------------------------|</span>
<span id="cb128-126"><a href="#cb128-126"></a>| <span class="in">`Murder`</span>    | Number of arrests for murder (per 100,000)      |</span>
<span id="cb128-127"><a href="#cb128-127"></a>| <span class="in">`Assault`</span>   | Number of arrests for assault (per 100,000)     |</span>
<span id="cb128-128"><a href="#cb128-128"></a>| <span class="in">`UrbanPop`</span>  | Percent of the population living in urban areas |</span>
<span id="cb128-129"><a href="#cb128-129"></a>| <span class="in">`Rape`</span>      | Number of arrests for rape (per 100,000)        |</span>
<span id="cb128-130"><a href="#cb128-130"></a></span>
<span id="cb128-131"><a href="#cb128-131"></a>Turn <span class="co">[</span><span class="ot">`USArrests`</span><span class="co">](https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/USArrests.html)</span> into a tibble and move the rownames into a column.</span>
<span id="cb128-132"><a href="#cb128-132"></a></span>
<span id="cb128-133"><a href="#cb128-133"></a><span class="in">```{r get data}</span></span>
<span id="cb128-134"><a href="#cb128-134"></a><span class="co">#| message: false</span></span>
<span id="cb128-135"><a href="#cb128-135"></a></span>
<span id="cb128-136"><a href="#cb128-136"></a>USArrests <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>(datasets<span class="sc">::</span>USArrests,</span>
<span id="cb128-137"><a href="#cb128-137"></a>                             <span class="at">rownames =</span> <span class="st">"state"</span>)</span>
<span id="cb128-138"><a href="#cb128-138"></a></span>
<span id="cb128-139"><a href="#cb128-139"></a>USArrests <span class="sc">%&gt;%</span></span>
<span id="cb128-140"><a href="#cb128-140"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>,</span>
<span id="cb128-141"><a href="#cb128-141"></a>                       <span class="at">filterable =</span> <span class="cn">TRUE</span>)</span>
<span id="cb128-142"><a href="#cb128-142"></a><span class="in">```</span></span>
<span id="cb128-143"><a href="#cb128-143"></a></span>
<span id="cb128-144"><a href="#cb128-144"></a>We create a recipe with <span class="co">[</span><span class="ot">`recipes::recipe`</span><span class="co">](https://recipes.tidymodels.org/reference/recipe.html)</span>,</span>
<span id="cb128-145"><a href="#cb128-145"></a><span class="co">[</span><span class="ot">`recipes::all_numeric_predictors()`</span><span class="co">](https://recipes.tidymodels.org/reference/has_role.html)</span>,</span>
<span id="cb128-146"><a href="#cb128-146"></a><span class="co">[</span><span class="ot">`recipes::step_normalize`</span><span class="co">](https://recipes.tidymodels.org/reference/step_normalize.html)</span></span>
<span id="cb128-147"><a href="#cb128-147"></a>and <span class="co">[</span><span class="ot">`recipes::step_pca`</span><span class="co">](https://recipes.tidymodels.org/reference/step_pca.html)</span></span>
<span id="cb128-148"><a href="#cb128-148"></a></span>
<span id="cb128-149"><a href="#cb128-149"></a>By default, <span class="co">[</span><span class="ot">`recipes::step_pca`</span><span class="co">](https://recipes.tidymodels.org/reference/step_pca.html)</span> uses <span class="co">[</span><span class="ot">`stats::prcomp`</span><span class="co">](https://rdrr.io/r/stats/prcomp.html)</span> with the argument defaults set to <span class="in">`retx = FALSE`</span>, <span class="in">`center = FALSE`</span>, <span class="in">`scale. = FALSE`</span>, and <span class="in">`tol = NULL`</span>.</span>
<span id="cb128-150"><a href="#cb128-150"></a></span>
<span id="cb128-151"><a href="#cb128-151"></a></span>
<span id="cb128-154"><a href="#cb128-154"></a><span class="in">```{r}</span></span>
<span id="cb128-155"><a href="#cb128-155"></a><span class="co">#| message: false</span></span>
<span id="cb128-156"><a href="#cb128-156"></a></span>
<span id="cb128-157"><a href="#cb128-157"></a>pca_recipe <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(<span class="at">formula =</span> <span class="sc">~</span>., </span>
<span id="cb128-158"><a href="#cb128-158"></a>                              <span class="at">data =</span> USArrests) <span class="sc">%&gt;%</span></span>
<span id="cb128-159"><a href="#cb128-159"></a>  recipes<span class="sc">::</span><span class="fu">step_normalize</span>(recipes<span class="sc">::</span><span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb128-160"><a href="#cb128-160"></a>  recipes<span class="sc">::</span><span class="fu">step_pca</span>(recipes<span class="sc">::</span><span class="fu">all_numeric_predictors</span>(),</span>
<span id="cb128-161"><a href="#cb128-161"></a>                    <span class="at">id =</span> <span class="st">"pca"</span>,</span>
<span id="cb128-162"><a href="#cb128-162"></a>                    <span class="at">num_comp =</span> <span class="dv">4</span>)</span>
<span id="cb128-163"><a href="#cb128-163"></a></span>
<span id="cb128-164"><a href="#cb128-164"></a>pca_recipe</span>
<span id="cb128-165"><a href="#cb128-165"></a><span class="in">```</span></span>
<span id="cb128-166"><a href="#cb128-166"></a></span>
<span id="cb128-167"><a href="#cb128-167"></a>Apply</span>
<span id="cb128-168"><a href="#cb128-168"></a><span class="co">[</span><span class="ot">`recipes::prep`</span><span class="co">](https://recipes.tidymodels.org/reference/prep.html)</span></span>
<span id="cb128-169"><a href="#cb128-169"></a>and</span>
<span id="cb128-170"><a href="#cb128-170"></a><span class="co">[</span><span class="ot">`recipes::bake`</span><span class="co">](https://recipes.tidymodels.org/reference/bake.html)</span> to</span>
<span id="cb128-171"><a href="#cb128-171"></a>compute the scores of the principal component analysis.</span>
<span id="cb128-172"><a href="#cb128-172"></a></span>
<span id="cb128-175"><a href="#cb128-175"></a><span class="in">```{r}</span></span>
<span id="cb128-176"><a href="#cb128-176"></a><span class="co">#| message: false</span></span>
<span id="cb128-177"><a href="#cb128-177"></a></span>
<span id="cb128-178"><a href="#cb128-178"></a>pca_estimates <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">prep</span>(<span class="at">x =</span> pca_recipe, <span class="at">training =</span> USArrests)</span>
<span id="cb128-179"><a href="#cb128-179"></a>  </span>
<span id="cb128-180"><a href="#cb128-180"></a>pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb128-181"><a href="#cb128-181"></a>  <span class="fu">summary</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-182"><a href="#cb128-182"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-183"><a href="#cb128-183"></a></span>
<span id="cb128-184"><a href="#cb128-184"></a><span class="in">```</span></span>
<span id="cb128-185"><a href="#cb128-185"></a></span>
<span id="cb128-188"><a href="#cb128-188"></a><span class="in">```{r}</span></span>
<span id="cb128-189"><a href="#cb128-189"></a><span class="co">#| message: false</span></span>
<span id="cb128-190"><a href="#cb128-190"></a></span>
<span id="cb128-191"><a href="#cb128-191"></a>pca_score <span class="ot">&lt;-</span> pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb128-192"><a href="#cb128-192"></a>  recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data =</span> USArrests)</span>
<span id="cb128-193"><a href="#cb128-193"></a>  </span>
<span id="cb128-194"><a href="#cb128-194"></a>  </span>
<span id="cb128-195"><a href="#cb128-195"></a>pca_score <span class="sc">%&gt;%</span>  </span>
<span id="cb128-196"><a href="#cb128-196"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-197"><a href="#cb128-197"></a></span>
<span id="cb128-198"><a href="#cb128-198"></a><span class="in">```</span></span>
<span id="cb128-199"><a href="#cb128-199"></a></span>
<span id="cb128-200"><a href="#cb128-200"></a>We can explore the results of the PCA using the <span class="co">[</span><span class="ot">`recipes::prep`</span><span class="co">](https://recipes.tidymodels.org/reference/prep.html)</span> and</span>
<span id="cb128-201"><a href="#cb128-201"></a><span class="co">[</span><span class="ot">`parsnip::tidy`</span><span class="co">](https://parsnip.tidymodels.org/reference/tidy.model_fit.html)</span>. We can see that pca is done at step number 2</span>
<span id="cb128-202"><a href="#cb128-202"></a></span>
<span id="cb128-205"><a href="#cb128-205"></a><span class="in">```{r}</span></span>
<span id="cb128-206"><a href="#cb128-206"></a><span class="co">#| message: false</span></span>
<span id="cb128-207"><a href="#cb128-207"></a></span>
<span id="cb128-208"><a href="#cb128-208"></a>pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb128-209"><a href="#cb128-209"></a>  parsnip<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-210"><a href="#cb128-210"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-211"><a href="#cb128-211"></a><span class="in">```</span></span>
<span id="cb128-212"><a href="#cb128-212"></a></span>
<span id="cb128-213"><a href="#cb128-213"></a>As such, we extract the pca loadings of the pca step.</span>
<span id="cb128-214"><a href="#cb128-214"></a></span>
<span id="cb128-217"><a href="#cb128-217"></a><span class="in">```{r}</span></span>
<span id="cb128-218"><a href="#cb128-218"></a><span class="co">#| message: false</span></span>
<span id="cb128-219"><a href="#cb128-219"></a></span>
<span id="cb128-220"><a href="#cb128-220"></a>tidied_pca_loadings <span class="ot">&lt;-</span> pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb128-221"><a href="#cb128-221"></a>  parsnip<span class="sc">::</span><span class="fu">tidy</span>(<span class="at">id =</span> <span class="st">"pca"</span>, <span class="at">type =</span> <span class="st">"coef"</span>)</span>
<span id="cb128-222"><a href="#cb128-222"></a></span>
<span id="cb128-223"><a href="#cb128-223"></a></span>
<span id="cb128-224"><a href="#cb128-224"></a>tidied_pca_loadings <span class="sc">%&gt;%</span></span>
<span id="cb128-225"><a href="#cb128-225"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-226"><a href="#cb128-226"></a></span>
<span id="cb128-227"><a href="#cb128-227"></a><span class="in">```</span></span>
<span id="cb128-228"><a href="#cb128-228"></a></span>
<span id="cb128-229"><a href="#cb128-229"></a>We make a visualization to see how the loadings of the four components look like</span>
<span id="cb128-230"><a href="#cb128-230"></a></span>
<span id="cb128-231"><a href="#cb128-231"></a><span class="in">```{r, fig.height = 8}</span></span>
<span id="cb128-232"><a href="#cb128-232"></a><span class="co">#| message: false</span></span>
<span id="cb128-233"><a href="#cb128-233"></a></span>
<span id="cb128-234"><a href="#cb128-234"></a>tidied_pca_loadings <span class="sc">%&gt;%</span></span>
<span id="cb128-235"><a href="#cb128-235"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(.data[[<span class="st">"component"</span>]] <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>, <span class="st">"PC4"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb128-236"><a href="#cb128-236"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">component =</span> forcats<span class="sc">::</span><span class="fu">fct_inorder</span>(.data[[<span class="st">"component"</span>]])) <span class="sc">%&gt;%</span></span>
<span id="cb128-237"><a href="#cb128-237"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> .data[[<span class="st">"value"</span>]], </span>
<span id="cb128-238"><a href="#cb128-238"></a>                                         <span class="at">y =</span> .data[[<span class="st">"terms"</span>]], </span>
<span id="cb128-239"><a href="#cb128-239"></a>                                         <span class="at">fill =</span> .data[[<span class="st">"terms"</span>]])) <span class="sc">+</span></span>
<span id="cb128-240"><a href="#cb128-240"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb128-241"><a href="#cb128-241"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> ggplot2<span class="sc">::</span><span class="fu">vars</span>(.data[[<span class="st">"component"</span>]])) <span class="sc">+</span></span>
<span id="cb128-242"><a href="#cb128-242"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb128-243"><a href="#cb128-243"></a></span>
<span id="cb128-244"><a href="#cb128-244"></a><span class="in">```</span></span>
<span id="cb128-245"><a href="#cb128-245"></a></span>
<span id="cb128-246"><a href="#cb128-246"></a>Let us take a closer look at the four variables that contribute to the</span>
<span id="cb128-247"><a href="#cb128-247"></a>four components  </span>
<span id="cb128-248"><a href="#cb128-248"></a></span>
<span id="cb128-251"><a href="#cb128-251"></a><span class="in">```{r}</span></span>
<span id="cb128-252"><a href="#cb128-252"></a><span class="co">#| message: false</span></span>
<span id="cb128-253"><a href="#cb128-253"></a></span>
<span id="cb128-254"><a href="#cb128-254"></a>tidied_pca_loadings <span class="sc">%&gt;%</span></span>
<span id="cb128-255"><a href="#cb128-255"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(.data[[<span class="st">"component"</span>]] <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>, <span class="st">"PC4"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb128-256"><a href="#cb128-256"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(.data[[<span class="st">"component"</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb128-257"><a href="#cb128-257"></a>  dplyr<span class="sc">::</span><span class="fu">top_n</span>(<span class="dv">4</span>, <span class="fu">abs</span>(.data[[<span class="st">"value"</span>]])) <span class="sc">%&gt;%</span></span>
<span id="cb128-258"><a href="#cb128-258"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-259"><a href="#cb128-259"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb128-260"><a href="#cb128-260"></a>    <span class="at">terms =</span> tidytext<span class="sc">::</span><span class="fu">reorder_within</span>(<span class="at">x =</span> .data[[<span class="st">"terms"</span>]], </span>
<span id="cb128-261"><a href="#cb128-261"></a>                                     <span class="at">by =</span> <span class="fu">abs</span>(.data[[<span class="st">"value"</span>]]), </span>
<span id="cb128-262"><a href="#cb128-262"></a>                                     <span class="at">within =</span> .data[[<span class="st">"component"</span>]])</span>
<span id="cb128-263"><a href="#cb128-263"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb128-264"><a href="#cb128-264"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">abs</span>(.data[[<span class="st">"value"</span>]]), </span>
<span id="cb128-265"><a href="#cb128-265"></a>                                         <span class="at">y =</span> .data[[<span class="st">"terms"</span>]], </span>
<span id="cb128-266"><a href="#cb128-266"></a>                                         <span class="at">fill =</span> .data[[<span class="st">"value"</span>]] <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb128-267"><a href="#cb128-267"></a>                  ) <span class="sc">+</span></span>
<span id="cb128-268"><a href="#cb128-268"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb128-269"><a href="#cb128-269"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> ggplot2<span class="sc">::</span><span class="fu">vars</span>(.data[[<span class="st">"component"</span>]]), </span>
<span id="cb128-270"><a href="#cb128-270"></a>                      <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb128-271"><a href="#cb128-271"></a>  tidytext<span class="sc">::</span><span class="fu">scale_y_reordered</span>() <span class="sc">+</span></span>
<span id="cb128-272"><a href="#cb128-272"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb128-273"><a href="#cb128-273"></a>    <span class="at">x =</span> <span class="st">"Absolute value of contribution to PCA component"</span>,</span>
<span id="cb128-274"><a href="#cb128-274"></a>    <span class="at">y =</span> <span class="cn">NULL</span>, </span>
<span id="cb128-275"><a href="#cb128-275"></a>    <span class="at">fill =</span> <span class="st">"Positive?"</span></span>
<span id="cb128-276"><a href="#cb128-276"></a>  )</span>
<span id="cb128-277"><a href="#cb128-277"></a></span>
<span id="cb128-278"><a href="#cb128-278"></a><span class="in">```</span></span>
<span id="cb128-279"><a href="#cb128-279"></a></span>
<span id="cb128-280"><a href="#cb128-280"></a>How much variation are we capturing for each component?</span>
<span id="cb128-281"><a href="#cb128-281"></a></span>
<span id="cb128-282"><a href="#cb128-282"></a>Here is how we can see the variance statistics but it is in a long form</span>
<span id="cb128-283"><a href="#cb128-283"></a></span>
<span id="cb128-286"><a href="#cb128-286"></a><span class="in">```{r}</span></span>
<span id="cb128-287"><a href="#cb128-287"></a><span class="co">#| message: false</span></span>
<span id="cb128-288"><a href="#cb128-288"></a><span class="co">#| </span></span>
<span id="cb128-289"><a href="#cb128-289"></a>tidied_pca_variance <span class="ot">&lt;-</span> pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb128-290"><a href="#cb128-290"></a>  parsnip<span class="sc">::</span><span class="fu">tidy</span>(<span class="at">id =</span> <span class="st">"pca"</span>, <span class="at">type =</span> <span class="st">"variance"</span>)</span>
<span id="cb128-291"><a href="#cb128-291"></a></span>
<span id="cb128-292"><a href="#cb128-292"></a>tidied_pca_variance <span class="sc">%&gt;%</span> </span>
<span id="cb128-293"><a href="#cb128-293"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-294"><a href="#cb128-294"></a><span class="in">```</span></span>
<span id="cb128-295"><a href="#cb128-295"></a></span>
<span id="cb128-296"><a href="#cb128-296"></a>Here is how we can see the variance statistics in its wide form</span>
<span id="cb128-297"><a href="#cb128-297"></a></span>
<span id="cb128-300"><a href="#cb128-300"></a><span class="in">```{r}</span></span>
<span id="cb128-301"><a href="#cb128-301"></a><span class="co">#| message: false</span></span>
<span id="cb128-302"><a href="#cb128-302"></a><span class="co">#| </span></span>
<span id="cb128-303"><a href="#cb128-303"></a>tidied_pca_variance <span class="sc">%&gt;%</span> </span>
<span id="cb128-304"><a href="#cb128-304"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> .data[[<span class="st">"component"</span>]], </span>
<span id="cb128-305"><a href="#cb128-305"></a>                     <span class="at">values_from =</span> .data[[<span class="st">"value"</span>]], </span>
<span id="cb128-306"><a href="#cb128-306"></a>                     <span class="at">names_prefix =</span> <span class="st">"PC"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-307"><a href="#cb128-307"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>dplyr<span class="sc">::</span><span class="fu">all_of</span>(<span class="st">"id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-308"><a href="#cb128-308"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-309"><a href="#cb128-309"></a><span class="in">```</span></span>
<span id="cb128-310"><a href="#cb128-310"></a></span>
<span id="cb128-311"><a href="#cb128-311"></a>Here is a simple plot to show the variance captured for each component</span>
<span id="cb128-312"><a href="#cb128-312"></a></span>
<span id="cb128-315"><a href="#cb128-315"></a><span class="in">```{r}</span></span>
<span id="cb128-316"><a href="#cb128-316"></a><span class="co">#| message: false</span></span>
<span id="cb128-317"><a href="#cb128-317"></a><span class="co">#| </span></span>
<span id="cb128-318"><a href="#cb128-318"></a><span class="co"># Get the variance</span></span>
<span id="cb128-319"><a href="#cb128-319"></a>percent_variation <span class="ot">&lt;-</span> tidied_pca_variance <span class="sc">%&gt;%</span></span>
<span id="cb128-320"><a href="#cb128-320"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(.data[[<span class="st">"terms"</span>]] <span class="sc">==</span> <span class="st">"percent variance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-321"><a href="#cb128-321"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(.data[[<span class="st">"value"</span>]])</span>
<span id="cb128-322"><a href="#cb128-322"></a></span>
<span id="cb128-323"><a href="#cb128-323"></a>percent_variation <span class="ot">&lt;-</span> percent_variation<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb128-324"><a href="#cb128-324"></a></span>
<span id="cb128-325"><a href="#cb128-325"></a><span class="co"># I use [1:4] to select the first four components</span></span>
<span id="cb128-326"><a href="#cb128-326"></a>dplyr<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">component =</span> <span class="fu">unique</span>(tidied_pca_loadings<span class="sc">$</span>component)[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], </span>
<span id="cb128-327"><a href="#cb128-327"></a>              <span class="at">percent_var =</span> percent_variation[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb128-328"><a href="#cb128-328"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">component =</span> forcats<span class="sc">::</span><span class="fu">fct_inorder</span>(.data[[<span class="st">"component"</span>]])) <span class="sc">%&gt;%</span></span>
<span id="cb128-329"><a href="#cb128-329"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> .data[[<span class="st">"component"</span>]], </span>
<span id="cb128-330"><a href="#cb128-330"></a>                                         <span class="at">y =</span> .data[[<span class="st">"percent_var"</span>]])) <span class="sc">+</span></span>
<span id="cb128-331"><a href="#cb128-331"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb128-332"><a href="#cb128-332"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb128-333"><a href="#cb128-333"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb128-334"><a href="#cb128-334"></a>      <span class="at">label =</span> <span class="fu">paste</span>(<span class="fu">round</span>(.data[[<span class="st">"percent_var"</span>]] <span class="sc">*</span> <span class="dv">100</span>,<span class="dv">0</span>),<span class="st">"%"</span>)),</span>
<span id="cb128-335"><a href="#cb128-335"></a>      <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb128-336"><a href="#cb128-336"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb128-337"><a href="#cb128-337"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.title.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb128-338"><a href="#cb128-338"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, </span>
<span id="cb128-339"><a href="#cb128-339"></a>                <span class="at">y =</span> <span class="st">"Percent variance </span><span class="sc">\n</span><span class="st">explained by each </span><span class="sc">\n</span><span class="st">PCA component"</span>)</span>
<span id="cb128-340"><a href="#cb128-340"></a></span>
<span id="cb128-341"><a href="#cb128-341"></a><span class="in">```</span></span>
<span id="cb128-342"><a href="#cb128-342"></a></span>
<span id="cb128-343"><a href="#cb128-343"></a>Here is a PCA Biplot of PC1 and PC2</span>
<span id="cb128-344"><a href="#cb128-344"></a></span>
<span id="cb128-347"><a href="#cb128-347"></a><span class="in">```{r}</span></span>
<span id="cb128-348"><a href="#cb128-348"></a><span class="co">#| message: false</span></span>
<span id="cb128-349"><a href="#cb128-349"></a></span>
<span id="cb128-350"><a href="#cb128-350"></a>filtered_loadings <span class="ot">&lt;-</span> tidied_pca_loadings <span class="sc">%&gt;%</span></span>
<span id="cb128-351"><a href="#cb128-351"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> .data[[<span class="st">"component"</span>]], </span>
<span id="cb128-352"><a href="#cb128-352"></a>                     <span class="at">values_from =</span> .data[[<span class="st">"value"</span>]])</span>
<span id="cb128-353"><a href="#cb128-353"></a></span>
<span id="cb128-354"><a href="#cb128-354"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb128-355"><a href="#cb128-355"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data =</span> pca_score,</span>
<span id="cb128-356"><a href="#cb128-356"></a>                      <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> .data[[<span class="st">"PC1"</span>]], </span>
<span id="cb128-357"><a href="#cb128-357"></a>                                             <span class="at">y =</span> .data[[<span class="st">"PC2"</span>]]),</span>
<span id="cb128-358"><a href="#cb128-358"></a>                                             <span class="at">size =</span> <span class="dv">2</span>, </span>
<span id="cb128-359"><a href="#cb128-359"></a>                      <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb128-360"><a href="#cb128-360"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(<span class="at">data =</span> pca_score,</span>
<span id="cb128-361"><a href="#cb128-361"></a>                     <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> .data[[<span class="st">"PC1"</span>]],</span>
<span id="cb128-362"><a href="#cb128-362"></a>                                            <span class="at">y =</span> .data[[<span class="st">"PC2"</span>]],</span>
<span id="cb128-363"><a href="#cb128-363"></a>                                            <span class="at">label =</span> .data[[<span class="st">"state"</span>]]),</span>
<span id="cb128-364"><a href="#cb128-364"></a>                     <span class="at">check_overlap =</span> <span class="cn">TRUE</span>,</span>
<span id="cb128-365"><a href="#cb128-365"></a>                     <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb128-366"><a href="#cb128-366"></a>                     <span class="at">hjust =</span> <span class="st">"inward"</span>) <span class="sc">+</span></span>
<span id="cb128-367"><a href="#cb128-367"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_segment</span>(<span class="at">data =</span> filtered_loadings,</span>
<span id="cb128-368"><a href="#cb128-368"></a>                        <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, </span>
<span id="cb128-369"><a href="#cb128-369"></a>                                               <span class="at">y =</span> <span class="dv">0</span>,</span>
<span id="cb128-370"><a href="#cb128-370"></a>                                               <span class="at">xend =</span> .data[[<span class="st">"PC1"</span>]] <span class="sc">*</span> <span class="fl">2.5</span>,</span>
<span id="cb128-371"><a href="#cb128-371"></a>                                               <span class="at">yend =</span> .data[[<span class="st">"PC2"</span>]] <span class="sc">*</span> <span class="fl">2.5</span></span>
<span id="cb128-372"><a href="#cb128-372"></a>                                               ),</span>
<span id="cb128-373"><a href="#cb128-373"></a>                        <span class="at">arrow =</span> ggplot2<span class="sc">::</span><span class="fu">arrow</span>(<span class="at">length =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="at">x =</span> <span class="fl">0.5</span>,</span>
<span id="cb128-374"><a href="#cb128-374"></a>                                                                   <span class="at">units =</span> <span class="st">"picas"</span>)),</span>
<span id="cb128-375"><a href="#cb128-375"></a>                        <span class="at">color =</span> <span class="st">"blue"</span></span>
<span id="cb128-376"><a href="#cb128-376"></a>                        ) <span class="sc">+</span></span>
<span id="cb128-377"><a href="#cb128-377"></a>  ggplot2<span class="sc">::</span><span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb128-378"><a href="#cb128-378"></a>                    <span class="at">x =</span> filtered_loadings[[<span class="st">"PC1"</span>]] <span class="sc">*</span> <span class="fl">2.7</span>,</span>
<span id="cb128-379"><a href="#cb128-379"></a>                    <span class="at">y =</span> filtered_loadings[[<span class="st">"PC2"</span>]] <span class="sc">*</span> <span class="fl">2.7</span>,</span>
<span id="cb128-380"><a href="#cb128-380"></a>                    <span class="at">label =</span> filtered_loadings[[<span class="st">"terms"</span>]]) <span class="sc">+</span></span>
<span id="cb128-381"><a href="#cb128-381"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_fixed</span>(<span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span></span>
<span id="cb128-382"><a href="#cb128-382"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>()</span>
<span id="cb128-383"><a href="#cb128-383"></a></span>
<span id="cb128-384"><a href="#cb128-384"></a><span class="in">```</span></span>
<span id="cb128-385"><a href="#cb128-385"></a></span>
<span id="cb128-386"><a href="#cb128-386"></a><span class="fu"># Matrix Completion</span></span>
<span id="cb128-387"><a href="#cb128-387"></a></span>
<span id="cb128-388"><a href="#cb128-388"></a><span class="fu">## Initialisation</span></span>
<span id="cb128-389"><a href="#cb128-389"></a></span>
<span id="cb128-392"><a href="#cb128-392"></a><span class="in">```{r}</span></span>
<span id="cb128-393"><a href="#cb128-393"></a><span class="co">#| message: false</span></span>
<span id="cb128-394"><a href="#cb128-394"></a></span>
<span id="cb128-395"><a href="#cb128-395"></a>missing_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb128-396"><a href="#cb128-396"></a>  <span class="at">SBP =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="cn">NA</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="cn">NA</span>),</span>
<span id="cb128-397"><a href="#cb128-397"></a>  <span class="at">DBP =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="cn">NA</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb128-398"><a href="#cb128-398"></a>)</span>
<span id="cb128-399"><a href="#cb128-399"></a></span>
<span id="cb128-400"><a href="#cb128-400"></a>colour_missing_cells <span class="ot">&lt;-</span> <span class="cf">function</span>(value, index, name) {</span>
<span id="cb128-401"><a href="#cb128-401"></a>   missing_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">is.na</span>(missing_data[[name]]))</span>
<span id="cb128-402"><a href="#cb128-402"></a>   <span class="cf">if</span> (index <span class="sc">%in%</span> missing_indices) {</span>
<span id="cb128-403"><a href="#cb128-403"></a>     <span class="fu">list</span>(<span class="at">background =</span> <span class="st">"#aaf0f8"</span>)</span>
<span id="cb128-404"><a href="#cb128-404"></a>   }</span>
<span id="cb128-405"><a href="#cb128-405"></a> }</span>
<span id="cb128-406"><a href="#cb128-406"></a></span>
<span id="cb128-407"><a href="#cb128-407"></a>xbar <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(missing_data , <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb128-408"><a href="#cb128-408"></a></span>
<span id="cb128-409"><a href="#cb128-409"></a>initialisation_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb128-410"><a href="#cb128-410"></a>  <span class="at">SBP =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb128-411"><a href="#cb128-411"></a>  <span class="at">DBP =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb128-412"><a href="#cb128-412"></a>)</span>
<span id="cb128-413"><a href="#cb128-413"></a></span>
<span id="cb128-414"><a href="#cb128-414"></a>thresh <span class="ot">&lt;-</span> <span class="fl">1e-2</span></span>
<span id="cb128-415"><a href="#cb128-415"></a>ismiss <span class="ot">&lt;-</span> <span class="fu">is.na</span>(missing_data)</span>
<span id="cb128-416"><a href="#cb128-416"></a></span>
<span id="cb128-417"><a href="#cb128-417"></a></span>
<span id="cb128-418"><a href="#cb128-418"></a><span class="in">```</span></span>
<span id="cb128-419"><a href="#cb128-419"></a></span>
<span id="cb128-420"><a href="#cb128-420"></a><span class="fu">## Functions</span></span>
<span id="cb128-421"><a href="#cb128-421"></a></span>
<span id="cb128-422"><a href="#cb128-422"></a>These are the implementations for calculating step 2a and 2b for Algorithm 12.1</span>
<span id="cb128-423"><a href="#cb128-423"></a></span>
<span id="cb128-424"><a href="#cb128-424"></a>::: {.panel-tabset}</span>
<span id="cb128-425"><a href="#cb128-425"></a></span>
<span id="cb128-426"><a href="#cb128-426"></a><span class="fu">### BaseR PCA</span></span>
<span id="cb128-427"><a href="#cb128-427"></a></span>
<span id="cb128-430"><a href="#cb128-430"></a><span class="in">```{r}</span></span>
<span id="cb128-431"><a href="#cb128-431"></a><span class="co">#| message: false</span></span>
<span id="cb128-432"><a href="#cb128-432"></a></span>
<span id="cb128-433"><a href="#cb128-433"></a>fit_pca <span class="ot">&lt;-</span> <span class="cf">function</span>(input_data, <span class="at">num_comp =</span> <span class="dv">1</span>) {</span>
<span id="cb128-434"><a href="#cb128-434"></a>  data_pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(input_data, <span class="at">center =</span> <span class="cn">FALSE</span>)</span>
<span id="cb128-435"><a href="#cb128-435"></a>  </span>
<span id="cb128-436"><a href="#cb128-436"></a>  pca_loadings <span class="ot">&lt;-</span> data_pca<span class="sc">$</span>rotation</span>
<span id="cb128-437"><a href="#cb128-437"></a>  pca_loadings_inverse <span class="ot">&lt;-</span> <span class="fu">solve</span>(pca_loadings)[<span class="dv">1</span><span class="sc">:</span>num_comp,, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb128-438"><a href="#cb128-438"></a>  pca_scores <span class="ot">&lt;-</span> data_pca<span class="sc">$</span>x[,<span class="dv">1</span><span class="sc">:</span>num_comp, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb128-439"><a href="#cb128-439"></a>  </span>
<span id="cb128-440"><a href="#cb128-440"></a>  estimated_data <span class="ot">&lt;-</span> pca_scores <span class="sc">%*%</span> pca_loadings_inverse</span>
<span id="cb128-441"><a href="#cb128-441"></a>  <span class="fu">return</span>(estimated_data)</span>
<span id="cb128-442"><a href="#cb128-442"></a></span>
<span id="cb128-443"><a href="#cb128-443"></a>}</span>
<span id="cb128-444"><a href="#cb128-444"></a></span>
<span id="cb128-445"><a href="#cb128-445"></a><span class="in">```</span></span>
<span id="cb128-446"><a href="#cb128-446"></a></span>
<span id="cb128-447"><a href="#cb128-447"></a><span class="fu">### BaseR SVD</span></span>
<span id="cb128-448"><a href="#cb128-448"></a></span>
<span id="cb128-451"><a href="#cb128-451"></a><span class="in">```{r}</span></span>
<span id="cb128-452"><a href="#cb128-452"></a><span class="co">#| message: false</span></span>
<span id="cb128-453"><a href="#cb128-453"></a></span>
<span id="cb128-454"><a href="#cb128-454"></a>fit_svd <span class="ot">&lt;-</span> <span class="cf">function</span>(input_data, <span class="at">num_comp =</span> <span class="dv">1</span>) {</span>
<span id="cb128-455"><a href="#cb128-455"></a>  svd_object <span class="ot">&lt;-</span><span class="fu">svd</span>(input_data)</span>
<span id="cb128-456"><a href="#cb128-456"></a>  </span>
<span id="cb128-457"><a href="#cb128-457"></a>  pca_loadings <span class="ot">&lt;-</span> svd_object<span class="sc">$</span>v[, <span class="dv">1</span><span class="sc">:</span>num_comp, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb128-458"><a href="#cb128-458"></a>  pca_loadings_inverse <span class="ot">&lt;-</span> <span class="fu">t</span>(pca_loadings)</span>
<span id="cb128-459"><a href="#cb128-459"></a>  </span>
<span id="cb128-460"><a href="#cb128-460"></a>  pca_scores <span class="ot">&lt;-</span> (svd_object<span class="sc">$</span>u <span class="sc">%*%</span> <span class="fu">diag</span>(svd_object<span class="sc">$</span>d))[, <span class="dv">1</span><span class="sc">:</span>num_comp, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb128-461"><a href="#cb128-461"></a>  </span>
<span id="cb128-462"><a href="#cb128-462"></a>  estimated_data <span class="ot">&lt;-</span> pca_scores <span class="sc">%*%</span> pca_loadings_inverse</span>
<span id="cb128-463"><a href="#cb128-463"></a>  </span>
<span id="cb128-464"><a href="#cb128-464"></a>  <span class="fu">return</span>(estimated_data)</span>
<span id="cb128-465"><a href="#cb128-465"></a></span>
<span id="cb128-466"><a href="#cb128-466"></a>}</span>
<span id="cb128-467"><a href="#cb128-467"></a></span>
<span id="cb128-468"><a href="#cb128-468"></a><span class="in">```</span></span>
<span id="cb128-469"><a href="#cb128-469"></a></span>
<span id="cb128-470"><a href="#cb128-470"></a><span class="fu">### Tidymodels</span></span>
<span id="cb128-471"><a href="#cb128-471"></a></span>
<span id="cb128-474"><a href="#cb128-474"></a><span class="in">```{r}</span></span>
<span id="cb128-475"><a href="#cb128-475"></a><span class="co">#| message: false</span></span>
<span id="cb128-476"><a href="#cb128-476"></a></span>
<span id="cb128-477"><a href="#cb128-477"></a>fit_pca_tidy <span class="ot">&lt;-</span> <span class="cf">function</span>(input_data, <span class="at">num_comp =</span> <span class="dv">1</span>) {</span>
<span id="cb128-478"><a href="#cb128-478"></a>  </span>
<span id="cb128-479"><a href="#cb128-479"></a>  pca_recipe <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(<span class="at">formula =</span> <span class="sc">~</span>.,</span>
<span id="cb128-480"><a href="#cb128-480"></a>                                <span class="at">data =</span> input_data) <span class="sc">%&gt;%</span></span>
<span id="cb128-481"><a href="#cb128-481"></a>    recipes<span class="sc">::</span><span class="fu">step_pca</span>(recipes<span class="sc">::</span><span class="fu">all_numeric_predictors</span>(),</span>
<span id="cb128-482"><a href="#cb128-482"></a>                      <span class="at">id =</span> <span class="st">"pca"</span>)</span>
<span id="cb128-483"><a href="#cb128-483"></a>  </span>
<span id="cb128-484"><a href="#cb128-484"></a>  </span>
<span id="cb128-485"><a href="#cb128-485"></a>  pca_estimates <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">prep</span>(<span class="at">x =</span> pca_recipe, <span class="at">training =</span> input_data)</span>
<span id="cb128-486"><a href="#cb128-486"></a>  </span>
<span id="cb128-487"><a href="#cb128-487"></a>  pca_scores <span class="ot">&lt;-</span> pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb128-488"><a href="#cb128-488"></a>    recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data =</span> input_data) <span class="sc">%&gt;%</span></span>
<span id="cb128-489"><a href="#cb128-489"></a>    <span class="fu">as.matrix</span>()</span>
<span id="cb128-490"><a href="#cb128-490"></a>  pca_scores <span class="ot">&lt;-</span> pca_scores[,<span class="dv">1</span><span class="sc">:</span>num_comp,drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb128-491"><a href="#cb128-491"></a>  </span>
<span id="cb128-492"><a href="#cb128-492"></a>  </span>
<span id="cb128-493"><a href="#cb128-493"></a>  pca_loadings <span class="ot">&lt;-</span> pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb128-494"><a href="#cb128-494"></a>    parsnip<span class="sc">::</span><span class="fu">tidy</span>(<span class="at">id =</span> <span class="st">"pca"</span>, <span class="at">type =</span> <span class="st">"coef"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-495"><a href="#cb128-495"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> .data[[<span class="st">"component"</span>]],</span>
<span id="cb128-496"><a href="#cb128-496"></a>                       <span class="at">values_from =</span> .data[[<span class="st">"value"</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb128-497"><a href="#cb128-497"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"terms"</span>,<span class="st">"id"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb128-498"><a href="#cb128-498"></a>    <span class="fu">as.matrix</span>()</span>
<span id="cb128-499"><a href="#cb128-499"></a>  </span>
<span id="cb128-500"><a href="#cb128-500"></a>  pca_loadings_inverse <span class="ot">&lt;-</span> <span class="fu">solve</span>(pca_loadings)[<span class="dv">1</span><span class="sc">:</span>num_comp,,drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb128-501"><a href="#cb128-501"></a>  </span>
<span id="cb128-502"><a href="#cb128-502"></a>  estimated_data <span class="ot">&lt;-</span> pca_scores <span class="sc">%*%</span> pca_loadings_inverse</span>
<span id="cb128-503"><a href="#cb128-503"></a>  </span>
<span id="cb128-504"><a href="#cb128-504"></a>  <span class="fu">return</span>(estimated_data)</span>
<span id="cb128-505"><a href="#cb128-505"></a>  </span>
<span id="cb128-506"><a href="#cb128-506"></a>}</span>
<span id="cb128-507"><a href="#cb128-507"></a></span>
<span id="cb128-508"><a href="#cb128-508"></a><span class="in">```</span></span>
<span id="cb128-509"><a href="#cb128-509"></a></span>
<span id="cb128-510"><a href="#cb128-510"></a>:::</span>
<span id="cb128-511"><a href="#cb128-511"></a></span>
<span id="cb128-512"><a href="#cb128-512"></a><span class="fu">## Iteration 1</span></span>
<span id="cb128-513"><a href="#cb128-513"></a></span>
<span id="cb128-514"><a href="#cb128-514"></a>::: {.panel-tabset}</span>
<span id="cb128-515"><a href="#cb128-515"></a></span>
<span id="cb128-516"><a href="#cb128-516"></a><span class="fu">### BaseR PCA</span></span>
<span id="cb128-517"><a href="#cb128-517"></a></span>
<span id="cb128-520"><a href="#cb128-520"></a><span class="in">```{r}</span></span>
<span id="cb128-521"><a href="#cb128-521"></a><span class="co">#| message: false</span></span>
<span id="cb128-522"><a href="#cb128-522"></a></span>
<span id="cb128-523"><a href="#cb128-523"></a>initialisation_data_pca <span class="ot">&lt;-</span> initialisation_data</span>
<span id="cb128-524"><a href="#cb128-524"></a></span>
<span id="cb128-525"><a href="#cb128-525"></a><span class="co"># Step 2(a)</span></span>
<span id="cb128-526"><a href="#cb128-526"></a>Xapp <span class="ot">&lt;-</span> <span class="fu">fit_pca</span>(initialisation_data_pca , <span class="at">num_comp =</span> <span class="dv">1</span>)</span>
<span id="cb128-527"><a href="#cb128-527"></a></span>
<span id="cb128-528"><a href="#cb128-528"></a><span class="co"># Step 2(b)</span></span>
<span id="cb128-529"><a href="#cb128-529"></a>initialisation_data_pca[ismiss] <span class="ot">&lt;-</span> Xapp[ismiss]</span>
<span id="cb128-530"><a href="#cb128-530"></a></span>
<span id="cb128-531"><a href="#cb128-531"></a><span class="co"># Step 2(c)</span></span>
<span id="cb128-532"><a href="#cb128-532"></a>mss_old_pca <span class="ot">&lt;-</span> <span class="fu">mean</span>(((missing_data <span class="sc">-</span> Xapp)[<span class="sc">!</span>ismiss])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb128-533"><a href="#cb128-533"></a></span>
<span id="cb128-534"><a href="#cb128-534"></a>initialisation_data_pca <span class="sc">%&gt;%</span>   </span>
<span id="cb128-535"><a href="#cb128-535"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">6</span>)</span>
<span id="cb128-536"><a href="#cb128-536"></a></span>
<span id="cb128-537"><a href="#cb128-537"></a>mss_old_pca</span>
<span id="cb128-538"><a href="#cb128-538"></a><span class="in">```</span></span>
<span id="cb128-539"><a href="#cb128-539"></a></span>
<span id="cb128-540"><a href="#cb128-540"></a><span class="fu">### BaseR SVD</span></span>
<span id="cb128-541"><a href="#cb128-541"></a></span>
<span id="cb128-544"><a href="#cb128-544"></a><span class="in">```{r}</span></span>
<span id="cb128-545"><a href="#cb128-545"></a><span class="co">#| message: false</span></span>
<span id="cb128-546"><a href="#cb128-546"></a></span>
<span id="cb128-547"><a href="#cb128-547"></a>initialisation_data_svd <span class="ot">&lt;-</span> initialisation_data</span>
<span id="cb128-548"><a href="#cb128-548"></a></span>
<span id="cb128-549"><a href="#cb128-549"></a><span class="co"># Step 2(a)</span></span>
<span id="cb128-550"><a href="#cb128-550"></a>Xapp <span class="ot">&lt;-</span> <span class="fu">fit_svd</span>(initialisation_data_svd , <span class="at">num_comp =</span> <span class="dv">1</span>)</span>
<span id="cb128-551"><a href="#cb128-551"></a></span>
<span id="cb128-552"><a href="#cb128-552"></a><span class="co"># Step 2(b)</span></span>
<span id="cb128-553"><a href="#cb128-553"></a>initialisation_data_svd[ismiss] <span class="ot">&lt;-</span> Xapp[ismiss]</span>
<span id="cb128-554"><a href="#cb128-554"></a></span>
<span id="cb128-555"><a href="#cb128-555"></a><span class="co"># Step 2(c)</span></span>
<span id="cb128-556"><a href="#cb128-556"></a>mss_old_svd <span class="ot">&lt;-</span> <span class="fu">mean</span>(((missing_data <span class="sc">-</span> Xapp)[<span class="sc">!</span>ismiss])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb128-557"><a href="#cb128-557"></a></span>
<span id="cb128-558"><a href="#cb128-558"></a>initialisation_data_svd <span class="sc">%&gt;%</span>   </span>
<span id="cb128-559"><a href="#cb128-559"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">6</span>)</span>
<span id="cb128-560"><a href="#cb128-560"></a></span>
<span id="cb128-561"><a href="#cb128-561"></a>mss_old_svd</span>
<span id="cb128-562"><a href="#cb128-562"></a><span class="in">```</span></span>
<span id="cb128-563"><a href="#cb128-563"></a></span>
<span id="cb128-564"><a href="#cb128-564"></a><span class="fu">### Tidymodels</span></span>
<span id="cb128-565"><a href="#cb128-565"></a></span>
<span id="cb128-568"><a href="#cb128-568"></a><span class="in">```{r}</span></span>
<span id="cb128-569"><a href="#cb128-569"></a><span class="co">#| message: false</span></span>
<span id="cb128-570"><a href="#cb128-570"></a></span>
<span id="cb128-571"><a href="#cb128-571"></a>initialisation_data_tidymodels <span class="ot">&lt;-</span> initialisation_data</span>
<span id="cb128-572"><a href="#cb128-572"></a></span>
<span id="cb128-573"><a href="#cb128-573"></a><span class="co"># Step 2(a)</span></span>
<span id="cb128-574"><a href="#cb128-574"></a>Xapp <span class="ot">&lt;-</span> <span class="fu">fit_pca_tidy</span>(initialisation_data_tidymodels , <span class="at">num_comp =</span> <span class="dv">1</span>)</span>
<span id="cb128-575"><a href="#cb128-575"></a></span>
<span id="cb128-576"><a href="#cb128-576"></a><span class="co"># Step 2(b)</span></span>
<span id="cb128-577"><a href="#cb128-577"></a>initialisation_data_tidymodels[ismiss] <span class="ot">&lt;-</span> Xapp[ismiss]</span>
<span id="cb128-578"><a href="#cb128-578"></a></span>
<span id="cb128-579"><a href="#cb128-579"></a><span class="co"># Step 2(c)</span></span>
<span id="cb128-580"><a href="#cb128-580"></a>mss_old_tidymodels <span class="ot">&lt;-</span> <span class="fu">mean</span>(((missing_data <span class="sc">-</span> Xapp)[<span class="sc">!</span>ismiss])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb128-581"><a href="#cb128-581"></a></span>
<span id="cb128-582"><a href="#cb128-582"></a>initialisation_data_tidymodels <span class="sc">%&gt;%</span>   </span>
<span id="cb128-583"><a href="#cb128-583"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">6</span>,</span>
<span id="cb128-584"><a href="#cb128-584"></a>    <span class="at">columns =</span> <span class="fu">list</span>(</span>
<span id="cb128-585"><a href="#cb128-585"></a>      <span class="at">SBP =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(<span class="at">format =</span> reactable<span class="sc">::</span><span class="fu">colFormat</span>(<span class="at">digits =</span> <span class="dv">2</span>)),</span>
<span id="cb128-586"><a href="#cb128-586"></a>      <span class="at">DBP =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(<span class="at">format =</span> reactable<span class="sc">::</span><span class="fu">colFormat</span>(<span class="at">digits =</span> <span class="dv">2</span>))</span>
<span id="cb128-587"><a href="#cb128-587"></a>    ),</span>
<span id="cb128-588"><a href="#cb128-588"></a>    <span class="at">defaultColDef =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(</span>
<span id="cb128-589"><a href="#cb128-589"></a>      <span class="at">style =</span> colour_missing_cells</span>
<span id="cb128-590"><a href="#cb128-590"></a>    ))</span>
<span id="cb128-591"><a href="#cb128-591"></a></span>
<span id="cb128-592"><a href="#cb128-592"></a>mss_old_tidymodels</span>
<span id="cb128-593"><a href="#cb128-593"></a><span class="in">```</span></span>
<span id="cb128-594"><a href="#cb128-594"></a></span>
<span id="cb128-595"><a href="#cb128-595"></a>:::</span>
<span id="cb128-596"><a href="#cb128-596"></a></span>
<span id="cb128-597"><a href="#cb128-597"></a><span class="fu">## The rest of the iteration</span></span>
<span id="cb128-598"><a href="#cb128-598"></a></span>
<span id="cb128-599"><a href="#cb128-599"></a>::: {.panel-tabset}</span>
<span id="cb128-600"><a href="#cb128-600"></a></span>
<span id="cb128-601"><a href="#cb128-601"></a><span class="fu">### BaseR PCA</span></span>
<span id="cb128-602"><a href="#cb128-602"></a></span>
<span id="cb128-603"><a href="#cb128-603"></a><span class="in">```{r, max.height = '500px'}</span></span>
<span id="cb128-604"><a href="#cb128-604"></a><span class="co">#| message: false</span></span>
<span id="cb128-605"><a href="#cb128-605"></a></span>
<span id="cb128-606"><a href="#cb128-606"></a>iter <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb128-607"><a href="#cb128-607"></a>rel_err <span class="ot">&lt;-</span> mss_old_pca</span>
<span id="cb128-608"><a href="#cb128-608"></a>thresh <span class="ot">&lt;-</span> <span class="fl">1e-2</span></span>
<span id="cb128-609"><a href="#cb128-609"></a><span class="cf">while</span>(rel_err <span class="sc">&gt;</span> thresh) {</span>
<span id="cb128-610"><a href="#cb128-610"></a>  iter <span class="ot">&lt;-</span> iter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb128-611"><a href="#cb128-611"></a>  </span>
<span id="cb128-612"><a href="#cb128-612"></a>  <span class="co"># Step 2(a)</span></span>
<span id="cb128-613"><a href="#cb128-613"></a>  Xapp <span class="ot">&lt;-</span> <span class="fu">fit_pca</span>(initialisation_data_pca , <span class="at">num_comp =</span> <span class="dv">1</span>)</span>
<span id="cb128-614"><a href="#cb128-614"></a>  </span>
<span id="cb128-615"><a href="#cb128-615"></a>  <span class="co"># Step 2(b)</span></span>
<span id="cb128-616"><a href="#cb128-616"></a>  initialisation_data_pca[ismiss] <span class="ot">&lt;-</span> Xapp[ismiss]</span>
<span id="cb128-617"><a href="#cb128-617"></a>  </span>
<span id="cb128-618"><a href="#cb128-618"></a>  <span class="co"># Step 2(c)</span></span>
<span id="cb128-619"><a href="#cb128-619"></a>  mss_pca <span class="ot">&lt;-</span> <span class="fu">mean</span>(((missing_data <span class="sc">-</span> Xapp)[<span class="sc">!</span>ismiss])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb128-620"><a href="#cb128-620"></a>  rel_err <span class="ot">&lt;-</span> mss_old_pca <span class="sc">-</span> mss_pca</span>
<span id="cb128-621"><a href="#cb128-621"></a>  mss_old_pca <span class="ot">&lt;-</span> mss_pca</span>
<span id="cb128-622"><a href="#cb128-622"></a>  <span class="fu">cat</span>(<span class="st">"Iter:"</span>, iter, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb128-623"><a href="#cb128-623"></a>      <span class="st">"MSS:"</span>, mss_pca, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb128-624"><a href="#cb128-624"></a>      <span class="st">"Rel. Err:"</span>, rel_err, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb128-625"><a href="#cb128-625"></a>  <span class="fu">print</span>(<span class="st">"Xapp"</span>)</span>
<span id="cb128-626"><a href="#cb128-626"></a>  <span class="fu">print</span>(Xapp)</span>
<span id="cb128-627"><a href="#cb128-627"></a>  <span class="fu">print</span>(<span class="st">"Data"</span>)</span>
<span id="cb128-628"><a href="#cb128-628"></a>  <span class="fu">print</span>(initialisation_data_pca)</span>
<span id="cb128-629"><a href="#cb128-629"></a>}</span>
<span id="cb128-630"><a href="#cb128-630"></a></span>
<span id="cb128-631"><a href="#cb128-631"></a><span class="in">```</span></span>
<span id="cb128-632"><a href="#cb128-632"></a></span>
<span id="cb128-633"><a href="#cb128-633"></a><span class="fu">### Tidymodels</span></span>
<span id="cb128-634"><a href="#cb128-634"></a></span>
<span id="cb128-635"><a href="#cb128-635"></a><span class="in">```{r, max.height = '500px'}</span></span>
<span id="cb128-636"><a href="#cb128-636"></a><span class="co">#| message: false</span></span>
<span id="cb128-637"><a href="#cb128-637"></a></span>
<span id="cb128-638"><a href="#cb128-638"></a>iter <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb128-639"><a href="#cb128-639"></a>rel_err <span class="ot">&lt;-</span> mss_old_svd</span>
<span id="cb128-640"><a href="#cb128-640"></a>thresh <span class="ot">&lt;-</span> <span class="fl">1e-2</span></span>
<span id="cb128-641"><a href="#cb128-641"></a><span class="cf">while</span>(rel_err <span class="sc">&gt;</span> thresh) {</span>
<span id="cb128-642"><a href="#cb128-642"></a>  iter <span class="ot">&lt;-</span> iter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb128-643"><a href="#cb128-643"></a>  </span>
<span id="cb128-644"><a href="#cb128-644"></a>  <span class="co"># Step 2(a)</span></span>
<span id="cb128-645"><a href="#cb128-645"></a>  Xapp <span class="ot">&lt;-</span> <span class="fu">fit_svd</span>(initialisation_data_svd, <span class="at">num_comp =</span> <span class="dv">1</span>)</span>
<span id="cb128-646"><a href="#cb128-646"></a>  </span>
<span id="cb128-647"><a href="#cb128-647"></a>  <span class="co"># Step 2(b)</span></span>
<span id="cb128-648"><a href="#cb128-648"></a>  initialisation_data_svd[ismiss] <span class="ot">&lt;-</span> Xapp[ismiss]</span>
<span id="cb128-649"><a href="#cb128-649"></a>  </span>
<span id="cb128-650"><a href="#cb128-650"></a>  <span class="co"># Step 2(c)</span></span>
<span id="cb128-651"><a href="#cb128-651"></a>  mss_svd <span class="ot">&lt;-</span> <span class="fu">mean</span>(((missing_data <span class="sc">-</span> Xapp)[<span class="sc">!</span>ismiss])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb128-652"><a href="#cb128-652"></a>  rel_err <span class="ot">&lt;-</span> mss_old_svd <span class="sc">-</span> mss_svd</span>
<span id="cb128-653"><a href="#cb128-653"></a>  mss_old_svd <span class="ot">&lt;-</span> mss_svd</span>
<span id="cb128-654"><a href="#cb128-654"></a>  <span class="fu">cat</span>(<span class="st">"Iter:"</span>, iter, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb128-655"><a href="#cb128-655"></a>      <span class="st">"MSS:"</span>, mss_svd, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb128-656"><a href="#cb128-656"></a>      <span class="st">"Rel. Err:"</span>, rel_err, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb128-657"><a href="#cb128-657"></a>  <span class="fu">print</span>(<span class="st">"Xapp"</span>)</span>
<span id="cb128-658"><a href="#cb128-658"></a>  <span class="fu">print</span>(Xapp)</span>
<span id="cb128-659"><a href="#cb128-659"></a>  <span class="fu">print</span>(<span class="st">"Data"</span>)</span>
<span id="cb128-660"><a href="#cb128-660"></a>  <span class="fu">print</span>(initialisation_data_svd)</span>
<span id="cb128-661"><a href="#cb128-661"></a>}</span>
<span id="cb128-662"><a href="#cb128-662"></a></span>
<span id="cb128-663"><a href="#cb128-663"></a><span class="in">```</span></span>
<span id="cb128-664"><a href="#cb128-664"></a></span>
<span id="cb128-665"><a href="#cb128-665"></a><span class="fu">### BaseR SVD</span></span>
<span id="cb128-666"><a href="#cb128-666"></a></span>
<span id="cb128-667"><a href="#cb128-667"></a><span class="in">```{r, max.height = '500px'}</span></span>
<span id="cb128-668"><a href="#cb128-668"></a><span class="co">#| message: false</span></span>
<span id="cb128-669"><a href="#cb128-669"></a></span>
<span id="cb128-670"><a href="#cb128-670"></a>iter <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb128-671"><a href="#cb128-671"></a>rel_err <span class="ot">&lt;-</span> mss_old_tidymodels </span>
<span id="cb128-672"><a href="#cb128-672"></a>thresh <span class="ot">&lt;-</span> <span class="fl">1e-2</span></span>
<span id="cb128-673"><a href="#cb128-673"></a><span class="cf">while</span>(rel_err <span class="sc">&gt;</span> thresh) {</span>
<span id="cb128-674"><a href="#cb128-674"></a>  iter <span class="ot">&lt;-</span> iter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb128-675"><a href="#cb128-675"></a>  </span>
<span id="cb128-676"><a href="#cb128-676"></a>  <span class="co"># Step 2(a)</span></span>
<span id="cb128-677"><a href="#cb128-677"></a>  Xapp <span class="ot">&lt;-</span> <span class="fu">fit_svd</span>(initialisation_data_tidymodels , <span class="at">num_comp =</span> <span class="dv">1</span>)</span>
<span id="cb128-678"><a href="#cb128-678"></a>  </span>
<span id="cb128-679"><a href="#cb128-679"></a>  <span class="co"># Step 2(b)</span></span>
<span id="cb128-680"><a href="#cb128-680"></a>  initialisation_data_tidymodels [ismiss] <span class="ot">&lt;-</span> Xapp[ismiss]</span>
<span id="cb128-681"><a href="#cb128-681"></a>  </span>
<span id="cb128-682"><a href="#cb128-682"></a>  <span class="co"># Step 2(c)</span></span>
<span id="cb128-683"><a href="#cb128-683"></a>  mss_tidymodels  <span class="ot">&lt;-</span> <span class="fu">mean</span>(((missing_data <span class="sc">-</span> Xapp)[<span class="sc">!</span>ismiss])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb128-684"><a href="#cb128-684"></a>  rel_err <span class="ot">&lt;-</span> mss_old_tidymodels  <span class="sc">-</span> mss_tidymodels </span>
<span id="cb128-685"><a href="#cb128-685"></a>  mss_old_tidymodels  <span class="ot">&lt;-</span> mss_tidymodels </span>
<span id="cb128-686"><a href="#cb128-686"></a>  <span class="fu">cat</span>(<span class="st">"Iter:"</span>, iter, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb128-687"><a href="#cb128-687"></a>      <span class="st">"MSS:"</span>, mss_tidymodels , <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb128-688"><a href="#cb128-688"></a>      <span class="st">"Rel. Err:"</span>, rel_err, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb128-689"><a href="#cb128-689"></a>  <span class="fu">print</span>(<span class="st">"Xapp"</span>)</span>
<span id="cb128-690"><a href="#cb128-690"></a>  <span class="fu">print</span>(Xapp)</span>
<span id="cb128-691"><a href="#cb128-691"></a>  <span class="fu">print</span>(<span class="st">"Data"</span>)</span>
<span id="cb128-692"><a href="#cb128-692"></a>  <span class="fu">print</span>(initialisation_data_tidymodels)</span>
<span id="cb128-693"><a href="#cb128-693"></a>}</span>
<span id="cb128-694"><a href="#cb128-694"></a></span>
<span id="cb128-695"><a href="#cb128-695"></a><span class="in">```</span></span>
<span id="cb128-696"><a href="#cb128-696"></a></span>
<span id="cb128-697"><a href="#cb128-697"></a>:::</span>
<span id="cb128-698"><a href="#cb128-698"></a></span>
<span id="cb128-699"><a href="#cb128-699"></a><span class="fu">## SoftImpute</span></span>
<span id="cb128-700"><a href="#cb128-700"></a></span>
<span id="cb128-703"><a href="#cb128-703"></a><span class="in">```{r}</span></span>
<span id="cb128-704"><a href="#cb128-704"></a><span class="co">#| message: false</span></span>
<span id="cb128-705"><a href="#cb128-705"></a><span class="co">#| warning: false</span></span>
<span id="cb128-706"><a href="#cb128-706"></a><span class="co">#| layout: [[1], [1]]</span></span>
<span id="cb128-707"><a href="#cb128-707"></a></span>
<span id="cb128-708"><a href="#cb128-708"></a>initialisation_data_tidymodels <span class="sc">%&gt;%</span> </span>
<span id="cb128-709"><a href="#cb128-709"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(</span>
<span id="cb128-710"><a href="#cb128-710"></a>    <span class="at">defaultPageSize =</span> <span class="dv">6</span>,</span>
<span id="cb128-711"><a href="#cb128-711"></a>    <span class="at">columns =</span> <span class="fu">list</span>(</span>
<span id="cb128-712"><a href="#cb128-712"></a>      <span class="at">SBP =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(<span class="at">format =</span> reactable<span class="sc">::</span><span class="fu">colFormat</span>(<span class="at">digits =</span> <span class="dv">2</span>)),</span>
<span id="cb128-713"><a href="#cb128-713"></a>      <span class="at">DBP =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(<span class="at">format =</span> reactable<span class="sc">::</span><span class="fu">colFormat</span>(<span class="at">digits =</span> <span class="dv">2</span>))</span>
<span id="cb128-714"><a href="#cb128-714"></a>    ),</span>
<span id="cb128-715"><a href="#cb128-715"></a>    <span class="at">defaultColDef =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(</span>
<span id="cb128-716"><a href="#cb128-716"></a>      <span class="at">style =</span> colour_missing_cells</span>
<span id="cb128-717"><a href="#cb128-717"></a>    )) <span class="sc">%&gt;%</span></span>
<span id="cb128-718"><a href="#cb128-718"></a>  reactablefmtr<span class="sc">::</span><span class="fu">add_title</span>(</span>
<span id="cb128-719"><a href="#cb128-719"></a>    <span class="at">title =</span> <span class="st">"Algorithm 12.1"</span></span>
<span id="cb128-720"><a href="#cb128-720"></a>    )</span>
<span id="cb128-721"><a href="#cb128-721"></a></span>
<span id="cb128-722"><a href="#cb128-722"></a></span>
<span id="cb128-723"><a href="#cb128-723"></a>fits <span class="ot">&lt;-</span> softImpute<span class="sc">::</span><span class="fu">softImpute</span>(missing_data, <span class="at">type =</span> <span class="st">"svd"</span>)</span>
<span id="cb128-724"><a href="#cb128-724"></a>softImpute<span class="sc">::</span><span class="fu">complete</span>(missing_data, fits) <span class="sc">%&gt;%</span> </span>
<span id="cb128-725"><a href="#cb128-725"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(</span>
<span id="cb128-726"><a href="#cb128-726"></a>    <span class="at">defaultPageSize =</span> <span class="dv">6</span>,</span>
<span id="cb128-727"><a href="#cb128-727"></a>    <span class="at">columns =</span> <span class="fu">list</span>(</span>
<span id="cb128-728"><a href="#cb128-728"></a>      <span class="at">SBP =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(<span class="at">format =</span> reactable<span class="sc">::</span><span class="fu">colFormat</span>(<span class="at">digits =</span> <span class="dv">2</span>)),</span>
<span id="cb128-729"><a href="#cb128-729"></a>      <span class="at">DBP =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(<span class="at">format =</span> reactable<span class="sc">::</span><span class="fu">colFormat</span>(<span class="at">digits =</span> <span class="dv">2</span>))</span>
<span id="cb128-730"><a href="#cb128-730"></a>    ),</span>
<span id="cb128-731"><a href="#cb128-731"></a>    <span class="at">defaultColDef =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(</span>
<span id="cb128-732"><a href="#cb128-732"></a>      <span class="at">style =</span> colour_missing_cells</span>
<span id="cb128-733"><a href="#cb128-733"></a>    )) <span class="sc">%&gt;%</span></span>
<span id="cb128-734"><a href="#cb128-734"></a>  reactablefmtr<span class="sc">::</span><span class="fu">add_title</span>(</span>
<span id="cb128-735"><a href="#cb128-735"></a>    <span class="at">title =</span> <span class="st">"Soft Impute"</span></span>
<span id="cb128-736"><a href="#cb128-736"></a>    )</span>
<span id="cb128-737"><a href="#cb128-737"></a><span class="in">```</span></span>
<span id="cb128-738"><a href="#cb128-738"></a></span>
<span id="cb128-739"><a href="#cb128-739"></a><span class="fu"># K-Means Clustering</span></span>
<span id="cb128-740"><a href="#cb128-740"></a></span>
<span id="cb128-741"><a href="#cb128-741"></a><span class="fu">## Introduction</span></span>
<span id="cb128-742"><a href="#cb128-742"></a></span>
<span id="cb128-743"><a href="#cb128-743"></a>We begin with a simple simulated example in which there truly are two clusters in the</span>
<span id="cb128-744"><a href="#cb128-744"></a></span>
<span id="cb128-747"><a href="#cb128-747"></a><span class="in">```{r}</span></span>
<span id="cb128-748"><a href="#cb128-748"></a><span class="co">#| message: false</span></span>
<span id="cb128-749"><a href="#cb128-749"></a></span>
<span id="cb128-750"><a href="#cb128-750"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb128-751"><a href="#cb128-751"></a></span>
<span id="cb128-752"><a href="#cb128-752"></a><span class="co"># CLuster centre at (0,0) and (3,-4)</span></span>
<span id="cb128-753"><a href="#cb128-753"></a>centers <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb128-754"><a href="#cb128-754"></a>  <span class="at">cluster =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), </span>
<span id="cb128-755"><a href="#cb128-755"></a>  <span class="at">num_points =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">25</span>),    <span class="co"># number points in each cluster</span></span>
<span id="cb128-756"><a href="#cb128-756"></a>  <span class="at">V1 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>),              <span class="co"># V1 coordinate of cluster center</span></span>
<span id="cb128-757"><a href="#cb128-757"></a>  <span class="at">V2 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="dv">4</span>)              <span class="co"># V2 coordinate of cluster center</span></span>
<span id="cb128-758"><a href="#cb128-758"></a>)</span>
<span id="cb128-759"><a href="#cb128-759"></a></span>
<span id="cb128-760"><a href="#cb128-760"></a>labelled_points <span class="ot">&lt;-</span> centers <span class="sc">%&gt;%</span></span>
<span id="cb128-761"><a href="#cb128-761"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb128-762"><a href="#cb128-762"></a>    <span class="at">V1 =</span> purrr<span class="sc">::</span><span class="fu">map2</span>(.data[[<span class="st">"num_points"</span>]], .data[[<span class="st">"V1"</span>]], rnorm),</span>
<span id="cb128-763"><a href="#cb128-763"></a>    <span class="at">V2 =</span> purrr<span class="sc">::</span><span class="fu">map2</span>(.data[[<span class="st">"num_points"</span>]], .data[[<span class="st">"V2"</span>]], rnorm)</span>
<span id="cb128-764"><a href="#cb128-764"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb128-765"><a href="#cb128-765"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"num_points"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-766"><a href="#cb128-766"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"V1"</span>, <span class="st">"V2"</span>))</span>
<span id="cb128-767"><a href="#cb128-767"></a></span>
<span id="cb128-768"><a href="#cb128-768"></a>labelled_points <span class="sc">%&gt;%</span> </span>
<span id="cb128-769"><a href="#cb128-769"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(</span>
<span id="cb128-770"><a href="#cb128-770"></a>    <span class="at">defaultPageSize =</span> <span class="dv">10</span>,</span>
<span id="cb128-771"><a href="#cb128-771"></a>    <span class="at">columns =</span> <span class="fu">list</span>(</span>
<span id="cb128-772"><a href="#cb128-772"></a>      <span class="at">V1 =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(<span class="at">format =</span> reactable<span class="sc">::</span><span class="fu">colFormat</span>(<span class="at">digits =</span> <span class="dv">2</span>)),</span>
<span id="cb128-773"><a href="#cb128-773"></a>      <span class="at">V2 =</span> reactable<span class="sc">::</span><span class="fu">colDef</span>(<span class="at">format =</span> reactable<span class="sc">::</span><span class="fu">colFormat</span>(<span class="at">digits =</span> <span class="dv">2</span>))</span>
<span id="cb128-774"><a href="#cb128-774"></a>    )</span>
<span id="cb128-775"><a href="#cb128-775"></a>  )</span>
<span id="cb128-776"><a href="#cb128-776"></a></span>
<span id="cb128-777"><a href="#cb128-777"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">data =</span> labelled_points, </span>
<span id="cb128-778"><a href="#cb128-778"></a>                <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> .data[[<span class="st">"V1"</span>]], </span>
<span id="cb128-779"><a href="#cb128-779"></a>                                       <span class="at">y =</span> .data[[<span class="st">"V2"</span>]], </span>
<span id="cb128-780"><a href="#cb128-780"></a>                                       <span class="at">color =</span> .data[[<span class="st">"cluster"</span>]])</span>
<span id="cb128-781"><a href="#cb128-781"></a>                ) <span class="sc">+</span></span>
<span id="cb128-782"><a href="#cb128-782"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span>)</span>
<span id="cb128-783"><a href="#cb128-783"></a></span>
<span id="cb128-784"><a href="#cb128-784"></a></span>
<span id="cb128-785"><a href="#cb128-785"></a><span class="in">```</span></span>
<span id="cb128-786"><a href="#cb128-786"></a></span>
<span id="cb128-787"><a href="#cb128-787"></a>We now perform K-means clustering with $K = 2$.</span>
<span id="cb128-788"><a href="#cb128-788"></a></span>
<span id="cb128-789"><a href="#cb128-789"></a>We’ll use the built-in <span class="co">[</span><span class="ot">`stats::kmeans`</span><span class="co">](https://stat.ethz.ch/R-manual/R-devel/library/stats/html/kmeans.html)</span> function, which accepts a data frame with all numeric columns as it’s primary argument</span>
<span id="cb128-790"><a href="#cb128-790"></a></span>
<span id="cb128-791"><a href="#cb128-791"></a><span class="in">```{r, max.height = '300px'}</span></span>
<span id="cb128-792"><a href="#cb128-792"></a><span class="co">#| message: false</span></span>
<span id="cb128-793"><a href="#cb128-793"></a>points <span class="ot">&lt;-</span> labelled_points <span class="sc">%&gt;%</span> </span>
<span id="cb128-794"><a href="#cb128-794"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"cluster"</span>))</span>
<span id="cb128-795"><a href="#cb128-795"></a></span>
<span id="cb128-796"><a href="#cb128-796"></a>result_kmeans <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">kmeans</span>(<span class="at">x =</span> points, </span>
<span id="cb128-797"><a href="#cb128-797"></a>                        <span class="at">centers =</span> <span class="dv">2</span>, </span>
<span id="cb128-798"><a href="#cb128-798"></a>                        <span class="at">nstart =</span> <span class="dv">20</span>)</span>
<span id="cb128-799"><a href="#cb128-799"></a></span>
<span id="cb128-800"><a href="#cb128-800"></a>result_kmeans</span>
<span id="cb128-801"><a href="#cb128-801"></a><span class="in">```</span></span>
<span id="cb128-802"><a href="#cb128-802"></a></span>
<span id="cb128-803"><a href="#cb128-803"></a>The <span class="co">[</span><span class="ot">`broom::tidy`</span><span class="co">](https://broom.tidymodels.org/)</span> function returns information for each cluster, including their mean position (centroid), size and within-cluster sum-of-squares.</span>
<span id="cb128-804"><a href="#cb128-804"></a></span>
<span id="cb128-807"><a href="#cb128-807"></a><span class="in">```{r}</span></span>
<span id="cb128-808"><a href="#cb128-808"></a><span class="co">#| message: false</span></span>
<span id="cb128-809"><a href="#cb128-809"></a></span>
<span id="cb128-810"><a href="#cb128-810"></a>result_kmeans <span class="sc">%&gt;%</span> </span>
<span id="cb128-811"><a href="#cb128-811"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb128-812"><a href="#cb128-812"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>()</span>
<span id="cb128-813"><a href="#cb128-813"></a></span>
<span id="cb128-814"><a href="#cb128-814"></a><span class="in">```</span></span>
<span id="cb128-815"><a href="#cb128-815"></a></span>
<span id="cb128-816"><a href="#cb128-816"></a>The <span class="co">[</span><span class="ot">`broom::glance`</span><span class="co">](https://broom.tidymodels.org/)</span> function returns model wise metrics. One of these is <span class="in">`tot.withinss`</span> which is the **total** within-cluster sum-of-squares that we seek to minimize when we perform K-means clustering.</span>
<span id="cb128-817"><a href="#cb128-817"></a></span>
<span id="cb128-820"><a href="#cb128-820"></a><span class="in">```{r}</span></span>
<span id="cb128-821"><a href="#cb128-821"></a><span class="co">#| message: false</span></span>
<span id="cb128-822"><a href="#cb128-822"></a></span>
<span id="cb128-823"><a href="#cb128-823"></a>result_kmeans <span class="sc">%&gt;%</span> </span>
<span id="cb128-824"><a href="#cb128-824"></a>  broom<span class="sc">::</span><span class="fu">glance</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb128-825"><a href="#cb128-825"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>()</span>
<span id="cb128-826"><a href="#cb128-826"></a></span>
<span id="cb128-827"><a href="#cb128-827"></a><span class="in">```</span></span>
<span id="cb128-828"><a href="#cb128-828"></a></span>
<span id="cb128-829"><a href="#cb128-829"></a>We can see what cluster each observation belongs to by using <span class="co">[</span><span class="ot">`broom::augment`</span><span class="co">](https://broom.tidymodels.org/)</span> which “predict” which cluster a given observation belongs to.</span>
<span id="cb128-830"><a href="#cb128-830"></a></span>
<span id="cb128-833"><a href="#cb128-833"></a><span class="in">```{r}</span></span>
<span id="cb128-834"><a href="#cb128-834"></a><span class="co">#| message: false</span></span>
<span id="cb128-835"><a href="#cb128-835"></a></span>
<span id="cb128-836"><a href="#cb128-836"></a>predicted_kmeans <span class="ot">&lt;-</span> result_kmeans <span class="sc">%&gt;%</span> </span>
<span id="cb128-837"><a href="#cb128-837"></a>  broom<span class="sc">::</span><span class="fu">augment</span>(<span class="at">data =</span> points)</span>
<span id="cb128-838"><a href="#cb128-838"></a></span>
<span id="cb128-839"><a href="#cb128-839"></a>predicted_kmeans <span class="sc">%&gt;%</span></span>
<span id="cb128-840"><a href="#cb128-840"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-841"><a href="#cb128-841"></a></span>
<span id="cb128-842"><a href="#cb128-842"></a><span class="in">```</span></span>
<span id="cb128-843"><a href="#cb128-843"></a></span>
<span id="cb128-846"><a href="#cb128-846"></a><span class="in">```{r}</span></span>
<span id="cb128-847"><a href="#cb128-847"></a><span class="co">#| message: false</span></span>
<span id="cb128-848"><a href="#cb128-848"></a></span>
<span id="cb128-849"><a href="#cb128-849"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">data =</span> predicted_kmeans, </span>
<span id="cb128-850"><a href="#cb128-850"></a>                <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> .data[[<span class="st">"V1"</span>]], </span>
<span id="cb128-851"><a href="#cb128-851"></a>                                       <span class="at">y =</span> .data[[<span class="st">"V2"</span>]], </span>
<span id="cb128-852"><a href="#cb128-852"></a>                                       <span class="at">color =</span> .data[[<span class="st">".cluster"</span>]])</span>
<span id="cb128-853"><a href="#cb128-853"></a>                ) <span class="sc">+</span></span>
<span id="cb128-854"><a href="#cb128-854"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span>)</span>
<span id="cb128-855"><a href="#cb128-855"></a></span>
<span id="cb128-856"><a href="#cb128-856"></a><span class="in">```</span></span>
<span id="cb128-857"><a href="#cb128-857"></a></span>
<span id="cb128-858"><a href="#cb128-858"></a><span class="fu">## Exploration</span></span>
<span id="cb128-859"><a href="#cb128-859"></a></span>
<span id="cb128-860"><a href="#cb128-860"></a>In reality, we will not know how many clusters is required for a given dataset. We need to try out a number of different values of $K$ and then find the best one.</span>
<span id="cb128-861"><a href="#cb128-861"></a></span>
<span id="cb128-862"><a href="#cb128-862"></a>Let us try $K$ from 1 to 9.</span>
<span id="cb128-863"><a href="#cb128-863"></a></span>
<span id="cb128-864"><a href="#cb128-864"></a><span class="in">```{r, max.height = '300px'}</span></span>
<span id="cb128-865"><a href="#cb128-865"></a><span class="co">#| message: false</span></span>
<span id="cb128-866"><a href="#cb128-866"></a></span>
<span id="cb128-867"><a href="#cb128-867"></a>kclusts <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-868"><a href="#cb128-868"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb128-869"><a href="#cb128-869"></a>    <span class="at">kclust =</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.x =</span> .data[[<span class="st">"k"</span>]], </span>
<span id="cb128-870"><a href="#cb128-870"></a>                        <span class="at">.f =</span> <span class="sc">~</span><span class="fu">kmeans</span>(<span class="at">x =</span> points, <span class="at">centers =</span> .x))) <span class="sc">%&gt;%</span></span>
<span id="cb128-871"><a href="#cb128-871"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb128-872"><a href="#cb128-872"></a>    <span class="at">tidied =</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.x =</span> .data[[<span class="st">"kclust"</span>]], </span>
<span id="cb128-873"><a href="#cb128-873"></a>                        <span class="at">.f =</span> broom<span class="sc">::</span>tidy),</span>
<span id="cb128-874"><a href="#cb128-874"></a>    <span class="at">glanced =</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.x =</span> .data[[<span class="st">"kclust"</span>]], </span>
<span id="cb128-875"><a href="#cb128-875"></a>                         <span class="at">.f =</span> broom<span class="sc">::</span>glance),</span>
<span id="cb128-876"><a href="#cb128-876"></a>    <span class="at">augmented =</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.x =</span> .data[[<span class="st">"kclust"</span>]], </span>
<span id="cb128-877"><a href="#cb128-877"></a>                           <span class="at">.f =</span> broom<span class="sc">::</span>augment, <span class="at">data =</span> points)</span>
<span id="cb128-878"><a href="#cb128-878"></a>  )</span>
<span id="cb128-879"><a href="#cb128-879"></a></span>
<span id="cb128-880"><a href="#cb128-880"></a>kclusts</span>
<span id="cb128-881"><a href="#cb128-881"></a><span class="in">```</span></span>
<span id="cb128-882"><a href="#cb128-882"></a></span>
<span id="cb128-883"><a href="#cb128-883"></a>Let <span class="in">`assignments`</span> be a dataset of which cluster each points goes to for $K$ from 1 to 9</span>
<span id="cb128-884"><a href="#cb128-884"></a></span>
<span id="cb128-887"><a href="#cb128-887"></a><span class="in">```{r}</span></span>
<span id="cb128-888"><a href="#cb128-888"></a><span class="co">#| message: false</span></span>
<span id="cb128-889"><a href="#cb128-889"></a></span>
<span id="cb128-890"><a href="#cb128-890"></a>assignments <span class="ot">&lt;-</span> kclusts <span class="sc">%&gt;%</span> </span>
<span id="cb128-891"><a href="#cb128-891"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"k"</span>, <span class="st">"augmented"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb128-892"><a href="#cb128-892"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"augmented"</span>))</span>
<span id="cb128-893"><a href="#cb128-893"></a></span>
<span id="cb128-894"><a href="#cb128-894"></a>assignments <span class="sc">%&gt;%</span></span>
<span id="cb128-895"><a href="#cb128-895"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-896"><a href="#cb128-896"></a><span class="in">```</span></span>
<span id="cb128-897"><a href="#cb128-897"></a></span>
<span id="cb128-898"><a href="#cb128-898"></a>Now we can plot the original points using the data from assignments, with each point coloured according to the predicted cluster.</span>
<span id="cb128-899"><a href="#cb128-899"></a></span>
<span id="cb128-900"><a href="#cb128-900"></a><span class="in">```{r, fig.height = 8}</span></span>
<span id="cb128-901"><a href="#cb128-901"></a></span>
<span id="cb128-902"><a href="#cb128-902"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">data =</span> assignments, </span>
<span id="cb128-903"><a href="#cb128-903"></a>                      <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> .data[[<span class="st">"V1"</span>]], </span>
<span id="cb128-904"><a href="#cb128-904"></a>                                             <span class="at">y =</span> .data[[<span class="st">"V2"</span>]])) <span class="sc">+</span></span>
<span id="cb128-905"><a href="#cb128-905"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> .data[[<span class="st">".cluster"</span>]]), </span>
<span id="cb128-906"><a href="#cb128-906"></a>             <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb128-907"><a href="#cb128-907"></a>  <span class="fu">facet_wrap</span>(ggplot2<span class="sc">::</span><span class="fu">vars</span>(.data[[<span class="st">"k"</span>]]))</span>
<span id="cb128-908"><a href="#cb128-908"></a></span>
<span id="cb128-909"><a href="#cb128-909"></a><span class="in">```</span></span>
<span id="cb128-910"><a href="#cb128-910"></a></span>
<span id="cb128-911"><a href="#cb128-911"></a>Let <span class="in">`clusters`</span> be a dataset of cluster mean position (centroids) for $K$ from 1 to 9</span>
<span id="cb128-912"><a href="#cb128-912"></a></span>
<span id="cb128-915"><a href="#cb128-915"></a><span class="in">```{r}</span></span>
<span id="cb128-916"><a href="#cb128-916"></a><span class="co">#| message: false</span></span>
<span id="cb128-917"><a href="#cb128-917"></a></span>
<span id="cb128-918"><a href="#cb128-918"></a>clusters <span class="ot">&lt;-</span> kclusts <span class="sc">%&gt;%</span></span>
<span id="cb128-919"><a href="#cb128-919"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"k"</span>, <span class="st">"tidied"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb128-920"><a href="#cb128-920"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"tidied"</span>))</span>
<span id="cb128-921"><a href="#cb128-921"></a></span>
<span id="cb128-922"><a href="#cb128-922"></a>clusters <span class="sc">%&gt;%</span></span>
<span id="cb128-923"><a href="#cb128-923"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-924"><a href="#cb128-924"></a></span>
<span id="cb128-925"><a href="#cb128-925"></a><span class="in">```</span></span>
<span id="cb128-926"><a href="#cb128-926"></a></span>
<span id="cb128-927"><a href="#cb128-927"></a>We can then add the centers of the cluster using the data from <span class="in">`clusters`</span></span>
<span id="cb128-928"><a href="#cb128-928"></a></span>
<span id="cb128-929"><a href="#cb128-929"></a><span class="in">```{r, fig.height = 8}</span></span>
<span id="cb128-930"><a href="#cb128-930"></a></span>
<span id="cb128-931"><a href="#cb128-931"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">data =</span> assignments, </span>
<span id="cb128-932"><a href="#cb128-932"></a>                      <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> .data[[<span class="st">"V1"</span>]], </span>
<span id="cb128-933"><a href="#cb128-933"></a>                                             <span class="at">y =</span> .data[[<span class="st">"V2"</span>]])) <span class="sc">+</span></span>
<span id="cb128-934"><a href="#cb128-934"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> .data[[<span class="st">".cluster"</span>]]), </span>
<span id="cb128-935"><a href="#cb128-935"></a>             <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb128-936"><a href="#cb128-936"></a>  <span class="fu">facet_wrap</span>(ggplot2<span class="sc">::</span><span class="fu">vars</span>(.data[[<span class="st">"k"</span>]])) <span class="sc">+</span></span>
<span id="cb128-937"><a href="#cb128-937"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> clusters, </span>
<span id="cb128-938"><a href="#cb128-938"></a>             <span class="at">size =</span> <span class="dv">10</span>, </span>
<span id="cb128-939"><a href="#cb128-939"></a>             <span class="at">shape =</span> <span class="st">"x"</span>)</span>
<span id="cb128-940"><a href="#cb128-940"></a></span>
<span id="cb128-941"><a href="#cb128-941"></a><span class="in">```</span></span>
<span id="cb128-942"><a href="#cb128-942"></a></span>
<span id="cb128-943"><a href="#cb128-943"></a>Let <span class="in">`clusterings`</span> be a dataset of cluster metrics for $K$ from 1 to 9</span>
<span id="cb128-944"><a href="#cb128-944"></a></span>
<span id="cb128-947"><a href="#cb128-947"></a><span class="in">```{r}</span></span>
<span id="cb128-948"><a href="#cb128-948"></a><span class="co">#| message: false</span></span>
<span id="cb128-949"><a href="#cb128-949"></a></span>
<span id="cb128-950"><a href="#cb128-950"></a>clusterings <span class="ot">&lt;-</span> kclusts <span class="sc">%&gt;%</span></span>
<span id="cb128-951"><a href="#cb128-951"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"k"</span>, <span class="st">"glanced"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb128-952"><a href="#cb128-952"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"glanced"</span>))</span>
<span id="cb128-953"><a href="#cb128-953"></a></span>
<span id="cb128-954"><a href="#cb128-954"></a>clusterings <span class="sc">%&gt;%</span></span>
<span id="cb128-955"><a href="#cb128-955"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-956"><a href="#cb128-956"></a></span>
<span id="cb128-957"><a href="#cb128-957"></a><span class="in">```</span></span>
<span id="cb128-958"><a href="#cb128-958"></a></span>
<span id="cb128-959"><a href="#cb128-959"></a>Now that we have the total within-cluster sum-of-squares for $K$ from 1 to 9, we can plot them against k so we can use the elbow method to find the optimal number of clusters.</span>
<span id="cb128-960"><a href="#cb128-960"></a></span>
<span id="cb128-963"><a href="#cb128-963"></a><span class="in">```{r}</span></span>
<span id="cb128-964"><a href="#cb128-964"></a><span class="co">#| message: false</span></span>
<span id="cb128-965"><a href="#cb128-965"></a></span>
<span id="cb128-966"><a href="#cb128-966"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">data =</span> clusterings, </span>
<span id="cb128-967"><a href="#cb128-967"></a>                <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> .data[[<span class="st">"k"</span>]], </span>
<span id="cb128-968"><a href="#cb128-968"></a>                                       <span class="at">y =</span> .data[[<span class="st">"tot.withinss"</span>]])) <span class="sc">+</span></span>
<span id="cb128-969"><a href="#cb128-969"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">"midnightblue"</span>) <span class="sc">+</span></span>
<span id="cb128-970"><a href="#cb128-970"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"midnightblue"</span>)</span>
<span id="cb128-971"><a href="#cb128-971"></a></span>
<span id="cb128-972"><a href="#cb128-972"></a></span>
<span id="cb128-973"><a href="#cb128-973"></a><span class="in">```</span></span>
<span id="cb128-974"><a href="#cb128-974"></a></span>
<span id="cb128-975"><a href="#cb128-975"></a>We see an elbow at k = 2 which makes us happy since the data set is specifically created to have 2 clusters. We can now extract the model where k = 2 from</span>
<span id="cb128-976"><a href="#cb128-976"></a></span>
<span id="cb128-977"><a href="#cb128-977"></a><span class="in">```{r, max.height = '300px'}</span></span>
<span id="cb128-978"><a href="#cb128-978"></a><span class="co">#| message: false</span></span>
<span id="cb128-979"><a href="#cb128-979"></a></span>
<span id="cb128-980"><a href="#cb128-980"></a>final_kclusts <span class="ot">&lt;-</span> kclusts <span class="sc">%&gt;%</span></span>
<span id="cb128-981"><a href="#cb128-981"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(.data[[<span class="st">"k"</span>]] <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-982"><a href="#cb128-982"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(.data[[<span class="st">"kclust"</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb128-983"><a href="#cb128-983"></a>  purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb128-984"><a href="#cb128-984"></a></span>
<span id="cb128-985"><a href="#cb128-985"></a><span class="in">```</span></span>
<span id="cb128-986"><a href="#cb128-986"></a></span>
<span id="cb128-987"><a href="#cb128-987"></a><span class="fu"># Hierarchical Clustering</span></span>
<span id="cb128-988"><a href="#cb128-988"></a></span>
<span id="cb128-989"><a href="#cb128-989"></a>The <span class="co">[</span><span class="ot">`stats::dist`</span><span class="co">](https://stat.ethz.ch/R-manual/R-devel/library/stats/html/dist.html)</span> function is used to calculate the Euclidean distance dissimilarity measure.</span>
<span id="cb128-990"><a href="#cb128-990"></a></span>
<span id="cb128-993"><a href="#cb128-993"></a><span class="in">```{r}</span></span>
<span id="cb128-994"><a href="#cb128-994"></a><span class="co">#| message: false</span></span>
<span id="cb128-995"><a href="#cb128-995"></a></span>
<span id="cb128-996"><a href="#cb128-996"></a>dissimilarity_measure <span class="ot">&lt;-</span> points <span class="sc">%&gt;%</span></span>
<span id="cb128-997"><a href="#cb128-997"></a>  stats<span class="sc">::</span><span class="fu">dist</span>(<span class="at">method =</span> <span class="st">"euclidean"</span>) </span>
<span id="cb128-998"><a href="#cb128-998"></a></span>
<span id="cb128-999"><a href="#cb128-999"></a>dissimilarity_measure <span class="sc">%&gt;%</span></span>
<span id="cb128-1000"><a href="#cb128-1000"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb128-1001"><a href="#cb128-1001"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>()</span>
<span id="cb128-1002"><a href="#cb128-1002"></a><span class="in">```</span></span>
<span id="cb128-1003"><a href="#cb128-1003"></a></span>
<span id="cb128-1004"><a href="#cb128-1004"></a>The <span class="co">[</span><span class="ot">`stats::hclust`</span><span class="co">](https://stat.ethz.ch/R-manual/R-devel/library/stats/html/hclust.html)</span> function implements hierarchical clustering in R. We use the data used for K-means clustering to plot the hierarchical clustering dendrogram using complete, single, and average linkage clustering, with Euclidean distance as the dissimilarity measure. </span>
<span id="cb128-1005"><a href="#cb128-1005"></a></span>
<span id="cb128-1008"><a href="#cb128-1008"></a><span class="in">```{r}</span></span>
<span id="cb128-1009"><a href="#cb128-1009"></a><span class="co">#| message: false</span></span>
<span id="cb128-1010"><a href="#cb128-1010"></a></span>
<span id="cb128-1011"><a href="#cb128-1011"></a>res_hclust_complete <span class="ot">&lt;-</span> dissimilarity_measure <span class="sc">%&gt;%</span></span>
<span id="cb128-1012"><a href="#cb128-1012"></a>  stats<span class="sc">::</span><span class="fu">hclust</span>(<span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb128-1013"><a href="#cb128-1013"></a></span>
<span id="cb128-1014"><a href="#cb128-1014"></a>res_hclust_average <span class="ot">&lt;-</span> dissimilarity_measure <span class="sc">%&gt;%</span></span>
<span id="cb128-1015"><a href="#cb128-1015"></a>  stats<span class="sc">::</span><span class="fu">hclust</span>(<span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb128-1016"><a href="#cb128-1016"></a></span>
<span id="cb128-1017"><a href="#cb128-1017"></a>res_hclust_single <span class="ot">&lt;-</span> dissimilarity_measure <span class="sc">%&gt;%</span></span>
<span id="cb128-1018"><a href="#cb128-1018"></a>  stats<span class="sc">::</span><span class="fu">hclust</span>(<span class="at">method =</span> <span class="st">"single"</span>)</span>
<span id="cb128-1019"><a href="#cb128-1019"></a></span>
<span id="cb128-1020"><a href="#cb128-1020"></a><span class="in">```</span></span>
<span id="cb128-1021"><a href="#cb128-1021"></a></span>
<span id="cb128-1022"><a href="#cb128-1022"></a>We use <span class="co">[</span><span class="ot">`factoextra::fviz_dend`</span><span class="co">](https://rpkgs.datanovia.com/factoextra/reference/fviz_dend.html)</span> to visualize the clustering created using <span class="in">`hclust`</span>.</span>
<span id="cb128-1023"><a href="#cb128-1023"></a></span>
<span id="cb128-1024"><a href="#cb128-1024"></a>To determine the cluster labels for each observation associated with a given cut of the dendrogram, we can use the <span class="co">[</span><span class="ot">`stats::cutree`</span><span class="co">](https://stat.ethz.ch/R-manual/R-devel/library/stats/html/cutree.html)</span> function</span>
<span id="cb128-1025"><a href="#cb128-1025"></a></span>
<span id="cb128-1026"><a href="#cb128-1026"></a>::: {.panel-tabset}</span>
<span id="cb128-1027"><a href="#cb128-1027"></a></span>
<span id="cb128-1028"><a href="#cb128-1028"></a><span class="fu">### Complete</span></span>
<span id="cb128-1029"><a href="#cb128-1029"></a></span>
<span id="cb128-1032"><a href="#cb128-1032"></a><span class="in">```{r}</span></span>
<span id="cb128-1033"><a href="#cb128-1033"></a><span class="co">#| message: false</span></span>
<span id="cb128-1034"><a href="#cb128-1034"></a><span class="co">#| warning: false</span></span>
<span id="cb128-1035"><a href="#cb128-1035"></a></span>
<span id="cb128-1036"><a href="#cb128-1036"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(res_hclust_complete, <span class="at">main =</span> <span class="st">"complete"</span>, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb128-1037"><a href="#cb128-1037"></a></span>
<span id="cb128-1038"><a href="#cb128-1038"></a>stats<span class="sc">::</span><span class="fu">cutree</span>(<span class="at">tree =</span> res_hclust_complete, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb128-1039"><a href="#cb128-1039"></a></span>
<span id="cb128-1040"><a href="#cb128-1040"></a>results_hclust <span class="ot">&lt;-</span> </span>
<span id="cb128-1041"><a href="#cb128-1041"></a>  tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb128-1042"><a href="#cb128-1042"></a>    <span class="at">cluster_id =</span> stats<span class="sc">::</span><span class="fu">cutree</span>(<span class="at">tree =</span> res_hclust_complete, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb128-1043"><a href="#cb128-1043"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1044"><a href="#cb128-1044"></a>  dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(points) <span class="sc">%&gt;%</span></span>
<span id="cb128-1045"><a href="#cb128-1045"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">cluster_id =</span> <span class="fu">as.factor</span>(.data<span class="sc">$</span>cluster_id))</span>
<span id="cb128-1046"><a href="#cb128-1046"></a></span>
<span id="cb128-1047"><a href="#cb128-1047"></a>results_hclust <span class="sc">%&gt;%</span></span>
<span id="cb128-1048"><a href="#cb128-1048"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-1049"><a href="#cb128-1049"></a><span class="in">```</span></span>
<span id="cb128-1050"><a href="#cb128-1050"></a></span>
<span id="cb128-1051"><a href="#cb128-1051"></a><span class="fu">### Average</span></span>
<span id="cb128-1052"><a href="#cb128-1052"></a></span>
<span id="cb128-1055"><a href="#cb128-1055"></a><span class="in">```{r}</span></span>
<span id="cb128-1056"><a href="#cb128-1056"></a><span class="co">#| message: false</span></span>
<span id="cb128-1057"><a href="#cb128-1057"></a><span class="co">#| warning: false</span></span>
<span id="cb128-1058"><a href="#cb128-1058"></a></span>
<span id="cb128-1059"><a href="#cb128-1059"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(res_hclust_average, <span class="at">main =</span> <span class="st">"average"</span>, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb128-1060"><a href="#cb128-1060"></a></span>
<span id="cb128-1061"><a href="#cb128-1061"></a><span class="fu">cutree</span>(<span class="at">tree =</span> res_hclust_average, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb128-1062"><a href="#cb128-1062"></a></span>
<span id="cb128-1063"><a href="#cb128-1063"></a>results_hclust <span class="ot">&lt;-</span> </span>
<span id="cb128-1064"><a href="#cb128-1064"></a>  tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb128-1065"><a href="#cb128-1065"></a>    <span class="at">cluster_id =</span> stats<span class="sc">::</span><span class="fu">cutree</span>(<span class="at">tree =</span> res_hclust_average, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb128-1066"><a href="#cb128-1066"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1067"><a href="#cb128-1067"></a>  dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(points) <span class="sc">%&gt;%</span></span>
<span id="cb128-1068"><a href="#cb128-1068"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">cluster_id =</span> <span class="fu">as.factor</span>(.data<span class="sc">$</span>cluster_id))</span>
<span id="cb128-1069"><a href="#cb128-1069"></a></span>
<span id="cb128-1070"><a href="#cb128-1070"></a>results_hclust <span class="sc">%&gt;%</span></span>
<span id="cb128-1071"><a href="#cb128-1071"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-1072"><a href="#cb128-1072"></a></span>
<span id="cb128-1073"><a href="#cb128-1073"></a><span class="in">```</span></span>
<span id="cb128-1074"><a href="#cb128-1074"></a></span>
<span id="cb128-1075"><a href="#cb128-1075"></a><span class="fu">### Single</span></span>
<span id="cb128-1076"><a href="#cb128-1076"></a></span>
<span id="cb128-1079"><a href="#cb128-1079"></a><span class="in">```{r}</span></span>
<span id="cb128-1080"><a href="#cb128-1080"></a><span class="co">#| message: false</span></span>
<span id="cb128-1081"><a href="#cb128-1081"></a><span class="co">#| warning: false</span></span>
<span id="cb128-1082"><a href="#cb128-1082"></a></span>
<span id="cb128-1083"><a href="#cb128-1083"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(res_hclust_single, <span class="at">main =</span> <span class="st">"single"</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb128-1084"><a href="#cb128-1084"></a></span>
<span id="cb128-1085"><a href="#cb128-1085"></a><span class="fu">cutree</span>(<span class="at">tree =</span> res_hclust_single, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb128-1086"><a href="#cb128-1086"></a></span>
<span id="cb128-1087"><a href="#cb128-1087"></a>results_hclust <span class="ot">&lt;-</span> </span>
<span id="cb128-1088"><a href="#cb128-1088"></a>  tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb128-1089"><a href="#cb128-1089"></a>    <span class="at">cluster_id =</span> stats<span class="sc">::</span><span class="fu">cutree</span>(<span class="at">tree =</span> res_hclust_single, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb128-1090"><a href="#cb128-1090"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1091"><a href="#cb128-1091"></a>  dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(points) <span class="sc">%&gt;%</span></span>
<span id="cb128-1092"><a href="#cb128-1092"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">cluster_id =</span> <span class="fu">as.factor</span>(.data<span class="sc">$</span>cluster_id))</span>
<span id="cb128-1093"><a href="#cb128-1093"></a></span>
<span id="cb128-1094"><a href="#cb128-1094"></a>results_hclust <span class="sc">%&gt;%</span></span>
<span id="cb128-1095"><a href="#cb128-1095"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-1096"><a href="#cb128-1096"></a></span>
<span id="cb128-1097"><a href="#cb128-1097"></a><span class="in">```</span></span>
<span id="cb128-1098"><a href="#cb128-1098"></a></span>
<span id="cb128-1099"><a href="#cb128-1099"></a>:::</span>
<span id="cb128-1100"><a href="#cb128-1100"></a></span>
<span id="cb128-1101"><a href="#cb128-1101"></a>We analyze the nature of the clusters mathematically by evaluating the c, which measures the clustering structure of the dataset - with values closer to 1 suggest a more balanced clustering structure and values closer to 0 suggest less well-formed clusters. However, the agglomerative coefficient tends to become larger as the number of samples increases, so it should not be used to compare across data sets of very different sizes.</span>
<span id="cb128-1102"><a href="#cb128-1102"></a></span>
<span id="cb128-1103"><a href="#cb128-1103"></a><span class="co">[</span><span class="ot">`cluster::agnes`</span><span class="co">](https://stat.ethz.ch/R-manual/R-devel/library/cluster/html/agnes.html)</span> allows us to compute this metric on the results from hierarchical clustering.</span>
<span id="cb128-1104"><a href="#cb128-1104"></a></span>
<span id="cb128-1105"><a href="#cb128-1105"></a>It looks like the complete linkage did the best.</span>
<span id="cb128-1106"><a href="#cb128-1106"></a></span>
<span id="cb128-1109"><a href="#cb128-1109"></a><span class="in">```{r}</span></span>
<span id="cb128-1110"><a href="#cb128-1110"></a><span class="co">#| message: false</span></span>
<span id="cb128-1111"><a href="#cb128-1111"></a></span>
<span id="cb128-1112"><a href="#cb128-1112"></a><span class="co"># Compute agglomerative coefficient values</span></span>
<span id="cb128-1113"><a href="#cb128-1113"></a></span>
<span id="cb128-1114"><a href="#cb128-1114"></a>ac_metric <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb128-1115"><a href="#cb128-1115"></a>  <span class="at">complete_ac =</span> cluster<span class="sc">::</span><span class="fu">agnes</span>(<span class="at">x =</span> dissimilarity_measure, </span>
<span id="cb128-1116"><a href="#cb128-1116"></a>                               <span class="at">metric =</span> <span class="st">"euclidean"</span>, </span>
<span id="cb128-1117"><a href="#cb128-1117"></a>                               <span class="at">method =</span> <span class="st">"complete"</span>)<span class="sc">$</span>ac,</span>
<span id="cb128-1118"><a href="#cb128-1118"></a>  <span class="at">average_ac =</span> cluster<span class="sc">::</span><span class="fu">agnes</span>(<span class="at">x =</span> dissimilarity_measure,</span>
<span id="cb128-1119"><a href="#cb128-1119"></a>                              <span class="at">metric =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb128-1120"><a href="#cb128-1120"></a>                              <span class="at">method =</span> <span class="st">"average"</span>)<span class="sc">$</span>ac,</span>
<span id="cb128-1121"><a href="#cb128-1121"></a>  <span class="at">single_ac =</span> cluster<span class="sc">::</span><span class="fu">agnes</span>(<span class="at">x =</span> dissimilarity_measure,</span>
<span id="cb128-1122"><a href="#cb128-1122"></a>                             <span class="at">metric =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb128-1123"><a href="#cb128-1123"></a>                             <span class="at">method =</span> <span class="st">"single"</span>)<span class="sc">$</span>ac</span>
<span id="cb128-1124"><a href="#cb128-1124"></a>)</span>
<span id="cb128-1125"><a href="#cb128-1125"></a></span>
<span id="cb128-1126"><a href="#cb128-1126"></a>ac_metric</span>
<span id="cb128-1127"><a href="#cb128-1127"></a><span class="in">```</span></span>
<span id="cb128-1128"><a href="#cb128-1128"></a></span>
<span id="cb128-1129"><a href="#cb128-1129"></a>Although hierarchical clustering provides a fully connected dendrogram representing the cluster relationships, there may still need to choose the preferred number of clusters to extract. Fortunately we can execute approaches similar to those discussed for k-means clustering with <span class="co">[</span><span class="ot">`factoextra::fviz_nbclust`</span><span class="co">](https://rpkgs.datanovia.com/factoextra/reference/fviz_nbclust.html)</span></span>
<span id="cb128-1130"><a href="#cb128-1130"></a></span>
<span id="cb128-1131"><a href="#cb128-1131"></a><span class="in">```{r, fig.height = 8}</span></span>
<span id="cb128-1132"><a href="#cb128-1132"></a><span class="co">#| message: false</span></span>
<span id="cb128-1133"><a href="#cb128-1133"></a><span class="co">#| warning: false</span></span>
<span id="cb128-1134"><a href="#cb128-1134"></a></span>
<span id="cb128-1135"><a href="#cb128-1135"></a><span class="co"># Plot cluster results</span></span>
<span id="cb128-1136"><a href="#cb128-1136"></a>p1 <span class="ot">&lt;-</span> factoextra<span class="sc">::</span><span class="fu">fviz_nbclust</span>(<span class="at">x =</span> points, </span>
<span id="cb128-1137"><a href="#cb128-1137"></a>                               <span class="at">FUN =</span> factoextra<span class="sc">::</span>hcut,</span>
<span id="cb128-1138"><a href="#cb128-1138"></a>                               <span class="at">method =</span> <span class="st">"wss"</span>,</span>
<span id="cb128-1139"><a href="#cb128-1139"></a>                               <span class="at">k.max =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb128-1140"><a href="#cb128-1140"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="at">label =</span> <span class="st">"(A) Elbow method"</span>)</span>
<span id="cb128-1141"><a href="#cb128-1141"></a></span>
<span id="cb128-1142"><a href="#cb128-1142"></a>p2 <span class="ot">&lt;-</span> factoextra<span class="sc">::</span><span class="fu">fviz_nbclust</span>(<span class="at">x =</span> points, </span>
<span id="cb128-1143"><a href="#cb128-1143"></a>                   <span class="at">FUN =</span> factoextra<span class="sc">::</span>hcut, </span>
<span id="cb128-1144"><a href="#cb128-1144"></a>                   <span class="at">method =</span> <span class="st">"silhouette"</span>, </span>
<span id="cb128-1145"><a href="#cb128-1145"></a>                   <span class="at">k.max =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb128-1146"><a href="#cb128-1146"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">"(B) Silhouette method"</span>)</span>
<span id="cb128-1147"><a href="#cb128-1147"></a></span>
<span id="cb128-1148"><a href="#cb128-1148"></a>p3 <span class="ot">&lt;-</span> factoextra<span class="sc">::</span><span class="fu">fviz_nbclust</span>(<span class="at">x =</span> points, </span>
<span id="cb128-1149"><a href="#cb128-1149"></a>                   <span class="at">FUN =</span> factoextra<span class="sc">::</span>hcut, </span>
<span id="cb128-1150"><a href="#cb128-1150"></a>                   <span class="at">method =</span> <span class="st">"gap_stat"</span>, </span>
<span id="cb128-1151"><a href="#cb128-1151"></a>                   <span class="at">k.max =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb128-1152"><a href="#cb128-1152"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">"(C) Gap statistic"</span>)</span>
<span id="cb128-1153"><a href="#cb128-1153"></a></span>
<span id="cb128-1154"><a href="#cb128-1154"></a><span class="co"># Display plots side by side</span></span>
<span id="cb128-1155"><a href="#cb128-1155"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb128-1156"><a href="#cb128-1156"></a></span>
<span id="cb128-1157"><a href="#cb128-1157"></a><span class="in">```</span></span>
<span id="cb128-1158"><a href="#cb128-1158"></a></span>
<span id="cb128-1159"><a href="#cb128-1159"></a>Another way of calculating distances is based on pearson correlation using <span class="co">[</span><span class="ot">proxy::dist</span><span class="co">]</span>. However, this only makes sense if we have data with 3 or more variables.</span>
<span id="cb128-1160"><a href="#cb128-1160"></a></span>
<span id="cb128-1163"><a href="#cb128-1163"></a><span class="in">```{r}</span></span>
<span id="cb128-1164"><a href="#cb128-1164"></a><span class="co">#| message: false</span></span>
<span id="cb128-1165"><a href="#cb128-1165"></a><span class="co">#| warning: false</span></span>
<span id="cb128-1166"><a href="#cb128-1166"></a></span>
<span id="cb128-1167"><a href="#cb128-1167"></a><span class="co"># correlation based distance</span></span>
<span id="cb128-1168"><a href="#cb128-1168"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb128-1169"><a href="#cb128-1169"></a>three_var_data <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">30</span> <span class="sc">*</span> <span class="dv">3</span>), <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb128-1170"><a href="#cb128-1170"></a></span>
<span id="cb128-1171"><a href="#cb128-1171"></a>three_var_data <span class="sc">%&gt;%</span></span>
<span id="cb128-1172"><a href="#cb128-1172"></a>  proxy<span class="sc">::</span><span class="fu">dist</span>(<span class="at">method =</span> <span class="st">"correlation"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-1173"><a href="#cb128-1173"></a>  stats<span class="sc">::</span><span class="fu">hclust</span>(<span class="at">method =</span> <span class="st">"complete"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-1174"><a href="#cb128-1174"></a>  factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(<span class="at">main =</span> <span class="st">"complete"</span>, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb128-1175"><a href="#cb128-1175"></a></span>
<span id="cb128-1176"><a href="#cb128-1176"></a><span class="in">```</span></span>
<span id="cb128-1177"><a href="#cb128-1177"></a></span>
<span id="cb128-1178"><a href="#cb128-1178"></a><span class="in">```{r, fig.height = 8}</span></span>
<span id="cb128-1179"><a href="#cb128-1179"></a><span class="co">#| message: false</span></span>
<span id="cb128-1180"><a href="#cb128-1180"></a></span>
<span id="cb128-1181"><a href="#cb128-1181"></a><span class="co"># Plot cluster results</span></span>
<span id="cb128-1182"><a href="#cb128-1182"></a>p1 <span class="ot">&lt;-</span> factoextra<span class="sc">::</span><span class="fu">fviz_nbclust</span>(<span class="at">x =</span> three_var_data, </span>
<span id="cb128-1183"><a href="#cb128-1183"></a>                               <span class="at">FUN =</span> factoextra<span class="sc">::</span>hcut,</span>
<span id="cb128-1184"><a href="#cb128-1184"></a>                               <span class="at">method =</span> <span class="st">"wss"</span>,</span>
<span id="cb128-1185"><a href="#cb128-1185"></a>                               <span class="at">hc_metric =</span> <span class="st">"pearson"</span>,</span>
<span id="cb128-1186"><a href="#cb128-1186"></a>                               <span class="at">k.max =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb128-1187"><a href="#cb128-1187"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="at">label =</span> <span class="st">"(A) Elbow method"</span>)</span>
<span id="cb128-1188"><a href="#cb128-1188"></a></span>
<span id="cb128-1189"><a href="#cb128-1189"></a>p2 <span class="ot">&lt;-</span> factoextra<span class="sc">::</span><span class="fu">fviz_nbclust</span>(<span class="at">x =</span> three_var_data, </span>
<span id="cb128-1190"><a href="#cb128-1190"></a>                   <span class="at">FUN =</span> factoextra<span class="sc">::</span>hcut, </span>
<span id="cb128-1191"><a href="#cb128-1191"></a>                   <span class="at">method =</span> <span class="st">"silhouette"</span>,</span>
<span id="cb128-1192"><a href="#cb128-1192"></a>                   <span class="at">hc_metric =</span> <span class="st">"pearson"</span>,</span>
<span id="cb128-1193"><a href="#cb128-1193"></a>                   <span class="at">k.max =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb128-1194"><a href="#cb128-1194"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">"(B) Silhouette method"</span>)</span>
<span id="cb128-1195"><a href="#cb128-1195"></a></span>
<span id="cb128-1196"><a href="#cb128-1196"></a>p3 <span class="ot">&lt;-</span> factoextra<span class="sc">::</span><span class="fu">fviz_nbclust</span>(<span class="at">x =</span> three_var_data, </span>
<span id="cb128-1197"><a href="#cb128-1197"></a>                   <span class="at">FUN =</span> factoextra<span class="sc">::</span>hcut, </span>
<span id="cb128-1198"><a href="#cb128-1198"></a>                   <span class="at">method =</span> <span class="st">"gap_stat"</span>,</span>
<span id="cb128-1199"><a href="#cb128-1199"></a>                   <span class="at">hc_metric =</span> <span class="st">"pearson"</span>,</span>
<span id="cb128-1200"><a href="#cb128-1200"></a>                   <span class="at">k.max =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb128-1201"><a href="#cb128-1201"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">"(C) Gap statistic"</span>)</span>
<span id="cb128-1202"><a href="#cb128-1202"></a></span>
<span id="cb128-1203"><a href="#cb128-1203"></a><span class="co"># Display plots side by side</span></span>
<span id="cb128-1204"><a href="#cb128-1204"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb128-1205"><a href="#cb128-1205"></a></span>
<span id="cb128-1206"><a href="#cb128-1206"></a><span class="in">```</span></span>
<span id="cb128-1207"><a href="#cb128-1207"></a></span>
<span id="cb128-1208"><a href="#cb128-1208"></a><span class="fu"># NCI60 Data Example</span></span>
<span id="cb128-1209"><a href="#cb128-1209"></a></span>
<span id="cb128-1210"><a href="#cb128-1210"></a>Unsupervised techniques are often used in the analysis of genomic data. </span>
<span id="cb128-1211"><a href="#cb128-1211"></a></span>
<span id="cb128-1212"><a href="#cb128-1212"></a>We illustrate these techniques on the <span class="co">[</span><span class="ot">NCI60</span><span class="co">](https://rdrr.io/cran/ISLR2/man/NCI60.html)</span> cancer cell line microarray data, which consists of 6,830 gene expression measurements on 64 cancer cell lines.</span>
<span id="cb128-1213"><a href="#cb128-1213"></a></span>
<span id="cb128-1214"><a href="#cb128-1214"></a><span class="in">`labels`</span> represents the type of cancer. V_1 to V_6830 represent a gene. </span>
<span id="cb128-1215"><a href="#cb128-1215"></a></span>
<span id="cb128-1218"><a href="#cb128-1218"></a><span class="in">```{r}</span></span>
<span id="cb128-1219"><a href="#cb128-1219"></a><span class="co">#| message: false</span></span>
<span id="cb128-1220"><a href="#cb128-1220"></a></span>
<span id="cb128-1221"><a href="#cb128-1221"></a>nci60 <span class="ot">&lt;-</span> ISLR2<span class="sc">::</span>NCI60<span class="sc">$</span>data <span class="sc">%&gt;%</span></span>
<span id="cb128-1222"><a href="#cb128-1222"></a>  tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-1223"><a href="#cb128-1223"></a>  magrittr<span class="sc">::</span><span class="fu">set_colnames</span>(., <span class="fu">paste0</span>(<span class="st">"V_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(.))) <span class="sc">%&gt;%</span></span>
<span id="cb128-1224"><a href="#cb128-1224"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">factor</span>(ISLR2<span class="sc">::</span>NCI60<span class="sc">$</span>labs)) <span class="sc">%&gt;%</span></span>
<span id="cb128-1225"><a href="#cb128-1225"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(.data[[<span class="st">"label"</span>]])</span>
<span id="cb128-1226"><a href="#cb128-1226"></a></span>
<span id="cb128-1227"><a href="#cb128-1227"></a><span class="co"># head(nci60) %&gt;%</span></span>
<span id="cb128-1228"><a href="#cb128-1228"></a><span class="co">#   reactable::reactable(defaultPageSize = 10)</span></span>
<span id="cb128-1229"><a href="#cb128-1229"></a><span class="in">```</span></span>
<span id="cb128-1230"><a href="#cb128-1230"></a></span>
<span id="cb128-1231"><a href="#cb128-1231"></a><span class="fu">## PCA on the NCI60 Data</span></span>
<span id="cb128-1232"><a href="#cb128-1232"></a></span>
<span id="cb128-1233"><a href="#cb128-1233"></a>We first perform PCA on the data after scaling the variables (genes) to have standard deviation one and plot the first few principal component score vectors, in order to</span>
<span id="cb128-1234"><a href="#cb128-1234"></a>visualize the data.</span>
<span id="cb128-1235"><a href="#cb128-1235"></a></span>
<span id="cb128-1238"><a href="#cb128-1238"></a><span class="in">```{r}</span></span>
<span id="cb128-1239"><a href="#cb128-1239"></a><span class="co">#| message: false</span></span>
<span id="cb128-1240"><a href="#cb128-1240"></a></span>
<span id="cb128-1241"><a href="#cb128-1241"></a>nci60_preproc_rec <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(<span class="at">formula =</span> label <span class="sc">~</span> ., <span class="at">data =</span> nci60) <span class="sc">%&gt;%</span></span>
<span id="cb128-1242"><a href="#cb128-1242"></a>  recipes<span class="sc">::</span><span class="fu">step_normalize</span>(recipes<span class="sc">::</span><span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb128-1243"><a href="#cb128-1243"></a>  recipes<span class="sc">::</span><span class="fu">step_pca</span>(recipes<span class="sc">::</span><span class="fu">all_numeric_predictors</span>(),</span>
<span id="cb128-1244"><a href="#cb128-1244"></a>                    <span class="at">id =</span> <span class="st">"pca"</span>,</span>
<span id="cb128-1245"><a href="#cb128-1245"></a>                    <span class="at">threshold =</span> <span class="fl">0.99</span>)</span>
<span id="cb128-1246"><a href="#cb128-1246"></a></span>
<span id="cb128-1247"><a href="#cb128-1247"></a><span class="in">```</span></span>
<span id="cb128-1248"><a href="#cb128-1248"></a></span>
<span id="cb128-1249"><a href="#cb128-1249"></a></span>
<span id="cb128-1252"><a href="#cb128-1252"></a><span class="in">```{r}</span></span>
<span id="cb128-1253"><a href="#cb128-1253"></a><span class="co">#| message: false</span></span>
<span id="cb128-1254"><a href="#cb128-1254"></a></span>
<span id="cb128-1255"><a href="#cb128-1255"></a>nci60_pca_estimates <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">prep</span>(<span class="at">x =</span> nci60_preproc_rec)</span>
<span id="cb128-1256"><a href="#cb128-1256"></a>  </span>
<span id="cb128-1257"><a href="#cb128-1257"></a>nci60_pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb128-1258"><a href="#cb128-1258"></a>  <span class="fu">summary</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-1259"><a href="#cb128-1259"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-1260"><a href="#cb128-1260"></a></span>
<span id="cb128-1261"><a href="#cb128-1261"></a><span class="in">```</span></span>
<span id="cb128-1262"><a href="#cb128-1262"></a></span>
<span id="cb128-1265"><a href="#cb128-1265"></a><span class="in">```{r}</span></span>
<span id="cb128-1266"><a href="#cb128-1266"></a><span class="co">#| message: false</span></span>
<span id="cb128-1267"><a href="#cb128-1267"></a></span>
<span id="cb128-1268"><a href="#cb128-1268"></a>nci60_pca_score <span class="ot">&lt;-</span> nci60_pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb128-1269"><a href="#cb128-1269"></a>  recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data =</span> <span class="cn">NULL</span>)</span>
<span id="cb128-1270"><a href="#cb128-1270"></a>  </span>
<span id="cb128-1271"><a href="#cb128-1271"></a>  </span>
<span id="cb128-1272"><a href="#cb128-1272"></a><span class="fu">head</span>(nci60_pca_score) <span class="sc">%&gt;%</span>  </span>
<span id="cb128-1273"><a href="#cb128-1273"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-1274"><a href="#cb128-1274"></a></span>
<span id="cb128-1275"><a href="#cb128-1275"></a><span class="in">```</span></span>
<span id="cb128-1276"><a href="#cb128-1276"></a></span>
<span id="cb128-1277"><a href="#cb128-1277"></a>We visualise the projections of the NCI60 cancer cell lines onto the first three principal components</span>
<span id="cb128-1278"><a href="#cb128-1278"></a></span>
<span id="cb128-1281"><a href="#cb128-1281"></a><span class="in">```{r}</span></span>
<span id="cb128-1282"><a href="#cb128-1282"></a><span class="co">#| message: false</span></span>
<span id="cb128-1283"><a href="#cb128-1283"></a>colors <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">palette.colors</span>(<span class="at">n =</span> <span class="dv">14</span>, <span class="at">palette =</span> <span class="st">"Polychrome 36"</span>))</span>
<span id="cb128-1284"><a href="#cb128-1284"></a></span>
<span id="cb128-1285"><a href="#cb128-1285"></a>nci60_pca_score <span class="sc">%&gt;%</span></span>
<span id="cb128-1286"><a href="#cb128-1286"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"label"</span>, <span class="st">"PC01"</span>,<span class="st">"PC02"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb128-1287"><a href="#cb128-1287"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> .data[[<span class="st">"PC01"</span>]],</span>
<span id="cb128-1288"><a href="#cb128-1288"></a>                                         <span class="at">y =</span> .data[[<span class="st">"PC02"</span>]], </span>
<span id="cb128-1289"><a href="#cb128-1289"></a>                                         <span class="at">color =</span> .data[[<span class="st">"label"</span>]])) <span class="sc">+</span></span>
<span id="cb128-1290"><a href="#cb128-1290"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb128-1291"><a href="#cb128-1291"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb128-1292"><a href="#cb128-1292"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span>
<span id="cb128-1293"><a href="#cb128-1293"></a></span>
<span id="cb128-1294"><a href="#cb128-1294"></a><span class="in">```</span></span>
<span id="cb128-1295"><a href="#cb128-1295"></a></span>
<span id="cb128-1298"><a href="#cb128-1298"></a><span class="in">```{r}</span></span>
<span id="cb128-1299"><a href="#cb128-1299"></a><span class="co">#| message: false</span></span>
<span id="cb128-1300"><a href="#cb128-1300"></a>nci60_pca_score <span class="sc">%&gt;%</span></span>
<span id="cb128-1301"><a href="#cb128-1301"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"label"</span>, <span class="st">"PC01"</span>,<span class="st">"PC03"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb128-1302"><a href="#cb128-1302"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> .data[[<span class="st">"PC01"</span>]],</span>
<span id="cb128-1303"><a href="#cb128-1303"></a>                                         <span class="at">y =</span> .data[[<span class="st">"PC03"</span>]], </span>
<span id="cb128-1304"><a href="#cb128-1304"></a>                                         <span class="at">color =</span> .data[[<span class="st">"label"</span>]])) <span class="sc">+</span></span>
<span id="cb128-1305"><a href="#cb128-1305"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb128-1306"><a href="#cb128-1306"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb128-1307"><a href="#cb128-1307"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span>
<span id="cb128-1308"><a href="#cb128-1308"></a></span>
<span id="cb128-1309"><a href="#cb128-1309"></a><span class="in">```</span></span>
<span id="cb128-1310"><a href="#cb128-1310"></a></span>
<span id="cb128-1311"><a href="#cb128-1311"></a>Here is a scatter plot matrix </span>
<span id="cb128-1312"><a href="#cb128-1312"></a></span>
<span id="cb128-1315"><a href="#cb128-1315"></a><span class="in">```{r}</span></span>
<span id="cb128-1316"><a href="#cb128-1316"></a><span class="co">#| message: false</span></span>
<span id="cb128-1317"><a href="#cb128-1317"></a><span class="co">#| warning: false</span></span>
<span id="cb128-1318"><a href="#cb128-1318"></a></span>
<span id="cb128-1319"><a href="#cb128-1319"></a>nci60_pca_score <span class="sc">%&gt;%</span></span>
<span id="cb128-1320"><a href="#cb128-1320"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"label"</span>, <span class="st">"PC01"</span>,<span class="st">"PC02"</span>,<span class="st">"PC03"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb128-1321"><a href="#cb128-1321"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> .panel_x, </span>
<span id="cb128-1322"><a href="#cb128-1322"></a>                                         <span class="at">y =</span> .panel_y, </span>
<span id="cb128-1323"><a href="#cb128-1323"></a>                                         <span class="at">color =</span> .data[[<span class="st">"label"</span>]], </span>
<span id="cb128-1324"><a href="#cb128-1324"></a>                                         <span class="at">fill =</span> .data[[<span class="st">"label"</span>]])) <span class="sc">+</span></span>
<span id="cb128-1325"><a href="#cb128-1325"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb128-1326"><a href="#cb128-1326"></a>  ggforce<span class="sc">::</span><span class="fu">geom_autodensity</span>(<span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb128-1327"><a href="#cb128-1327"></a>  ggforce<span class="sc">::</span><span class="fu">facet_matrix</span>(<span class="at">rows =</span> ggplot2<span class="sc">::</span><span class="fu">vars</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"label"</span>)), <span class="at">layer.diag =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb128-1328"><a href="#cb128-1328"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span> </span>
<span id="cb128-1329"><a href="#cb128-1329"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb128-1330"><a href="#cb128-1330"></a>  cowplot<span class="sc">::</span><span class="fu">theme_minimal_grid</span>() <span class="sc">+</span></span>
<span id="cb128-1331"><a href="#cb128-1331"></a>  cowplot<span class="sc">::</span><span class="fu">panel_border</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb128-1332"><a href="#cb128-1332"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb128-1333"><a href="#cb128-1333"></a></span>
<span id="cb128-1334"><a href="#cb128-1334"></a><span class="in">```</span></span>
<span id="cb128-1335"><a href="#cb128-1335"></a></span>
<span id="cb128-1336"><a href="#cb128-1336"></a>How much variation are we capturing for each component?</span>
<span id="cb128-1337"><a href="#cb128-1337"></a></span>
<span id="cb128-1338"><a href="#cb128-1338"></a>We extract the pca loadings of the pca step.</span>
<span id="cb128-1339"><a href="#cb128-1339"></a></span>
<span id="cb128-1342"><a href="#cb128-1342"></a><span class="in">```{r}</span></span>
<span id="cb128-1343"><a href="#cb128-1343"></a><span class="co">#| message: false</span></span>
<span id="cb128-1344"><a href="#cb128-1344"></a></span>
<span id="cb128-1345"><a href="#cb128-1345"></a>nci60_pca_loadings <span class="ot">&lt;-</span> nci60_pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb128-1346"><a href="#cb128-1346"></a>  parsnip<span class="sc">::</span><span class="fu">tidy</span>(<span class="at">id =</span> <span class="st">"pca"</span>, <span class="at">type =</span> <span class="st">"coef"</span>)</span>
<span id="cb128-1347"><a href="#cb128-1347"></a></span>
<span id="cb128-1348"><a href="#cb128-1348"></a></span>
<span id="cb128-1349"><a href="#cb128-1349"></a><span class="fu">head</span>(nci60_pca_loadings) <span class="sc">%&gt;%</span></span>
<span id="cb128-1350"><a href="#cb128-1350"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-1351"><a href="#cb128-1351"></a></span>
<span id="cb128-1352"><a href="#cb128-1352"></a><span class="in">```</span></span>
<span id="cb128-1353"><a href="#cb128-1353"></a></span>
<span id="cb128-1354"><a href="#cb128-1354"></a>Here is how we can see the variance statistics but it is in a long form</span>
<span id="cb128-1355"><a href="#cb128-1355"></a></span>
<span id="cb128-1358"><a href="#cb128-1358"></a><span class="in">```{r}</span></span>
<span id="cb128-1359"><a href="#cb128-1359"></a><span class="co">#| message: false</span></span>
<span id="cb128-1360"><a href="#cb128-1360"></a></span>
<span id="cb128-1361"><a href="#cb128-1361"></a>nci60_pca_variance <span class="ot">&lt;-</span> nci60_pca_estimates <span class="sc">%&gt;%</span></span>
<span id="cb128-1362"><a href="#cb128-1362"></a>  parsnip<span class="sc">::</span><span class="fu">tidy</span>(<span class="at">id =</span> <span class="st">"pca"</span>, <span class="at">type =</span> <span class="st">"variance"</span>)</span>
<span id="cb128-1363"><a href="#cb128-1363"></a></span>
<span id="cb128-1364"><a href="#cb128-1364"></a><span class="in">```</span></span>
<span id="cb128-1365"><a href="#cb128-1365"></a></span>
<span id="cb128-1366"><a href="#cb128-1366"></a>Here is how we can see the variance statistics in its wide form</span>
<span id="cb128-1367"><a href="#cb128-1367"></a></span>
<span id="cb128-1370"><a href="#cb128-1370"></a><span class="in">```{r}</span></span>
<span id="cb128-1371"><a href="#cb128-1371"></a><span class="co">#| message: false</span></span>
<span id="cb128-1372"><a href="#cb128-1372"></a></span>
<span id="cb128-1373"><a href="#cb128-1373"></a>nci60_pca_variance <span class="sc">%&gt;%</span> </span>
<span id="cb128-1374"><a href="#cb128-1374"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> .data[[<span class="st">"component"</span>]], </span>
<span id="cb128-1375"><a href="#cb128-1375"></a>                     <span class="at">values_from =</span> .data[[<span class="st">"value"</span>]], </span>
<span id="cb128-1376"><a href="#cb128-1376"></a>                     <span class="at">names_prefix =</span> <span class="st">"PC"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1377"><a href="#cb128-1377"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>dplyr<span class="sc">::</span><span class="fu">all_of</span>(<span class="st">"id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1378"><a href="#cb128-1378"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-1379"><a href="#cb128-1379"></a><span class="in">```</span></span>
<span id="cb128-1380"><a href="#cb128-1380"></a></span>
<span id="cb128-1381"><a href="#cb128-1381"></a>Here is a simple plot to show the variance captured for each component.</span>
<span id="cb128-1382"><a href="#cb128-1382"></a></span>
<span id="cb128-1385"><a href="#cb128-1385"></a><span class="in">```{r}</span></span>
<span id="cb128-1386"><a href="#cb128-1386"></a><span class="co">#| message: false</span></span>
<span id="cb128-1387"><a href="#cb128-1387"></a></span>
<span id="cb128-1388"><a href="#cb128-1388"></a><span class="co"># Get the variance</span></span>
<span id="cb128-1389"><a href="#cb128-1389"></a>percent_variation <span class="ot">&lt;-</span> nci60_pca_variance <span class="sc">%&gt;%</span></span>
<span id="cb128-1390"><a href="#cb128-1390"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(.data[[<span class="st">"terms"</span>]] <span class="sc">==</span> <span class="st">"percent variance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1391"><a href="#cb128-1391"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(.data[[<span class="st">"value"</span>]])</span>
<span id="cb128-1392"><a href="#cb128-1392"></a></span>
<span id="cb128-1393"><a href="#cb128-1393"></a>percent_variation <span class="ot">&lt;-</span> percent_variation<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb128-1394"><a href="#cb128-1394"></a>component <span class="ot">=</span> <span class="fu">unique</span>(nci60_pca_loadings<span class="sc">$</span>component) <span class="sc">%&gt;%</span></span>
<span id="cb128-1395"><a href="#cb128-1395"></a>  stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="at">pattern =</span> <span class="st">"PC"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-1396"><a href="#cb128-1396"></a>  <span class="fu">as.integer</span>()</span>
<span id="cb128-1397"><a href="#cb128-1397"></a></span>
<span id="cb128-1398"><a href="#cb128-1398"></a><span class="co"># I use [1:4] to select the first four components</span></span>
<span id="cb128-1399"><a href="#cb128-1399"></a>dplyr<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">component =</span> component, </span>
<span id="cb128-1400"><a href="#cb128-1400"></a>              <span class="at">percent_var =</span> percent_variation) <span class="sc">%&gt;%</span></span>
<span id="cb128-1401"><a href="#cb128-1401"></a>  <span class="co">#dplyr::mutate(component = forcats::fct_inorder(.data[["component"]])) %&gt;%</span></span>
<span id="cb128-1402"><a href="#cb128-1402"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> .data[[<span class="st">"component"</span>]], </span>
<span id="cb128-1403"><a href="#cb128-1403"></a>                                         <span class="at">y =</span> .data[[<span class="st">"percent_var"</span>]])) <span class="sc">+</span></span>
<span id="cb128-1404"><a href="#cb128-1404"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb128-1405"><a href="#cb128-1405"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb128-1406"><a href="#cb128-1406"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb128-1407"><a href="#cb128-1407"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.title.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb128-1408"><a href="#cb128-1408"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, </span>
<span id="cb128-1409"><a href="#cb128-1409"></a>                <span class="at">y =</span> <span class="st">"Percent variance </span><span class="sc">\n</span><span class="st">explained by each </span><span class="sc">\n</span><span class="st">PCA component"</span>)</span>
<span id="cb128-1410"><a href="#cb128-1410"></a></span>
<span id="cb128-1411"><a href="#cb128-1411"></a><span class="in">```</span></span>
<span id="cb128-1412"><a href="#cb128-1412"></a></span>
<span id="cb128-1413"><a href="#cb128-1413"></a>We see that together, the first seven principal components explain around 40% of the variance in the data.</span>
<span id="cb128-1414"><a href="#cb128-1414"></a></span>
<span id="cb128-1417"><a href="#cb128-1417"></a><span class="in">```{r}</span></span>
<span id="cb128-1418"><a href="#cb128-1418"></a><span class="co">#| message: false</span></span>
<span id="cb128-1419"><a href="#cb128-1419"></a></span>
<span id="cb128-1420"><a href="#cb128-1420"></a><span class="co"># Get the variance</span></span>
<span id="cb128-1421"><a href="#cb128-1421"></a>cumulative_percent_variation <span class="ot">&lt;-</span> nci60_pca_variance <span class="sc">%&gt;%</span></span>
<span id="cb128-1422"><a href="#cb128-1422"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(.data[[<span class="st">"terms"</span>]] <span class="sc">==</span> <span class="st">"cumulative percent variance"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1423"><a href="#cb128-1423"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(.data[[<span class="st">"value"</span>]])</span>
<span id="cb128-1424"><a href="#cb128-1424"></a></span>
<span id="cb128-1425"><a href="#cb128-1425"></a>cumulative_percent_variation <span class="ot">&lt;-</span> cumulative_percent_variation<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb128-1426"><a href="#cb128-1426"></a>component <span class="ot">=</span> <span class="fu">unique</span>(nci60_pca_loadings<span class="sc">$</span>component) <span class="sc">%&gt;%</span></span>
<span id="cb128-1427"><a href="#cb128-1427"></a>  stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="at">pattern =</span> <span class="st">"PC"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-1428"><a href="#cb128-1428"></a>  <span class="fu">as.integer</span>()</span>
<span id="cb128-1429"><a href="#cb128-1429"></a></span>
<span id="cb128-1430"><a href="#cb128-1430"></a><span class="co"># I use [1:4] to select the first four components</span></span>
<span id="cb128-1431"><a href="#cb128-1431"></a>dplyr<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">component =</span> component, </span>
<span id="cb128-1432"><a href="#cb128-1432"></a>              <span class="at">cumulative_percent_var =</span> cumulative_percent_variation) <span class="sc">%&gt;%</span></span>
<span id="cb128-1433"><a href="#cb128-1433"></a>  <span class="co">#dplyr::mutate(component = forcats::fct_inorder(.data[["component"]])) %&gt;%</span></span>
<span id="cb128-1434"><a href="#cb128-1434"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> .data[[<span class="st">"component"</span>]], </span>
<span id="cb128-1435"><a href="#cb128-1435"></a>                                         <span class="at">y =</span> .data[[<span class="st">"cumulative_percent_var"</span>]])) <span class="sc">+</span></span>
<span id="cb128-1436"><a href="#cb128-1436"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb128-1437"><a href="#cb128-1437"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb128-1438"><a href="#cb128-1438"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb128-1439"><a href="#cb128-1439"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.title.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb128-1440"><a href="#cb128-1440"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, </span>
<span id="cb128-1441"><a href="#cb128-1441"></a>                <span class="at">y =</span> <span class="st">"Cumulative percent </span><span class="sc">\n</span><span class="st">variance explained </span><span class="sc">\n</span><span class="st">by each PCA </span><span class="sc">\n</span><span class="st">component"</span>)</span>
<span id="cb128-1442"><a href="#cb128-1442"></a></span>
<span id="cb128-1443"><a href="#cb128-1443"></a><span class="in">```</span></span>
<span id="cb128-1444"><a href="#cb128-1444"></a></span>
<span id="cb128-1445"><a href="#cb128-1445"></a><span class="fu">## Clustering on NCI60 dataset (Base R)</span></span>
<span id="cb128-1446"><a href="#cb128-1446"></a></span>
<span id="cb128-1447"><a href="#cb128-1447"></a>We now proceed to hierarchically cluster the cell lines in the NCI60 data, with the goal of finding out whether or not the observations cluster into distinct types of cancer.</span>
<span id="cb128-1448"><a href="#cb128-1448"></a></span>
<span id="cb128-1449"><a href="#cb128-1449"></a>We first preprocess the data suited for hierarchical clustering</span>
<span id="cb128-1450"><a href="#cb128-1450"></a></span>
<span id="cb128-1453"><a href="#cb128-1453"></a><span class="in">```{r}</span></span>
<span id="cb128-1454"><a href="#cb128-1454"></a><span class="co">#| message: false</span></span>
<span id="cb128-1455"><a href="#cb128-1455"></a></span>
<span id="cb128-1456"><a href="#cb128-1456"></a>nci60_scaled <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(<span class="at">formula =</span> label <span class="sc">~</span> ., <span class="at">data =</span> nci60) <span class="sc">%&gt;%</span></span>
<span id="cb128-1457"><a href="#cb128-1457"></a>  recipes<span class="sc">::</span><span class="fu">step_normalize</span>(recipes<span class="sc">::</span><span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb128-1458"><a href="#cb128-1458"></a>  recipes<span class="sc">::</span><span class="fu">prep</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-1459"><a href="#cb128-1459"></a>  recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data =</span> <span class="cn">NULL</span>)</span>
<span id="cb128-1460"><a href="#cb128-1460"></a></span>
<span id="cb128-1461"><a href="#cb128-1461"></a><span class="in">```</span></span>
<span id="cb128-1462"><a href="#cb128-1462"></a></span>
<span id="cb128-1463"><a href="#cb128-1463"></a>We choose the preferred number of clusters to extract.</span>
<span id="cb128-1464"><a href="#cb128-1464"></a></span>
<span id="cb128-1465"><a href="#cb128-1465"></a><span class="in">```{r, fig.height = 8}</span></span>
<span id="cb128-1466"><a href="#cb128-1466"></a><span class="co">#| message: false</span></span>
<span id="cb128-1467"><a href="#cb128-1467"></a><span class="co">#| warning: false</span></span>
<span id="cb128-1468"><a href="#cb128-1468"></a></span>
<span id="cb128-1469"><a href="#cb128-1469"></a>nci60_num_cluster <span class="ot">&lt;-</span> nci60_scaled <span class="sc">%&gt;%</span> </span>
<span id="cb128-1470"><a href="#cb128-1470"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"label"</span>))</span>
<span id="cb128-1471"><a href="#cb128-1471"></a></span>
<span id="cb128-1472"><a href="#cb128-1472"></a><span class="co"># Plot cluster results</span></span>
<span id="cb128-1473"><a href="#cb128-1473"></a>p1 <span class="ot">&lt;-</span> factoextra<span class="sc">::</span><span class="fu">fviz_nbclust</span>(<span class="at">x =</span> nci60_num_cluster, </span>
<span id="cb128-1474"><a href="#cb128-1474"></a>                               <span class="at">FUN =</span> factoextra<span class="sc">::</span>hcut,</span>
<span id="cb128-1475"><a href="#cb128-1475"></a>                               <span class="at">method =</span> <span class="st">"wss"</span>,</span>
<span id="cb128-1476"><a href="#cb128-1476"></a>                               <span class="at">hc_metric =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb128-1477"><a href="#cb128-1477"></a>                               <span class="at">k.max =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb128-1478"><a href="#cb128-1478"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="at">label =</span> <span class="st">"(A) Elbow method"</span>)</span>
<span id="cb128-1479"><a href="#cb128-1479"></a></span>
<span id="cb128-1480"><a href="#cb128-1480"></a>p2 <span class="ot">&lt;-</span> factoextra<span class="sc">::</span><span class="fu">fviz_nbclust</span>(<span class="at">x =</span> nci60_num_cluster, </span>
<span id="cb128-1481"><a href="#cb128-1481"></a>                   <span class="at">FUN =</span> factoextra<span class="sc">::</span>hcut, </span>
<span id="cb128-1482"><a href="#cb128-1482"></a>                   <span class="at">method =</span> <span class="st">"silhouette"</span>,</span>
<span id="cb128-1483"><a href="#cb128-1483"></a>                   <span class="at">hc_metric =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb128-1484"><a href="#cb128-1484"></a>                   <span class="at">k.max =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb128-1485"><a href="#cb128-1485"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">"(B) Silhouette method"</span>)</span>
<span id="cb128-1486"><a href="#cb128-1486"></a></span>
<span id="cb128-1487"><a href="#cb128-1487"></a>p3 <span class="ot">&lt;-</span> factoextra<span class="sc">::</span><span class="fu">fviz_nbclust</span>(<span class="at">x =</span> nci60_num_cluster, </span>
<span id="cb128-1488"><a href="#cb128-1488"></a>                   <span class="at">FUN =</span> factoextra<span class="sc">::</span>hcut, </span>
<span id="cb128-1489"><a href="#cb128-1489"></a>                   <span class="at">method =</span> <span class="st">"gap_stat"</span>, </span>
<span id="cb128-1490"><a href="#cb128-1490"></a>                   <span class="at">hc_metric =</span> <span class="st">"euclidean"</span>,</span>
<span id="cb128-1491"><a href="#cb128-1491"></a>                   <span class="at">k.max =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb128-1492"><a href="#cb128-1492"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">"(C) Gap statistic"</span>)</span>
<span id="cb128-1493"><a href="#cb128-1493"></a></span>
<span id="cb128-1494"><a href="#cb128-1494"></a><span class="co"># Display plots side by side</span></span>
<span id="cb128-1495"><a href="#cb128-1495"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb128-1496"><a href="#cb128-1496"></a></span>
<span id="cb128-1497"><a href="#cb128-1497"></a><span class="in">```</span></span>
<span id="cb128-1498"><a href="#cb128-1498"></a></span>
<span id="cb128-1499"><a href="#cb128-1499"></a>We now perform hierarchical clustering of the observations using complete, single, and average linkage. Euclidean distance is used as the dissimilarity measure.</span>
<span id="cb128-1500"><a href="#cb128-1500"></a></span>
<span id="cb128-1503"><a href="#cb128-1503"></a><span class="in">```{r}</span></span>
<span id="cb128-1504"><a href="#cb128-1504"></a><span class="co">#| message: false</span></span>
<span id="cb128-1505"><a href="#cb128-1505"></a><span class="co">#| warning: false</span></span>
<span id="cb128-1506"><a href="#cb128-1506"></a></span>
<span id="cb128-1507"><a href="#cb128-1507"></a>nci60_complete <span class="ot">&lt;-</span> nci60_num_cluster <span class="sc">%&gt;%</span></span>
<span id="cb128-1508"><a href="#cb128-1508"></a>    stats<span class="sc">::</span><span class="fu">dist</span>(<span class="at">method =</span> <span class="st">"euclidean"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-1509"><a href="#cb128-1509"></a>    stats<span class="sc">::</span><span class="fu">hclust</span>(<span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb128-1510"><a href="#cb128-1510"></a></span>
<span id="cb128-1511"><a href="#cb128-1511"></a>nci60_average <span class="ot">&lt;-</span> nci60_num_cluster <span class="sc">%&gt;%</span></span>
<span id="cb128-1512"><a href="#cb128-1512"></a>    stats<span class="sc">::</span><span class="fu">dist</span>(<span class="at">method =</span> <span class="st">"euclidean"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-1513"><a href="#cb128-1513"></a>    stats<span class="sc">::</span><span class="fu">hclust</span>(<span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb128-1514"><a href="#cb128-1514"></a></span>
<span id="cb128-1515"><a href="#cb128-1515"></a>nci60_single <span class="ot">&lt;-</span> nci60_num_cluster <span class="sc">%&gt;%</span></span>
<span id="cb128-1516"><a href="#cb128-1516"></a>    stats<span class="sc">::</span><span class="fu">dist</span>(<span class="at">method =</span> <span class="st">"euclidean"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-1517"><a href="#cb128-1517"></a>    stats<span class="sc">::</span><span class="fu">hclust</span>(<span class="at">method =</span> <span class="st">"single"</span>)</span>
<span id="cb128-1518"><a href="#cb128-1518"></a></span>
<span id="cb128-1519"><a href="#cb128-1519"></a><span class="in">```</span></span>
<span id="cb128-1520"><a href="#cb128-1520"></a></span>
<span id="cb128-1521"><a href="#cb128-1521"></a>We then visualize them to see if any of them have some good natural separations.</span>
<span id="cb128-1522"><a href="#cb128-1522"></a></span>
<span id="cb128-1523"><a href="#cb128-1523"></a>Typically, single linkage will tend to yield trailing clusters: very large clusters onto which individual observations.</span>
<span id="cb128-1524"><a href="#cb128-1524"></a></span>
<span id="cb128-1525"><a href="#cb128-1525"></a>Complete and average linkage tend to yield more balanced, attractive clusters. For this reason, complete and average linkage are generally preferred to single linkage.</span>
<span id="cb128-1526"><a href="#cb128-1526"></a></span>
<span id="cb128-1527"><a href="#cb128-1527"></a>::: {.panel-tabset}</span>
<span id="cb128-1528"><a href="#cb128-1528"></a></span>
<span id="cb128-1529"><a href="#cb128-1529"></a><span class="fu">### Complete</span></span>
<span id="cb128-1530"><a href="#cb128-1530"></a></span>
<span id="cb128-1533"><a href="#cb128-1533"></a><span class="in">```{r}</span></span>
<span id="cb128-1534"><a href="#cb128-1534"></a><span class="co">#| message: false</span></span>
<span id="cb128-1535"><a href="#cb128-1535"></a><span class="co">#| warning: false</span></span>
<span id="cb128-1536"><a href="#cb128-1536"></a></span>
<span id="cb128-1537"><a href="#cb128-1537"></a></span>
<span id="cb128-1538"><a href="#cb128-1538"></a>nci60_complete<span class="sc">$</span>labels <span class="ot">&lt;-</span> nci60_scaled<span class="sc">$</span>label</span>
<span id="cb128-1539"><a href="#cb128-1539"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(nci60_complete, <span class="at">main =</span> <span class="st">"complete"</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb128-1540"><a href="#cb128-1540"></a></span>
<span id="cb128-1541"><a href="#cb128-1541"></a>stats<span class="sc">::</span><span class="fu">cutree</span>(<span class="at">tree =</span> nci60_complete, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb128-1542"><a href="#cb128-1542"></a></span>
<span id="cb128-1543"><a href="#cb128-1543"></a><span class="in">```</span></span>
<span id="cb128-1544"><a href="#cb128-1544"></a></span>
<span id="cb128-1545"><a href="#cb128-1545"></a><span class="fu">### Average</span></span>
<span id="cb128-1546"><a href="#cb128-1546"></a></span>
<span id="cb128-1549"><a href="#cb128-1549"></a><span class="in">```{r}</span></span>
<span id="cb128-1550"><a href="#cb128-1550"></a><span class="co">#| message: false</span></span>
<span id="cb128-1551"><a href="#cb128-1551"></a><span class="co">#| warning: false</span></span>
<span id="cb128-1552"><a href="#cb128-1552"></a></span>
<span id="cb128-1553"><a href="#cb128-1553"></a>nci60_average<span class="sc">$</span>labels <span class="ot">&lt;-</span> nci60_scaled<span class="sc">$</span>label</span>
<span id="cb128-1554"><a href="#cb128-1554"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(nci60_average, <span class="at">main =</span> <span class="st">"average"</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb128-1555"><a href="#cb128-1555"></a></span>
<span id="cb128-1556"><a href="#cb128-1556"></a>stats<span class="sc">::</span><span class="fu">cutree</span>(<span class="at">tree =</span> nci60_average, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb128-1557"><a href="#cb128-1557"></a></span>
<span id="cb128-1558"><a href="#cb128-1558"></a><span class="in">```</span></span>
<span id="cb128-1559"><a href="#cb128-1559"></a></span>
<span id="cb128-1560"><a href="#cb128-1560"></a><span class="fu">### Single</span></span>
<span id="cb128-1561"><a href="#cb128-1561"></a></span>
<span id="cb128-1564"><a href="#cb128-1564"></a><span class="in">```{r}</span></span>
<span id="cb128-1565"><a href="#cb128-1565"></a><span class="co">#| message: false</span></span>
<span id="cb128-1566"><a href="#cb128-1566"></a><span class="co">#| warning: false</span></span>
<span id="cb128-1567"><a href="#cb128-1567"></a></span>
<span id="cb128-1568"><a href="#cb128-1568"></a>nci60_single<span class="sc">$</span>labels <span class="ot">&lt;-</span> nci60_scaled<span class="sc">$</span>label</span>
<span id="cb128-1569"><a href="#cb128-1569"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(nci60_single, <span class="at">main =</span> <span class="st">"single"</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb128-1570"><a href="#cb128-1570"></a></span>
<span id="cb128-1571"><a href="#cb128-1571"></a>stats<span class="sc">::</span><span class="fu">cutree</span>(<span class="at">tree =</span> nci60_single, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb128-1572"><a href="#cb128-1572"></a></span>
<span id="cb128-1573"><a href="#cb128-1573"></a><span class="in">```</span></span>
<span id="cb128-1574"><a href="#cb128-1574"></a></span>
<span id="cb128-1575"><a href="#cb128-1575"></a>:::</span>
<span id="cb128-1576"><a href="#cb128-1576"></a></span>
<span id="cb128-1577"><a href="#cb128-1577"></a>We will use complete linkage hierarchical clustering for the analysis that follows.</span>
<span id="cb128-1578"><a href="#cb128-1578"></a>We calculate which Label is the most common within each cluster.</span>
<span id="cb128-1579"><a href="#cb128-1579"></a></span>
<span id="cb128-1582"><a href="#cb128-1582"></a><span class="in">```{r}</span></span>
<span id="cb128-1583"><a href="#cb128-1583"></a><span class="co">#| message: false</span></span>
<span id="cb128-1584"><a href="#cb128-1584"></a><span class="co">#| warning: false</span></span>
<span id="cb128-1585"><a href="#cb128-1585"></a></span>
<span id="cb128-1586"><a href="#cb128-1586"></a>tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb128-1587"><a href="#cb128-1587"></a>  <span class="at">label =</span> nci60<span class="sc">$</span>label,</span>
<span id="cb128-1588"><a href="#cb128-1588"></a>  <span class="at">cluster_id =</span> stats<span class="sc">::</span><span class="fu">cutree</span>(nci60_complete, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb128-1589"><a href="#cb128-1589"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb128-1590"><a href="#cb128-1590"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(.data[[<span class="st">"label"</span>]], .data[[<span class="st">"cluster_id"</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb128-1591"><a href="#cb128-1591"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(.data[[<span class="st">"cluster_id"</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb128-1592"><a href="#cb128-1592"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">total =</span> <span class="fu">sum</span>(.data[[<span class="st">"n"</span>]]),</span>
<span id="cb128-1593"><a href="#cb128-1593"></a>                <span class="at">prop =</span> .data[[<span class="st">"n"</span>]] <span class="sc">/</span> <span class="fu">sum</span>(.data[[<span class="st">"n"</span>]])) <span class="sc">%&gt;%</span></span>
<span id="cb128-1594"><a href="#cb128-1594"></a>  dplyr<span class="sc">::</span><span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">order_by =</span> .data[[<span class="st">"prop"</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb128-1595"><a href="#cb128-1595"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-1596"><a href="#cb128-1596"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>()</span>
<span id="cb128-1597"><a href="#cb128-1597"></a></span>
<span id="cb128-1598"><a href="#cb128-1598"></a><span class="in">```</span></span>
<span id="cb128-1599"><a href="#cb128-1599"></a></span>
<span id="cb128-1600"><a href="#cb128-1600"></a>How do these NCI60 hierarchical clustering results compare to what we get if we perform K-means clustering with K = 4?</span>
<span id="cb128-1601"><a href="#cb128-1601"></a></span>
<span id="cb128-1604"><a href="#cb128-1604"></a><span class="in">```{r}</span></span>
<span id="cb128-1605"><a href="#cb128-1605"></a><span class="co">#| message: false</span></span>
<span id="cb128-1606"><a href="#cb128-1606"></a></span>
<span id="cb128-1607"><a href="#cb128-1607"></a>nci60_kmeans_results <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(nci60_num_cluster, <span class="at">centers =</span> <span class="dv">4</span>, <span class="at">nstart =</span> <span class="dv">50</span>)</span>
<span id="cb128-1608"><a href="#cb128-1608"></a></span>
<span id="cb128-1609"><a href="#cb128-1609"></a><span class="in">```</span></span>
<span id="cb128-1610"><a href="#cb128-1610"></a></span>
<span id="cb128-1613"><a href="#cb128-1613"></a><span class="in">```{r}</span></span>
<span id="cb128-1614"><a href="#cb128-1614"></a><span class="co">#| message: false</span></span>
<span id="cb128-1615"><a href="#cb128-1615"></a></span>
<span id="cb128-1616"><a href="#cb128-1616"></a>nci60_kmeans_results <span class="sc">%&gt;%</span> </span>
<span id="cb128-1617"><a href="#cb128-1617"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-1618"><a href="#cb128-1618"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(cluster, size, withinss) <span class="sc">%&gt;%</span></span>
<span id="cb128-1619"><a href="#cb128-1619"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>()</span>
<span id="cb128-1620"><a href="#cb128-1620"></a></span>
<span id="cb128-1621"><a href="#cb128-1621"></a><span class="in">```</span></span>
<span id="cb128-1622"><a href="#cb128-1622"></a></span>
<span id="cb128-1623"><a href="#cb128-1623"></a>We see that the four clusters obtained using hierarchical clustering and Kmeans clustering are somewhat different.</span>
<span id="cb128-1624"><a href="#cb128-1624"></a></span>
<span id="cb128-1627"><a href="#cb128-1627"></a><span class="in">```{r}</span></span>
<span id="cb128-1628"><a href="#cb128-1628"></a><span class="co">#| message: false</span></span>
<span id="cb128-1629"><a href="#cb128-1629"></a></span>
<span id="cb128-1630"><a href="#cb128-1630"></a>cluster_kmeans <span class="ot">&lt;-</span> nci60_kmeans_results<span class="sc">$</span>cluster</span>
<span id="cb128-1631"><a href="#cb128-1631"></a>cluster_hclust <span class="ot">&lt;-</span> <span class="fu">cutree</span>(nci60_complete, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb128-1632"><a href="#cb128-1632"></a></span>
<span id="cb128-1633"><a href="#cb128-1633"></a><span class="fu">table</span>(cluster_hclust, cluster_kmeans)</span>
<span id="cb128-1634"><a href="#cb128-1634"></a></span>
<span id="cb128-1635"><a href="#cb128-1635"></a><span class="fu">tibble</span>(</span>
<span id="cb128-1636"><a href="#cb128-1636"></a>  <span class="at">kmeans =</span> <span class="fu">factor</span>(cluster_kmeans),</span>
<span id="cb128-1637"><a href="#cb128-1637"></a>  <span class="at">hclust =</span> <span class="fu">factor</span>(cluster_hclust)</span>
<span id="cb128-1638"><a href="#cb128-1638"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb128-1639"><a href="#cb128-1639"></a>  yardstick<span class="sc">::</span><span class="fu">conf_mat</span>(<span class="at">truth =</span> kmeans, </span>
<span id="cb128-1640"><a href="#cb128-1640"></a>                      <span class="at">estimate =</span> hclust,</span>
<span id="cb128-1641"><a href="#cb128-1641"></a>                      <span class="at">dnn =</span> <span class="fu">c</span>(<span class="st">"Hierarchical clustering"</span>, <span class="st">"K-means"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb128-1642"><a href="#cb128-1642"></a>  parsnip<span class="sc">::</span><span class="fu">autoplot</span>(<span class="at">type =</span> <span class="st">"heatmap"</span>)</span>
<span id="cb128-1643"><a href="#cb128-1643"></a><span class="in">```</span></span>
<span id="cb128-1644"><a href="#cb128-1644"></a></span>
<span id="cb128-1645"><a href="#cb128-1645"></a>Cluster 2 in K-means clustering is identical to cluster 4 in hierarchical clustering. However, the other clusters defer. For the twenty seven samples in K-means Cluster 3, twenty goes to hierarchical clustering Cluster 1 and seven goes to hierarchical clustering Cluster 2.</span>
<span id="cb128-1646"><a href="#cb128-1646"></a></span>
<span id="cb128-1647"><a href="#cb128-1647"></a>Rather than performing hierarchical clustering on the entire data matrix, we can also perform hierarchical clustering on the first few principal component score vectors, as follows:</span>
<span id="cb128-1648"><a href="#cb128-1648"></a></span>
<span id="cb128-1651"><a href="#cb128-1651"></a><span class="in">```{r}</span></span>
<span id="cb128-1652"><a href="#cb128-1652"></a><span class="co">#| message: false</span></span>
<span id="cb128-1653"><a href="#cb128-1653"></a></span>
<span id="cb128-1654"><a href="#cb128-1654"></a><span class="co"># nci60_scaled &lt;- recipes::recipe(formula = label ~ ., data = nci60) %&gt;%</span></span>
<span id="cb128-1655"><a href="#cb128-1655"></a><span class="co">#   recipes::step_normalize(recipes::all_numeric_predictors()) %&gt;%</span></span>
<span id="cb128-1656"><a href="#cb128-1656"></a><span class="co">#   recipes::prep() %&gt;%</span></span>
<span id="cb128-1657"><a href="#cb128-1657"></a><span class="co">#   recipes::bake(new_data = NULL)</span></span>
<span id="cb128-1658"><a href="#cb128-1658"></a></span>
<span id="cb128-1659"><a href="#cb128-1659"></a>nci60_pca <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(<span class="sc">~</span>., nci60_scaled) <span class="sc">%&gt;%</span></span>
<span id="cb128-1660"><a href="#cb128-1660"></a>  <span class="fu">step_pca</span>(recipes<span class="sc">::</span><span class="fu">all_numeric_predictors</span>(), <span class="at">num_comp =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-1661"><a href="#cb128-1661"></a>  recipes<span class="sc">::</span><span class="fu">prep</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-1662"><a href="#cb128-1662"></a>  recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data =</span> <span class="cn">NULL</span>)</span>
<span id="cb128-1663"><a href="#cb128-1663"></a><span class="in">```</span></span>
<span id="cb128-1664"><a href="#cb128-1664"></a></span>
<span id="cb128-1667"><a href="#cb128-1667"></a><span class="in">```{r}</span></span>
<span id="cb128-1668"><a href="#cb128-1668"></a><span class="co">#| message: false</span></span>
<span id="cb128-1669"><a href="#cb128-1669"></a><span class="co">#| warning: false</span></span>
<span id="cb128-1670"><a href="#cb128-1670"></a></span>
<span id="cb128-1671"><a href="#cb128-1671"></a>nci60_pca_complete <span class="ot">&lt;-</span> nci60_pca <span class="sc">%&gt;%</span></span>
<span id="cb128-1672"><a href="#cb128-1672"></a>    stats<span class="sc">::</span><span class="fu">dist</span>(<span class="at">method =</span> <span class="st">"euclidean"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-1673"><a href="#cb128-1673"></a>    stats<span class="sc">::</span><span class="fu">hclust</span>(<span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb128-1674"><a href="#cb128-1674"></a></span>
<span id="cb128-1675"><a href="#cb128-1675"></a>nci60_pca_complete<span class="sc">$</span>labels <span class="ot">&lt;-</span> nci60_pca<span class="sc">$</span>label</span>
<span id="cb128-1676"><a href="#cb128-1676"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(nci60_pca_complete, <span class="at">main =</span> <span class="st">"complete"</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb128-1677"><a href="#cb128-1677"></a></span>
<span id="cb128-1678"><a href="#cb128-1678"></a>stats<span class="sc">::</span><span class="fu">cutree</span>(<span class="at">tree =</span> nci60_pca_complete, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb128-1679"><a href="#cb128-1679"></a></span>
<span id="cb128-1680"><a href="#cb128-1680"></a><span class="in">```</span></span>
<span id="cb128-1681"><a href="#cb128-1681"></a></span>
<span id="cb128-1682"><a href="#cb128-1682"></a><span class="fu">## Clustering on NCI60 dataset (tidyclust)</span></span>
<span id="cb128-1683"><a href="#cb128-1683"></a></span>
<span id="cb128-1684"><a href="#cb128-1684"></a>Recall that we scale the data before clustering and remove the labels.</span>
<span id="cb128-1685"><a href="#cb128-1685"></a></span>
<span id="cb128-1688"><a href="#cb128-1688"></a><span class="in">```{r}</span></span>
<span id="cb128-1689"><a href="#cb128-1689"></a><span class="co">#| message: false</span></span>
<span id="cb128-1690"><a href="#cb128-1690"></a></span>
<span id="cb128-1691"><a href="#cb128-1691"></a>nci60_scaled <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(<span class="at">formula =</span> label <span class="sc">~</span> ., <span class="at">data =</span> nci60) <span class="sc">%&gt;%</span></span>
<span id="cb128-1692"><a href="#cb128-1692"></a>  recipes<span class="sc">::</span><span class="fu">step_normalize</span>(recipes<span class="sc">::</span><span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb128-1693"><a href="#cb128-1693"></a>  recipes<span class="sc">::</span><span class="fu">prep</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-1694"><a href="#cb128-1694"></a>  recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data =</span> <span class="cn">NULL</span>)</span>
<span id="cb128-1695"><a href="#cb128-1695"></a></span>
<span id="cb128-1696"><a href="#cb128-1696"></a>nci60_num_cluster <span class="ot">&lt;-</span> nci60_scaled <span class="sc">%&gt;%</span> </span>
<span id="cb128-1697"><a href="#cb128-1697"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"label"</span>))</span>
<span id="cb128-1698"><a href="#cb128-1698"></a></span>
<span id="cb128-1699"><a href="#cb128-1699"></a><span class="in">```</span></span>
<span id="cb128-1700"><a href="#cb128-1700"></a></span>
<span id="cb128-1701"><a href="#cb128-1701"></a>Here is how we can create the clustering elbow plot using <span class="in">`tidyclust`</span></span>
<span id="cb128-1702"><a href="#cb128-1702"></a></span>
<span id="cb128-1705"><a href="#cb128-1705"></a><span class="in">```{r}</span></span>
<span id="cb128-1706"><a href="#cb128-1706"></a>kmeans_spec <span class="ot">&lt;-</span> tidyclust<span class="sc">::</span><span class="fu">k_means</span>(</span>
<span id="cb128-1707"><a href="#cb128-1707"></a>  <span class="at">num_clusters =</span> tune<span class="sc">::</span><span class="fu">tune</span>())</span>
<span id="cb128-1708"><a href="#cb128-1708"></a></span>
<span id="cb128-1709"><a href="#cb128-1709"></a>nci60_cv <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">vfold_cv</span>(nci60_num_cluster, <span class="at">v =</span> <span class="dv">5</span>)</span>
<span id="cb128-1710"><a href="#cb128-1710"></a></span>
<span id="cb128-1711"><a href="#cb128-1711"></a>nci60_rec <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(<span class="at">formula =</span> <span class="sc">~</span> ., <span class="at">data =</span> nci60_num_cluster)</span>
<span id="cb128-1712"><a href="#cb128-1712"></a></span>
<span id="cb128-1713"><a href="#cb128-1713"></a>kmeans_wflow <span class="ot">&lt;-</span> workflows<span class="sc">::</span><span class="fu">workflow</span>(nci60_rec, kmeans_spec)</span>
<span id="cb128-1714"><a href="#cb128-1714"></a></span>
<span id="cb128-1715"><a href="#cb128-1715"></a>clust_num_grid <span class="ot">&lt;-</span> dials<span class="sc">::</span><span class="fu">grid_regular</span>(</span>
<span id="cb128-1716"><a href="#cb128-1716"></a>  tidyclust<span class="sc">::</span><span class="fu">num_clusters</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">15</span>)), </span>
<span id="cb128-1717"><a href="#cb128-1717"></a>  <span class="at">levels =</span> <span class="dv">15</span>)</span>
<span id="cb128-1718"><a href="#cb128-1718"></a></span>
<span id="cb128-1719"><a href="#cb128-1719"></a>clust_num_grid <span class="sc">%&gt;%</span></span>
<span id="cb128-1720"><a href="#cb128-1720"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-1721"><a href="#cb128-1721"></a></span>
<span id="cb128-1722"><a href="#cb128-1722"></a>res <span class="ot">&lt;-</span> tidyclust<span class="sc">::</span><span class="fu">tune_cluster</span>(</span>
<span id="cb128-1723"><a href="#cb128-1723"></a> kmeans_wflow,</span>
<span id="cb128-1724"><a href="#cb128-1724"></a> <span class="at">resamples =</span> nci60_cv,</span>
<span id="cb128-1725"><a href="#cb128-1725"></a> <span class="at">grid =</span> clust_num_grid,</span>
<span id="cb128-1726"><a href="#cb128-1726"></a> <span class="at">control =</span> tune<span class="sc">::</span><span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>, <span class="at">extract =</span> identity),</span>
<span id="cb128-1727"><a href="#cb128-1727"></a> <span class="at">metrics =</span> tidyclust<span class="sc">::</span><span class="fu">cluster_metric_set</span>(tidyclust<span class="sc">::</span>sse_ratio)</span>
<span id="cb128-1728"><a href="#cb128-1728"></a>) </span>
<span id="cb128-1729"><a href="#cb128-1729"></a></span>
<span id="cb128-1730"><a href="#cb128-1730"></a>res_metrics <span class="ot">&lt;-</span> res <span class="sc">%&gt;%</span> tune<span class="sc">::</span><span class="fu">collect_metrics</span>()</span>
<span id="cb128-1731"><a href="#cb128-1731"></a></span>
<span id="cb128-1732"><a href="#cb128-1732"></a>res_metrics <span class="sc">%&gt;%</span></span>
<span id="cb128-1733"><a href="#cb128-1733"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-1734"><a href="#cb128-1734"></a></span>
<span id="cb128-1735"><a href="#cb128-1735"></a>res_metrics <span class="sc">%&gt;%</span></span>
<span id="cb128-1736"><a href="#cb128-1736"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">"sse_ratio"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-1737"><a href="#cb128-1737"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .data[[<span class="st">"num_clusters"</span>]], </span>
<span id="cb128-1738"><a href="#cb128-1738"></a>                      <span class="at">y =</span> .data[[<span class="st">"mean"</span>]])) <span class="sc">+</span></span>
<span id="cb128-1739"><a href="#cb128-1739"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb128-1740"><a href="#cb128-1740"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb128-1741"><a href="#cb128-1741"></a>  <span class="fu">ylab</span>(<span class="st">"mean WSS/TSS ratio, over 5 folds"</span>) <span class="sc">+</span></span>
<span id="cb128-1742"><a href="#cb128-1742"></a>  <span class="fu">xlab</span>(<span class="st">"Number of clusters"</span>) <span class="sc">+</span></span>
<span id="cb128-1743"><a href="#cb128-1743"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>)</span>
<span id="cb128-1744"><a href="#cb128-1744"></a><span class="in">```</span></span>
<span id="cb128-1745"><a href="#cb128-1745"></a></span>
<span id="cb128-1746"><a href="#cb128-1746"></a></span>
<span id="cb128-1747"><a href="#cb128-1747"></a><span class="co">[</span><span class="ot">`tidyclust::hier_clust`</span><span class="co">](https://emilhvitfeldt.github.io/tidyclust/reference/hier_clust.html)</span> is used to do the hierarchical clustering. Here, we set the number of clusters to three and use the complete linkage method. It actually uses <span class="co">[</span><span class="ot">`stats::hclust()`</span><span class="co">](https://rdrr.io/r/stats/hclust.html)</span> and Euclidean distance under the hood.</span>
<span id="cb128-1748"><a href="#cb128-1748"></a></span>
<span id="cb128-1751"><a href="#cb128-1751"></a><span class="in">```{r}</span></span>
<span id="cb128-1752"><a href="#cb128-1752"></a>hc_spec <span class="ot">&lt;-</span> tidyclust<span class="sc">::</span><span class="fu">hier_clust</span>(</span>
<span id="cb128-1753"><a href="#cb128-1753"></a>  <span class="at">num_clusters =</span> <span class="dv">3</span>,</span>
<span id="cb128-1754"><a href="#cb128-1754"></a>  <span class="at">linkage_method =</span> <span class="st">"complete"</span>)</span>
<span id="cb128-1755"><a href="#cb128-1755"></a></span>
<span id="cb128-1756"><a href="#cb128-1756"></a>hc_fit <span class="ot">&lt;-</span> hc_spec <span class="sc">%&gt;%</span></span>
<span id="cb128-1757"><a href="#cb128-1757"></a>  tidyclust<span class="sc">::</span><span class="fu">fit</span>(label <span class="sc">~</span> .,<span class="at">data =</span> nci60_scaled)</span>
<span id="cb128-1758"><a href="#cb128-1758"></a><span class="in">```</span></span>
<span id="cb128-1759"><a href="#cb128-1759"></a></span>
<span id="cb128-1760"><a href="#cb128-1760"></a>We use <span class="co">[</span><span class="ot">`tidyclust::within_cluster_sse`</span><span class="co">](https://emilhvitfeldt.github.io/tidyclust/reference/within_cluster_sse.html)</span> to calculate the Sum of Squared Error in each cluster</span>
<span id="cb128-1761"><a href="#cb128-1761"></a></span>
<span id="cb128-1764"><a href="#cb128-1764"></a><span class="in">```{r}</span></span>
<span id="cb128-1765"><a href="#cb128-1765"></a>hc_fit <span class="sc">%&gt;%</span></span>
<span id="cb128-1766"><a href="#cb128-1766"></a>  tidyclust<span class="sc">::</span><span class="fu">within_cluster_sse</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-1767"><a href="#cb128-1767"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-1768"><a href="#cb128-1768"></a></span>
<span id="cb128-1769"><a href="#cb128-1769"></a><span class="in">```</span></span>
<span id="cb128-1770"><a href="#cb128-1770"></a></span>
<span id="cb128-1771"><a href="#cb128-1771"></a>We use <span class="co">[</span><span class="ot">`tidyclust::tot_sse`</span><span class="co">](https://emilhvitfeldt.github.io/tidyclust/reference/tot_sse.html)</span> to calculate the total sum of squares.</span>
<span id="cb128-1772"><a href="#cb128-1772"></a></span>
<span id="cb128-1775"><a href="#cb128-1775"></a><span class="in">```{r}</span></span>
<span id="cb128-1776"><a href="#cb128-1776"></a>hc_fit <span class="sc">%&gt;%</span> </span>
<span id="cb128-1777"><a href="#cb128-1777"></a>  tidyclust<span class="sc">::</span><span class="fu">tot_sse</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-1778"><a href="#cb128-1778"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-1779"><a href="#cb128-1779"></a><span class="in">```</span></span>
<span id="cb128-1780"><a href="#cb128-1780"></a></span>
<span id="cb128-1781"><a href="#cb128-1781"></a>We use <span class="co">[</span><span class="ot">`tidyclust::sse_ratio`</span><span class="co">](https://emilhvitfeldt.github.io/tidyclust/reference/sse_ratio.html)</span> to calculate the ratio of the WSS to the total SSE.</span>
<span id="cb128-1782"><a href="#cb128-1782"></a></span>
<span id="cb128-1785"><a href="#cb128-1785"></a><span class="in">```{r}</span></span>
<span id="cb128-1786"><a href="#cb128-1786"></a>hc_fit <span class="sc">%&gt;%</span> </span>
<span id="cb128-1787"><a href="#cb128-1787"></a>  tidyclust<span class="sc">::</span><span class="fu">sse_ratio</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-1788"><a href="#cb128-1788"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-1789"><a href="#cb128-1789"></a><span class="in">```</span></span>
<span id="cb128-1790"><a href="#cb128-1790"></a></span>
<span id="cb128-1791"><a href="#cb128-1791"></a>We use <span class="co">[</span><span class="ot">`tidyclust::silhouettes`</span><span class="co">](https://emilhvitfeldt.github.io/tidyclust/reference/silhouettes.html)</span> to measure silhouettes between clusters for all observations.</span>
<span id="cb128-1792"><a href="#cb128-1792"></a>Ensure that the labels are removed.</span>
<span id="cb128-1793"><a href="#cb128-1793"></a></span>
<span id="cb128-1796"><a href="#cb128-1796"></a><span class="in">```{r}</span></span>
<span id="cb128-1797"><a href="#cb128-1797"></a>hc_fit <span class="sc">%&gt;%</span> </span>
<span id="cb128-1798"><a href="#cb128-1798"></a>  tidyclust<span class="sc">::</span><span class="fu">silhouettes</span>(<span class="at">new_data =</span> nci60_num_cluster) <span class="sc">%&gt;%</span></span>
<span id="cb128-1799"><a href="#cb128-1799"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-1800"><a href="#cb128-1800"></a>  </span>
<span id="cb128-1801"><a href="#cb128-1801"></a><span class="in">```</span></span>
<span id="cb128-1802"><a href="#cb128-1802"></a></span>
<span id="cb128-1803"><a href="#cb128-1803"></a>We use <span class="co">[</span><span class="ot">`tidyclust::avg_silhouette`</span><span class="co">](https://emilhvitfeldt.github.io/tidyclust/reference/avg_silhouette.html)</span> to measure average silhouettes across all observations.</span>
<span id="cb128-1804"><a href="#cb128-1804"></a>Ensure that the labels are removed. (This is also the mean of the column <span class="in">`sil_width`</span>)</span>
<span id="cb128-1805"><a href="#cb128-1805"></a></span>
<span id="cb128-1808"><a href="#cb128-1808"></a><span class="in">```{r}</span></span>
<span id="cb128-1809"><a href="#cb128-1809"></a>hc_fit <span class="sc">%&gt;%</span> </span>
<span id="cb128-1810"><a href="#cb128-1810"></a>  tidyclust<span class="sc">::</span><span class="fu">avg_silhouette</span>(<span class="at">new_data =</span> nci60_num_cluster) <span class="sc">%&gt;%</span></span>
<span id="cb128-1811"><a href="#cb128-1811"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-1812"><a href="#cb128-1812"></a><span class="in">```</span></span>
<span id="cb128-1813"><a href="#cb128-1813"></a></span>
<span id="cb128-1814"><a href="#cb128-1814"></a>Use <span class="co">[</span><span class="ot">`tidyclust::cluster_metric_set`</span><span class="co">](https://emilhvitfeldt.github.io/tidyclust/reference/cluster_metric_set.html)</span> to combine the metrics together.</span>
<span id="cb128-1815"><a href="#cb128-1815"></a></span>
<span id="cb128-1818"><a href="#cb128-1818"></a><span class="in">```{r}</span></span>
<span id="cb128-1819"><a href="#cb128-1819"></a>many_metrics <span class="ot">&lt;-</span> tidyclust<span class="sc">::</span><span class="fu">cluster_metric_set</span>(</span>
<span id="cb128-1820"><a href="#cb128-1820"></a>  tidyclust<span class="sc">::</span>tot_wss,</span>
<span id="cb128-1821"><a href="#cb128-1821"></a>  tidyclust<span class="sc">::</span>tot_sse,</span>
<span id="cb128-1822"><a href="#cb128-1822"></a>  tidyclust<span class="sc">::</span>sse_ratio,</span>
<span id="cb128-1823"><a href="#cb128-1823"></a>  tidyclust<span class="sc">::</span>avg_silhouette)</span>
<span id="cb128-1824"><a href="#cb128-1824"></a></span>
<span id="cb128-1825"><a href="#cb128-1825"></a><span class="co"># new_data required for tidyclust::avg_silhouette to work</span></span>
<span id="cb128-1826"><a href="#cb128-1826"></a>hc_fit <span class="sc">%&gt;%</span></span>
<span id="cb128-1827"><a href="#cb128-1827"></a>  <span class="fu">many_metrics</span>(<span class="at">new_data =</span> nci60_num_cluster) <span class="sc">%&gt;%</span></span>
<span id="cb128-1828"><a href="#cb128-1828"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-1829"><a href="#cb128-1829"></a></span>
<span id="cb128-1830"><a href="#cb128-1830"></a><span class="in">```</span></span>
<span id="cb128-1831"><a href="#cb128-1831"></a></span>
<span id="cb128-1832"><a href="#cb128-1832"></a>We use <span class="co">[</span><span class="ot">`tidyclust::extract_cluster_assignment`</span><span class="co">](https://emilhvitfeldt.github.io/tidyclust/reference/extract_cluster_assignment.html)</span> to see the cluster assignments. However, the labels need to be updated.</span>
<span id="cb128-1833"><a href="#cb128-1833"></a></span>
<span id="cb128-1836"><a href="#cb128-1836"></a><span class="in">```{r}</span></span>
<span id="cb128-1837"><a href="#cb128-1837"></a>hc_fit <span class="sc">%&gt;%</span></span>
<span id="cb128-1838"><a href="#cb128-1838"></a>  tidyclust<span class="sc">::</span><span class="fu">extract_cluster_assignment</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-1839"><a href="#cb128-1839"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">labels =</span> nci60_scaled<span class="sc">$</span>label) <span class="sc">%&gt;%</span></span>
<span id="cb128-1840"><a href="#cb128-1840"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-1841"><a href="#cb128-1841"></a></span>
<span id="cb128-1842"><a href="#cb128-1842"></a><span class="in">```</span></span>
<span id="cb128-1843"><a href="#cb128-1843"></a></span>
<span id="cb128-1844"><a href="#cb128-1844"></a>Centroid can be extracted using <span class="co">[</span><span class="ot">`extract_centroids`</span><span class="co">](https://emilhvitfeldt.github.io/tidyclust/reference/extract_centroids.html)</span>. Here is a preview of the first few columns. For hierarchical clustering, the geometric mean over the predictors for each cluster is used.</span>
<span id="cb128-1845"><a href="#cb128-1845"></a></span>
<span id="cb128-1848"><a href="#cb128-1848"></a><span class="in">```{r}</span></span>
<span id="cb128-1849"><a href="#cb128-1849"></a>hc_fit_centroids <span class="ot">&lt;-</span> hc_fit <span class="sc">%&gt;%</span> </span>
<span id="cb128-1850"><a href="#cb128-1850"></a>  tidyclust<span class="sc">::</span><span class="fu">extract_centroids</span>()</span>
<span id="cb128-1851"><a href="#cb128-1851"></a></span>
<span id="cb128-1852"><a href="#cb128-1852"></a>hc_fit_centroids[,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>] <span class="sc">%&gt;%</span></span>
<span id="cb128-1853"><a href="#cb128-1853"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-1854"><a href="#cb128-1854"></a><span class="in">```</span></span>
<span id="cb128-1855"><a href="#cb128-1855"></a></span>
<span id="cb128-1856"><a href="#cb128-1856"></a>Here is how to see the plots. <span class="in">`hc_fit$fit`</span> gives back the <span class="in">`hclust`</span> object. We can plot the hierarchical clustering results.</span>
<span id="cb128-1857"><a href="#cb128-1857"></a></span>
<span id="cb128-1860"><a href="#cb128-1860"></a><span class="in">```{r}</span></span>
<span id="cb128-1861"><a href="#cb128-1861"></a><span class="co">#| message: false</span></span>
<span id="cb128-1862"><a href="#cb128-1862"></a><span class="co">#| warning: false</span></span>
<span id="cb128-1863"><a href="#cb128-1863"></a></span>
<span id="cb128-1864"><a href="#cb128-1864"></a></span>
<span id="cb128-1865"><a href="#cb128-1865"></a>hc_fit<span class="sc">$</span>fit<span class="sc">$</span>labels <span class="ot">&lt;-</span> nci60_scaled<span class="sc">$</span>label</span>
<span id="cb128-1866"><a href="#cb128-1866"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(hc_fit<span class="sc">$</span>fit, <span class="at">main =</span> <span class="st">"complete"</span>, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb128-1867"><a href="#cb128-1867"></a></span>
<span id="cb128-1868"><a href="#cb128-1868"></a>stats<span class="sc">::</span><span class="fu">cutree</span>(<span class="at">tree =</span> hc_fit<span class="sc">$</span>fit, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb128-1869"><a href="#cb128-1869"></a><span class="in">```</span></span>
<span id="cb128-1870"><a href="#cb128-1870"></a></span>
<span id="cb128-1871"><a href="#cb128-1871"></a>Alternatively, we can use <span class="co">[</span><span class="ot">`tidyclust::extract_fit_summary`</span><span class="co">](https://emilhvitfeldt.github.io/tidyclust/reference/extract_fit_summary.html)</span> as well.</span>
<span id="cb128-1872"><a href="#cb128-1872"></a></span>
<span id="cb128-1875"><a href="#cb128-1875"></a><span class="in">```{r}</span></span>
<span id="cb128-1876"><a href="#cb128-1876"></a>hc_summary <span class="ot">&lt;-</span> hc_fit <span class="sc">%&gt;%</span> </span>
<span id="cb128-1877"><a href="#cb128-1877"></a>  tidyclust<span class="sc">::</span><span class="fu">extract_fit_summary</span>() </span>
<span id="cb128-1878"><a href="#cb128-1878"></a><span class="in">```</span></span>
<span id="cb128-1879"><a href="#cb128-1879"></a></span>
<span id="cb128-1880"><a href="#cb128-1880"></a>Here is how you can do k-means clustering using <span class="co">[</span><span class="ot">`tidyclust::k_means`</span><span class="co">](https://emilhvitfeldt.github.io/tidyclust/reference/k_means.html)</span>.</span>
<span id="cb128-1881"><a href="#cb128-1881"></a></span>
<span id="cb128-1884"><a href="#cb128-1884"></a><span class="in">```{r}</span></span>
<span id="cb128-1885"><a href="#cb128-1885"></a>km_spec <span class="ot">&lt;-</span> tidyclust<span class="sc">::</span><span class="fu">k_means</span>(<span class="at">num_clusters =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-1886"><a href="#cb128-1886"></a>  parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">"stats"</span>, <span class="at">algorithm =</span> <span class="st">"Lloyd"</span>)</span>
<span id="cb128-1887"><a href="#cb128-1887"></a></span>
<span id="cb128-1888"><a href="#cb128-1888"></a>km_fit <span class="ot">&lt;-</span> km_spec <span class="sc">%&gt;%</span></span>
<span id="cb128-1889"><a href="#cb128-1889"></a>  tidyclust<span class="sc">::</span><span class="fu">fit</span>(label <span class="sc">~</span>.,<span class="at">data =</span> nci60_scaled)</span>
<span id="cb128-1890"><a href="#cb128-1890"></a></span>
<span id="cb128-1891"><a href="#cb128-1891"></a>km_summary <span class="ot">&lt;-</span> km_fit <span class="sc">%&gt;%</span> <span class="fu">extract_fit_summary</span>()</span>
<span id="cb128-1892"><a href="#cb128-1892"></a><span class="in">```</span></span>
<span id="cb128-1893"><a href="#cb128-1893"></a></span>
<span id="cb128-1894"><a href="#cb128-1894"></a><span class="in">`stats::predict`</span> returns the cluster a new observation belongs to</span>
<span id="cb128-1895"><a href="#cb128-1895"></a></span>
<span id="cb128-1898"><a href="#cb128-1898"></a><span class="in">```{r}</span></span>
<span id="cb128-1899"><a href="#cb128-1899"></a>km_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(km_fit, nci60_num_cluster, <span class="at">prefix =</span> <span class="st">"KM_"</span>)</span>
<span id="cb128-1900"><a href="#cb128-1900"></a>hc_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(hc_fit, nci60_num_cluster, <span class="at">prefix =</span> <span class="st">"HC_"</span>)</span>
<span id="cb128-1901"><a href="#cb128-1901"></a><span class="in">```</span></span>
<span id="cb128-1902"><a href="#cb128-1902"></a></span>
<span id="cb128-1903"><a href="#cb128-1903"></a>However, <span class="in">`stats::predict`</span> on the "training data" will not necessarily produce the same results as <span class="co">[</span><span class="ot">`tidyclust::extract_cluster_assignment`</span><span class="co">](https://emilhvitfeldt.github.io/tidyclust/reference/extract_cluster_assignment.html)</span></span>
<span id="cb128-1904"><a href="#cb128-1904"></a></span>
<span id="cb128-1907"><a href="#cb128-1907"></a><span class="in">```{r}</span></span>
<span id="cb128-1908"><a href="#cb128-1908"></a><span class="fu">cbind</span>(</span>
<span id="cb128-1909"><a href="#cb128-1909"></a>  hc_preds,</span>
<span id="cb128-1910"><a href="#cb128-1910"></a>  tidyclust<span class="sc">::</span><span class="fu">extract_cluster_assignment</span>(hc_fit),</span>
<span id="cb128-1911"><a href="#cb128-1911"></a>  nci60_scaled<span class="sc">$</span>label) <span class="sc">%&gt;%</span></span>
<span id="cb128-1912"><a href="#cb128-1912"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-1913"><a href="#cb128-1913"></a>  </span>
<span id="cb128-1914"><a href="#cb128-1914"></a><span class="in">```</span></span>
<span id="cb128-1915"><a href="#cb128-1915"></a></span>
<span id="cb128-1916"><a href="#cb128-1916"></a>We notice that the three-cluster assignments from hier_clust do not line up perfectly with the five-cluster assignments from k_means.</span>
<span id="cb128-1917"><a href="#cb128-1917"></a></span>
<span id="cb128-1920"><a href="#cb128-1920"></a><span class="in">```{r}</span></span>
<span id="cb128-1921"><a href="#cb128-1921"></a><span class="fu">tibble</span>(</span>
<span id="cb128-1922"><a href="#cb128-1922"></a>  <span class="at">hc =</span> hc_preds<span class="sc">$</span>.pred_cluster,</span>
<span id="cb128-1923"><a href="#cb128-1923"></a>  <span class="at">km =</span> km_preds<span class="sc">$</span>.pred_cluster</span>
<span id="cb128-1924"><a href="#cb128-1924"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1925"><a href="#cb128-1925"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(.data[[<span class="st">"hc"</span>]], .data[[<span class="st">"km"</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb128-1926"><a href="#cb128-1926"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>)</span>
<span id="cb128-1927"><a href="#cb128-1927"></a><span class="in">```</span></span>
<span id="cb128-1928"><a href="#cb128-1928"></a></span>
<span id="cb128-1929"><a href="#cb128-1929"></a><span class="in">`tidyclust`</span> also have a useful function called <span class="co">[</span><span class="ot">`tidyclust::reconcile_clusterings`</span><span class="co">](https://emilhvitfeldt.github.io/tidyclust/reference/reconcile_clusterings.html)</span> to match clusters from k-means with the clusters from hierarchical clustering.</span>
<span id="cb128-1930"><a href="#cb128-1930"></a></span>
<span id="cb128-1933"><a href="#cb128-1933"></a><span class="in">```{r}</span></span>
<span id="cb128-1934"><a href="#cb128-1934"></a>cluster_table <span class="ot">&lt;-</span> tidyclust<span class="sc">::</span><span class="fu">reconcile_clusterings</span>(</span>
<span id="cb128-1935"><a href="#cb128-1935"></a>  <span class="at">primary_cluster_assignment =</span> hc_preds<span class="sc">$</span>.pred_cluster, </span>
<span id="cb128-1936"><a href="#cb128-1936"></a>  <span class="at">alt_cluster_assignment =</span> km_preds<span class="sc">$</span>.pred_cluster,</span>
<span id="cb128-1937"><a href="#cb128-1937"></a>  <span class="at">one_to_one =</span> <span class="cn">FALSE</span></span>
<span id="cb128-1938"><a href="#cb128-1938"></a>)</span>
<span id="cb128-1939"><a href="#cb128-1939"></a></span>
<span id="cb128-1940"><a href="#cb128-1940"></a>cluster_table <span class="sc">%&gt;%</span></span>
<span id="cb128-1941"><a href="#cb128-1941"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">labels =</span> nci60_scaled<span class="sc">$</span>label) <span class="sc">%&gt;%</span></span>
<span id="cb128-1942"><a href="#cb128-1942"></a>  reactable<span class="sc">::</span><span class="fu">reactable</span>(<span class="at">defaultPageSize =</span> <span class="dv">5</span>,</span>
<span id="cb128-1943"><a href="#cb128-1943"></a>                       <span class="at">filterable =</span> <span class="cn">TRUE</span>)</span>
<span id="cb128-1944"><a href="#cb128-1944"></a></span>
<span id="cb128-1945"><a href="#cb128-1945"></a><span class="in">```</span></span>
<span id="cb128-1946"><a href="#cb128-1946"></a></span>
<span id="cb128-1947"><a href="#cb128-1947"></a>We can see that <span class="in">`KM_1`</span> and <span class="in">`KM_2`</span> is matched to <span class="in">`HC_1`</span>, <span class="in">`KM_3`</span> is matched to <span class="in">`HC_2`</span>, <span class="in">`KM_4`</span> and <span class="in">`KM_5`</span> is matched to <span class="in">`HC_3`</span>.</span>
<span id="cb128-1948"><a href="#cb128-1948"></a></span>
<span id="cb128-1949"><a href="#cb128-1949"></a><span class="fu"># Blog References</span></span>
<span id="cb128-1950"><a href="#cb128-1950"></a></span>
<span id="cb128-1951"><a href="#cb128-1951"></a><span class="ss">-   </span>Tengku Hanis's <span class="co">[</span><span class="ot">blog</span><span class="co">](https://tengkuhanis.netlify.app/post/explore-data-using-pca/)</span> titled "Explore data using PCA"</span>
<span id="cb128-1952"><a href="#cb128-1952"></a></span>
<span id="cb128-1953"><a href="#cb128-1953"></a><span class="ss">-   </span>Julia Silge's</span>
<span id="cb128-1954"><a href="#cb128-1954"></a>    <span class="co">[</span><span class="ot">blog</span><span class="co">](https://juliasilge.com/blog/cocktail-recipes-umap/)</span> titled</span>
<span id="cb128-1955"><a href="#cb128-1955"></a>    "PCA and UMAP with tidymodels and #TidyTuesday cocktail recipes"</span>
<span id="cb128-1956"><a href="#cb128-1956"></a>    </span>
<span id="cb128-1957"><a href="#cb128-1957"></a><span class="ss">-   </span>Julia Silge's <span class="co">[</span><span class="ot">blog</span><span class="co">](https://juliasilge.com/blog/kmeans-employment/)</span> titled "Getting started with k-means and #TidyTuesday employment status"</span>
<span id="cb128-1958"><a href="#cb128-1958"></a></span>
<span id="cb128-1959"><a href="#cb128-1959"></a><span class="ss">-   </span>Tidymodels' <span class="co">[</span><span class="ot">tutorial</span><span class="co">](https://www.tidymodels.org/learn/statistics/k-means/)</span> titled "K-means clustering with tidy data principles"</span>
<span id="cb128-1960"><a href="#cb128-1960"></a>    </span>
<span id="cb128-1961"><a href="#cb128-1961"></a><span class="ss">-   </span>Emil Hvitfeldt's ISLR tidymodels Labs <span class="co">[</span><span class="ot">Chapter 12</span><span class="co">](https://emilhvitfeldt.github.io/ISLR-tidymodels-labs/unsupervised-learning.html)</span></span>
<span id="cb128-1962"><a href="#cb128-1962"></a></span>
<span id="cb128-1963"><a href="#cb128-1963"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Eric (R_ic)</span><span class="co">](https://twitter.com/ericntay)</span> RPubs's <span class="co">[</span><span class="ot">post</span><span class="co">](https://rpubs.com/eR_ic/clustering)</span> titled "Train and Evaluate Clustering Models using Tidymodels and friends"</span>
<span id="cb128-1964"><a href="#cb128-1964"></a></span>
<span id="cb128-1965"><a href="#cb128-1965"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Chapter 21</span><span class="co">](https://bradleyboehmke.github.io/HOML/hierarchical.html)</span> Hierarchical Clustering from Hands-On Machine Learning with R</span>
<span id="cb128-1966"><a href="#cb128-1966"></a></span>
<span id="cb128-1967"><a href="#cb128-1967"></a><span class="fu"># Package References</span></span>
<span id="cb128-1968"><a href="#cb128-1968"></a></span>
<span id="cb128-1969"><a href="#cb128-1969"></a><span class="in">```{r results='asis'}</span></span>
<span id="cb128-1970"><a href="#cb128-1970"></a><span class="co">#| message: true</span></span>
<span id="cb128-1971"><a href="#cb128-1971"></a><span class="co">#| warning: false</span></span>
<span id="cb128-1972"><a href="#cb128-1972"></a></span>
<span id="cb128-1973"><a href="#cb128-1973"></a></span>
<span id="cb128-1974"><a href="#cb128-1974"></a>get_citation <span class="ot">&lt;-</span> <span class="cf">function</span>(package_name) {</span>
<span id="cb128-1975"><a href="#cb128-1975"></a>  transform_name <span class="ot">&lt;-</span> package_name <span class="sc">%&gt;%</span> </span>
<span id="cb128-1976"><a href="#cb128-1976"></a>    <span class="fu">citation</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb128-1977"><a href="#cb128-1977"></a>    <span class="fu">format</span>(<span class="at">style=</span><span class="st">"text"</span>)</span>
<span id="cb128-1978"><a href="#cb128-1978"></a>  <span class="fu">return</span>(transform_name[<span class="dv">1</span>])</span>
<span id="cb128-1979"><a href="#cb128-1979"></a>} </span>
<span id="cb128-1980"><a href="#cb128-1980"></a></span>
<span id="cb128-1981"><a href="#cb128-1981"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"base"</span>, <span class="st">"ggplot2"</span>, <span class="st">"rmarkdown"</span>, <span class="st">"cluster"</span>,</span>
<span id="cb128-1982"><a href="#cb128-1982"></a>              <span class="st">"report"</span>, <span class="st">"tidytext"</span>, <span class="st">"knitr"</span>, <span class="st">"broom"</span>,</span>
<span id="cb128-1983"><a href="#cb128-1983"></a>              <span class="st">"cowplot"</span>, <span class="st">"dplyr"</span>, <span class="st">"factoextra"</span>, <span class="st">"forcats"</span>,</span>
<span id="cb128-1984"><a href="#cb128-1984"></a>              <span class="st">"ggforce"</span>, <span class="st">"gridExtra"</span>, <span class="st">"htmltools"</span>, <span class="st">"ISLR2"</span>,</span>
<span id="cb128-1985"><a href="#cb128-1985"></a>              <span class="st">"magrittr"</span>, <span class="st">"Matrix"</span>, <span class="st">"parsnip"</span>, <span class="st">"proxy"</span>,</span>
<span id="cb128-1986"><a href="#cb128-1986"></a>              <span class="st">"purrr"</span>, <span class="st">"reactable"</span>, <span class="st">"reactablefmtr"</span>, <span class="st">"recipes"</span>,</span>
<span id="cb128-1987"><a href="#cb128-1987"></a>              <span class="st">"scales"</span>, <span class="st">"softImpute"</span>, <span class="st">"stringr"</span>, <span class="st">"styler"</span>,</span>
<span id="cb128-1988"><a href="#cb128-1988"></a>              <span class="st">"tibble"</span>, <span class="st">"tidyr"</span>, <span class="st">"yardstick"</span>, <span class="st">"tidyclust"</span>,</span>
<span id="cb128-1989"><a href="#cb128-1989"></a>              <span class="st">"rsample"</span>, <span class="st">"tune"</span>, <span class="st">"dials"</span>, <span class="st">"workflows"</span>,</span>
<span id="cb128-1990"><a href="#cb128-1990"></a>              <span class="st">"Rfast"</span>,<span class="st">"flexclust"</span>)</span>
<span id="cb128-1991"><a href="#cb128-1991"></a></span>
<span id="cb128-1992"><a href="#cb128-1992"></a>table <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">Packages =</span> packages)</span>
<span id="cb128-1993"><a href="#cb128-1993"></a></span>
<span id="cb128-1994"><a href="#cb128-1994"></a>table <span class="sc">%&gt;%</span></span>
<span id="cb128-1995"><a href="#cb128-1995"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb128-1996"><a href="#cb128-1996"></a>    <span class="at">transform_name =</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(.data[[<span class="st">"Packages"</span>]],</span>
<span id="cb128-1997"><a href="#cb128-1997"></a>                                    get_citation)</span>
<span id="cb128-1998"><a href="#cb128-1998"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1999"><a href="#cb128-1999"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(.data[[<span class="st">"transform_name"</span>]]) <span class="sc">%&gt;%</span> </span>
<span id="cb128-2000"><a href="#cb128-2000"></a>  report<span class="sc">::</span><span class="fu">as.report_parameters</span>()</span>
<span id="cb128-2001"><a href="#cb128-2001"></a></span>
<span id="cb128-2002"><a href="#cb128-2002"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



<script src="index_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>